import{$ as dy,$a as Ay,$b as ck,A as dI,Aa as sc,Ab as mo,Ac as Rk,B as Sv,Ba as yy,Bb as Gr,Bc as zk,C as uI,Ca as ky,Cb as fl,Cc as Ek,D as au,Da as _y,Db as bl,Dc as kM,E as Cv,Ea as hi,Eb as sf,Ec as cf,F as Uh,Fa as bu,Fb as Mu,Fc as Ak,G as Pv,Ga as Sy,Gb as tk,Gc as jr,H as Tv,Ha as LI,Hb as Bu,Hc as df,I as mI,Ia as Pt,Ib as ok,Ic as uf,J as Bv,Ja as Ur,Jb as qe,Jc as Dk,K as Rv,Ka as Xh,Kb as af,L as zv,La as OI,Lb as jt,M as Gh,Ma as Py,Mb as rk,N as Ev,Na as $I,Nb as iM,O as Av,Oa as Kh,Ob as ik,P as Lv,Pa as HI,Pb as nM,Q as lu,Qa as Zh,Qb as nk,R as ay,Ra as ml,Rb as sM,S as ly,Sa as Jh,Sb as sk,T as py,Ta as Ry,Tb as aM,U as cy,Ua as VI,Ub as ak,V as II,Va as yu,Vb as lM,W as At,Wa as zy,Wb as lk,X as MI,Xa as ku,Xb as pM,Y as Gt,Ya as Ey,Yb as pk,Z as BI,Za as Qh,Zb as cM,_ as mu,_a as ac,_b as lf,a as Ot,aa as uy,ab as Ly,ac as dM,b as Qd,ba as my,bb as UI,bc as dk,c as ur,ca as Ct,cb as Oy,cc as uM,d as eu,da as ic,db as $y,dc as uk,e as Oh,ea as Jt,eb as Hy,ec as mM,f as Nn,fa as Zs,fb as jI,fc as mk,g as Zp,ga as Yh,gb as Wt,gc as gM,h as tc,ha as gu,hb as fi,hc as ea,i as oI,ia as gy,ib as Yn,ic as gk,j as Vn,ja as Vo,jb as Cu,jc as hk,k as ou,ka as jn,kb as qy,kc as Ru,l as iv,la as hy,lb as JI,lc as fk,m as nv,ma as RI,mb as Pu,mc as bk,n as sv,na as hu,nb as Yy,nc as hM,o as mr,oa as fy,ob as Xy,oc as xk,p as wv,pa as by,pb as QI,pc as bM,q as xv,qa as gt,qb as Tu,qc as vk,r as sn,ra as zI,rb as Ky,rc as wM,s as iu,sa as fu,sb as Zy,sc as Pk,t as nu,ta as EI,tb as eM,tc as zu,u as cl,ua as wy,ub as hl,uc as Tk,v as vv,va as xy,vb as of,vc as Eo,w as yv,wa as vy,wb as nf,wc as Eu,x as kv,xa as Uo,xb as Jy,xc as Au,y as su,ya as nc,yb as Qy,yc as Lu,z as _v,za as AI,zb as rM,zc as Du}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-FP5F5ZJF.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-JHDNEZ2S.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-6APWM54Y.js";import{a as Lk}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-NYXUZSFM.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-6E4YLJ7N.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-WPBIRQKW.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-ANZRWSQG.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-A7H65XQR.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-3YXFYJDF.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-4MYEYIAD.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-3QYDYQGZ.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-SUHTPZQ6.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-37P4QJNM.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-AHEKDM56.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-SPXEDP4F.js";import{a as rt,b as By,c as Ir,d as Uy,e as XI,g as Su,h as Gy,j as tf}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-7FI2MDEW.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-BRWIKIOH.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-6EM36CHR.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-5SSPOSMM.js";import{B as cn,C as wu,a as Gs,b as js,c as Z0,d as pl,e as tu,f as Hh,g as J0,h as Fh,i as Q0,j as ev,k as tv,l as rn,m as ov,n as Ze,o as Wn,r as qs,s as an,t as Fi,u as Gn,v as Cy,w as DI}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-K7GTOQOF.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-J6PW46LN.js";import{a as $u}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-MYFPC7JL.js";import{a as co,b as Ds}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-J4PII53O.js";import{a as Fk}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-3VPDXFHB.js";import{a as Jd}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-DGUSNMI6.js";import{a as pc,b as Ou,e as Mr}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-SJHH7D4M.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-UTXQBMIU.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-RY2J4NJ5.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-C3P3T3ZH.js";import{c as Kd,d as j0,e as q0,f as Zd}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-62LT5M57.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-PMKFRLJQ.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-7J57LFAQ.js";import{a as Y0,b as X0,c as K0,d as ll,e as $h}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-42Z7F6OI.js";import{b as Hs,c as Ox,e as kh}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-4NOU5JI7.js";import{a as $k}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-ATZMAFYW.js";import{a as cI}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-OK7ZVC47.js";import{a as Hu,b as Ok,c as mf,e as Hk}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-BS2OULPH.js";import{A as fv,C as bv,E as pI,F as Js,G as gr,H as gl,N as Vy,O as YI,R as Iu,S as ek,d as pv,e as iI,f as cv,g as nI,h as dv,j as sI,p as uv,q as mv,r as aI,s as gv,u as hv,v as lI}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-6IF6WEHT.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-O6PMXHNM.js";import{c as wk,d as fM}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-GBQLNXB2.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-KX5WYF6X.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-2ZSJTEL4.js";import{d as yk,e as kk,f as _k,g as Sk,h as Ck}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-UZHQQPUO.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-FNDWQ47Z.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-AM4HY7V5.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-SIS6753J.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-UXXUTAF2.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-WSFDKSOA.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-KIUROP56.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-4S2I4DNX.js";import{a as Mv,b as Ft,c as Vr}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-F3FKT4PT.js";import{a as Iv,b as gI}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-4V3ZXIH7.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-NEJVYNVW.js";import{a as Ke,b as Wo}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-4L4MVWTZ.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-KD6JQRPN.js";import{i as av,j as rI}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-GSNLO72V.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-ZS6XDNRC.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-37UCGGLL.js";import{a as nn,b as Vh}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-R6B3OP4L.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-HRBY2TDI.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-EJVU6EON.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-NSZCLYYH.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-XAHWJCHM.js";import{a as xM}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-NKVKKLNB.js";import{a as Jp,b as Qp,c as Nh,d as rv,e as Pr,f as ec}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-GKNNYVJM.js";import{a as Qs,b as oM}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-ZK3SHDQZ.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-LHWUPDNK.js";import{d as tM}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-U2ER3OU7.js";import{a as lc,b as ZI}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-2W4X3IFD.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-MCNMUDIA.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-H5BBUEPP.js";import{a as Xn,b as rf}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-PHAF2BHA.js";import{l as Fy,m as Ny,n as qI,s as Wy,t as _u,u as ef}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-6K7I74ZB.js";import{a as Un,b as Wh}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-5PPLARRQ.js";import{a as My,d as WI}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-HJNGQYXW.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-BOE2DMZY.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-KS27YGZ2.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-O74DBT6I.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-32JIUN7D.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-E4ZD6KNZ.js";import{a as ru,b as lv}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-IJKSJUXI.js";import{a as Nk}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-D5NZH3V5.js";import{a as jy,b as KI}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-ALK2N4CS.js";import{A as jd,B as F0,C as N0,D as W0,E as qd,F as Ah,G as Lh,H as on,I as V0,J as tI,K as Yd,L as Fn,M as Xd,N as al,O as U0,Q as G0,U as Dh,a as Id,b as Ux,c as uo,d as Ns,e as _r,f as cr,g as Wd,h as On,i as Sr,j as $n,k as E0,l as Xp,m as er,n as Kp,v as Ud,w as L0,x as Ro,y as Hn,z as Cr}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-MXKCLDZQ.js";import{a as Vx,b as W6}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-6NLO373P.js";import{a as Di,b as Ap}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-L6D35ZLG.js";import{$ as il,A as gi,B as Rh,C as _0,D as S0,E as He,F as C0,G as Hd,H as Nr,I as tl,J as vt,K as zh,L as P0,N as ol,O as T0,P as Fd,Q as Yp,R as I0,S as pr,U as M0,Y as Z6,Z as ce,_ as rl,a as _h,aa as Ee,b as jx,ba as Nd,c as V6,ca as B0,d as Ja,da as Be,e as Od,f as u0,g as X6,h as m0,i as g0,j as h0,k as Mh,l as f0,m as b0,n as w0,o as x0,p as v0,q as y0,r as k0,s as K6,t as mi,x as Bh,y as Ht,z as el}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-NYP6MVJV.js";import{a as Op,b as qx}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-7YRHQMEY.js";import{b as a0,k as Y6}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-EHABWAQA.js";import{b as l0,i as $d,j as p0,k as c0,l as d0,p as Qa}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-66SX7DDZ.js";import{a as Mt,b as Za}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-E4VVBERU.js";import{a as Lt,b as tn}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-RR27C2AD.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-EJNEESKH.js";import{A as Yx,Bb as qp,Cb as Ph,Db as Th,Eb as i0,F as j6,H as Np,Hb as Dd,I as Wp,Ib as Ih,K as Vp,L as ja,N as Up,O as Gp,Ob as n0,Pb as s0,R as Kx,Wa as Ed,_a as Jx,bb as Qx,f as Sh,j as $p,jb as Ka,lb as Ad,m as U6,mb as e0,nb as t0,ob as Ld,pa as Rd,pb as o0,ra as Zx,rb as r0,sc as Us,x as G6}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-HPT5HZOQ.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-2QCUNMSR.js";import{a as dt,b as Fs}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-NXSNJ6QR.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-HKV6IKNB.js";import{a as Sd,b as Hx}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-NDFICHSQ.js";import{a as Hp,b as Ch,c as lr,d as Md}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-TMHGKZNS.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-EOLY4NUI.js";import{a as Ya,d as zd,e as Xa,g as Vs}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-WDL7WSUO.js";import{d as ta,e as Ik,f as pf,g as Mk,h as vM}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-YOOQ2ZL4.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-IVJ4PJPV.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-JCEEM47B.js";import{e as Dy,f as GI,t as Bk,u as yM}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-EMHVCPXB.js";import{$a as vI,Bb as Qv,Cb as CI,Ea as Uv,Fa as wI,Hb as ey,I as Ov,Ib as PI,L as $v,N as Hv,P as Fv,Q as Ys,Qa as cu,R as jh,Ra as xI,Sb as zo,Tb as Ks,Ub as Tr,Vb as rc,Y as Nt,Z as ln,_a as Gv,a as H0,ab as jv,b as eI,ea as pu,fa as Nv,fb as oc,gb as qv,gc as ty,hb as Xs,hc as uu,ia as Wv,ib as qh,ic as oy,ja as fI,jb as Yv,jc as ry,kb as yI,kc as iy,lb as du,lc as ny,ma as Vv,mb as Xv,mc as ul,na as bI,nb as Kv,nc as TI,ob as kI,oc as sy,rb as Zv,sb as _I,uc as pn,vb as Jv,vc as qn,w as Dv,wb as SI,wc as vu,x as hI}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-YCONWC7G.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-6SOTDXGG.js";import{c as FI,d as xu,e as Ty,f as Iy,g as NI}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-XCHJIBPF.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-234IQOQ6.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-GWH4CZ2Y.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-VEGICFTU.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-QAVZPT44.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-6L2BNAN4.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-O6PBIJCS.js";import{a as dl}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-52TYO376.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-O3RNL3YM.js";import{n as Ls,o as bh,q as ct,r as Ai}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-LKXLB67Q.js";import{a as Vd,b as A0}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-EFGNE3QK.js";import{a as O0,d as sl,g as St,h as Co}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-2ZFBD3G4.js";import{b as D0,c as Q6,d as nl,g as Eh}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-MAKLDF4X.js";import{a as Dt,b as No,h as R0,i as z0,k as Wr}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-DCENUA5W.js";import{a as Oi,b as Lp}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-FBEXWBLZ.js";import{a as $i,b as Dp}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-GAMN4PQE.js";import{a as Gd,b as $0}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-WOYM4PLU.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-XZFEMDXO.js";import{a as dr}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-HRC6U2FA.js";import{a as Ue,b as ge,j as $e}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-VFXE2PDF.js";import{a as mt,b as Fo}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-NOVVUOFA.js";import{a as yt,b as J6}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-O4X2ROJD.js";import{a as f,d as N}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-JCY75W2O.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-6RI4RMDR.js";import{b as Rp,d as he,e as kd,f as zx,g as se,l as je,m as Re,n as Ho,q as et,r as ui}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-2U7X3GPZ.js";import{a as Lx,b as Dx,g as H6}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-YARX3LKC.js";import{a as Mo}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-RNWCP5TE.js";import{f as $6,g as vd,h as ux,i as Bd,k as Hi,l as Fp,p as Xx,q as q6}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-IJTGJ2IJ.js";import"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-LRTZKHD5.js";import{b as Ep,d as $x,k as Oe,l as Bo}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-K7TOKHRB.js";import{A as xh,C as vh,D as So,a as gx,e as hx,g as wh,h as nt,k as yd,l as Os,p as fx,s as $s,t as bx,x as wx,y as xx}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-YS6PTYAT.js";import{a as Ex,b as _d,h as Ax}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-XPMBPAG6.js";import{a as yx,b as kx,c as _x,d as Sx,e as kr,f as Cx,h as Px,i as Tx,j as Ix,k as Mx,l as yh,m as Bx,n as Rx,p as zp}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-3TT6MLV5.js";import{a as ve,b as L,c as Ce,d as Gx,e as fe}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-NTV5DAJE.js";import{k as Le,l as zt,m as Me,o as en,p as Td,r as F,s as Li,v as oe}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-DRFHQBX2.js";import{a as jp}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-ZASSYVVQ.js";import{a as V,c as Ua,g as Ga,j as Ve,k as Qo,n as Fr,p as qa}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-D2IZAATT.js";import{c as Nx,d as F6,h as Wx,j as N6}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-XWPAC3IQ.js";import{a as Fx,c as ae,d as Cd,e as Pd}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-LNFZRNS4.js";import{C as q,D as a,E as w,F as k}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-MEBYNTO5.js";import{a as H}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-7W5M2OIM.js";import{a as Zt,b as Ws}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-2ZPCZLH5.js";import{a as vx,b as le,c as st}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-76ZHVWHH.js";import{b as Hr,c as ro,d as Ge,f as yr}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-HUFF5UNH.js";import{a as $t}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-SLJKSPNZ.js";import{b as pt}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-O337SNXT.js";import{a as mx}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-MN6RPB34.js";import{c as Va,d as dx}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-HYLSVIZW.js";import{b as Ye,d as B,f as z}from"https://st-p.rmcdn1.net/1ce0501a/dist/c/c-4KSVPGYT.js";var TS=Ye((tle,Hm)=>{"use strict";var SS={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u1EA4:"A",\u1EAE:"A",\u1EB2:"A",\u1EB4:"A",\u1EB6:"A",\u00C6:"AE",\u1EA6:"A",\u1EB0:"A",\u0202:"A",\u1EA2:"A",\u1EA0:"A",\u1EA8:"A",\u1EAA:"A",\u1EAC:"A",\u00C7:"C",\u1E08:"C",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u1EBE:"E",\u1E16:"E",\u1EC0:"E",\u1E14:"E",\u1E1C:"E",\u0206:"E",\u1EBA:"E",\u1EBC:"E",\u1EB8:"E",\u1EC2:"E",\u1EC4:"E",\u1EC6:"E",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u1E2E:"I",\u020A:"I",\u1EC8:"I",\u1ECA:"I",\u00D0:"D",\u00D1:"N",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u1ED0:"O",\u1E4C:"O",\u1E52:"O",\u020E:"O",\u1ECE:"O",\u1ECC:"O",\u1ED4:"O",\u1ED6:"O",\u1ED8:"O",\u1EDC:"O",\u1EDE:"O",\u1EE0:"O",\u1EDA:"O",\u1EE2:"O",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u1EE6:"U",\u1EE4:"U",\u1EEC:"U",\u1EEE:"U",\u1EF0:"U",\u00DD:"Y",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u1EA5:"a",\u1EAF:"a",\u1EB3:"a",\u1EB5:"a",\u1EB7:"a",\u00E6:"ae",\u1EA7:"a",\u1EB1:"a",\u0203:"a",\u1EA3:"a",\u1EA1:"a",\u1EA9:"a",\u1EAB:"a",\u1EAD:"a",\u00E7:"c",\u1E09:"c",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u1EBF:"e",\u1E17:"e",\u1EC1:"e",\u1E15:"e",\u1E1D:"e",\u0207:"e",\u1EBB:"e",\u1EBD:"e",\u1EB9:"e",\u1EC3:"e",\u1EC5:"e",\u1EC7:"e",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u1E2F:"i",\u020B:"i",\u1EC9:"i",\u1ECB:"i",\u00F0:"d",\u00F1:"n",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u1ED1:"o",\u1E4D:"o",\u1E53:"o",\u020F:"o",\u1ECF:"o",\u1ECD:"o",\u1ED5:"o",\u1ED7:"o",\u1ED9:"o",\u1EDD:"o",\u1EDF:"o",\u1EE1:"o",\u1EDB:"o",\u1EE3:"o",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u1EE7:"u",\u1EE5:"u",\u1EED:"u",\u1EEF:"u",\u1EF1:"u",\u00FD:"y",\u00FF:"y",\u0100:"A",\u0101:"a",\u0102:"A",\u0103:"a",\u0104:"A",\u0105:"a",\u0106:"C",\u0107:"c",\u0108:"C",\u0109:"c",\u010A:"C",\u010B:"c",\u010C:"C",\u010D:"c",C\u0306:"C",c\u0306:"c",\u010E:"D",\u010F:"d",\u0110:"D",\u0111:"d",\u0112:"E",\u0113:"e",\u0114:"E",\u0115:"e",\u0116:"E",\u0117:"e",\u0118:"E",\u0119:"e",\u011A:"E",\u011B:"e",\u011C:"G",\u01F4:"G",\u011D:"g",\u01F5:"g",\u011E:"G",\u011F:"g",\u0120:"G",\u0121:"g",\u0122:"G",\u0123:"g",\u0124:"H",\u0125:"h",\u0126:"H",\u0127:"h",\u1E2A:"H",\u1E2B:"h",\u0128:"I",\u0129:"i",\u012A:"I",\u012B:"i",\u012C:"I",\u012D:"i",\u012E:"I",\u012F:"i",\u0130:"I",\u0131:"i",\u0132:"IJ",\u0133:"ij",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u1E30:"K",\u1E31:"k",K\u0306:"K",k\u0306:"k",\u0139:"L",\u013A:"l",\u013B:"L",\u013C:"l",\u013D:"L",\u013E:"l",\u013F:"L",\u0140:"l",\u0141:"l",\u0142:"l",\u1E3E:"M",\u1E3F:"m",M\u0306:"M",m\u0306:"m",\u0143:"N",\u0144:"n",\u0145:"N",\u0146:"n",\u0147:"N",\u0148:"n",\u0149:"n",N\u0306:"N",n\u0306:"n",\u014C:"O",\u014D:"o",\u014E:"O",\u014F:"o",\u0150:"O",\u0151:"o",\u0152:"OE",\u0153:"oe",P\u0306:"P",p\u0306:"p",\u0154:"R",\u0155:"r",\u0156:"R",\u0157:"r",\u0158:"R",\u0159:"r",R\u0306:"R",r\u0306:"r",\u0212:"R",\u0213:"r",\u015A:"S",\u015B:"s",\u015C:"S",\u015D:"s",\u015E:"S",\u0218:"S",\u0219:"s",\u015F:"s",\u0160:"S",\u0161:"s",\u0162:"T",\u0163:"t",\u021B:"t",\u021A:"T",\u0164:"T",\u0165:"t",\u0166:"T",\u0167:"t",T\u0306:"T",t\u0306:"t",\u0168:"U",\u0169:"u",\u016A:"U",\u016B:"u",\u016C:"U",\u016D:"u",\u016E:"U",\u016F:"u",\u0170:"U",\u0171:"u",\u0172:"U",\u0173:"u",\u0216:"U",\u0217:"u",V\u0306:"V",v\u0306:"v",\u0174:"W",\u0175:"w",\u1E82:"W",\u1E83:"w",X\u0306:"X",x\u0306:"x",\u0176:"Y",\u0177:"y",\u0178:"Y",Y\u0306:"Y",y\u0306:"y",\u0179:"Z",\u017A:"z",\u017B:"Z",\u017C:"z",\u017D:"Z",\u017E:"z",\u017F:"s",\u0192:"f",\u01A0:"O",\u01A1:"o",\u01AF:"U",\u01B0:"u",\u01CD:"A",\u01CE:"a",\u01CF:"I",\u01D0:"i",\u01D1:"O",\u01D2:"o",\u01D3:"U",\u01D4:"u",\u01D5:"U",\u01D6:"u",\u01D7:"U",\u01D8:"u",\u01D9:"U",\u01DA:"u",\u01DB:"U",\u01DC:"u",\u1EE8:"U",\u1EE9:"u",\u1E78:"U",\u1E79:"u",\u01FA:"A",\u01FB:"a",\u01FC:"AE",\u01FD:"ae",\u01FE:"O",\u01FF:"o",\u00DE:"TH",\u00FE:"th",\u1E54:"P",\u1E55:"p",\u1E64:"S",\u1E65:"s",X\u0301:"X",x\u0301:"x",\u0403:"\u0413",\u0453:"\u0433",\u040C:"\u041A",\u045C:"\u043A",A\u030B:"A",a\u030B:"a",E\u030B:"E",e\u030B:"e",I\u030B:"I",i\u030B:"i",\u01F8:"N",\u01F9:"n",\u1ED2:"O",\u1ED3:"o",\u1E50:"O",\u1E51:"o",\u1EEA:"U",\u1EEB:"u",\u1E80:"W",\u1E81:"w",\u1EF2:"Y",\u1EF3:"y",\u0200:"A",\u0201:"a",\u0204:"E",\u0205:"e",\u0208:"I",\u0209:"i",\u020C:"O",\u020D:"o",\u0210:"R",\u0211:"r",\u0214:"U",\u0215:"u",B\u030C:"B",b\u030C:"b",\u010C\u0323:"C",\u010D\u0323:"c",\u00CA\u030C:"E",\u00EA\u030C:"e",F\u030C:"F",f\u030C:"f",\u01E6:"G",\u01E7:"g",\u021E:"H",\u021F:"h",J\u030C:"J",\u01F0:"j",\u01E8:"K",\u01E9:"k",M\u030C:"M",m\u030C:"m",P\u030C:"P",p\u030C:"p",Q\u030C:"Q",q\u030C:"q",\u0158\u0329:"R",\u0159\u0329:"r",\u1E66:"S",\u1E67:"s",V\u030C:"V",v\u030C:"v",W\u030C:"W",w\u030C:"w",X\u030C:"X",x\u030C:"x",Y\u030C:"Y",y\u030C:"y",A\u0327:"A",a\u0327:"a",B\u0327:"B",b\u0327:"b",\u1E10:"D",\u1E11:"d",\u0228:"E",\u0229:"e",\u0190\u0327:"E",\u025B\u0327:"e",\u1E28:"H",\u1E29:"h",I\u0327:"I",i\u0327:"i",\u0197\u0327:"I",\u0268\u0327:"i",M\u0327:"M",m\u0327:"m",O\u0327:"O",o\u0327:"o",Q\u0327:"Q",q\u0327:"q",U\u0327:"U",u\u0327:"u",X\u0327:"X",x\u0327:"x",Z\u0327:"Z",z\u0327:"z",\u0439:"\u0438",\u0419:"\u0418",\u0451:"\u0435",\u0401:"\u0415"},CS=Object.keys(SS).join("|"),y9=new RegExp(CS,"g"),k9=new RegExp(CS,"");function _9(e){return SS[e]}var PS=function(e){return e.replace(y9,_9)},S9=function(e){return!!e.match(k9)};Hm.exports=PS;Hm.exports.has=S9;Hm.exports.remove=PS});var Wb=Ye((aye,ag)=>{"use strict";(function(e){"use strict";typeof define=="function"&&define.amd?define(e):typeof ag<"u"&&typeof ag.exports<"u"?ag.exports=e():typeof Package<"u"?Sortable=e():window.Sortable=e()})(function(){"use strict";var e,o,t,r,i,n,s,l,c,d,p,m,u,g,h,b,x={},S,y,C,P=/\s+/g,v="Sortable"+new Date().getTime(),T=window,R=T.document,I=T.parseInt,M="draggable"in R.createElement("div"),D=function(O){return O=R.createElement("x"),O.style.cssText="pointer-events:auto",O.style.pointerEvents==="auto"}(),E=!1,A=Math.abs,$=[].slice,j=[],pe=Ae(function(O,U,Y){if(Y&&U.scroll){var re,Ne,ke=U.scrollSensitivity,Te=U.scrollSpeed,ut=O.clientX,Fe=O.clientY,wt=window.innerWidth,lt=window.innerHeight,xt,ot;if(c!==Y&&(l=U.scroll,c=Y,l===!0)){l=Y;do if(l.offsetWidth<l.scrollWidth||l.offsetHeight<l.scrollHeight)break;while(l=l.parentNode)}l&&(re=l,Ne=l.getBoundingClientRect(),xt=(A(Ne.right-ut)<=ke)-(A(Ne.left-ut)<=ke),ot=(A(Ne.bottom-Fe)<=ke)-(A(Ne.top-Fe)<=ke)),xt||ot||(xt=(wt-ut<=ke)-(ut<=ke),ot=(lt-Fe<=ke)-(Fe<=ke),(xt||ot)&&(re=T)),(x.vx!==xt||x.vy!==ot||x.el!==re)&&(x.el=re,x.vx=xt,x.vy=ot,clearInterval(x.pid),re&&(x.pid=setInterval(function(){re===T?T.scrollTo(T.pageXOffset+xt*Te,T.pageYOffset+ot*Te):(ot&&(re.scrollTop+=ot*Te),xt&&(re.scrollLeft+=xt*Te))},24)))}},30),ee=function(O){var U=O.group;(!U||typeof U!="object")&&(U=O.group={name:U}),["pull","put"].forEach(function(Y){Y in U||(U[Y]=!0)}),O.groups=" "+U.name+(U.put.join?" "+U.put.join(" "):"")+" "};function G(O,U){if(!(O&&O.nodeType&&O.nodeType===1))throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(O);this.el=O,this.options=U=Qe({},U),O[v]=this,O.sortable=this;var Y={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,startTheresold:5,scrollSpeed:10,draggable:/[uo]l/i.test(O.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",ignore:"a, img",filter:null,animation:0,setData:function(ke,Te){ke.setData("Text",Te.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,moveByBlock:!1};for(var re in Y)!(re in U)&&(U[re]=Y[re]);ee(U);for(var Ne in this)Ne.charAt(0)==="_"&&(this[Ne]=this[Ne].bind(this));this.nativeDraggable=U.forceFallback?!1:M,_e(O,"mousedown",this._onTapStart),_e(O,"touchstart",this._onTapStart),this.nativeDraggable&&(_e(O,"dragover",this),_e(O,"dragenter",this)),j.push(this._onDragOver),U.store&&this.sort(U.store.get(this))}G.prototype={constructor:G,dropIntoGroup:function(O){s=O},_onTapStart:function(O){var U=this,Y=this.el,re=this.options,Ne=O.type,ke=O.touches&&O.touches[0],Te=(ke||O).target,ut=Te,Fe=re.filter;if(!(Ne==="mousedown"&&O.button!==0||re.disabled)&&(Te=we(Te,re.draggable,Y),!!Te)){if(O.stopPropagation(),O.preventDefault(),u=be(Te),typeof Fe=="function"){if(Fe.call(this,O,Te,this)){X(U,ut,"filter",Te,Y,u),O.preventDefault();return}}else if(Fe&&(Fe=Fe.split(",").some(function(wt){if(wt=we(ut,wt.trim(),Y),wt)return X(U,wt,"filter",Te,Y,u),!0}),Fe)){O.preventDefault();return}re.handle&&!we(ut,re.handle,Y)||this._prepareDragStart(O,ke,Te)}},_prepareDragStart:function(O,U,Y){var re=this,Ne=re.el,ke=re.options,Te=Ne.ownerDocument,ut;if(Y&&!e&&Y.parentNode===Ne){S=O,i=Ne,e=Y,o=e.parentNode,n=e.nextSibling,b=ke.group;var ut=function(){re._disableDelayedDrag(),ze(e,re.options.chosenClass,!0),re._triggerDragStart(U)},Fe=function(xt){var ot=Math.sqrt(Math.pow(S.screenX-xt.screenX,2)+Math.pow(S.screenY-xt.screenY,2));ot>=ke.startTheresold&&(wt(),ut())},wt=function(){ie(Te,"mousemove",Fe),ie(Te,"mouseup",wt),ie(Te,"touchend",wt),ie(Te,"touchcancel",wt)};ke.ignore.split(",").forEach(function(xt){J(e,xt.trim(),te)}),_e(Te,"mouseup",re._onDrop),_e(Te,"touchend",re._onDrop),_e(Te,"touchcancel",re._onDrop),ke.delay&&(_e(Te,"mouseup",re._disableDelayedDrag),_e(Te,"touchend",re._disableDelayedDrag),_e(Te,"touchcancel",re._disableDelayedDrag),_e(Te,"mousemove",re._disableDelayedDrag),_e(Te,"touchmove",re._disableDelayedDrag),re._dragStartTimer=setTimeout(ut,ke.delay)),ke.startTheresold?(_e(Te,"mousemove",Fe),_e(Te,"mouseup",wt),_e(Te,"touchend",wt),_e(Te,"touchcancel",wt),_e(Te,"touchmove",wt)):ut()}},_disableDelayedDrag:function(){var O=this.el.ownerDocument;clearTimeout(this._dragStartTimer),ie(O,"mouseup",this._disableDelayedDrag),ie(O,"touchend",this._disableDelayedDrag),ie(O,"touchcancel",this._disableDelayedDrag),ie(O,"mousemove",this._disableDelayedDrag),ie(O,"touchmove",this._disableDelayedDrag)},_triggerDragStart:function(O){O?(S={target:e,clientX:O.clientX,clientY:O.clientY},this._onDragStart(S,"touch")):this.nativeDraggable?(_e(e,"dragend",this),_e(i,"dragstart",this._onDragStart)):this._onDragStart(S,!0);try{R.selection?R.selection.empty():window.getSelection().removeAllRanges()}catch{}this.dx=0,this.dy=0},_dragStarted:function(){if(i&&e){ze(e,this.options.ghostClass,!0),G.active=this;var O=X(this,i,"start",e,i,u);O.groupdrag&&(h=O.groupdrag)}},_emulateDragOver:function(){if(y){if(this._lastX===y.clientX&&this._lastY===y.clientY)return;this._lastX=y.clientX,this._lastY=y.clientY,D||ne(t,"display","none");var O=R.elementFromPoint(y.clientX,y.clientY),U=O,Y=" "+this.options.group.name,re=j.length;if(U)do{if(U[v]&&U[v].options.groups.indexOf(Y)>-1){for(;re--;)j[re]({clientX:y.clientX,clientY:y.clientY,target:O,rootEl:U});break}O=U}while(U=U.parentNode);D||ne(t,"display","")}},_onTouchMove:function(O){if(S){this._appendGhost(),G.active||this._dragStarted();var U=O.touches?O.touches[0]:O,Y=this.options,re=Y.denyX?0:U.clientX-S.clientX,Ne=Y.denyY?0:U.clientY-S.clientY,ke=this.dx,Te=this.dy,ut=(this.dx||0)-re,Fe=(this.dy||0)-Ne;if(this.options.onMoveGhost){var wt=this.options.onMoveGhost(t,ut,Fe,e);re=re+wt.dx,Ne=Ne+wt.dy}this.dx=re,this.dy=Ne;var lt=O.touches?"translate3d("+re+"px,"+Ne+"px,0)":"translate("+re+"px,"+Ne+"px)";C=!0,y=U,ne(t,"webkitTransform",lt),ne(t,"mozTransform",lt),ne(t,"msTransform",lt),ne(t,"transform",lt),e.cooldown=+new Date+400,O.preventDefault();var xt=X(this,i,"touchMove",t,null,null,null,{ghostOffsetX:re,ghostOffsetY:Ne,ghost:t,x:U.clientX,y:U.clientY,dx:ut,dy:Fe,dragEl:e,next:e.nextElementSibling,prev:e.previousElementSibling});if(Y.moveByBlock&&xt.result){var ot=xt.result.changeParent||e.parentNode||this.el,ai=Y.group,Ri=b===ai,zi=e.getBoundingClientRect();if(xt.result.toEmptyGroup){ot=xt.result.toEmptyGroup,Q(i,ot,e,zi,null,null)!==!1&&(e.contains(ot)||(ot.appendChild(e),o=ot),this._animate(zi,e),Rt&&this._animate(Do,Rt));return}var Rt=xt.result.target,Do=Rt.getBoundingClientRect(),Ln=function(ci){for(;ci;){if(ci.animated)return!0;ci=ci.parentNode}return!1};if(Ln(Rt))return;var li=Q(i,ot,e,zi,Rt,Do),Ei=li===void 0?xt.result.direction:li,Dn=Rt.nextElementSibling,Pp=Rt.offsetWidth>e.offsetWidth,bd=Rt.offsetHeight>e.offsetHeight,gh=Do.right-Do.left,hh=Do.bottom-Do.top,po=ne(Rt),Oo=ne(Rt.parentNode),$o=/left|right|inline/.test(po.cssFloat+po.display)||Oo.display=="flex"&&Oo["flex-direction"].indexOf("row")===0,pi=($o?(O.clientX-Do.left)/gh:(O.clientY-Do.top)/hh)>.5,wo;if(Ei!==!1){if(E=!0,setTimeout(ye,30),K(Ri),Ei===1||Ei===-1)wo=Ei===1;else if($o){var ar=e.offsetTop,vr=Rt.offsetTop;ar===vr?wo=Rt.previousElementSibling===e&&!Pp||pi&&Pp:wo=vr>ar}else wo=Dn!==e&&!bd||pi&&bd;e.contains(ot)||(wo&&!Dn?ot.appendChild(e):Rt.parentNode.insertBefore(e,wo?Dn:Rt)),o=e.parentNode,this._animate(zi,e),this._animate(Do,Rt)}}}},_appendGhost:function(){if(!t){var O=e.getBoundingClientRect(),U=ne(e),Y=this.options,re=i,Ne;if(t=e.cloneNode(!0),ze(t,Y.ghostClass,!1),ze(t,Y.fallbackClass,!0),Y.relParent){for(re=e;re&&re.className.indexOf(Y.relParent)==-1;)re=re.parentNode;re=re||i}var ke=re.getBoundingClientRect();if(Y.noFixedGhost){var Te=ne(re);ne(t,"top",O.top-I(U.marginTop,10)-ke.top-I(Te.marginTop,10)),ne(t,"left",O.left-I(U.marginLeft,10)-ke.left-I(Te.marginLeft,10)),ne(t,"position","absolute")}else ne(t,"top",O.top-I(U.marginTop,10)),ne(t,"left",ke.left),ne(t,"position","fixed");ne(t,"width",O.width),ne(t,"height",O.height),ne(t,"opacity","0.8"),ne(t,"zIndex","100000"),ne(t,"pointerEvents","none"),Y.fallbackOnBody&&R.body.appendChild(t)||re.appendChild(t),Ne=t.getBoundingClientRect(),ne(t,"width",O.width*2-Ne.width),ne(t,"height",O.height*2-Ne.height)}},_onDragStart:function(O,U){var Y=O.dataTransfer,re=this.options;this._offUpEvents(),b.pull=="clone"&&(r=e.cloneNode(!0),ne(r,"display","none"),i.insertBefore(r,e)),U?(U==="touch"?(_e(R,"touchmove",this._onTouchMove),_e(R,"touchend",this._onDrop),_e(R,"touchcancel",this._onDrop)):(_e(R,"mousemove",this._onTouchMove),_e(R,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,50)):(Y&&(Y.effectAllowed="move",re.setData&&re.setData.call(this,Y,e)),_e(R,"drop",this),setTimeout(this._dragStarted,0))},_onDragOver:function(O){var U=this.el,Y,re,Ne,ke=this.options,Te=ke.group,ut=Te.put,Fe=b===Te,wt=ke.sort;if(!ke.moveByBlock&&(O.preventDefault!==void 0&&(O.preventDefault(),!ke.dragoverBubble&&O.stopPropagation()),C=!0,b&&!ke.disabled&&(Fe?wt||(Ne=!i.contains(e)):b.pull&&ut&&(b.name===Te.name||ut.indexOf&&~ut.indexOf(b.name)))&&(O.rootEl===void 0||O.rootEl===this.el))){if(pe(O,ke,this.el),E)return;if(Y=we(O.target,ke.draggable,U),re=e.getBoundingClientRect(),Ne){K(!0),r||n?i.insertBefore(e,r||n):wt||i.appendChild(e);return}if(U.children.length===0||U.children[0]===t||U===O.target&&(Y=de(U,O))){if(Y){if(Y.animated)return;lt=Y.getBoundingClientRect()}K(Fe),Q(i,U,e,re,Y,lt)!==!1&&(e.contains(U)||(U.appendChild(e),o=U),this._animate(re,e),Y&&this._animate(lt,Y))}else if(Y&&!Y.animated&&Y!==e&&Y.parentNode[v]!==void 0){d!==Y&&(d=Y,p=ne(Y),m=ne(Y.parentNode));var lt=Y.getBoundingClientRect(),xt=lt.right-lt.left,ot=lt.bottom-lt.top,ai=/left|right|inline/.test(p.cssFloat+p.display)||m.display=="flex"&&m["flex-direction"].indexOf("row")===0,Ri=Y.offsetWidth>e.offsetWidth,zi=Y.offsetHeight>e.offsetHeight,Rt=(ai?(O.clientX-lt.left)/xt:(O.clientY-lt.top)/ot)>.5,Do=Y.nextElementSibling,Ln=Q(i,U,e,re,Y,lt),li;if(Ln!==!1){if(E=!0,setTimeout(ye,30),K(Fe),Ln===1||Ln===-1)li=Ln===1;else if(ai){var Ei=e.offsetTop,Dn=Y.offsetTop;Ei===Dn?li=Y.previousElementSibling===e&&!Ri||Rt&&Ri:li=Dn>Ei}else li=Do!==e&&!zi||Rt&&zi;e.contains(U)||(li&&!Do?U.appendChild(e):Y.parentNode.insertBefore(e,li?Do:Y)),o=e.parentNode,this._animate(re,e),this._animate(lt,Y)}}}},_animate:function(O,U){var Y=this.options.animation;if(Y){var re=U.getBoundingClientRect();ne(U,"transition","none"),ne(U,"transform","translate3d("+(O.left-re.left)+"px,"+(O.top-re.top)+"px,0)"),U.offsetWidth,ne(U,"transition","all "+Y+"ms"),ne(U,"transform","translate3d(0,0,0)"),clearTimeout(U.animated),U.animated=setTimeout(function(){ne(U,"transition",""),ne(U,"transform",""),U.animated=!1},Y)}},_offUpEvents:function(){var O=this.el.ownerDocument;ie(R,"touchmove",this._onTouchMove),ie(O,"mouseup",this._onDrop),ie(O,"touchend",this._onDrop),ie(O,"touchcancel",this._onDrop)},forceDrop:function(O,U){var Y=this.el,re=this.options;clearInterval(this._loopId),clearInterval(x.pid),clearTimeout(this._dragStartTimer),o=O,g=U,ie(R,"mousemove",this._onTouchMove),this.nativeDraggable&&(ie(R,"drop",this),ie(Y,"dragstart",this._onDragStart)),this._offUpEvents(),t&&t.parentNode&&t.parentNode.removeChild(t),e&&(this.nativeDraggable&&ie(e,"dragend",this),te(e),ze(e,this.options.ghostClass,!1),ze(e,this.options.chosenClass,!1),i===o?r&&r.parentNode.removeChild(r):g>=0&&(X(null,o,"sort",e,i,u,g),X(this,i,"sort",e,i,u,g),X(null,o,"add",e,i,u,g),X(this,i,"remove",e,i,u,g))),i=e=o=t=n=r=l=c=S=y=C=g=s=d=p=b=G.active=null},_onDrop:function(O){var U=this.el,Y=this.options;if(clearInterval(this._loopId),clearInterval(x.pid),clearTimeout(this._dragStartTimer),ie(R,"mousemove",this._onTouchMove),this.nativeDraggable&&(ie(R,"drop",this),ie(U,"dragstart",this._onDragStart)),this._offUpEvents(),O){if(C&&(O.preventDefault(),!Y.dropBubble&&O.stopPropagation()),t&&t.parentNode&&t.parentNode.removeChild(t),e){if(this.nativeDraggable&&ie(e,"dragend",this),te(e),ze(e,this.options.ghostClass,!1),ze(e,this.options.chosenClass,!1),!h)o=s||o,i!==o?(ke=be(e),ke>=0&&(X(null,o,"sort",e,i,u,ke,{draggedGroup:h}),X(this,i,"sort",e,i,u,ke,{draggedGroup:h}),X(null,o,"add",e,i,u,ke,{draggedGroup:h}),X(this,i,"remove",e,i,u,ke,{draggedGroup:h}))):(r&&r.parentNode.removeChild(r),e.nextSibling!==n&&(ke=be(e),ke>=0&&(X(this,i,"update",e,i,u,ke,{draggedGroup:h}),X(this,i,"sort",e,i,u,ke,{draggedGroup:h}))));else{var re=s||o||i,Ne=e.nextElementSibling,ke=be(e),Te,ut=!0;_.each(h,function(Fe,wt){var lt=Fe.el,xt=Fe.oldParent,ot=null;e!==lt?(ot={parent:lt.parentNode,before:lt.nextElementSibling},Ne?Ne.parentNode.insertBefore(lt,ut?e:Ne):re.appendChild(lt)):ut=!1,re==xt?(X(this,re,"update",lt,re,Fe.oldIndex,ke,{context:Fe.context,prevContext:Te,camebackTo:ot}),X(this,re,"sort",lt,re,Fe.oldIndex,ke,{context:Fe.context,prevContext:Te,camebackTo:ot})):(X(null,re,"sort",lt,re,Fe.oldIndex,ke,{context:Fe.context,prevContext:Te,camebackTo:ot}),X(this,xt,"sort",lt,re,Fe.oldIndex,ke,{context:Fe.context,prevContext:Te,camebackTo:ot}),X(null,re,"add",lt,re,Fe.oldIndex,ke,{context:Fe.context,prevContext:Te,camebackTo:ot}),X(this,xt,"remove",lt,re,Fe.oldIndex,ke,{context:Fe.context,prevContext:Te,camebackTo:ot})),Te=Fe.context})}G.active&&((ke===null||ke===-1)&&(ke=u),X(this,i,"end",e,i,u,ke),this.save())}i=e=o=t=n=r=l=c=h=s=S=y=C=ke=d=p=b=G.active=null}},handleEvent:function(O){var U=O.type;U==="dragover"||U==="dragenter"?e&&(this._onDragOver(O),xe(O)):(U==="drop"||U==="dragend")&&this._onDrop(O)},toArray:function(){for(var O=[],U,Y=this.el.children,re=0,Ne=Y.length,ke=this.options;re<Ne;re++)U=Y[re],we(U,ke.draggable,this.el)&&O.push(U.getAttribute(ke.dataIdAttr)||Se(U));return O},sort:function(O){var U={},Y=this.el;this.toArray().forEach(function(re,Ne){var ke=Y.children[Ne];we(ke,this.options.draggable,Y)&&(U[re]=ke)},this),O.forEach(function(re){U[re]&&(Y.removeChild(U[re]),Y.appendChild(U[re]))})},save:function(){var O=this.options.store;O&&O.set(this)},closest:function(O,U){return we(O,U||this.options.draggable,this.el)},option:function(O,U){var Y=this.options;if(U===void 0)return Y[O];Y[O]=U,O==="group"&&ee(Y)},destroy:function(){var O=this.el;O[v]=null,ie(O,"mousedown",this._onTapStart),ie(O,"touchstart",this._onTapStart),this.nativeDraggable&&(ie(O,"dragover",this),ie(O,"dragenter",this)),Array.prototype.forEach.call(O.querySelectorAll("[draggable]"),function(U){U.removeAttribute("draggable")}),j.splice(j.indexOf(this._onDragOver),1),this._onDrop(),this.el=O=null}};function K(O){r&&r.state!==O&&(ne(r,"display",O?"none":""),!O&&r.state&&i.insertBefore(r,e),r.state=O)}function we(O,U,Y){if(O){Y=Y||R,U=U.split(".");var re=U.shift().toUpperCase(),Ne=new RegExp("\\s("+U.join("|")+")(?=\\s)","g");do if(re===">*"&&O.parentNode===Y||(re===""||O.nodeName.toUpperCase()==re)&&(!U.length||((" "+O.className+" ").match(Ne)||[]).length==U.length))return O;while(O!==Y&&(O=O.parentNode))}return null}function xe(O){O.dataTransfer&&(O.dataTransfer.dropEffect="move"),O.preventDefault()}function _e(O,U,Y){O.addEventListener(U,Y,!1)}function ie(O,U,Y){O.removeEventListener(U,Y,!1)}function ze(O,U,Y){if(O)if(O.classList)O.classList[Y?"add":"remove"](U);else{var re=(" "+O.className+" ").replace(P," ").replace(" "+U+" "," ");O.className=(re+(Y?" "+U:"")).replace(P," ")}}function ne(O,U,Y){var re=O&&O.style;if(re){if(Y===void 0)return R.defaultView&&R.defaultView.getComputedStyle?Y=R.defaultView.getComputedStyle(O,""):O.currentStyle&&(Y=O.currentStyle),U===void 0?Y:Y[U];U in re||(U="-webkit-"+U),re[U]=Y+(typeof Y=="string"?"":"px")}}function J(O,U,Y){if(O){var re=O.getElementsByTagName(U),Ne=0,ke=re.length;if(Y)for(;Ne<ke;Ne++)Y(re[Ne],Ne);return re}return[]}function X(O,U,Y,re,Ne,ke,Te,ut){var Fe=R.createEvent("Event"),wt=(O||U[v]).options,lt="on"+Y.charAt(0).toUpperCase()+Y.substr(1);return Fe.initEvent(Y,!0,!0),Fe.to=U,Fe.from=Ne||U,Fe.item=re||U,Fe.clone=r,Fe.oldIndex=ke,Fe.newIndex=Te,Fe.data=ut,Fe.setDraggedGroup=function(xt){h=xt},Fe.getGhost=function(){return t},U.dispatchEvent(Fe),wt[lt]&&wt[lt].call(O,Fe),Fe}function Q(O,U,Y,re,Ne,ke){var Te,ut=O[v],Fe=ut.options.onMove,wt;return Te=R.createEvent("Event"),Te.initEvent("move",!0,!0),Te.to=U,Te.from=O,Te.dragged=Y,Te.draggedRect=re,Te.ghost=t,Te.related=Ne||U,Te.relatedRect=ke||U.getBoundingClientRect(),O.dispatchEvent(Te),Fe&&(wt=Fe.call(ut,Te)),wt}function te(O){O.draggable=!1}function ye(){E=!1}function de(O,U){var Y=O.lastElementChild,re=Y.getBoundingClientRect();return(U.clientY-(re.top+re.height)>5||U.clientX-(re.right+re.width)>5)&&Y}function Se(O){for(var U=O.tagName+O.className+O.src+O.href+O.textContent,Y=U.length,re=0;Y--;)re+=U.charCodeAt(Y);return re.toString(36)}function be(O){var U=0;if(!O||!O.parentNode)return-1;for(;O&&(O=O.previousElementSibling);)O.nodeName.toUpperCase()!=="TEMPLATE"&&U++;return U}function Ae(O,U){var Y,re;return function(){Y===void 0&&(Y=arguments,re=this,setTimeout(function(){Y.length===1?O.call(re,Y[0]):O.apply(re,Y),Y=void 0},U))}}function Qe(O,U){if(O&&U)for(var Y in U)U.hasOwnProperty(Y)&&(O[Y]=U[Y]);return O}return G.utils={on:_e,off:ie,css:ne,find:J,is:function(O,U){return!!we(O,U,O)},extend:Qe,throttle:Ae,closest:we,toggleClass:ze,index:be},G.create=function(O,U){return new G(O,U)},G.version="1.4.2",G})});var xr=Ye((G2e,Nc)=>{"use strict";function rL(e){return e&&e.__esModule?e:{default:e}}Nc.exports=rL,Nc.exports.__esModule=!0,Nc.exports.default=Nc.exports});var Wc=Ye((j2e,kn)=>{"use strict";function mw(e){"@babel/helpers - typeof";return kn.exports=mw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},kn.exports.__esModule=!0,kn.exports.default=kn.exports,mw(e)}kn.exports=mw,kn.exports.__esModule=!0,kn.exports.default=kn.exports});var lp=Ye((q2e,Vc)=>{"use strict";var iL=Wc().default;function FP(e){if(typeof WeakMap!="function")return null;var o=new WeakMap,t=new WeakMap;return(FP=function(i){return i?t:o})(e)}function nL(e,o){if(!o&&e&&e.__esModule)return e;if(e===null||iL(e)!="object"&&typeof e!="function")return{default:e};var t=FP(o);if(t&&t.has(e))return t.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var s=i?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}Vc.exports=nL,Vc.exports.__esModule=!0,Vc.exports.default=Vc.exports});var hw=Ye((Y2e,_n)=>{"use strict";function gw(){return _n.exports=gw=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},_n.exports.__esModule=!0,_n.exports.default=_n.exports,gw.apply(null,arguments)}_n.exports=gw,_n.exports.__esModule=!0,_n.exports.default=_n.exports});var pp=Ye((X2e,Uc)=>{"use strict";function sL(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}Uc.exports=sL,Uc.exports.__esModule=!0,Uc.exports.default=Uc.exports});var WP=Ye((K2e,Gc)=>{"use strict";var NP=Wc().default;function aL(e,o){if(NP(e)!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var r=t.call(e,o||"default");if(NP(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(e)}Gc.exports=aL,Gc.exports.__esModule=!0,Gc.exports.default=Gc.exports});var fw=Ye((Z2e,jc)=>{"use strict";var lL=Wc().default,pL=WP();function cL(e){var o=pL(e,"string");return lL(o)=="symbol"?o:o+""}jc.exports=cL,jc.exports.__esModule=!0,jc.exports.default=jc.exports});var cp=Ye((J2e,qc)=>{"use strict";var dL=fw();function VP(e,o){for(var t=0;t<o.length;t++){var r=o[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,dL(r.key),r)}}function uL(e,o,t){return o&&VP(e.prototype,o),t&&VP(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}qc.exports=uL,qc.exports.__esModule=!0,qc.exports.default=qc.exports});var Xc=Ye((Q2e,Yc)=>{"use strict";function mL(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Yc.exports=mL,Yc.exports.__esModule=!0,Yc.exports.default=Yc.exports});var Lg=Ye((e_e,Kc)=>{"use strict";var gL=Wc().default,hL=Xc();function fL(e,o){if(o&&(gL(o)=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hL(e)}Kc.exports=fL,Kc.exports.__esModule=!0,Kc.exports.default=Kc.exports});var Dg=Ye((t_e,Sn)=>{"use strict";function bw(e){return Sn.exports=bw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},Sn.exports.__esModule=!0,Sn.exports.default=Sn.exports,bw(e)}Sn.exports=bw,Sn.exports.__esModule=!0,Sn.exports.default=Sn.exports});var UP=Ye((o_e,Cn)=>{"use strict";function ww(e,o){return Cn.exports=ww=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Cn.exports.__esModule=!0,Cn.exports.default=Cn.exports,ww(e,o)}Cn.exports=ww,Cn.exports.__esModule=!0,Cn.exports.default=Cn.exports});var Og=Ye((r_e,Zc)=>{"use strict";var bL=UP();function wL(e,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),o&&bL(e,o)}Zc.exports=wL,Zc.exports.__esModule=!0,Zc.exports.default=Zc.exports});var dp=Ye((i_e,Jc)=>{"use strict";var xL=fw();function vL(e,o,t){return(o=xL(o))in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}Jc.exports=vL,Jc.exports.__esModule=!0,Jc.exports.default=Jc.exports});var vw=Ye((n_e,xw)=>{"use strict";function jP(e){var o,t,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e))for(o=0;o<e.length;o++)e[o]&&(t=jP(e[o]))&&(r&&(r+=" "),r+=t);else for(o in e)e[o]&&(r&&(r+=" "),r+=o);return r}function GP(){for(var e,o,t=0,r="";t<arguments.length;)(e=arguments[t++])&&(o=jP(e))&&(r&&(r+=" "),r+=o);return r}xw.exports=GP,xw.exports.clsx=GP});var qP=Ye(yw=>{"use strict";Object.defineProperty(yw,"__esModule",{value:!0});yw.default=yL;function yL(e){var o=e.cellCount,t=e.cellSize,r=e.computeMetadataCallback,i=e.computeMetadataCallbackProps,n=e.nextCellsCount,s=e.nextCellSize,l=e.nextScrollToIndex,c=e.scrollToIndex,d=e.updateScrollOffsetForScrollToIndex;(o!==n||(typeof t=="number"||typeof s=="number")&&t!==s)&&(r(i),c>=0&&c===l&&d())}});var YP=Ye((a_e,Qc)=>{"use strict";function kL(e,o){if(e==null)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(o.indexOf(r)>=0)continue;t[r]=e[r]}return t}Qc.exports=kL,Qc.exports.__esModule=!0,Qc.exports.default=Qc.exports});var XP=Ye((l_e,ed)=>{"use strict";var _L=YP();function SL(e,o){if(e==null)return{};var t,r,i=_L(e,o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)t=n[r],o.indexOf(t)>=0||{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}ed.exports=SL,ed.exports.__esModule=!0,ed.exports.default=ed.exports});var Pn=Ye(tt=>{"use strict";var KP=xr(),CL=lp();Object.defineProperty(tt,"__esModule",{value:!0});tt.bpfrpt_proptype_VisibleCellRange=tt.bpfrpt_proptype_Alignment=tt.bpfrpt_proptype_OverscanIndicesGetter=tt.bpfrpt_proptype_OverscanIndices=tt.bpfrpt_proptype_OverscanIndicesGetterParams=tt.bpfrpt_proptype_RenderedSection=tt.bpfrpt_proptype_ScrollbarPresenceChange=tt.bpfrpt_proptype_Scroll=tt.bpfrpt_proptype_NoContentRenderer=tt.bpfrpt_proptype_CellSize=tt.bpfrpt_proptype_CellSizeGetter=tt.bpfrpt_proptype_CellRangeRenderer=tt.bpfrpt_proptype_CellRangeRendererParams=tt.bpfrpt_proptype_StyleCache=tt.bpfrpt_proptype_CellCache=tt.bpfrpt_proptype_CellRenderer=tt.bpfrpt_proptype_CellRendererParams=tt.bpfrpt_proptype_CellPosition=void 0;var p_e=CL(H()),c_e=KP($g()),d_e=KP(dl()),PL=null;tt.bpfrpt_proptype_CellPosition=PL;var TL=null;tt.bpfrpt_proptype_CellRendererParams=TL;var IL=null;tt.bpfrpt_proptype_CellRenderer=IL;var ML=null;tt.bpfrpt_proptype_CellCache=ML;var BL=null;tt.bpfrpt_proptype_StyleCache=BL;var RL=null;tt.bpfrpt_proptype_CellRangeRendererParams=RL;var zL=null;tt.bpfrpt_proptype_CellRangeRenderer=zL;var EL=null;tt.bpfrpt_proptype_CellSizeGetter=EL;var AL=null;tt.bpfrpt_proptype_CellSize=AL;var LL=null;tt.bpfrpt_proptype_NoContentRenderer=LL;var DL=null;tt.bpfrpt_proptype_Scroll=DL;var OL=null;tt.bpfrpt_proptype_ScrollbarPresenceChange=OL;var $L=null;tt.bpfrpt_proptype_RenderedSection=$L;var HL=null;tt.bpfrpt_proptype_OverscanIndicesGetterParams=HL;var FL=null;tt.bpfrpt_proptype_OverscanIndices=FL;var NL=null;tt.bpfrpt_proptype_OverscanIndicesGetter=NL;var WL=null;tt.bpfrpt_proptype_Alignment=WL;var VL=null;tt.bpfrpt_proptype_VisibleCellRange=VL});var ZP=Ye(Hg=>{"use strict";var kw=xr();Object.defineProperty(Hg,"__esModule",{value:!0});Hg.default=void 0;var UL=kw(pp()),GL=kw(cp()),up=kw(dp()),m_e=Pn(),jL=function(){function e(o){var t=o.cellCount,r=o.cellSizeGetter,i=o.estimatedCellSize;(0,UL.default)(this,e),(0,up.default)(this,"_cellSizeAndPositionData",{}),(0,up.default)(this,"_lastMeasuredIndex",-1),(0,up.default)(this,"_lastBatchedIndex",-1),(0,up.default)(this,"_cellCount",void 0),(0,up.default)(this,"_cellSizeGetter",void 0),(0,up.default)(this,"_estimatedCellSize",void 0),this._cellSizeGetter=r,this._cellCount=t,this._estimatedCellSize=i}return(0,GL.default)(e,[{key:"areOffsetsAdjusted",value:function(){return!1}},{key:"configure",value:function(t){var r=t.cellCount,i=t.estimatedCellSize,n=t.cellSizeGetter;this._cellCount=r,this._estimatedCellSize=i,this._cellSizeGetter=n}},{key:"getCellCount",value:function(){return this._cellCount}},{key:"getEstimatedCellSize",value:function(){return this._estimatedCellSize}},{key:"getLastMeasuredIndex",value:function(){return this._lastMeasuredIndex}},{key:"getOffsetAdjustment",value:function(){return 0}},{key:"getSizeAndPositionOfCell",value:function(t){if(t<0||t>=this._cellCount)throw Error("Requested index ".concat(t," is outside of range 0..").concat(this._cellCount));if(t>this._lastMeasuredIndex)for(var r=this.getSizeAndPositionOfLastMeasuredCell(),i=r.offset+r.size,n=this._lastMeasuredIndex+1;n<=t;n++){var s=this._cellSizeGetter({index:n});if(s===void 0||isNaN(s))throw Error("Invalid size returned for cell ".concat(n," of value ").concat(s));s===null?(this._cellSizeAndPositionData[n]={offset:i,size:0},this._lastBatchedIndex=t):(this._cellSizeAndPositionData[n]={offset:i,size:s},i+=s,this._lastMeasuredIndex=t)}return this._cellSizeAndPositionData[t]}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function(){return this._lastMeasuredIndex>=0?this._cellSizeAndPositionData[this._lastMeasuredIndex]:{offset:0,size:0}}},{key:"getTotalSize",value:function(){var t=this.getSizeAndPositionOfLastMeasuredCell(),r=t.offset+t.size,i=this._cellCount-this._lastMeasuredIndex-1,n=i*this._estimatedCellSize;return r+n}},{key:"getUpdatedOffsetForIndex",value:function(t){var r=t.align,i=r===void 0?"auto":r,n=t.containerSize,s=t.currentOffset,l=t.targetIndex;if(n<=0)return 0;var c=this.getSizeAndPositionOfCell(l),d=c.offset,p=d-n+c.size,m;switch(i){case"start":m=d;break;case"end":m=p;break;case"center":m=d-(n-c.size)/2;break;default:m=Math.max(p,Math.min(d,s));break}var u=this.getTotalSize();return Math.max(0,Math.min(u-n,m))}},{key:"getVisibleCellRange",value:function(t){var r=t.containerSize,i=t.offset,n=this.getTotalSize();if(n===0)return{};var s=i+r,l=this._findNearestCell(i),c=this.getSizeAndPositionOfCell(l);i=c.offset+c.size;for(var d=l;i<s&&d<this._cellCount-1;)d++,i+=this.getSizeAndPositionOfCell(d).size;return{start:l,stop:d}}},{key:"resetCell",value:function(t){this._lastMeasuredIndex=Math.min(this._lastMeasuredIndex,t-1)}},{key:"_binarySearch",value:function(t,r,i){for(;r<=t;){var n=r+Math.floor((t-r)/2),s=this.getSizeAndPositionOfCell(n).offset;if(s===i)return n;s<i?r=n+1:s>i&&(t=n-1)}return r>0?r-1:0}},{key:"_exponentialSearch",value:function(t,r){for(var i=1;t<this._cellCount&&this.getSizeAndPositionOfCell(t).offset<r;)t+=i,i*=2;return this._binarySearch(Math.min(t,this._cellCount-1),Math.floor(t/2),r)}},{key:"_findNearestCell",value:function(t){if(isNaN(t))throw Error("Invalid offset ".concat(t," specified"));t=Math.max(0,t);var r=this.getSizeAndPositionOfLastMeasuredCell(),i=Math.max(0,this._lastMeasuredIndex);return r.offset>=t?this._binarySearch(i,0,t):this._exponentialSearch(i,t)}}]),e}();Hg.default=jL});var JP=Ye(Fg=>{"use strict";Object.defineProperty(Fg,"__esModule",{value:!0});Fg.getMaxElementSize=void 0;var qL=15e5,YL=16777100,XL=function(){return typeof window<"u"},KL=function(){return!!window.chrome},ZL=function(){return XL()&&KL()?YL:qL};Fg.getMaxElementSize=ZL});var $g=Ye(Ng=>{"use strict";var td=xr();Object.defineProperty(Ng,"__esModule",{value:!0});Ng.default=void 0;var JL=td(XP()),QL=td(pp()),eD=td(cp()),QP=td(dp()),tD=td(ZP()),oD=JP(),f_e=Pn(),rD=function(){function e(o){var t=o.maxScrollSize,r=t===void 0?(0,oD.getMaxElementSize)():t,i=(0,JL.default)(o,["maxScrollSize"]);(0,QL.default)(this,e),(0,QP.default)(this,"_cellSizeAndPositionManager",void 0),(0,QP.default)(this,"_maxScrollSize",void 0),this._cellSizeAndPositionManager=new tD.default(i),this._maxScrollSize=r}return(0,eD.default)(e,[{key:"areOffsetsAdjusted",value:function(){return this._cellSizeAndPositionManager.getTotalSize()>this._maxScrollSize}},{key:"configure",value:function(t){this._cellSizeAndPositionManager.configure(t)}},{key:"getCellCount",value:function(){return this._cellSizeAndPositionManager.getCellCount()}},{key:"getEstimatedCellSize",value:function(){return this._cellSizeAndPositionManager.getEstimatedCellSize()}},{key:"getLastMeasuredIndex",value:function(){return this._cellSizeAndPositionManager.getLastMeasuredIndex()}},{key:"getOffsetAdjustment",value:function(t){var r=t.containerSize,i=t.offset,n=this._cellSizeAndPositionManager.getTotalSize(),s=this.getTotalSize(),l=this._getOffsetPercentage({containerSize:r,offset:i,totalSize:s});return Math.round(l*(s-n))}},{key:"getSizeAndPositionOfCell",value:function(t){return this._cellSizeAndPositionManager.getSizeAndPositionOfCell(t)}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function(){return this._cellSizeAndPositionManager.getSizeAndPositionOfLastMeasuredCell()}},{key:"getTotalSize",value:function(){return Math.min(this._maxScrollSize,this._cellSizeAndPositionManager.getTotalSize())}},{key:"getUpdatedOffsetForIndex",value:function(t){var r=t.align,i=r===void 0?"auto":r,n=t.containerSize,s=t.currentOffset,l=t.targetIndex;s=this._safeOffsetToOffset({containerSize:n,offset:s});var c=this._cellSizeAndPositionManager.getUpdatedOffsetForIndex({align:i,containerSize:n,currentOffset:s,targetIndex:l});return this._offsetToSafeOffset({containerSize:n,offset:c})}},{key:"getVisibleCellRange",value:function(t){var r=t.containerSize,i=t.offset;return i=this._safeOffsetToOffset({containerSize:r,offset:i}),this._cellSizeAndPositionManager.getVisibleCellRange({containerSize:r,offset:i})}},{key:"resetCell",value:function(t){this._cellSizeAndPositionManager.resetCell(t)}},{key:"_getOffsetPercentage",value:function(t){var r=t.containerSize,i=t.offset,n=t.totalSize;return n<=r?0:i/(n-r)}},{key:"_offsetToSafeOffset",value:function(t){var r=t.containerSize,i=t.offset,n=this._cellSizeAndPositionManager.getTotalSize(),s=this.getTotalSize();if(n===s)return i;var l=this._getOffsetPercentage({containerSize:r,offset:i,totalSize:n});return Math.round(l*(s-r))}},{key:"_safeOffsetToOffset",value:function(t){var r=t.containerSize,i=t.offset,n=this._cellSizeAndPositionManager.getTotalSize(),s=this.getTotalSize();if(n===s)return i;var l=this._getOffsetPercentage({containerSize:r,offset:i,totalSize:s});return Math.round(l*(n-r))}}]),e}();Ng.default=rD});var e3=Ye(_w=>{"use strict";Object.defineProperty(_w,"__esModule",{value:!0});_w.default=iD;function iD(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,o={};return function(t){var r=t.callback,i=t.indices,n=Object.keys(i),s=!e||n.every(function(c){var d=i[c];return Array.isArray(d)?d.length>0:d>=0}),l=n.length!==Object.keys(o).length||n.some(function(c){var d=o[c],p=i[c];return Array.isArray(p)?d.join(",")!==p.join(","):d!==p});o=i,s&&l&&r(i)}}});var Sw=Ye(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});Ii.default=lD;Ii.SCROLL_DIRECTION_VERTICAL=Ii.SCROLL_DIRECTION_HORIZONTAL=Ii.SCROLL_DIRECTION_FORWARD=Ii.SCROLL_DIRECTION_BACKWARD=void 0;var x_e=Pn(),nD=-1;Ii.SCROLL_DIRECTION_BACKWARD=nD;var t3=1;Ii.SCROLL_DIRECTION_FORWARD=t3;var sD="horizontal";Ii.SCROLL_DIRECTION_HORIZONTAL=sD;var aD="vertical";Ii.SCROLL_DIRECTION_VERTICAL=aD;function lD(e){var o=e.cellCount,t=e.overscanCellsCount,r=e.scrollDirection,i=e.startIndex,n=e.stopIndex;return r===t3?{overscanStartIndex:Math.max(0,i),overscanStopIndex:Math.min(o-1,n+t)}:{overscanStartIndex:Math.max(0,i-t),overscanStopIndex:Math.min(o-1,n)}}});var o3=Ye(Cw=>{"use strict";var pD=xr();Object.defineProperty(Cw,"__esModule",{value:!0});Cw.default=cD;var y_e=pD($g()),k_e=Pn();function cD(e){var o=e.cellSize,t=e.cellSizeAndPositionManager,r=e.previousCellsCount,i=e.previousCellSize,n=e.previousScrollToAlignment,s=e.previousScrollToIndex,l=e.previousSize,c=e.scrollOffset,d=e.scrollToAlignment,p=e.scrollToIndex,m=e.size,u=e.sizeJustIncreasedFromZero,g=e.updateScrollIndexCallback,h=t.getCellCount(),b=p>=0&&p<h,x=m!==l||u||!i||typeof o=="number"&&o!==i;b&&(x||d!==n||p!==s)?g(p):!b&&h>0&&(m<l||h<r)&&c>t.getTotalSize()-m&&g(h-1)}});var Tw=Ye(Pw=>{"use strict";Object.defineProperty(Pw,"__esModule",{value:!0});Pw.default=dD;var S_e=Pn();function dD(e){for(var o=e.cellCache,t=e.cellRenderer,r=e.columnSizeAndPositionManager,i=e.columnStartIndex,n=e.columnStopIndex,s=e.deferredMeasurementCache,l=e.horizontalOffsetAdjustment,c=e.isScrolling,d=e.isScrollingOptOut,p=e.parent,m=e.rowSizeAndPositionManager,u=e.rowStartIndex,g=e.rowStopIndex,h=e.styleCache,b=e.verticalOffsetAdjustment,x=e.visibleColumnIndices,S=e.visibleRowIndices,y=[],C=r.areOffsetsAdjusted()||m.areOffsetsAdjusted(),P=!c&&!C,v=u;v<=g;v++)for(var T=m.getSizeAndPositionOfCell(v),R=i;R<=n;R++){var I=r.getSizeAndPositionOfCell(R),M=R>=x.start&&R<=x.stop&&v>=S.start&&v<=S.stop,D="".concat(v,"-").concat(R),E=void 0;P&&h[D]?E=h[D]:s&&!s.has(v,R)?E={height:"auto",left:0,position:"absolute",top:0,width:"auto"}:(E={height:T.size,left:I.offset+l,position:"absolute",top:T.offset+b,width:I.size},h[D]=E);var A={columnIndex:R,isScrolling:c,isVisible:M,key:D,parent:p,rowIndex:v,style:E},$=void 0;(d||c)&&!l&&!b?(o[D]||(o[D]=t(A)),$=o[D]):$=t(A),!($==null||$===!1)&&y.push($)}return y}});var i3=Ye((od,r3)=>{"use strict";od.__esModule=!0;od.default=void 0;var uD=!!(typeof window<"u"&&window.document&&window.document.createElement);od.default=uD;r3.exports=od.default});var s3=Ye((Vg,n3)=>{"use strict";var mD=xr();Vg.__esModule=!0;Vg.default=hD;var gD=mD(i3()),Wg;function hD(e){if((!Wg&&Wg!==0||e)&&gD.default){var o=document.createElement("div");o.style.position="absolute",o.style.top="-9999px",o.style.width="50px",o.style.height="50px",o.style.overflow="scroll",document.body.appendChild(o),Wg=o.offsetWidth-o.clientWidth,document.body.removeChild(o)}return Wg}n3.exports=Vg.default});var c3=Ye(Iw=>{"use strict";Object.defineProperty(Iw,"__esModule",{value:!0});function a3(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);e!=null&&this.setState(e)}function l3(e){function o(t){var r=this.constructor.getDerivedStateFromProps(e,t);return r??null}this.setState(o.bind(this))}function p3(e,o){try{var t=this.props,r=this.state;this.props=e,this.state=o,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(t,r)}finally{this.props=t,this.state=r}}a3.__suppressDeprecationWarning=!0;l3.__suppressDeprecationWarning=!0;p3.__suppressDeprecationWarning=!0;function fD(e){var o=e.prototype;if(!o||!o.isReactComponent)throw new Error("Can only polyfill class components");if(typeof e.getDerivedStateFromProps!="function"&&typeof o.getSnapshotBeforeUpdate!="function")return e;var t=null,r=null,i=null;if(typeof o.componentWillMount=="function"?t="componentWillMount":typeof o.UNSAFE_componentWillMount=="function"&&(t="UNSAFE_componentWillMount"),typeof o.componentWillReceiveProps=="function"?r="componentWillReceiveProps":typeof o.UNSAFE_componentWillReceiveProps=="function"&&(r="UNSAFE_componentWillReceiveProps"),typeof o.componentWillUpdate=="function"?i="componentWillUpdate":typeof o.UNSAFE_componentWillUpdate=="function"&&(i="UNSAFE_componentWillUpdate"),t!==null||r!==null||i!==null){var n=e.displayName||e.name,s=typeof e.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

`+n+" uses "+s+" but also contains the following legacy lifecycles:"+(t!==null?`
  `+t:"")+(r!==null?`
  `+r:"")+(i!==null?`
  `+i:"")+`

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-async-component-lifecycle-hooks`)}if(typeof e.getDerivedStateFromProps=="function"&&(o.componentWillMount=a3,o.componentWillReceiveProps=l3),typeof o.getSnapshotBeforeUpdate=="function"){if(typeof o.componentDidUpdate!="function")throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");o.componentWillUpdate=p3;var l=o.componentDidUpdate;o.componentDidUpdate=function(d,p,m){var u=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:m;l.call(this,d,p,u)}}return e}Iw.polyfill=fD});var d3=Ye(mp=>{"use strict";Object.defineProperty(mp,"__esModule",{value:!0});mp.caf=mp.raf=void 0;var ir;typeof window<"u"?ir=window:typeof self<"u"?ir=self:ir={};var bD=ir.requestAnimationFrame||ir.webkitRequestAnimationFrame||ir.mozRequestAnimationFrame||ir.oRequestAnimationFrame||ir.msRequestAnimationFrame||function(e){return ir.setTimeout(e,1e3/60)},wD=ir.cancelAnimationFrame||ir.webkitCancelAnimationFrame||ir.mozCancelAnimationFrame||ir.oCancelAnimationFrame||ir.msCancelAnimationFrame||function(e){ir.clearTimeout(e)},xD=bD;mp.raf=xD;var vD=wD;mp.caf=vD});var u3=Ye(Ss=>{"use strict";var yD=xr();Object.defineProperty(Ss,"__esModule",{value:!0});Ss.bpfrpt_proptype_AnimationTimeoutId=Ss.requestAnimationTimeout=Ss.cancelAnimationTimeout=void 0;var Mw=d3(),I_e=yD(dl()),kD=null;Ss.bpfrpt_proptype_AnimationTimeoutId=kD;var _D=function(o){return(0,Mw.caf)(o.id)};Ss.cancelAnimationTimeout=_D;var SD=function(o,t){var r;Promise.resolve().then(function(){r=Date.now()});var i=function s(){Date.now()-r>=t?o.call():n.id=(0,Mw.raf)(s)},n={id:(0,Mw.raf)(i)};return n};Ss.requestAnimationTimeout=SD});var k3=Ye(gp=>{"use strict";var Yo=xr(),v3=lp();Object.defineProperty(gp,"__esModule",{value:!0});gp.default=gp.DEFAULT_SCROLLING_RESET_TIME_INTERVAL=void 0;var CD=Yo(hw()),PD=Yo(pp()),TD=Yo(cp()),ID=Yo(Lg()),MD=Yo(Dg()),Bt=Yo(Xc()),BD=Yo(Og()),_t=Yo(dp()),Bw=v3(H()),RD=Yo(vw()),m3=Yo(qP()),g3=Yo($g()),h3=Yo(e3()),Dr=v3(Sw()),f3=Yo(o3()),zD=Yo(Tw()),ED=Yo(s3()),AD=c3(),Rw=u3(),B_e=Pn(),R_e=Yo(dl()),b3,w3;function x3(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);o&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,r)}return t}function Ra(e){for(var o=1;o<arguments.length;o++){var t=arguments[o]!=null?arguments[o]:{};o%2?x3(t,!0).forEach(function(r){(0,_t.default)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):x3(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var y3=150;gp.DEFAULT_SCROLLING_RESET_TIME_INTERVAL=y3;var zw={OBSERVED:"observed",REQUESTED:"requested"},LD=function(){return null},Ew=(w3=b3=function(e){(0,BD.default)(o,e);function o(t){var r;(0,PD.default)(this,o),r=(0,ID.default)(this,(0,MD.default)(o).call(this,t)),(0,_t.default)((0,Bt.default)(r),"_onGridRenderedMemoizer",(0,h3.default)()),(0,_t.default)((0,Bt.default)(r),"_onScrollMemoizer",(0,h3.default)(!1)),(0,_t.default)((0,Bt.default)(r),"_deferredInvalidateColumnIndex",null),(0,_t.default)((0,Bt.default)(r),"_deferredInvalidateRowIndex",null),(0,_t.default)((0,Bt.default)(r),"_recomputeScrollLeftFlag",!1),(0,_t.default)((0,Bt.default)(r),"_recomputeScrollTopFlag",!1),(0,_t.default)((0,Bt.default)(r),"_horizontalScrollBarSize",0),(0,_t.default)((0,Bt.default)(r),"_verticalScrollBarSize",0),(0,_t.default)((0,Bt.default)(r),"_scrollbarPresenceChanged",!1),(0,_t.default)((0,Bt.default)(r),"_scrollingContainer",void 0),(0,_t.default)((0,Bt.default)(r),"_childrenToDisplay",void 0),(0,_t.default)((0,Bt.default)(r),"_columnStartIndex",void 0),(0,_t.default)((0,Bt.default)(r),"_columnStopIndex",void 0),(0,_t.default)((0,Bt.default)(r),"_rowStartIndex",void 0),(0,_t.default)((0,Bt.default)(r),"_rowStopIndex",void 0),(0,_t.default)((0,Bt.default)(r),"_renderedColumnStartIndex",0),(0,_t.default)((0,Bt.default)(r),"_renderedColumnStopIndex",0),(0,_t.default)((0,Bt.default)(r),"_renderedRowStartIndex",0),(0,_t.default)((0,Bt.default)(r),"_renderedRowStopIndex",0),(0,_t.default)((0,Bt.default)(r),"_initialScrollTop",void 0),(0,_t.default)((0,Bt.default)(r),"_initialScrollLeft",void 0),(0,_t.default)((0,Bt.default)(r),"_disablePointerEventsTimeoutId",void 0),(0,_t.default)((0,Bt.default)(r),"_styleCache",{}),(0,_t.default)((0,Bt.default)(r),"_cellCache",{}),(0,_t.default)((0,Bt.default)(r),"_debounceScrollEndedCallback",function(){r._disablePointerEventsTimeoutId=null,r.setState({isScrolling:!1,needToResetStyleCache:!1})}),(0,_t.default)((0,Bt.default)(r),"_invokeOnGridRenderedHelper",function(){var s=r.props.onSectionRendered;r._onGridRenderedMemoizer({callback:s,indices:{columnOverscanStartIndex:r._columnStartIndex,columnOverscanStopIndex:r._columnStopIndex,columnStartIndex:r._renderedColumnStartIndex,columnStopIndex:r._renderedColumnStopIndex,rowOverscanStartIndex:r._rowStartIndex,rowOverscanStopIndex:r._rowStopIndex,rowStartIndex:r._renderedRowStartIndex,rowStopIndex:r._renderedRowStopIndex}})}),(0,_t.default)((0,Bt.default)(r),"_setScrollingContainerRef",function(s){r._scrollingContainer=s}),(0,_t.default)((0,Bt.default)(r),"_onScroll",function(s){s.target===r._scrollingContainer&&r.handleScrollEvent(s.target)});var i=new g3.default({cellCount:t.columnCount,cellSizeGetter:function(l){return o._wrapSizeGetter(t.columnWidth)(l)},estimatedCellSize:o._getEstimatedColumnSize(t)}),n=new g3.default({cellCount:t.rowCount,cellSizeGetter:function(l){return o._wrapSizeGetter(t.rowHeight)(l)},estimatedCellSize:o._getEstimatedRowSize(t)});return r.state={instanceProps:{columnSizeAndPositionManager:i,rowSizeAndPositionManager:n,prevColumnWidth:t.columnWidth,prevRowHeight:t.rowHeight,prevColumnCount:t.columnCount,prevRowCount:t.rowCount,prevIsScrolling:t.isScrolling===!0,prevScrollToColumn:t.scrollToColumn,prevScrollToRow:t.scrollToRow,scrollbarSize:0,scrollbarSizeMeasured:!1},isScrolling:!1,scrollDirectionHorizontal:Dr.SCROLL_DIRECTION_FORWARD,scrollDirectionVertical:Dr.SCROLL_DIRECTION_FORWARD,scrollLeft:0,scrollTop:0,scrollPositionChangeReason:null,needToResetStyleCache:!1},t.scrollToRow>0&&(r._initialScrollTop=r._getCalculatedScrollTop(t,r.state)),t.scrollToColumn>0&&(r._initialScrollLeft=r._getCalculatedScrollLeft(t,r.state)),r}return(0,TD.default)(o,[{key:"getOffsetForCell",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=r.alignment,n=i===void 0?this.props.scrollToAlignment:i,s=r.columnIndex,l=s===void 0?this.props.scrollToColumn:s,c=r.rowIndex,d=c===void 0?this.props.scrollToRow:c,p=Ra({},this.props,{scrollToAlignment:n,scrollToColumn:l,scrollToRow:d});return{scrollLeft:this._getCalculatedScrollLeft(p),scrollTop:this._getCalculatedScrollTop(p)}}},{key:"getTotalRowsHeight",value:function(){return this.state.instanceProps.rowSizeAndPositionManager.getTotalSize()}},{key:"getTotalColumnsWidth",value:function(){return this.state.instanceProps.columnSizeAndPositionManager.getTotalSize()}},{key:"handleScrollEvent",value:function(r){var i=r.scrollLeft,n=i===void 0?0:i,s=r.scrollTop,l=s===void 0?0:s;if(!(l<0)){this._debounceScrollEnded();var c=this.props,d=c.autoHeight,p=c.autoWidth,m=c.height,u=c.width,g=this.state.instanceProps,h=g.scrollbarSize,b=g.rowSizeAndPositionManager.getTotalSize(),x=g.columnSizeAndPositionManager.getTotalSize(),S=Math.min(Math.max(0,x-u+h),n),y=Math.min(Math.max(0,b-m+h),l);if(this.state.scrollLeft!==S||this.state.scrollTop!==y){var C=S!==this.state.scrollLeft?S>this.state.scrollLeft?Dr.SCROLL_DIRECTION_FORWARD:Dr.SCROLL_DIRECTION_BACKWARD:this.state.scrollDirectionHorizontal,P=y!==this.state.scrollTop?y>this.state.scrollTop?Dr.SCROLL_DIRECTION_FORWARD:Dr.SCROLL_DIRECTION_BACKWARD:this.state.scrollDirectionVertical,v={isScrolling:!0,scrollDirectionHorizontal:C,scrollDirectionVertical:P,scrollPositionChangeReason:zw.OBSERVED};d||(v.scrollTop=y),p||(v.scrollLeft=S),v.needToResetStyleCache=!1,this.setState(v)}this._invokeOnScrollMemoizer({scrollLeft:S,scrollTop:y,totalColumnsWidth:x,totalRowsHeight:b})}}},{key:"invalidateCellSizeAfterRender",value:function(r){var i=r.columnIndex,n=r.rowIndex;this._deferredInvalidateColumnIndex=typeof this._deferredInvalidateColumnIndex=="number"?Math.min(this._deferredInvalidateColumnIndex,i):i,this._deferredInvalidateRowIndex=typeof this._deferredInvalidateRowIndex=="number"?Math.min(this._deferredInvalidateRowIndex,n):n}},{key:"measureAllCells",value:function(){var r=this.props,i=r.columnCount,n=r.rowCount,s=this.state.instanceProps;s.columnSizeAndPositionManager.getSizeAndPositionOfCell(i-1),s.rowSizeAndPositionManager.getSizeAndPositionOfCell(n-1)}},{key:"recomputeGridSize",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=r.columnIndex,n=i===void 0?0:i,s=r.rowIndex,l=s===void 0?0:s,c=this.props,d=c.scrollToColumn,p=c.scrollToRow,m=this.state.instanceProps;m.columnSizeAndPositionManager.resetCell(n),m.rowSizeAndPositionManager.resetCell(l),this._recomputeScrollLeftFlag=d>=0&&(this.state.scrollDirectionHorizontal===Dr.SCROLL_DIRECTION_FORWARD?n<=d:n>=d),this._recomputeScrollTopFlag=p>=0&&(this.state.scrollDirectionVertical===Dr.SCROLL_DIRECTION_FORWARD?l<=p:l>=p),this._styleCache={},this._cellCache={},this.forceUpdate()}},{key:"scrollToCell",value:function(r){var i=r.columnIndex,n=r.rowIndex,s=this.props.columnCount,l=this.props;s>1&&i!==void 0&&this._updateScrollLeftForScrollToColumn(Ra({},l,{scrollToColumn:i})),n!==void 0&&this._updateScrollTopForScrollToRow(Ra({},l,{scrollToRow:n}))}},{key:"componentDidMount",value:function(){var r=this.props,i=r.getScrollbarSize,n=r.height,s=r.scrollLeft,l=r.scrollToColumn,c=r.scrollTop,d=r.scrollToRow,p=r.width,m=this.state.instanceProps;if(this._initialScrollTop=0,this._initialScrollLeft=0,this._handleInvalidatedGridSize(),m.scrollbarSizeMeasured||this.setState(function(h){var b=Ra({},h,{needToResetStyleCache:!1});return b.instanceProps.scrollbarSize=i(),b.instanceProps.scrollbarSizeMeasured=!0,b}),typeof s=="number"&&s>=0||typeof c=="number"&&c>=0){var u=o._getScrollToPositionStateUpdate({prevState:this.state,scrollLeft:s,scrollTop:c});u&&(u.needToResetStyleCache=!1,this.setState(u))}this._scrollingContainer&&(this._scrollingContainer.scrollLeft!==this.state.scrollLeft&&(this._scrollingContainer.scrollLeft=this.state.scrollLeft),this._scrollingContainer.scrollTop!==this.state.scrollTop&&(this._scrollingContainer.scrollTop=this.state.scrollTop));var g=n>0&&p>0;l>=0&&g&&this._updateScrollLeftForScrollToColumn(),d>=0&&g&&this._updateScrollTopForScrollToRow(),this._invokeOnGridRenderedHelper(),this._invokeOnScrollMemoizer({scrollLeft:s||0,scrollTop:c||0,totalColumnsWidth:m.columnSizeAndPositionManager.getTotalSize(),totalRowsHeight:m.rowSizeAndPositionManager.getTotalSize()}),this._maybeCallOnScrollbarPresenceChange()}},{key:"componentDidUpdate",value:function(r,i){var n=this,s=this.props,l=s.autoHeight,c=s.autoWidth,d=s.columnCount,p=s.height,m=s.rowCount,u=s.scrollToAlignment,g=s.scrollToColumn,h=s.scrollToRow,b=s.width,x=this.state,S=x.scrollLeft,y=x.scrollPositionChangeReason,C=x.scrollTop,P=x.instanceProps;this._handleInvalidatedGridSize();var v=d>0&&r.columnCount===0||m>0&&r.rowCount===0;y===zw.REQUESTED&&(!c&&S>=0&&(S!==this._scrollingContainer.scrollLeft||v)&&(this._scrollingContainer.scrollLeft=S),!l&&C>=0&&(C!==this._scrollingContainer.scrollTop||v)&&(this._scrollingContainer.scrollTop=C));var T=(r.width===0||r.height===0)&&p>0&&b>0;if(this._recomputeScrollLeftFlag?(this._recomputeScrollLeftFlag=!1,this._updateScrollLeftForScrollToColumn(this.props)):(0,f3.default)({cellSizeAndPositionManager:P.columnSizeAndPositionManager,previousCellsCount:r.columnCount,previousCellSize:r.columnWidth,previousScrollToAlignment:r.scrollToAlignment,previousScrollToIndex:r.scrollToColumn,previousSize:r.width,scrollOffset:S,scrollToAlignment:u,scrollToIndex:g,size:b,sizeJustIncreasedFromZero:T,updateScrollIndexCallback:function(){return n._updateScrollLeftForScrollToColumn(n.props)}}),this._recomputeScrollTopFlag?(this._recomputeScrollTopFlag=!1,this._updateScrollTopForScrollToRow(this.props)):(0,f3.default)({cellSizeAndPositionManager:P.rowSizeAndPositionManager,previousCellsCount:r.rowCount,previousCellSize:r.rowHeight,previousScrollToAlignment:r.scrollToAlignment,previousScrollToIndex:r.scrollToRow,previousSize:r.height,scrollOffset:C,scrollToAlignment:u,scrollToIndex:h,size:p,sizeJustIncreasedFromZero:T,updateScrollIndexCallback:function(){return n._updateScrollTopForScrollToRow(n.props)}}),this._invokeOnGridRenderedHelper(),S!==i.scrollLeft||C!==i.scrollTop){var R=P.rowSizeAndPositionManager.getTotalSize(),I=P.columnSizeAndPositionManager.getTotalSize();this._invokeOnScrollMemoizer({scrollLeft:S,scrollTop:C,totalColumnsWidth:I,totalRowsHeight:R})}this._maybeCallOnScrollbarPresenceChange()}},{key:"componentWillUnmount",value:function(){this._disablePointerEventsTimeoutId&&(0,Rw.cancelAnimationTimeout)(this._disablePointerEventsTimeoutId)}},{key:"render",value:function(){var r=this.props,i=r.autoContainerWidth,n=r.autoHeight,s=r.autoWidth,l=r.className,c=r.containerProps,d=r.containerRole,p=r.containerStyle,m=r.height,u=r.id,g=r.noContentRenderer,h=r.role,b=r.style,x=r.tabIndex,S=r.width,y=this.state,C=y.instanceProps,P=y.needToResetStyleCache,v=this._isScrolling(),T={boxSizing:"border-box",direction:"ltr",height:n?"auto":m,position:"relative",width:s?"auto":S,WebkitOverflowScrolling:"touch",willChange:"transform"};P&&(this._styleCache={}),this.state.isScrolling||this._resetStyleCache(),this._calculateChildrenToRender(this.props,this.state);var R=C.columnSizeAndPositionManager.getTotalSize(),I=C.rowSizeAndPositionManager.getTotalSize(),M=I>m?C.scrollbarSize:0,D=R>S?C.scrollbarSize:0;(D!==this._horizontalScrollBarSize||M!==this._verticalScrollBarSize)&&(this._horizontalScrollBarSize=D,this._verticalScrollBarSize=M,this._scrollbarPresenceChanged=!0),T.overflowX=R+M<=S?"hidden":"auto",T.overflowY=I+D<=m?"hidden":"auto";var E=this._childrenToDisplay,A=E.length===0&&m>0&&S>0;return Bw.createElement("div",(0,CD.default)({ref:this._setScrollingContainerRef},c,{"aria-label":this.props["aria-label"],"aria-readonly":this.props["aria-readonly"],className:(0,RD.default)("ReactVirtualized__Grid",l),id:u,onScroll:this._onScroll,role:h,style:Ra({},T,{},b),tabIndex:x}),E.length>0&&Bw.createElement("div",{className:"ReactVirtualized__Grid__innerScrollContainer",role:d,style:Ra({width:i?"auto":R,height:I,maxWidth:R,maxHeight:I,overflow:"hidden",pointerEvents:v?"none":"",position:"relative"},p)},E),A&&g())}},{key:"_calculateChildrenToRender",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.state,n=r.cellRenderer,s=r.cellRangeRenderer,l=r.columnCount,c=r.deferredMeasurementCache,d=r.height,p=r.overscanColumnCount,m=r.overscanIndicesGetter,u=r.overscanRowCount,g=r.rowCount,h=r.width,b=r.isScrollingOptOut,x=i.scrollDirectionHorizontal,S=i.scrollDirectionVertical,y=i.instanceProps,C=this._initialScrollTop>0?this._initialScrollTop:i.scrollTop,P=this._initialScrollLeft>0?this._initialScrollLeft:i.scrollLeft,v=this._isScrolling(r,i);if(this._childrenToDisplay=[],d>0&&h>0){var T=y.columnSizeAndPositionManager.getVisibleCellRange({containerSize:h,offset:P}),R=y.rowSizeAndPositionManager.getVisibleCellRange({containerSize:d,offset:C}),I=y.columnSizeAndPositionManager.getOffsetAdjustment({containerSize:h,offset:P}),M=y.rowSizeAndPositionManager.getOffsetAdjustment({containerSize:d,offset:C});this._renderedColumnStartIndex=T.start,this._renderedColumnStopIndex=T.stop,this._renderedRowStartIndex=R.start,this._renderedRowStopIndex=R.stop;var D=m({direction:"horizontal",cellCount:l,overscanCellsCount:p,scrollDirection:x,startIndex:typeof T.start=="number"?T.start:0,stopIndex:typeof T.stop=="number"?T.stop:-1}),E=m({direction:"vertical",cellCount:g,overscanCellsCount:u,scrollDirection:S,startIndex:typeof R.start=="number"?R.start:0,stopIndex:typeof R.stop=="number"?R.stop:-1}),A=D.overscanStartIndex,$=D.overscanStopIndex,j=E.overscanStartIndex,pe=E.overscanStopIndex;if(c){if(!c.hasFixedHeight()){for(var ee=j;ee<=pe;ee++)if(!c.has(ee,0)){A=0,$=l-1;break}}if(!c.hasFixedWidth()){for(var G=A;G<=$;G++)if(!c.has(0,G)){j=0,pe=g-1;break}}}this._childrenToDisplay=s({cellCache:this._cellCache,cellRenderer:n,columnSizeAndPositionManager:y.columnSizeAndPositionManager,columnStartIndex:A,columnStopIndex:$,deferredMeasurementCache:c,horizontalOffsetAdjustment:I,isScrolling:v,isScrollingOptOut:b,parent:this,rowSizeAndPositionManager:y.rowSizeAndPositionManager,rowStartIndex:j,rowStopIndex:pe,scrollLeft:P,scrollTop:C,styleCache:this._styleCache,verticalOffsetAdjustment:M,visibleColumnIndices:T,visibleRowIndices:R}),this._columnStartIndex=A,this._columnStopIndex=$,this._rowStartIndex=j,this._rowStopIndex=pe}}},{key:"_debounceScrollEnded",value:function(){var r=this.props.scrollingResetTimeInterval;this._disablePointerEventsTimeoutId&&(0,Rw.cancelAnimationTimeout)(this._disablePointerEventsTimeoutId),this._disablePointerEventsTimeoutId=(0,Rw.requestAnimationTimeout)(this._debounceScrollEndedCallback,r)}},{key:"_handleInvalidatedGridSize",value:function(){if(typeof this._deferredInvalidateColumnIndex=="number"&&typeof this._deferredInvalidateRowIndex=="number"){var r=this._deferredInvalidateColumnIndex,i=this._deferredInvalidateRowIndex;this._deferredInvalidateColumnIndex=null,this._deferredInvalidateRowIndex=null,this.recomputeGridSize({columnIndex:r,rowIndex:i})}}},{key:"_invokeOnScrollMemoizer",value:function(r){var i=this,n=r.scrollLeft,s=r.scrollTop,l=r.totalColumnsWidth,c=r.totalRowsHeight;this._onScrollMemoizer({callback:function(p){var m=p.scrollLeft,u=p.scrollTop,g=i.props,h=g.height,b=g.onScroll,x=g.width;b({clientHeight:h,clientWidth:x,scrollHeight:c,scrollLeft:m,scrollTop:u,scrollWidth:l})},indices:{scrollLeft:n,scrollTop:s}})}},{key:"_isScrolling",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.state;return Object.hasOwnProperty.call(r,"isScrolling")?!!r.isScrolling:!!i.isScrolling}},{key:"_maybeCallOnScrollbarPresenceChange",value:function(){if(this._scrollbarPresenceChanged){var r=this.props.onScrollbarPresenceChange;this._scrollbarPresenceChanged=!1,r({horizontal:this._horizontalScrollBarSize>0,size:this.state.instanceProps.scrollbarSize,vertical:this._verticalScrollBarSize>0})}}},{key:"scrollToPosition",value:function(r){var i=r.scrollLeft,n=r.scrollTop,s=o._getScrollToPositionStateUpdate({prevState:this.state,scrollLeft:i,scrollTop:n});s&&(s.needToResetStyleCache=!1,this.setState(s))}},{key:"_getCalculatedScrollLeft",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.state;return o._getCalculatedScrollLeft(r,i)}},{key:"_updateScrollLeftForScrollToColumn",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.state,n=o._getScrollLeftForScrollToColumnStateUpdate(r,i);n&&(n.needToResetStyleCache=!1,this.setState(n))}},{key:"_getCalculatedScrollTop",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.state;return o._getCalculatedScrollTop(r,i)}},{key:"_resetStyleCache",value:function(){var r=this._styleCache,i=this._cellCache,n=this.props.isScrollingOptOut;this._cellCache={},this._styleCache={};for(var s=this._rowStartIndex;s<=this._rowStopIndex;s++)for(var l=this._columnStartIndex;l<=this._columnStopIndex;l++){var c="".concat(s,"-").concat(l);this._styleCache[c]=r[c],n&&(this._cellCache[c]=i[c])}}},{key:"_updateScrollTopForScrollToRow",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.state,n=o._getScrollTopForScrollToRowStateUpdate(r,i);n&&(n.needToResetStyleCache=!1,this.setState(n))}}],[{key:"getDerivedStateFromProps",value:function(r,i){var n={};r.columnCount===0&&i.scrollLeft!==0||r.rowCount===0&&i.scrollTop!==0?(n.scrollLeft=0,n.scrollTop=0):(r.scrollLeft!==i.scrollLeft&&r.scrollToColumn<0||r.scrollTop!==i.scrollTop&&r.scrollToRow<0)&&Object.assign(n,o._getScrollToPositionStateUpdate({prevState:i,scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}));var s=i.instanceProps;n.needToResetStyleCache=!1,(r.columnWidth!==s.prevColumnWidth||r.rowHeight!==s.prevRowHeight)&&(n.needToResetStyleCache=!0),s.columnSizeAndPositionManager.configure({cellCount:r.columnCount,estimatedCellSize:o._getEstimatedColumnSize(r),cellSizeGetter:o._wrapSizeGetter(r.columnWidth)}),s.rowSizeAndPositionManager.configure({cellCount:r.rowCount,estimatedCellSize:o._getEstimatedRowSize(r),cellSizeGetter:o._wrapSizeGetter(r.rowHeight)}),(s.prevColumnCount===0||s.prevRowCount===0)&&(s.prevColumnCount=0,s.prevRowCount=0),r.autoHeight&&r.isScrolling===!1&&s.prevIsScrolling===!0&&Object.assign(n,{isScrolling:!1});var l,c;return(0,m3.default)({cellCount:s.prevColumnCount,cellSize:typeof s.prevColumnWidth=="number"?s.prevColumnWidth:null,computeMetadataCallback:function(){return s.columnSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:r,nextCellsCount:r.columnCount,nextCellSize:typeof r.columnWidth=="number"?r.columnWidth:null,nextScrollToIndex:r.scrollToColumn,scrollToIndex:s.prevScrollToColumn,updateScrollOffsetForScrollToIndex:function(){l=o._getScrollLeftForScrollToColumnStateUpdate(r,i)}}),(0,m3.default)({cellCount:s.prevRowCount,cellSize:typeof s.prevRowHeight=="number"?s.prevRowHeight:null,computeMetadataCallback:function(){return s.rowSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:r,nextCellsCount:r.rowCount,nextCellSize:typeof r.rowHeight=="number"?r.rowHeight:null,nextScrollToIndex:r.scrollToRow,scrollToIndex:s.prevScrollToRow,updateScrollOffsetForScrollToIndex:function(){c=o._getScrollTopForScrollToRowStateUpdate(r,i)}}),s.prevColumnCount=r.columnCount,s.prevColumnWidth=r.columnWidth,s.prevIsScrolling=r.isScrolling===!0,s.prevRowCount=r.rowCount,s.prevRowHeight=r.rowHeight,s.prevScrollToColumn=r.scrollToColumn,s.prevScrollToRow=r.scrollToRow,s.scrollbarSize=r.getScrollbarSize(),s.scrollbarSize===void 0?(s.scrollbarSizeMeasured=!1,s.scrollbarSize=0):s.scrollbarSizeMeasured=!0,n.instanceProps=s,Ra({},n,{},l,{},c)}},{key:"_getEstimatedColumnSize",value:function(r){return typeof r.columnWidth=="number"?r.columnWidth:r.estimatedColumnSize}},{key:"_getEstimatedRowSize",value:function(r){return typeof r.rowHeight=="number"?r.rowHeight:r.estimatedRowSize}},{key:"_getScrollToPositionStateUpdate",value:function(r){var i=r.prevState,n=r.scrollLeft,s=r.scrollTop,l={scrollPositionChangeReason:zw.REQUESTED};return typeof n=="number"&&n>=0&&(l.scrollDirectionHorizontal=n>i.scrollLeft?Dr.SCROLL_DIRECTION_FORWARD:Dr.SCROLL_DIRECTION_BACKWARD,l.scrollLeft=n),typeof s=="number"&&s>=0&&(l.scrollDirectionVertical=s>i.scrollTop?Dr.SCROLL_DIRECTION_FORWARD:Dr.SCROLL_DIRECTION_BACKWARD,l.scrollTop=s),typeof n=="number"&&n>=0&&n!==i.scrollLeft||typeof s=="number"&&s>=0&&s!==i.scrollTop?l:{}}},{key:"_wrapSizeGetter",value:function(r){return typeof r=="function"?r:function(){return r}}},{key:"_getCalculatedScrollLeft",value:function(r,i){var n=r.columnCount,s=r.height,l=r.scrollToAlignment,c=r.scrollToColumn,d=r.width,p=i.scrollLeft,m=i.instanceProps;if(n>0){var u=n-1,g=c<0?u:Math.min(u,c),h=m.rowSizeAndPositionManager.getTotalSize(),b=m.scrollbarSizeMeasured&&h>s?m.scrollbarSize:0;return m.columnSizeAndPositionManager.getUpdatedOffsetForIndex({align:l,containerSize:d-b,currentOffset:p,targetIndex:g})}return 0}},{key:"_getScrollLeftForScrollToColumnStateUpdate",value:function(r,i){var n=i.scrollLeft,s=o._getCalculatedScrollLeft(r,i);return typeof s=="number"&&s>=0&&n!==s?o._getScrollToPositionStateUpdate({prevState:i,scrollLeft:s,scrollTop:-1}):{}}},{key:"_getCalculatedScrollTop",value:function(r,i){var n=r.height,s=r.rowCount,l=r.scrollToAlignment,c=r.scrollToRow,d=r.width,p=i.scrollTop,m=i.instanceProps;if(s>0){var u=s-1,g=c<0?u:Math.min(u,c),h=m.columnSizeAndPositionManager.getTotalSize(),b=m.scrollbarSizeMeasured&&h>d?m.scrollbarSize:0;return m.rowSizeAndPositionManager.getUpdatedOffsetForIndex({align:l,containerSize:n-b,currentOffset:p,targetIndex:g})}return 0}},{key:"_getScrollTopForScrollToRowStateUpdate",value:function(r,i){var n=i.scrollTop,s=o._getCalculatedScrollTop(r,i);return typeof s=="number"&&s>=0&&n!==s?o._getScrollToPositionStateUpdate({prevState:i,scrollLeft:-1,scrollTop:s}):{}}}]),o}(Bw.PureComponent),(0,_t.default)(b3,"propTypes",null),w3);(0,_t.default)(Ew,"defaultProps",{"aria-label":"grid","aria-readonly":!0,autoContainerWidth:!1,autoHeight:!1,autoWidth:!1,cellRangeRenderer:zD.default,containerRole:"rowgroup",containerStyle:{},estimatedColumnSize:100,estimatedRowSize:30,getScrollbarSize:ED.default,noContentRenderer:LD,onScroll:function(){},onScrollbarPresenceChange:function(){},onSectionRendered:function(){},overscanColumnCount:0,overscanIndicesGetter:Dr.default,overscanRowCount:10,role:"grid",scrollingResetTimeInterval:y3,scrollToAlignment:"auto",scrollToColumn:-1,scrollToRow:-1,style:{},tabIndex:0,isScrollingOptOut:!1});(0,AD.polyfill)(Ew);var DD=Ew;gp.default=DD});var S3=Ye(Mi=>{"use strict";Object.defineProperty(Mi,"__esModule",{value:!0});Mi.default=FD;Mi.SCROLL_DIRECTION_VERTICAL=Mi.SCROLL_DIRECTION_HORIZONTAL=Mi.SCROLL_DIRECTION_FORWARD=Mi.SCROLL_DIRECTION_BACKWARD=void 0;var E_e=Pn(),OD=-1;Mi.SCROLL_DIRECTION_BACKWARD=OD;var _3=1;Mi.SCROLL_DIRECTION_FORWARD=_3;var $D="horizontal";Mi.SCROLL_DIRECTION_HORIZONTAL=$D;var HD="vertical";Mi.SCROLL_DIRECTION_VERTICAL=HD;function FD(e){var o=e.cellCount,t=e.overscanCellsCount,r=e.scrollDirection,i=e.startIndex,n=e.stopIndex;return t=Math.max(1,t),r===_3?{overscanStartIndex:Math.max(0,i-1),overscanStopIndex:Math.min(o-1,n+t)}:{overscanStartIndex:Math.max(0,i-t),overscanStopIndex:Math.min(o-1,n+1)}}});var P3=Ye(nr=>{"use strict";var Ug=xr();Object.defineProperty(nr,"__esModule",{value:!0});Object.defineProperty(nr,"default",{enumerable:!0,get:function(){return C3.default}});Object.defineProperty(nr,"Grid",{enumerable:!0,get:function(){return C3.default}});Object.defineProperty(nr,"accessibilityOverscanIndicesGetter",{enumerable:!0,get:function(){return ND.default}});Object.defineProperty(nr,"defaultCellRangeRenderer",{enumerable:!0,get:function(){return WD.default}});Object.defineProperty(nr,"defaultOverscanIndicesGetter",{enumerable:!0,get:function(){return VD.default}});Object.defineProperty(nr,"bpfrpt_proptype_NoContentRenderer",{enumerable:!0,get:function(){return Cs.bpfrpt_proptype_NoContentRenderer}});Object.defineProperty(nr,"bpfrpt_proptype_Alignment",{enumerable:!0,get:function(){return Cs.bpfrpt_proptype_Alignment}});Object.defineProperty(nr,"bpfrpt_proptype_CellPosition",{enumerable:!0,get:function(){return Cs.bpfrpt_proptype_CellPosition}});Object.defineProperty(nr,"bpfrpt_proptype_CellSize",{enumerable:!0,get:function(){return Cs.bpfrpt_proptype_CellSize}});Object.defineProperty(nr,"bpfrpt_proptype_OverscanIndicesGetter",{enumerable:!0,get:function(){return Cs.bpfrpt_proptype_OverscanIndicesGetter}});Object.defineProperty(nr,"bpfrpt_proptype_RenderedSection",{enumerable:!0,get:function(){return Cs.bpfrpt_proptype_RenderedSection}});Object.defineProperty(nr,"bpfrpt_proptype_CellRendererParams",{enumerable:!0,get:function(){return Cs.bpfrpt_proptype_CellRendererParams}});Object.defineProperty(nr,"bpfrpt_proptype_Scroll",{enumerable:!0,get:function(){return Cs.bpfrpt_proptype_Scroll}});var C3=Ug(k3()),ND=Ug(S3()),WD=Ug(Tw()),VD=Ug(Sw()),Cs=Pn()});var Aw=Ye(Yi=>{"use strict";var UD=xr(),GD=lp();Object.defineProperty(Yi,"__esModule",{value:!0});Yi.bpfrpt_proptype_Scroll=Yi.bpfrpt_proptype_RenderedRows=Yi.bpfrpt_proptype_RowRenderer=Yi.bpfrpt_proptype_RowRendererParams=void 0;var D_e=GD(H()),O_e=UD(dl()),jD=null;Yi.bpfrpt_proptype_RowRendererParams=jD;var qD=null;Yi.bpfrpt_proptype_RowRenderer=qD;var YD=null;Yi.bpfrpt_proptype_RenderedRows=YD;var XD=null;Yi.bpfrpt_proptype_Scroll=XD});var E3=Ye(Gg=>{"use strict";var Xi=xr(),B3=lp();Object.defineProperty(Gg,"__esModule",{value:!0});Gg.default=void 0;var KD=Xi(hw()),ZD=Xi(pp()),JD=Xi(cp()),QD=Xi(Lg()),eO=Xi(Dg()),rd=Xi(Xc()),tO=Xi(Og()),za=Xi(dp()),R3=B3(P3()),T3=B3(H()),oO=Xi(vw()),H_e=Aw(),F_e=Xi(dl()),I3,M3,z3=(M3=I3=function(e){(0,tO.default)(o,e);function o(){var t,r;(0,ZD.default)(this,o);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return r=(0,QD.default)(this,(t=(0,eO.default)(o)).call.apply(t,[this].concat(n))),(0,za.default)((0,rd.default)(r),"Grid",void 0),(0,za.default)((0,rd.default)(r),"_cellRenderer",function(l){var c=l.parent,d=l.rowIndex,p=l.style,m=l.isScrolling,u=l.isVisible,g=l.key,h=r.props.rowRenderer,b=Object.getOwnPropertyDescriptor(p,"width");return b&&b.writable&&(p.width="100%"),h({index:d,style:p,isScrolling:m,isVisible:u,key:g,parent:c})}),(0,za.default)((0,rd.default)(r),"_setRef",function(l){r.Grid=l}),(0,za.default)((0,rd.default)(r),"_onScroll",function(l){var c=l.clientHeight,d=l.scrollHeight,p=l.scrollTop,m=r.props.onScroll;m({clientHeight:c,scrollHeight:d,scrollTop:p})}),(0,za.default)((0,rd.default)(r),"_onSectionRendered",function(l){var c=l.rowOverscanStartIndex,d=l.rowOverscanStopIndex,p=l.rowStartIndex,m=l.rowStopIndex,u=r.props.onRowsRendered;u({overscanStartIndex:c,overscanStopIndex:d,startIndex:p,stopIndex:m})}),r}return(0,JD.default)(o,[{key:"forceUpdateGrid",value:function(){this.Grid&&this.Grid.forceUpdate()}},{key:"getOffsetForRow",value:function(r){var i=r.alignment,n=r.index;if(this.Grid){var s=this.Grid.getOffsetForCell({alignment:i,rowIndex:n,columnIndex:0}),l=s.scrollTop;return l}return 0}},{key:"invalidateCellSizeAfterRender",value:function(r){var i=r.columnIndex,n=r.rowIndex;this.Grid&&this.Grid.invalidateCellSizeAfterRender({rowIndex:n,columnIndex:i})}},{key:"measureAllRows",value:function(){this.Grid&&this.Grid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=r.columnIndex,n=i===void 0?0:i,s=r.rowIndex,l=s===void 0?0:s;this.Grid&&this.Grid.recomputeGridSize({rowIndex:l,columnIndex:n})}},{key:"recomputeRowHeights",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.Grid&&this.Grid.recomputeGridSize({rowIndex:r,columnIndex:0})}},{key:"scrollToPosition",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.Grid&&this.Grid.scrollToPosition({scrollTop:r})}},{key:"scrollToRow",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.Grid&&this.Grid.scrollToCell({columnIndex:0,rowIndex:r})}},{key:"render",value:function(){var r=this.props,i=r.className,n=r.noRowsRenderer,s=r.scrollToIndex,l=r.width,c=(0,oO.default)("ReactVirtualized__List",i);return T3.createElement(R3.default,(0,KD.default)({},this.props,{autoContainerWidth:!0,cellRenderer:this._cellRenderer,className:c,columnWidth:l,columnCount:1,noContentRenderer:n,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,ref:this._setRef,scrollToRow:s}))}}]),o}(T3.PureComponent),(0,za.default)(I3,"propTypes",null),M3);Gg.default=z3;(0,za.default)(z3,"defaultProps",{autoHeight:!1,estimatedRowSize:30,onScroll:function(){},noRowsRenderer:function(){return null},onRowsRendered:function(){},overscanIndicesGetter:R3.accessibilityOverscanIndicesGetter,overscanRowCount:10,scrollToAlignment:"auto",scrollToIndex:-1,style:{}})});var L3=Ye(id=>{"use strict";var rO=xr();Object.defineProperty(id,"__esModule",{value:!0});Object.defineProperty(id,"default",{enumerable:!0,get:function(){return A3.default}});Object.defineProperty(id,"List",{enumerable:!0,get:function(){return A3.default}});Object.defineProperty(id,"bpfrpt_proptype_RowRendererParams",{enumerable:!0,get:function(){return iO.bpfrpt_proptype_RowRendererParams}});var A3=rO(E3()),iO=Aw()});var D3=Ye(Lw=>{"use strict";Object.defineProperty(Lw,"__esModule",{value:!0});Lw.default=nO;function nO(e,o){var t;typeof o<"u"?t=o:typeof window<"u"?t=window:typeof self<"u"?t=self:t=window;var r=typeof t.document<"u"&&t.document.attachEvent;if(!r){var i=function(){var R=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||function(I){return t.setTimeout(I,20)};return function(I){return R(I)}}(),n=function(){var R=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.clearTimeout;return function(I){return R(I)}}(),s=function(I){var M=I.__resizeTriggers__,D=M.firstElementChild,E=M.lastElementChild,A=D.firstElementChild;E.scrollLeft=E.scrollWidth,E.scrollTop=E.scrollHeight,A.style.width=D.offsetWidth+1+"px",A.style.height=D.offsetHeight+1+"px",D.scrollLeft=D.scrollWidth,D.scrollTop=D.scrollHeight},l=function(I){return I.offsetWidth!=I.__resizeLast__.width||I.offsetHeight!=I.__resizeLast__.height},c=function(I){if(!(I.target.className&&typeof I.target.className.indexOf=="function"&&I.target.className.indexOf("contract-trigger")<0&&I.target.className.indexOf("expand-trigger")<0)){var M=this;s(this),this.__resizeRAF__&&n(this.__resizeRAF__),this.__resizeRAF__=i(function(){l(M)&&(M.__resizeLast__.width=M.offsetWidth,M.__resizeLast__.height=M.offsetHeight,M.__resizeListeners__.forEach(function(D){D.call(M,I)}))})}},d=!1,p="",m="animationstart",u="Webkit Moz O ms".split(" "),g="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),h="";{var b=t.document.createElement("fakeelement");if(b.style.animationName!==void 0&&(d=!0),d===!1){for(var x=0;x<u.length;x++)if(b.style[u[x]+"AnimationName"]!==void 0){h=u[x],p="-"+h.toLowerCase()+"-",m=g[x],d=!0;break}}}var S="resizeanim",y="@"+p+"keyframes "+S+" { from { opacity: 0; } to { opacity: 0; } } ",C=p+"animation: 1ms "+S+"; "}var P=function(I){if(!I.getElementById("detectElementResize")){var M=(y||"")+".resize-triggers { "+(C||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',D=I.head||I.getElementsByTagName("head")[0],E=I.createElement("style");E.id="detectElementResize",E.type="text/css",e!=null&&E.setAttribute("nonce",e),E.styleSheet?E.styleSheet.cssText=M:E.appendChild(I.createTextNode(M)),D.appendChild(E)}},v=function(I,M){if(r)I.attachEvent("onresize",M);else{if(!I.__resizeTriggers__){var D=I.ownerDocument,E=t.getComputedStyle(I);E&&E.position=="static"&&(I.style.position="relative"),P(D),I.__resizeLast__={},I.__resizeListeners__=[],(I.__resizeTriggers__=D.createElement("div")).className="resize-triggers";var A='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>';if(window.trustedTypes){var $=trustedTypes.createPolicy("react-virtualized-auto-sizer",{createHTML:function(){return A}});I.__resizeTriggers__.innerHTML=$.createHTML("")}else I.__resizeTriggers__.innerHTML=A;I.appendChild(I.__resizeTriggers__),s(I),I.addEventListener("scroll",c,!0),m&&(I.__resizeTriggers__.__animationListener__=function(pe){pe.animationName==S&&s(I)},I.__resizeTriggers__.addEventListener(m,I.__resizeTriggers__.__animationListener__))}I.__resizeListeners__.push(M)}},T=function(I,M){if(r)I.detachEvent("onresize",M);else if(I.__resizeListeners__.splice(I.__resizeListeners__.indexOf(M),1),!I.__resizeListeners__.length){I.removeEventListener("scroll",c,!0),I.__resizeTriggers__.__animationListener__&&(I.__resizeTriggers__.removeEventListener(m,I.__resizeTriggers__.__animationListener__),I.__resizeTriggers__.__animationListener__=null);try{I.__resizeTriggers__=!I.removeChild(I.__resizeTriggers__)}catch{}}};return{addResizeListener:v,removeResizeListener:T}}});var W3=Ye(jg=>{"use strict";var Tn=xr(),sO=lp();Object.defineProperty(jg,"__esModule",{value:!0});jg.default=void 0;var aO=Tn(pp()),lO=Tn(cp()),pO=Tn(Lg()),cO=Tn(Dg()),Ea=Tn(Xc()),dO=Tn(Og()),Ki=Tn(dp()),O3=sO(H()),uO=Tn(D3()),U_e=Tn(dl()),$3,H3;function F3(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);o&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,r)}return t}function mO(e){for(var o=1;o<arguments.length;o++){var t=arguments[o]!=null?arguments[o]:{};o%2?F3(t,!0).forEach(function(r){(0,Ki.default)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):F3(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var N3=(H3=$3=function(e){(0,dO.default)(o,e);function o(){var t,r;(0,aO.default)(this,o);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return r=(0,pO.default)(this,(t=(0,cO.default)(o)).call.apply(t,[this].concat(n))),(0,Ki.default)((0,Ea.default)(r),"state",{height:r.props.defaultHeight||0,width:r.props.defaultWidth||0}),(0,Ki.default)((0,Ea.default)(r),"_parentNode",void 0),(0,Ki.default)((0,Ea.default)(r),"_autoSizer",void 0),(0,Ki.default)((0,Ea.default)(r),"_window",void 0),(0,Ki.default)((0,Ea.default)(r),"_detectElementResize",void 0),(0,Ki.default)((0,Ea.default)(r),"_onResize",function(){var l=r.props,c=l.disableHeight,d=l.disableWidth,p=l.onResize;if(r._parentNode){var m=r._parentNode.offsetHeight||0,u=r._parentNode.offsetWidth||0,g=r._window||window,h=g.getComputedStyle(r._parentNode)||{},b=parseInt(h.paddingLeft,10)||0,x=parseInt(h.paddingRight,10)||0,S=parseInt(h.paddingTop,10)||0,y=parseInt(h.paddingBottom,10)||0,C=m-S-y,P=u-b-x;(!c&&r.state.height!==C||!d&&r.state.width!==P)&&(r.setState({height:m-S-y,width:u-b-x}),p({height:m,width:u}))}}),(0,Ki.default)((0,Ea.default)(r),"_setRef",function(l){r._autoSizer=l}),r}return(0,lO.default)(o,[{key:"componentDidMount",value:function(){var r=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._window=this._autoSizer.parentNode.ownerDocument.defaultView,this._detectElementResize=(0,uO.default)(r,this._window),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var r=this.props,i=r.children,n=r.className,s=r.disableHeight,l=r.disableWidth,c=r.style,d=this.state,p=d.height,m=d.width,u={overflow:"visible"},g={};return s||(u.height=0,g.height=p),l||(u.width=0,g.width=m),O3.createElement("div",{className:n,ref:this._setRef,style:mO({},u,{},c)},i(g))}}]),o}(O3.Component),(0,Ki.default)($3,"propTypes",null),H3);jg.default=N3;(0,Ki.default)(N3,"defaultProps",{onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}})});var U3=Ye(qg=>{"use strict";var gO=xr();Object.defineProperty(qg,"__esModule",{value:!0});Object.defineProperty(qg,"default",{enumerable:!0,get:function(){return V3.default}});Object.defineProperty(qg,"AutoSizer",{enumerable:!0,get:function(){return V3.default}});var V3=gO(W3())});var px=B($t()),D6=B(Mo());Ds();var me=B($t());ux();var si=B(Mo()),De=B(pt());So();Zd();ui();st();qx();Bo();Qd();var Br=B($t()),Uk=B(Mo()),Ie=B(pt());eu();Ho();Zd();df();Za();Du();kM();Mh();Bo();ef();qI();var Gk=B(xM());Bo();Ho();Bo();var Z=B(pt());Qd();ro();So();bu();var Fu=["aboveAll","frontFixed","normal","backFixed"],Wk={aboveAll:[],frontFixed:[],normal:[],backFixed:[]},Vk=(e,o)=>{let t=!0;return Z.default.each(Oe.viewports,r=>{!!e[r.name]!=!!o[r.name]&&(t=!1)}),t&&(Z.default.each(e,(r,i)=>{if(!o[i])t=!1;else{let n=o[i];Z.default.each(r,(s,l)=>{let c=n[l];c.length!==s.length&&(t=!1);let d=Z.default.flatten(s),p=Z.default.flatten(c);Z.default.each(d,(m,u)=>{p[u]!==m&&(t=!1)})})}}),t)},It=class It{constructor(o,t){this.mag=t,this._order={},this._calculated={},Re.on("mag:loadfull:complete",()=>{this.mag.pages.each(r=>this._bindPageEvents(r)),this._updateCalculatedIndex(),this.mag.pages.on("add",r=>{this._fillInitialOrder(r),this._bindPageEvents(r),this._updateCalculatedIndex()}),this._snapshot=this._doSnapshop()})}_getModelFromMag(o){let t;return this.mag.pages.each(r=>{t||(t=r.widgets.get(o))}),t}static conditionalSet(o,t){o&&(Vk(o.get("order"),t)||o.set({order:JSON.parse(JSON.stringify(t))},{silent:!0,skipHistory:!0}))}static conditionalSave(o,t,r={}){o&&(!Vk(o.get("order"),t)||o.changed.order&&!o._saveInProgress?o.save({order:JSON.parse(JSON.stringify(t))},{silent:!0,parse:!1,skipHistory:!0,...r,patch:!0}):r.success&&r.success())}static getPartialOrder(o,t){let r={};return Z.default.each(o,(i,n)=>{r[n]={},Z.default.each(i,(s,l)=>{r[n][l]=Z.default.reduce(s,(c,d)=>{if(d instanceof Array){let p=Z.default.filter(d,m=>t.includes(m));return p.length&&c.push(p),c}return t.includes(d)&&c.push(d),c},[])})}),r}static extendOrder(o,t){Z.default.each(o,(r,i)=>{Z.default.each(r,(n,s)=>{n.unshift((t[i]||t.default)[s])})})}static getWidgetOrder(o=[],t={aboveAll:[],frontFixed:[],normal:[],backFixed:[]},r="default"){let i=o.map(u=>u.id),n=u=>{if(Array.isArray(u))return u.length>0?u.every(g=>i.includes(g)):!1;{let g=u;return i.includes(g)}},{aboveAll:s=[],frontFixed:l=[],normal:c=[],backFixed:d=[]}=t,p=Z.default.flatten([...s,...l,...c,...d]);if(Z.default.difference(i,p).length===0)return{aboveAll:s.filter(n),frontFixed:l.filter(n),normal:c.filter(n),backFixed:d.filter(n)};{let u=o.map(y=>hi({target:y,viewport:r,pageId:y.get("pid")})),g=new Map;for(let y in t)for(let C of Z.default.flatten(t[y])){let P=u.find(T=>T.get("_id")===C),v=P?P.get("pack_id")||P.get("_id"):C;g.set(v,y)}let h=Z.default.sortBy(u,y=>y.get("z")*-1),b=h.reduce((y,C)=>{let P=C.get("pack_id"),v=C.get("_id");return P&&Array.isArray(y[P])?y[P].push(v):P&&(y[P]=[v]),y},{}),x=h.reduce((y,C)=>{let P=C.get("pack_id")||C.get("_id");if(C.get("is_above"))y.aboveAll.push(P);else if(C.get("fixed_position")){let v=g.get(P);["frontFixed","backFixed"].includes(v)?y[v].push(P):y.normal.length===0?y.frontFixed.push(P):y.backFixed.push(P)}else y.normal.push(P);return y},{aboveAll:[],frontFixed:[],normal:[],backFixed:[]}),S=y=>y in b?b[y]:y;return{aboveAll:Z.default.unique(x.aboveAll).map(S),frontFixed:Z.default.unique(x.frontFixed).map(S),normal:Z.default.unique(x.normal).map(S),backFixed:Z.default.unique(x.backFixed).map(S)}}}static getCorrectedOrderForPage({mixedWidgets:o,pageOrder:t,addViewports:r=[],viewportsForCorrection:i=["default","tablet_portrait","phone_portrait"]}){let n=Z.default.compact(vh(o,"id").map(c=>c?.get("type")!=="background"?c:null)),s=vh([...Object.keys(t),...r]),l={};for(let c of s){let d=t[c]?nt(t[c]):nt(Wk);i.includes(c)?l[c]=It.getWidgetOrder(n,d,c):l[c]=d}return l}static getAttributeForViewport(o,t,r){return hi({target:o,viewport:t,pageId:o.get("pid")}).get(r)}getFullOrder(){return this._order}_fillNewViewport(o,t){let r=o.get("_id"),i={};this._order[r][t]=i;let n={},s=this.mag.pages.find(c=>c!==o&&c.getViewportParam(t,"enabled")&&this._order[c.get("_id")]&&this._order[c.get("_id")][t]);Z.default.each(this._order[r].default,(c,d)=>{if(d==="aboveAll"&&s){i[d]=Z.default.clone(this._order[s.get("_id")][t].aboveAll);return}i[d]=[];let p=i[d];Z.default.each(Z.default.flatten(c),m=>{let u=this._getModelFromMag(m);if(!u)return;let g=this.getValueForViewport(u,t,"pack_id",!0),h=!!this.getValueForViewport(u,t,"fixed_position",!0);g?(n[g]||(n[g]=[],h&&d==="normal"?(i.frontFixed=i.frontFixed||[],i.frontFixed.push(n[g])):!h&&(d==="frontFixed"||d==="backFixed")?(i.normal=i.normal||[],i.normal.push(n[g])):p.push(n[g])),n[g].push(m)):h&&d==="normal"?(i.frontFixed=i.frontFixed||[],i.frontFixed.push(m)):!h&&(d==="frontFixed"||d==="backFixed")?(i.normal=i.normal||[],i.normal.push(m)):p.push(m)})});let l=c=>{Z.default.each(c,d=>{Z.default.each(d,p=>{p.widgetsOrder[r]&&(p.widgetsOrder[r][t]=JSON.parse(JSON.stringify(i)))})})};l(Ot.undoStacks),l(Ot.redoStacks)}_fillInitialOrder(o){let t=o.get("order"),r=Z.default.flatten([].concat(t.default.aboveAll,t.default.frontFixed,t.default.normal,t.default.backFixed)),i={};this.mag.pages.each(d=>d.widgets.each(p=>{p.get("is_global")&&p.get("originId")&&(i[p.get("originId")]=p.get("_id"))})),Z.default.each(t,d=>{Z.default.each(d,p=>{Z.default.each(p,(m,u)=>{m instanceof Array?p[u]=m.map(g=>i[g]||g):p[u]=i[m]||m})})});let n=Z.default.filter(Z.default.map(this.getGlobalWids(),d=>d.id),d=>!r.includes(d)),s=this.mag.pages.find(d=>d.get("num")===1),l=this.getOrder(s,"default");Z.default.each(Fu,d=>{l[d]=Z.default.filter(l[d],p=>p instanceof Array?!!Z.default.compact(Z.default.map(p,m=>n.includes(m)?!0:null)).length:n.includes(p))}),Z.default.each(t,d=>{Z.default.each(d,(p,m)=>{p.splice.apply(p,[0,0].concat(l[m]))})}),It.conditionalSet(o,t),It.conditionalSave(o,t);let c=d=>{Z.default.each(d,p=>{Z.default.each(p,m=>{m.widgetsOrder[o.get("_id")]=JSON.parse(JSON.stringify(o.get("order")))})})};c(Ot.undoStacks),c(Ot.redoStacks)}_bindPageEvents(o){if(!this._order[o.get("_id")]){let r=o.getViewportParam("tablet_portrait","enabled"),i=o.getViewportParam("phone_portrait","enabled"),n=["default"];r&&n.push("tablet_portrait"),i&&n.push("phone_portrait");let s=It.getCorrectedOrderForPage({mixedWidgets:[...this.mag.globalWidgets,...o.widgets],pageOrder:o.get("order"),addViewports:n});this._order[o.get("_id")]=nt(s)}o.on("widget:remove",(r,i)=>{i.changeParentPage||(this.mag.pages.each(n=>{Oe.viewports.forEach(s=>{let l=s.name;this._order[n.get("_id")][l]&&this.removeWidsFromOrder(this._order[n.get("_id")][l],[r.id])})}),this.saveAffectedPages(),this._updateCalculatedIndex())}),o.on("widgets:remove",(r,i)=>{i.changeParentPage||(this.mag.pages.each(n=>{Oe.viewports.forEach(s=>{let l=s.name;this._order[n.get("_id")][l]&&this.removeWidsFromOrder(this._order[n.get("_id")][l],r)}),setTimeout(()=>{It.conditionalSave(n,this._order[n.get("_id")])},0)}),this._updateCalculatedIndex())});let t=r=>i=>{let n=i.previousAttributes();if((!n["viewport_"+r]||!n["viewport_"+r].enabled)&&i.get("viewport_"+r).enabled){let s=this._order[i.get("_id")];if(!s[r])this._fillNewViewport(i,r);else{let l={},c=s.default,d=s[r];for(let p of Fu){let m=It.mergeOrderItems({basicOrder:c[p],orderForMerge:d[p],models:[...this.mag.globalWidgets,...i.widgets],viewport:r});l[p]=m}this._order[i.get("_id")][r]=l}It.conditionalSave(i,this._order[i.get("_id")]),this._updateCalculatedIndex()}};o.on("change:viewport_phone_portrait",t("phone_portrait")),o.on("change:viewport_tablet_portrait",t("tablet_portrait"))}getGlobalWids(){return this.mag.globalWidgets.models}getWidsOrder(o,t={}){let r=o.get("order"),i=[];return Z.default.each(Oe.viewports,n=>{let s=t.viewport&&t.viewport!==n.name?void 0:n.name;if(s&&r[s])for(let l of Object.keys(r[s])){let c=t.type&&t.type!==l?void 0:l;c&&r[s][c]&&(i=i.concat(Z.default.flatten(r[s][c])))}}),i}restoreViewportToDefault(o,t){let r=o.get("_id");!this._order[r][t]||t==="default"||(this._fillNewViewport(o,t),It.conditionalSet(o,this._order[r]),this._updateCalculatedIndex())}_updateCalculatedIndex(o){for(let t in this._order)if(this._order.hasOwnProperty(t)){this._calculated[t]={};let r=this._calculated[t];Oe.viewports.forEach(i=>{let n=i.name;if(r[n]={},!this._order[t][n])return;let s=Z.default.flatten(Z.default.map(Fu,c=>Z.default.flatten(this._order[t][n][c]))),l=100+s.length;Z.default.each(s,c=>{r[n][c]=l--})})}Re.trigger("index:changed",this._order,o)}updateFromSocket(o){Object.assign(this._order,o),this._updateCalculatedIndex(!0)}getZIndex(o,t,r){return!this._calculated[t]||!this._calculated[t][r]||!this._calculated[t][r][o]?100:this._calculated[t][r][o]}getOrder(o,t){return o?t?(this._order[o.get("_id")][t]||(this._order[o.get("_id")][t]=JSON.parse(JSON.stringify(this._order[o.get("_id")].default))),JSON.parse(JSON.stringify(this._order[o.get("_id")][t]))):this._order[o.get("_id")]:this._order}_doSnapshop(){return JSON.parse(JSON.stringify(this._order))}snapshot(){let o=this._snapshot;return this._snapshot=this._doSnapshop(),o}applySnapshot(o){let t=[];this.mag.pages.each(r=>{let i=r.get("wids");r.widgets.each(n=>{n.get("is_global")&&i.includes(n.get("_id"))&&t.push(n.get("_id"))})}),Z.default.each(o,(r,i)=>{let n=this.mag.pages.get(i);n&&Z.default.each(r,s=>{Z.default.each(s,(l,c)=>{s[c]=Z.default.compact(Z.default.map(l,d=>d instanceof Array?Z.default.compact(Z.default.map(d,p=>!t.includes(p)&&!n.widgets.get(p)?null:p)):!t.includes(d)&&!n.widgets.get(d)?null:d))})})}),this._order=o,this.mag.pages.each(r=>{let i=this._order[r.get("_id")];i&&It.conditionalSet(r,i)}),setTimeout(()=>{let r=[];this.mag.pages.each(i=>{let n=i.get("wids");i.widgets.each(s=>{s.get("is_global")&&n.includes(s.get("_id"))&&r.push(s.get("_id"))})}),Z.default.each(this._order,(i,n)=>{let s=this.mag.pages.get(n);s&&(Z.default.each(i,(l,c)=>{Z.default.each(l,(d,p)=>{l[p]=Z.default.compact(Z.default.map(d,g=>g instanceof Array?Z.default.compact(Z.default.map(g,h=>!r.includes(h)&&!s.widgets.get(h)?null:h)):!r.includes(g)&&!s.widgets.get(g)?null:g));let m=[],u=Z.default.compact(Z.default.map(r,g=>{let h=!1;return Z.default.each(l,b=>{h||Z.default.flatten(b).includes(g)&&(h=!0)}),h||Z.default.each(this._order,(b,x)=>{if(x===n)return;let S=b[c]||b.default,y=!1;Z.default.each(S,(C,P)=>{y||Z.default.flatten(C).includes(g)&&(y=P)}),y&&Z.default.each(S[y],(C,P)=>{if(C===g&&(h={idx:P,group:y,global:g}),C instanceof Array){if(m.includes(g))return;C.includes(g)&&(m=m.concat(C),h={idx:P,global:g,group:y,pack:C})}})}),h===!0?null:h}));Z.default.each(Z.default.sortBy(u,(g,h)=>g.idx<h.idx?1:-1),g=>{l[g.group].splice(g.idx,0,g.pack?g.pack:g.global)})})}),It.conditionalSave(s,i))}),this._updateCalculatedIndex()},0)}setOrderForPage(o,t,r,i){let n=this.getGlobalWids();this._order[t.id][r]=o,It.conditionalSet(t,this._order[t.id]);let s=(d,p)=>{let m=null;return Z.default.each(d,u=>{Z.default.each(u,g=>{if(g instanceof Array){let h=Z.default.filter(n,b=>g.includes(b.id));!Z.default.isEmpty(h)&&h[0].get("pack_id")===p&&(m=g)}})}),m},l=(d,p)=>{let m=!1;Z.default.each(d,u=>{Z.default.each(u,(g,h)=>{if(g instanceof Array&&!m){let b=g.indexOf(p);b!==-1&&(m=!0,g.length<=2?u.splice(h,1,g[0],g[1]):(g.splice(b,1),u.splice(h,0,p)))}})})},c=(d,p,m,u,g)=>{let h=u?s(d,m):null;u&&this.removeWidsFromOrder(d,u),g&&Z.default.each(g,b=>{l(d,b)}),h&&Array.prototype.splice.apply(h,[0,h.length].concat(JSON.parse(JSON.stringify(p))))};if(i){Z.default.each(this._order,(p,m)=>{Z.default.each(p,(u,g)=>{m!==t.id&&r===g&&(c(u,i.pack,i.pack_id,i.added,i.removed,r),It.conditionalSet(this.mag.pages.get(m),this._order[m]))})});let d=p=>{Z.default.each(p,m=>{Z.default.each(m,u=>{Z.default.each(u.widgetsOrder,(g,h)=>{h!==t.get("_id")&&Oe.viewports.forEach(b=>{let x=b.name;u.widgetsOrder[h][x]&&c(u.widgetsOrder[h][x],i.pack,i.pack_id,i.added,i.removed,x)})})})})};d(Ot.undoStacks),d(Ot.redoStacks)}this._syncAbovePages(t.id,r),this._updateCalculatedIndex()}getCurrentGroup(o,t){let r="";return Z.default.each(o,(i,n)=>{if(i.indexOf(t)!==-1){r=n;return}let l=i.filter(c=>c instanceof Array);Z.default.each(l,c=>{c.indexOf(t)!==-1&&(r=n)})}),r}removeWidsFromOrder(o,t){Z.default.each(t,function(r){Z.default.each(o,function(i){let n=i.indexOf(r);n!==-1&&i.splice(n,1);let s=null,l=i.filter(c=>c instanceof Array);if(Z.default.each(l,c=>{let d=c.indexOf(r);d!==-1&&(c.splice(d,1),c.length===0&&(s=c))}),s){let c=i.indexOf(s);c!==-1&&i.splice(c,1)}})}.bind(this))}_moveWidsTo(o,t,r,i){let n=Z.default.compact(t.map(function(s){if(Z.default.flatten(r).includes(s))return null;let l=null;return Z.default.each(o,c=>{c!==r&&(l||(l=Z.default.find(c,d=>d instanceof Array&&d.includes(s))))}),l?JSON.parse(JSON.stringify(l)):s}));this.removeWidsFromOrder(o,Z.default.flatten(n)),Z.default.each(n,function(s){r.unshift(i||s)})}moveWidsToFix(o,t,r,i){this._moveWidsTo(o,t.filter(function(n){return!o.frontFixed.includes(n)&&!o.backFixed.includes(n)}.bind(this)),i?o.backFixed:o.frontFixed,r)}moveWidsToFrontFixed(o,t,r){this._moveWidsTo(o,t,o.frontFixed,r)}moveWidsToBackFixed(o,t,r){this._moveWidsTo(o,t,o.backFixed,r)}moveWidsToNormal(o,t,r){this._moveWidsTo(o,t,o.normal,r)}moveWidsToAbove(o,t,r){this._moveWidsTo(o,t,o.aboveAll,r)}_syncAbovePages(o,t){let r=this._order[o][t].aboveAll;Z.default.each(this._order,(i,n)=>{n!==o&&i[t]&&i[t].aboveAll&&(i[t].aboveAll.splice.apply(i[t].aboveAll,[0,i[t].aboveAll.length,...r]),It.conditionalSet(this.mag.pages.get(n),i))})}addWidgetsToDisabledViewport(o,t,r){let i=this._order[o],n=i&&i[r],s=It.insertWidgetsIntoViewport({pageOrder:n,models:t,viewport:r});this._order[o][r]=s}static insertWidgetsIntoViewport({pageOrder:o,models:t,viewport:r}){let i=o?nt(o):nt(Wk),n=[],s={};for(let c of t){let d=hi({target:c,viewport:r,pageId:c.get("_id")}),p=d.get("pack_id"),m=d.get("_id");p&&Array.isArray(s[p])?s[p].unshift(m):p&&(s[p]=[m]),n.push(d)}for(let c of n){let d=c.get("_id"),m=c.get("pack_id")||d;c.get("is_above")?i.aboveAll.unshift(m):c.get("fixed_position")?i.frontFixed.unshift(m):i.normal.unshift(m)}let l=c=>c in s?s[c]:c;return{aboveAll:Z.default.unique(i.aboveAll).map(l),frontFixed:Z.default.unique(i.frontFixed).map(l),normal:Z.default.unique(i.normal).map(l),backFixed:Z.default.unique(i.backFixed).map(l)}}moveWidget(o,t,r,i=o.getCurrentViewport()){let n=this._order[o.get("_id")][i];Z.default.each(Fu,s=>{let l=n[s],c=l.map(d=>{if(d instanceof Array){let p=d.map(m=>t.find(u=>u.get("_id")===m)&&m);return p.length===0||p.filter(m=>!!m).length===0?null:p.filter(m=>!!m).length===d.length?d:p}else return t.find(p=>p.get("_id")===d)&&d}).reduce((d,p,m,u)=>{if(p instanceof Array){let g=p.reduce((h,b,x,S)=>(b&&!S[x-1]&&h.push([b]),b&&S[x-1]&&h[h.length-1].push(b),h),[]);if(g.length===0)return d;if(g.length!==1||g[0].length!==p.length)return[...d,...g]}return p&&!u[m-1]?d.push([p]):p&&u[m-1]instanceof Array&&u[m-1].filter(g=>!g).length>0?d.push([p]):p&&u[m-1]&&d[d.length-1].push(p),d},[]);Z.default.each(c,d=>{let p=d[0],m=l.indexOf(p);if(m===-1){Z.default.each(l,g=>{if(g instanceof Array&&g.includes(p)){let h=g.indexOf(p),b=h-r;g.splice(h,d.length),g.splice.apply(g,[b<0?0:b,0].concat(d))}});return}let u=m-r;if(s==="frontFixed"&&u>=l.length){l.splice(m,d.length),n.backFixed.splice.apply(n.backFixed,[0,0].concat(d));return}if(s==="backFixed"&&u<0){l.splice(m,d.length),n.frontFixed.splice.apply(n.frontFixed,[n.frontFixed.length,0].concat(d));return}l.splice(m,d.length),l.splice.apply(l,[u<0?0:u,0].concat(d))})}),this._syncAbovePages(o.get("_id"),i),It.conditionalSet(o,this._order[o.get("_id")]),this._updateCalculatedIndex()}getPagesToSave(){return this.mag.pages.map(o=>o)}saveAffectedPages(){if(this.saveInProgress)return this.saveRequired||(this.saveRequired=new Promise(o=>{this.saveResolve=o})),this.saveRequired;{let o;return this.saveRequired&&(o=this.saveResolve),this.saveRequired=null,this.saveInProgress=!0,new Promise(t=>{Z.default.defer(()=>{let r=this._saveAffectedPages().then(()=>{if(this.saveInProgress=!1,this.saveRequired)return this.saveAffectedPages()});o&&o(r),t(r)})})}}_saveAffectedPages(){return Promise.all(Z.default.map(this.getPagesToSave(),o=>new Promise(t=>{It.conditionalSave(o,this._order[o.get("_id")],{success:t,error:t})})))}packOrder(o,t,r){let i={},n=o.reduce((l,c)=>(c instanceof Array?l=[...l,...c.map(d=>t.find(p=>p.id===d))]:l.push(t.find(d=>d.id===c)),l),[]).filter(l=>!!l);if(!n.length)return;let s=o.filter(l=>l instanceof Array);Z.default.each(n,l=>{let c=l.get("_id"),d=s.find(m=>m.includes(c));if(!o.includes(c)&&!d)return;let p=this.getValueForViewport(l,r,"pack_id");p&&(i[p]=i[p]||[],i[p].includes(c)||i[p].push(c),o.includes(i[p])||(d?o.splice(o.indexOf(d),0,i[p]):o[o.indexOf(c)]=i[p]),d?(d.splice(d.indexOf(c),1),d.length===0&&o.splice(o.indexOf(d),1)):o.includes(c)&&o.splice(o.indexOf(c),1))})}doPack(o,t,r,i){this.mag.pages.map(s=>{let l=this._order[s.get("_id")];Z.default.each(l,(c,d)=>{this.getValueForViewport(o[0],d,"pack_id")===i&&Z.default.each(c,p=>{this.packOrder(p,o,d)})}),It.conditionalSet(s,this._order[s.get("_id")])});let n=s=>{Z.default.each(s,l=>{Z.default.each(l,c=>{Z.default.each(c.widgetsOrder,(d,p)=>{p!==t.get("_id")&&Oe.viewports.forEach(m=>{let u=m.name;c.widgetsOrder[p][u]&&this.getValueForViewport(o[0],u,"pack_id")===i&&Z.default.each(c.widgetsOrder[p][u],g=>{this.packOrder(g,o,u)})})})})})};n(Ot.undoStacks),n(Ot.redoStacks),this._syncAbovePages(t.get("_id"),r),this._updateCalculatedIndex()}doUnpack(o,t,r){this.mag.pages.map(n=>{let l=this._order[n.get("_id")][r];Z.default.each(l,c=>{let d=o[0].get("_id"),p=c.find(m=>m instanceof Array&&m.includes(d));if(p){let m=c.indexOf(p);c.splice.apply(c,[m,1].concat(p))}}),It.conditionalSet(n,this._order[n.get("_id")])});let i=n=>{Z.default.each(n,s=>{Z.default.each(s,l=>{Z.default.each(l.widgetsOrder,(c,d)=>{d!==t.get("_id")&&Oe.viewports.forEach(p=>{let m=p.name;l.widgetsOrder[d][m]&&Z.default.each(l.widgetsOrder[d][m],u=>{let g=o[0].get("_id"),h=u.find(b=>b instanceof Array&&b.includes(g));if(h){let b=u.indexOf(h);u.splice.apply(u,[b,1].concat(h))}})})})})})};this._syncAbovePages(t.get("_id"),r),i(Ot.undoStacks),i(Ot.redoStacks),this._updateCalculatedIndex()}getValueForViewport(o,t,r,i){if(i&&!Z.default.isEmpty(o["viewport_"+t]))return o["viewport_"+t][r];let n=o.toJSON(),s=n[r];return Oe.widgetViewportFields(o.get("type")).includes(r)?t==="default"?s:n["viewport_"+t]?n["viewport_"+t][r]:s:s}updateOrder(o,t,r,i,n,s){let l={},c={},d=(g,h)=>{let b=!1;return Z.default.each(this._order,x=>{x[h]&&Z.default.flatten(x[h].backFixed).includes(g)&&(b=!0)}),b},p={},m={},u=[];for(let g of t){let h=hi({target:g,viewport:r,pageId:g.get("pid")}),b=h.get("pack_id");u.push(h),b&&(p[b]=p[b]||[],p[b].unshift(g.get("_id")))}u.forEach(g=>{let b=this.getGlobalWids().concat(n?n.widgets.map(I=>I):[]),x=g.get("is_global"),S=g.get("is_above"),y=g.get("_id"),C=this.getCurrentGroup(o,y),P=!!g.get("fixed_position"),v=g.get("pack_id"),T=null,R="";if(v&&(Z.default.each(o,(I,M)=>{Z.default.each(I,D=>{if(D instanceof Array){let E=Z.default.find(b,A=>A.id===D[0]);E&&It.getAttributeForViewport(E,r,"pack_id")===v&&(T=D,R=M)}})}),c[v]||Z.default.each(i,I=>{let M=Z.default.find(I,D=>D instanceof Array&&D.includes(y));M&&(c[v]=JSON.parse(JSON.stringify(M)))})),S)R!=="aboveAll"&&(T=null),n!==s&&v?!T&&!l[v]&&c[v]?(this.moveWidsToAbove(o,[y],c[v]),l[v]=1):T&&!T.includes(y)?T.unshift(y):!T&&!m[v]&&!c[v]&&(this.moveWidsToAbove(o,[p[v]]),m[v]=1):!T&&v&&!m[v]&&!c[v]?(this.moveWidsToAbove(o,[p[v]]),m[v]=1):T&&!T.includes(y)?T.unshift(y):this.moveWidsToAbove(o,[y]);else if(P){R!=="frontFixed"&&R!=="backFixed"&&(T=null);let I=x&&d(y,r);x||n===s?C!=="frontFixed"&&C!=="backFixed"&&(n!==s&&v?!T&&!l[v]&&c[v]?(this.moveWidsToFix(o,[y],c[v],I),l[v]=1):T&&!T.includes(y)?T.unshift(y):!T&&!m[v]&&!c[v]&&(this.moveWidsToFix(o,[p[v]],void 0,I),m[v]=1):!T&&v&&!m[v]&&!c[v]?(this.moveWidsToFix(o,[p[v]],void 0,I),m[v]=1):T&&!T.includes(y)?T.unshift(y):this.moveWidsToFix(o,[y],void 0,I)):this.removeWidsFromOrder(o,[y])}else R!=="normal"&&(T=null),x||n===s?C!=="normal"&&(n!==s&&v?!T&&!l[v]&&c[v]?(this.moveWidsToNormal(o,[y],c[v]),l[v]=1):T&&!T.includes(y)?T.unshift(y):!T&&!m[v]&&!c[v]&&(this.moveWidsToNormal(o,[p[v]]),m[v]=1):!T&&v&&!m[v]&&!c[v]?(this.moveWidsToNormal(o,[p[v]]),m[v]=1):T&&!T.includes(y)?T.unshift(y):this.moveWidsToNormal(o,[y])):this.removeWidsFromOrder(o,[y])})}updateIndexAddFromTemplate(o,t,r=!0){this.mag.pages.each(n=>{let s=this._order[n.get("_id")];n!==o&&It.extendOrder(s,t),r?It.conditionalSave(n,this._order[n.get("_id")]):It.conditionalSet(n,this._order[n.get("_id")])});let i=n=>{Z.default.each(n,(s,l)=>{Z.default.each(s,c=>{Z.default.each(c.widgetsOrder,(d,p)=>{p===o.get("_id")&&l===p||c.widgetsOrder[p]&&It.extendOrder(c.widgetsOrder[p],t)})})})};i(Ot.undoStacks),i(Ot.redoStacks),this._updateCalculatedIndex()}updateIndex(o,t,r=!0){let i=this._order[o.get("_id")],n={};this.mag.pages.each(l=>{n[l.id]={},Oe.viewports.forEach(c=>{let d=c.name;if(Z.default.isEmpty(l.get("viewport_"+d))&&d!=="default")return;d&&!this._order[l.get("_id")][d]&&(this._order[l.get("_id")][d]=JSON.parse(JSON.stringify(this._order[l.get("_id")].default)));let p=Z.default.sortBy(t,m=>this.getZIndex(m.id,o.id,d));n[l.id][d]=p,this.updateOrder(this._order[l.get("_id")][d],p,d,i[d],l,o)}),r?It.conditionalSave(l,this._order[l.get("_id")]):It.conditionalSet(l,this._order[l.get("_id")])});let s=l=>{Z.default.each(l,(c,d)=>{Z.default.each(c,p=>{Z.default.each(p.widgetsOrder,(m,u)=>{u===o.get("_id")&&d===u||Oe.viewports.forEach(g=>{let h=g.name;p.widgetsOrder[u]&&p.widgetsOrder[u][h]&&n[u]&&this.updateOrder(p.widgetsOrder[u][h],n[u]&&n[u][h]||t,h,i[h],null,o.get("_id"))})})})})};this._syncAbovePages(o.get("_id"),o.getCurrentViewport()),s(Ot.undoStacks),s(Ot.redoStacks),this._updateCalculatedIndex()}};z(It,"mergeOrderItems",({basicOrder:o=[],orderForMerge:t=[],models:r=[],viewport:i="default"})=>{let n=Z.default.flatten(o),s=Z.default.flatten(t),l={},c=new Set,d=(g,h,b)=>{h&&Array.isArray(g[h])?g[h].push(b):h&&(g[h]=[b])},p=0;for(let g=0;g<n.length;g++){let h=n[g],b=r.find(S=>S.get("_id")===h),x=b?It.getAttributeForViewport(b,i,"pack_id"):null;if(s.includes(h)){let S=s[p];x&&d(l,x,S);let y=x||S;c.add(y),p++}else{x&&d(l,x,h);let S=x||h;c.add(S)}}let m=g=>g in l?l[g]:g;return Array.from(c).map(m)});var gf=It,cc=gf;Wn();je();var hf=ur.prototype,_M=ur.extend({idAttribute:"_id",urlRoot:"/api/mag/",PUBLISH_URL:"/api/publish/",UNPUBLISH_URL:"/api/unpublish/",CHECKDOMAIN_URL:"/api/checkdomain",SETDOMAIN_URL:"/api/mag/domain/",publish_attempts:0,user_templates:{},name:"Mag",undoKeys:[],initialize:function(){Ie.default.bindAll(this),this.globalWidgets=new Au,cf&&(this.pages=new cf,this.trashPages=new Ak,this.pages.on("change:screenshot",e=>{this.trigger("change:page:screenshot",e.id,e.get("screenshot"),"default")}),this.pages.on("change:viewport_phone_portrait change:viewport_tablet_portrait",e=>{let o=Object.keys(e.changedAttributes())[0],t=e.previousAttributes()[o]?.screenshot,r=e.attributes[o]?.screenshot;t!==r&&this.trigger("change:page:screenshot",e.id,r,o==="viewport_tablet_portrait"?"tablet_portrait":"phone_portrait")})),this.on("mag_state_changed",function(e){e&&e.socketUpdate||this.triggerSocketUpdate()},this),this.on("change:updated",function(e,o,t){this.trigger("mag_state_changed",t)},this),this.on("change:changed",function(e,o,t){if(o){if(this.trigger("changed"),t&&t.socketUpdate)return;this.triggerSocketUpdate({changed:o})}},this),this.on("change:pids",function(e,o,t){Ie.default.defer(Ie.default.bind(function(){this.pages.each(function(r){r&&o.indexOf(r.id)===-1&&this.pages.remove(r.id)},this)},this)),(!t||!t.xhr&&!t.socketUpdate&&!t.success)&&this.triggerSocketUpdate(this.pick("pids"),{})},this),this.on("change:opts",function(e,o,t){(!t||!t.socketUpdate)&&this.triggerSocketUpdate(this.pick("opts"))}),this.on("error",function(){this._saveduser&&this.set("user",this._saveduser),delete this._saveduser},this),Re.on("global_appear:widget",function(e){this.globalWidgets.add(e)}.bind(this)),Re.on("global_disappear:widget",function(e){this.globalWidgets.remove(e)}.bind(this))},parse:function(e){return this.has("changed")&&delete e.changed,Ie.default.isObject(this.get("user"))&&delete e.user,e.last_changed=e.last_changed&&new Date(e.last_changed),e.user&&(this.user=new Kd(e.user,{parse:!0})),hf.parse.apply(this,arguments)},save:function(){if(!this.get("user"))return hf.save.apply(this,arguments);let e=hf.save.apply(this,arguments);return this.set("changed",!0),e},getPage:function(e){return this.pages.get(e)},addPage:function(e,o,t,r=void 0){e=e||{},!this._addBlock&&(this._addBlock=!0,e.num=e.num||this.getMaxNum()+1,e.mid=this.id,e.order=this.hasGlobalWidgets()?{default:cc.getWidgetOrder(this.globalWidgets.models,r)}:void 0,Br.default.ajax({url:"/api/page/",method:"POST",dataType:"json",data:e,success:function(i){this._addBlock=!1;let n=new jr(i.page,{parse:!0});i.edit_params&&(window.RM.constructorRouter.mag.edit_params.set(i.edit_params),window.RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),window.RM.constructorRouter.textStyles.generateCSS("link","constructor",document));let s=i.textStyles,l=i.linkStyles,c=i.listStyles;if(i.edit_params){let d=Ny(i.edit_params.paragraph_styles||[]);d.length&&d.forEach(m=>{s.some(u=>u.name===m.name)||s.push(m)});let p=Fy(i.edit_params.link_styles||[]);p.length&&p.forEach(m=>{l.some(u=>u.name===m.name)||l.push(m)})}_u({newTextStyles:s,newLinkStyles:l,newListStyles:c}),n.set("parentPage",null),t||this.onAdd(n),o&&o(n)},error:function(i){if(this._addBlock=!1,i.status===400)try{o(JSON.parse(i.responseText))}catch{alert("Seems there is a connection problem.")}else alert("Seems there is a connection problem.")},context:this}))},onAdd:function(e,o){this.pages.add(e);let t;t=Ie.default.clone(this.get("pids")),t.push(e.id),t=(0,Ie.default)(t).chain().uniq().compact().value(),this.set({pids:t},o)},getActivePages:function(){return this.pages.filter(function(e){return Ie.default.include(this.get("pids"),e.id)},this)},getTitle:function(){return this.get("title")||"Project Title"},getMaxNum:function(){let e=Ie.default.max(Ie.default.map(this.getActivePages(),function(o){return o.get("num")}));return(!e||e<0)&&(e=0),e},loadFull:function(e){let o=e.success;e.success=Ie.default.bind(function(t,r,i){let n=Ie.default.clone(t);this.pages.reset(n.pages,{parse:Ie.default.has(e,"parse")?e.parse:!0}),delete n.pages;let s=n.user.email===window.RM.constructorRouter.me?.get("email"),l=n.roleName;(s||l==="member")&&(l=Ze.getCurrentProjectRole(n.num_id)),this.roleName=l,this.rolePermissions=l==="editor"?n.editorPermissions:n.rolePermissions,this.teamRole=n.roleName,delete n.roleName,delete n.rolePermissions,delete n.editorPermissions,this.set(this.parse(n)),this.initGlobalWidgets(),Re.trigger("mag:loadfull:complete"),o&&o(t,r,i)},this),Br.default.ajax(Ie.default.extend(e,{url:"/api/magFullById/"+this.get("num_id"),dataType:"json"}))},setMag:function(e){let o=Ie.default.clone(e);this.pages.reset(o.pages,{parse:!0}),delete o.pages,this.set(this.parse(o)),this.initGlobalWidgets()},fetchTrashPages:function(e={}){return Rk(this.get("num_id")).then(o=>{o&&this.trashPages.reset(o,{parse:!0});let t=!!(o&&o.length);return this.get("has_deleted_pages")!==t&&this.set({has_deleted_pages:t},e),o})},sendPagesToTrash:function(e=[]){return zk(this.get("num_id"),e.map(o=>o.get("_id"))).then(()=>{e.map(o=>{this.trashPages.get(o.get("_id"))||this.trashPages.add(o)})})},restorePage:async function(e,o,t=!1){o=o||{},Br.default.ajax({type:"POST",url:"/api/user/permissions/can_create_page",data:JSON.stringify({mag:this.toJSON()}),contentType:"application/json",context:this,success:function(){Br.default.get("/api/pageFullById/"+e,Ie.default.bind(function(r){r=new jr(r,{parse:!0}),t||this.onAdd(r),this.trashPages.remove(r),this.set("has_deleted_pages",!!this.trashPages.length),t||this.save(),o.success&&o.success(r)},this)).fail(o.error)},error:o.error})},restoreMag:function(e){Br.default.ajax({type:"POST",url:"/api/mag/"+this.get("num_id")+"/revert-version",success:function(){typeof e=="function"&&e()},error:function(){console.log("Error while restore :(")},context:this})},emptyTrash:function(){return this.deleteTrashPages().then(()=>{this.trashPages.reset(),this.trashPages.triggerSocketEmptyTrash(),this.set("has_deleted_pages",!1)})},deleteTrashPage:function(e,o){o=o||{};let t=this.trashPages.get(e)||this.pages.get(e);Br.default.ajax({url:"/api/page/"+e+"/trash",type:"DELETE",success:function(){this.trashPages.get(e)&&(this.trashPages.remove(t),this.set("has_deleted_pages",!!this.trashPages.length)),o.success&&o.success()},error:o.error,context:this})},deleteTrashPages:function(e=[]){return Ek(this.get("num_id"),e).then(()=>{e.forEach(o=>{let t=this.trashPages.get(o);t&&this.trashPages.remove(t)}),this.set("has_deleted_pages",!!this.trashPages.length)})},getPageNumId:function(e,o){let r=(o&&o.onlyActive?(0,Ie.default)(this.getActivePages()):this.pages).find(function(i){return i.get("num")===e});return r&&r.get("num_id")},getPageId:function(e,o){let r=(o&&o.onlyActive?(0,Ie.default)(this.getActivePages()):this.pages).find(function(i){let n=i.get("num"),s=i.get("uri");return n&&e&&n.toString()===e.toString()||s&&e&&s.toString()===e.toString()});return r&&r.id},getPageUri:function(e){let o=this.pages.find(function(t){return t.get("_id")==e});return o&&(o.get("uri")||o.get("num"))},getPageDataUri:function(e){let o=this.pages.find(function(t){return t.get("_id")==e});return o&&o.get("uri")},getPageNum:function(e){let o=this.pages.find(function(t){return t.get("_id")==e});return o&&o.get("num")},getWidgetPage:function(e){return Ie.default.find(this.pages.models,function(o){return Ie.default.find(o.widgets.models,function(t){return t.get("_id")===e})})},getWidgetById:function(e){let o;return Ie.default.find(this.pages.models,function(t){let r=Ie.default.find(t.widgets.models,function(i){return i.get("_id")===e});return r&&(o=r),r}),o},deletePage:function(e,o){let t=Ie.default.reject(this.get("pids"),function(l){return l===e.id},this),r,i,n,s;if(Ie.default.isEmpty(t))return!1;this.get("master_share_pid")===e.get("_id")&&this.unset("master_share_pid"),r=e.getOwnGlobalWidgets(),Ie.default.isEmpty(r)||(i=this.pages.get(t[0]),n=this.changeParentPage(r,i,{silent:!0}),s=r.concat(n),window.RM.constructorRouter.workspace.save_group(s,{skipHistory:!0})),this._deleteXHR&&this._deleteXHR.abort(),this._deleteXHR=this.save({pids:t},{success:Ie.default.bind(function(){e.isEmptyPage||(this.set("has_deleted_pages",!0),this.trigger("change:has_deleted_pages",this)),o&&o(),e.isEmptyPage&&!this.get("shared")&&this.deleteTrashPage(e.id)},this)}),e.save({trash_date:new Date},{silent:!0,noSocketUpdate:!0,patch:!0})},checkDeletingPages:function(e=[]){if(e.find(r=>window.RM.constructorRouter.isPageLocked(r))!==void 0)return!1;let t=Ie.default.reject(this.get("pids"),function(r){return e.includes(r)},this);return!Ie.default.isEmpty(t)},deletePages:function(e,o){let t=Ie.default.reject(this.get("pids"),function(s){return e.includes(s)},this);if(Ie.default.isEmpty(t)){o&&o(new Error("can not delete all pages"));return}this.get("master_share_pid")&&e.includes(this.get("master_share_pid"))&&(this.unset("master_share_pid"),this.save({}));let r=[],i=[],n=[];if(e.forEach(s=>{let l=this.getPage(s);n=n.concat(l.getOwnGlobalWidgets()),l.isEmptyPage?r.push(l):i.push(l)}),!Ie.default.isEmpty(n)){let s=this.pages.get(t[0]),l=this.changeParentPage(n,s,{silent:!0}),c=n.concat(l);window.RM.constructorRouter.workspace.save_group(c,{skipHistory:!0})}this._deleteXHR&&this._deleteXHR.abort(),this._deleteXHR=this.save({pids:t},{success:()=>{i.length&&(this.set("has_deleted_pages",!0),this.trigger("change:has_deleted_pages",this)),o&&o({deleteNotEmptyPages:!!i.length}),r.length&&(this.get("shared")?i=i.concat(r):this.deleteTrashPages(r.map(s=>s.get("_id")))),i.length&&this.sendPagesToTrash(i)},error:()=>{o&&o(new Error("save project pids error"))},patch:!0})},deleteMag:function(e){Br.default.ajax({type:"POST",url:"/api/mags/archive",data:JSON.stringify({mag_num_ids:[Number(this.get("num_id"))],folder_num_ids:[]}),contentType:"application/json; charset=utf-8",success:function(){typeof e=="function"&&e()},error:function(o){console.log("Error deleting mag: "+o.responseText)},context:this})},publish:function(e,o){this.updateUsedFonts({success:Ie.default.bind(function(){let t={major:e||void 0,description:e&&o||void 0};this.publish_attempts+=1,Br.default.ajax({type:"POST",url:this.PUBLISH_URL+this.get("num_id"),global:!1,data:t,success:Ie.default.bind(function(r){this.set(Ie.default.extend(this.parse(r),{changed:!1})),this.publish_attempts=0},this),error:Ie.default.bind(function(r){this.trigger("mag_publish_error",r.responseJSON||{error:r.statusText,message:r.responseText})},this)})},this),error:Ie.default.bind(function(){this.trigger("mag_publish_error",{error:"Used fonts save error",message:"Used fonts save error"})},this)})},unpublish:function(){Br.default.ajax({type:"POST",url:this.UNPUBLISH_URL+this.get("num_id"),success:Ie.default.bind(function(){this.set({is_published:null,published:null,updated:null})},this),error:Ie.default.bind(function(){console.error(arguments)},this)})},checkDomain:function(e,o){return Br.default.ajax({type:"POST",url:this.CHECKDOMAIN_URL,data:{num_id:this.get("num_id"),domain:e},success:Ie.default.bind(function(t){this.set({last_checked_domain:e},{silent:!0}),o&&o(t)},this),error:Ie.default.bind(function(){console.error(arguments),o&&o(null)},this)})},mapDomain:function(e,o){return o=o||{},Br.default.ajax({type:"POST",url:this.SETDOMAIN_URL+this.get("num_id"),data:{domain:e,status:"on"},success:Ie.default.bind(function(t){this.set({domain:e},{silent:!0}),o.success&&o.success(t)},this),error:Ie.default.bind(function(t){return t&&t.status>=500?o.error(null):o.error&&o.error({badDNSSettings:!0})},this)})},unmapDomain:function(e){return Br.default.ajax({type:"POST",url:this.SETDOMAIN_URL+this.get("num_id"),data:{status:"off"},success:Ie.default.bind(function(o){this.unset("domain",{silent:!0}),e&&e(o)},this),error:Ie.default.bind(function(){console.error(arguments),e&&e(null)},this)})},loadUserTemplates(){return m0().then(e=>(this.isTemplatesLoaded=!0,this.user_templates=e,e)).catch(()=>{throw this.isTemplatesLoaded=!1,new Error("Error loading page templates")})},getPageTemplate:function(e){let o=null;return Ie.default.any(this.user_templates,function(t){if(t.id==e)return o=t,!0}),o},addCustomPageTemplate:function(e){let o=Ie.default.find(this.user_templates,function(t){return t.custom});o&&o.templates.unshift(e)},getAllWidgets(){let e=[];return Ie.default.each(this.pages.models,o=>{if(o.widgets.length){let t=o.attributes.wids;Ie.default.each(o.widgets.models,r=>{let i=Oe.viewport_list.reduce((n,s)=>(r[s]&&(n[s]=r[s]),n),{});t.includes(r.id)&&e.push({...r.attributes,...i,...r.hasNested&&r.widgets_collection?.models?{widgets_collection:r.widgets_collection.models}:{}})})}else Ie.default.each(o.attributes.wids,t=>e.push(t))}),e},getUsedFontsNames:function(){return new Set(Mt.getUsedFontsFromWidgetsModels({models:this.getAllWidgets(),onlyFontsNames:!0},Mt.fontsShortList))},getFontsShortList(){return Mt.fontsShortList},getUsedFonts:function(e){e=e||{};let o=this.edit_params?this.edit_params.get("fonts"):this.get("edit_params")?this.get("edit_params").fonts:[];return Mt.getUsedFontsFromWidgetsModels({...e,models:this.getAllWidgets(),customList:e.includeCustom?Ie.default.filter(o,{provider:"custom"}):[]},Mt.fontsShortList)},updateUsedFonts:function(e){e=e||{};let o=this.getUsedFonts({includeCustom:!0,excludeUnusedDefault:!0}),t=Mt.sortFontsByProvider(o);this.save(t,{patch:!0,url:this.url()+"?skip_changed=true",success:Ie.default.bind(function(){e.success&&e.success()},this),error:Ie.default.bind(function(){e.error&&e.error()},this)})},filterUnusedFonts:function(){let e=this.edit_params.attributes.fonts;if(!Ie.default.any(e,function(i){return i.provider=="typekit"&&i.hidden}))return;let t=Ie.default.pluck(Ie.default.where(this.getUsedFonts({includeCustom:!1}),{provider:"typekit"}),"css_name"),r=Ie.default.reject(e,function(i){return t.indexOf(i.css_name)===-1&&i.hidden&&i.provider=="typekit"});Ie.default.isEqual(Ie.default.pluck(r,"css_name"),Ie.default.pluck(e,"css_name"))||this.edit_params.save({fonts:r},{silent:!0})},getUsedStyles:function(e){return Mt.getUsedStylesFromWidgetsModels(this.getAllWidgets(),e,e==="link")},mergeEditParams:function(e){e=e||{};let o=this.edit_params,t,r=Ie.default.clone(o.get("paragraph_styles"))||[],i=!1;t=Ie.default.pluck(r,"_name"),Ie.default.each(e.paragraph_styles,function(l){Ie.default.contains(t,l._name)||(r.push(l),i=!0)}),i&&(o.set("paragraph_styles",r),window.RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document));let n=Ie.default.clone(o.get("link_styles"))||[],s=!1;t=Ie.default.pluck(n,"_name"),Ie.default.each(e.link_styles,function(l){Ie.default.contains(t,l._name)||(n.push(l),s=!0)}),s&&(o.set("link_styles",n),window.RM.constructorRouter.textStyles.generateCSS("link","constructor",document)),(i||s)&&this.save(),e.fonts&&e.fonts.length&&window.RM.constructorRouter.fonts.addFonts(e.fonts,"paste")},triggerEditParamsRewrite:function(e,o){JSON.stringify(e.paragraph_styles)!=JSON.stringify(o.paragraph_styles)&&window.RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),JSON.stringify(e.link_styles)!=JSON.stringify(o.link_styles)&&window.RM.constructorRouter.textStyles.generateCSS("link","constructor",document),JSON.stringify(e.fonts)!=JSON.stringify(o.fonts)&&window.RM.constructorRouter.fonts.appendFontsCssToDocument({version:"edit"},function(){window.RM.constructorRouter.trigger("font-added")})},fetchLastChanged:function(e){this.fetch({data:{fields:"last_changed"},noSocketUpdate:!0,success:Ie.default.bind(function(){this.previousAttributes()&&this.previousAttributes().last_changed?new Date(this.previousAttributes().last_changed).getTime()+300*1e3<new Date(this.get("last_changed")).getTime()?e({wasChanged:!0}):e({wasChanged:!1}):e({wasChanged:!1})},this)})},updateLastChanged:function(){this.set("last_changed",new Date)},changeParentPage:function(e,o,t){t=Ie.default.extend(t||{},{nosave:!0,changeParentPage:!0});let r=new Uk.default.Collection;return Ie.default.each(e,function(i){let n=i.get("pid"),s=this.pages.get(n);n!=o.id&&(i.set("pid",o.id,{silent:!0}),i.collection=o.widgets,o.addWidget(i,t),t.forceRemove=!0,s.removeWidgets([i.id],t),r.add(s))}.bind(this)),r.isEmpty()||r.add(o),r.models},removeGlobalWidgets:function(e){let o=Ie.default.difference(this.get("gwids"),e);this.save({gwids:o})},initGlobalWidgets:function(){let e=this.pages.chain().reduce(function(o,t){return[...o,...t.widgets.models]},[]).filter(function(o){return o.isGlobal()}).uniq(function(o){return o.get("_id")}.bind(this)).value();this.globalWidgets.set(e)},addGlobalWidgetsFromTemplate:function(e){let o=e.widgets.models.filter(i=>i.isGlobal()),t=Ie.default.map(o,i=>i.get("_id")),r=cc.getPartialOrder(e.attributes.order,t);RM.constructorRouter.indexController.updateIndexAddFromTemplate(e,r),this.initGlobalWidgets()},hasGlobalWidgets:function(){return this.globalWidgets&&this.globalWidgets.length>0},hasCodeInjection(){if(Ie.default.any(["ci_head","ci_body_top","ci_body_bottom","ci_css"],r=>this.get(r)))return!0;let o=!1,t=r=>{let i=(d,p)=>typeof d.get=="function"?d.get(p):d[p],n=!!(i(r,"type")==="iframe"&&i(r,"code"));if(!n||i(r,"use_iframe"))return;let l=(0,Gk.getEmbedType)(i(r,"code"))==="codeinjection";if(!l)return;let c=!!(Ie.default.all(Oe.viewport_listall,function(d){let p=r[d];return p&&p.hidden||!p})&&i(r,"hidden"));n&&l&&!c&&(o=!0)};return this.pages.each(function(r){r.widgets.length?r.widgets.each(t):r.attributes.wids.forEach(t)}),o},hasWidgetsWithType(e){return this.pages.some(o=>(o.widgets.length?o.widgets:o.attributes.wids).some(t=>(typeof t.get=="function"?t.get("type"):t.type)===e))},getViewportWidth(e){return!e||e==="default"?this.get("desktopWidth")||Oe.dictionary.default.width:e==="phone_portrait"?this.get("phoneWidth")||Oe.dictionary.phone_portrait.width:Oe.dictionary[e].width},setViewportWidth(e,o){e==="default"?this.set("desktopWidth",o):e==="phone_portrait"&&this.set("phoneWidth",o)},isPermissionAllowed(e){return e?((this.rolePermissions||[]).find((t={})=>t.name===e)||{}).value??!0:!0},increaseWidgetAddCounter(){let e=this.get("widgetAddCounter")||0;this.save({widgetAddCounter:++e},{patch:!0}),(e>0&&e<=20&&e%5===0||e>20&&e<=100&&e%10===0)&&se(he.WidgetTotal,{total:e})}}),dc=_M;HI();var Zn=B(pt());eu();Zp();var jk=ur.prototype,SM=ur.extend({id:"_pageOrder",url:"/api/pageOrder/",name:"PageOrder",isNew:function(){return!1},load:function(e){let o=e.pages.reduce(function(t,r){return t.push({id:r.id,num:r.get("num"),parentPage:r.get("parentPage")||null}),t},[]);return this.magId=e.get("_id"),this.set({order:o}),null},saveInProgress:function(){return this._xhr&&this._xhr.state()==="pending"},save:function(e){if(e.order)return this.orderPages(e.order),this._xhr&&this._xhr.abort(),this._xhr=Nn.prototype.save.apply(this,arguments),this._xhr.skipResponse=!0,this._xhr.fail(Zn.default.bind(function(o){if(o.responseJSON&&o.responseJSON.error&&o.responseJSON.error==="invalid order")return this.trigger("reorder");alert("Something went wrong while saving the pages order. Please, reload the page.")},this)),this._xhr},parse:function(e,o){if(o&&o.xhr&&o.xhr.skipResponse){jk.parse.apply(this,arguments);return}return jk.parse.apply(this,arguments)},orderPages:function(e,o={}){Zn.default.each(RM.constructorRouter.mag.getActivePages(),t=>{let r=Zn.default.find(e||this.get("order"),i=>i.id===t.id);r&&t.set({num:r.num,parentPage:r.parentPage||null},o)})},validateAndFixPageOrder(e){let o=Zn.default.pluck(this.get("order"),"num");(o[0]!==1||!Zn.default.isEqual(o,Zn.default.range(1,o.length+1)))&&this.fixPageOrder(e)},fixPageOrder(e){let o=e.getActivePages().map(t=>({id:t.get("_id"),num:t.get("num"),parentPage:t.parentPage||null}));this.fixNums(o,e.get("_id")||this.magId)},fixNums(e,o){let t=[],r={};return Zn.default.sortBy(e,"num").forEach((i,n)=>{t.push({id:i.id,parentPage:i.parentPage&&r[i.parentPage]?i.parentPage:null,num:n+1}),r[i.id]=i}),this.save({order:t,mid:o||this.magId})},reorderPagesAfterAdd({page:e,pageNum:o,magId:t}){let r=Array.from(this.get("order")),i=o||e.get("num"),n=i>r.length?r.length:r.findIndex(s=>s.num===i);r.splice(n,0,{id:e.get("_id"),num:i,parentPage:e.get("parentPage")}),this.fixNums(r,t)},reorderAfterDrag(e,o=0,t,r){let i=Array.from(this.get("order")),n=i.findIndex(d=>d.num===e);if(n===-1)return;let s=i.splice(n,o+1),l=e===t.num?e+1:t.num,c=i.findIndex(d=>d.num===l);c===-1&&(c=i.length),s.length&&(s[0]=t),i.splice(c,0,...s),this.fixNums(i,r)},deletePagesFromOrder(e,o){let r=this.get("order").filter(i=>!e.includes(i.id));return this.fixNums(r,o)},updateParentIds(e,o){let r=this.get("order").map(i=>e.includes(i.id)?{id:i.id,num:i.num,parentPage:o}:i);this.set("order",r)},removeParentIds(e){let t=this.get("order").map(r=>e.includes(r.id)?{id:r.id,num:r.num,parentPage:null}:r);this.set("order",t)}}),qk=SM;var Ao=B(pt());Za();ui();var Yk=function(e){this.edit_params=e,this.proxyMethods(["set","get","fetch","on","off","save"]),this.rememberStylesOrder(),this.on("sync",Ao.default.bind(this.rememberStylesOrder,this))};Yk.prototype={id:"_textStyles",isNew:function(){return!1},proxyMethods:function(e){let o=this,t=this.edit_params;Ao.default.each(e,function(r){o[r]=function(){return t[r].apply(t,arguments)}})},getList:function(e,o){let t=[];return e=="paragraph"&&(t=this.get("paragraph_styles")||[]),e=="link"&&(t=this.get("link_styles")||[]),o?Ao.default.clone(t):t},getStylesListSorted:function(e){let o=this.getList(e,!0);return o.sort(function(t,r){return t._sort-r._sort}),o},getOrder:function(e){return Ao.default.pluck(this.getList(e),"_sort")},rememberStylesOrder:function(){this.orderBefore={},this.orderBefore.paragraph=this.getOrder("paragraph"),this.orderBefore.link=this.getOrder("link")},generateCSS:function(e,o,t,r){Mt.generateCSS(e,o,t,this.getList(e),r)},findStyle:function(e,o){return Ao.default.findWhere(this.getList(e),{_name:o})},redefineStyle:function(e,o,t){let r=this.getList(e,!0);for(var i=0;i<r.length&&r[i]._name!=o;i++);if(i>=r.length)return;let n=Ao.default.clone(r[i]);r[i]=Ao.default.extend(n,t),this.save(e+"_styles",r)},reorder:function(e,o){let t=this.getList(e,!0);for(let r=0;r<t.length;r++)t[r]=Ao.default.clone(t[r]),t[r]._sort=Ao.default.indexOf(o,t[r]._name);this.set(e+"_styles",t)},addStyle:function(e,o){let t=this.getList(e,!0);return o=Ao.default.extend({_caption:"New style",_name:e+"-"+et.generateUUID(),_sort:t.length},o),t.push(o),this.save(e+"_styles",t),o},deleteStyle:function(e,o){let t=this.getList(e),r=Ao.default.findWhere(t,{_name:o});r&&(t=Ao.default.without(t,r),this.save(e+"_styles",t))},duplicateStyle:function(e,o){let t=this.getList(e,!0),r=Ao.default.findWhere(t,{_name:o});if(!r)return;let i=Ao.default.clone(r);return i._name=e+"-"+et.generateUUID(),t.push(i),this.save(e+"_styles",t),i},changeStyle:function(e,o){let t=this.getList(e,!0);for(var r=0;r<t.length&&t[r]._name!=o;r++);r>=t.length||(t[r]=Ao.default.clone(t[r]),this.save(e+"_styles",t))},restoreStyle:function(e,o,t){let r=this.getList(e);for(var i=0;i<r.length&&r[i]._name!=o;i++);i>=r.length||Ao.default.extend(r[i],t)}};var Xk=Yk;Y6();var Qn=B($t()),mc=B(Mo()),at=B(pt());tn();var Kk={"template-constructor-grid-guides-controller":Lt`
    <% if (offsetTop) { %>
        <div class="guide-columns ghost <%= zeroGutter ? 'zero-gutter' : '' %>" style="height: <%= offsetTop %>px; bottom: auto;">
            <% for (var i = 0; i < columnWidths.length; i++) { %>
                <div class="guide-column" style="width: <%= columnWidths[i] %>px;"></div>
            <% };%>
        </div>
    <% };%>
    <div class="guide-columns <%= zeroGutter ? 'zero-gutter' : '' %>" style="top: <%= offsetTop %>px; bottom: <%= offsetBottom %>px;">
        <% for (var i = 0; i < columnWidths.length; i++) { %>
            <div class="guide-column" style="width: <%= columnWidths[i] %>px;">
                <% if (zeroGutter) { %>
                    <svg viewBox="0 0 2 <%= maxGuideHeight %>" xmlns="http://www.w3.org/2000/svg" class="left-stroke">
                        <line x1="<%= i === 0 ? 0.5 : 1 %>" y1="0" x2="<%= i === 0 ? 0.5 : 1 %>" y2="100%" stroke-width="1"></line>
                    </svg>
                    <svg viewBox="0 0 2 <%= maxGuideHeight %>" xmlns="http://www.w3.org/2000/svg" class="right-stroke">
                        <line x1="<%= i === columnWidths.length - 1 ? 1.5 : 1 %>" y1="0" x2="<%= i === columnWidths.length - 1 ? 1.5 : 1 %>" y2="100%" stroke-width="1"></line>
                    </svg>
                <% };%>
            </div>
        <% };%>
    </div>
    <% if (offsetBottom) { %>
        <div class="guide-columns ghost <%= zeroGutter ? 'zero-gutter' : '' %>" style="height: <%= offsetBottom %>px; top: auto;">
            <% for (var i = 0; i < columnWidths.length; i++) { %>
                <div class="guide-column" style="width: <%= columnWidths[i] %>px;"></div>
            <% };%>
        </div>
    <% };%>
`};var Zk=B(Mo()),oa=B(pt());eu();var CM=ur.extend({idAttribute:"_id",name:"Guides",addPage:function(e,o){if(oa.default.isArray(this.get("pages"))){let t=oa.default.clone(this.get("pages"));t.push(e),this.set({pages:t},o)}return this},removePage:function(e){return oa.default.isArray(this.get("pages"))&&this.set({pages:oa.default.without(this.get("pages"),e)}),this}}),Jk=Zk.default.Collection.extend({model:CM,url:"/api/guides/",initialize:function(e,o){this.url+=""+o.mag.get("num_id")+"/"},getByPage:function(e){let o=this.find(function(t){return oa.default.contains(t.get("pages")||[],e.id)&&t.get("viewport")===e.getCurrentViewport()});if(!o){let t=RM.constructorRouter.mag.get("_id"),r=RM.constructorRouter.mag.pages.map(n=>n.get("_id")),i;try{i=JSON.parse(window.sessionStorage.getItem("RM-lastUsedGuidesSet")||"{}")[t]}catch{}i&&(o=this.find(function(n){return oa.default.intersection(n.get("pages")||[],r).length&&n.get("viewport")===e.getCurrentViewport()&&n.get("index")===i}))}return o||this.find(function(t){return t.get("index")===1&&t.get("viewport")===e.getCurrentViewport()})},getByIndex:function(e,o){return this.find(function(t){return t.get("index")===e&&t.get("viewport")===o})},setPage:function(e,o){let t=this.getByPage(e);t.get("viewport")===e.getCurrentViewport()&&t.removePage(e.id).save(),this.getByIndex(o,e.getCurrentViewport()).addPage(e.id).save()},comparator:function(e){return e.get("index")+e.get("viewport")}});var ra=B($t()),xo=B(mx()),Wu=class{constructor(o,t){this.type=["right","left"].includes(t)?"horizontal":"vertical",this.$el=(0,ra.default)(`<div class="distance-line distance-line-${this.type}"></div>`).appendTo(o),this.$length=(0,ra.default)('<span class="distance-length"></span>').appendTo(this.$el),["right","left"].includes(t)?(this.$markerLeft=(0,ra.default)('<span class="distance-marker-left"></span>').appendTo(this.$el),this.$markerRight=(0,ra.default)('<span class="distance-marker-right"></span>').appendTo(this.$el)):["top","bottom"].includes(t)&&(this.$markerTop=(0,ra.default)('<span class="distance-marker-top"></span>').appendTo(this.$el),this.$markerBottom=(0,ra.default)('<span class="distance-marker-bottom"></span>').appendTo(this.$el)),this.length=0}destroy(){this.$el.remove()}updateLength(o){this.length=o,this.$length.text(o)}update(o,t,r,i=!1,n=!1){let s=RM.constructorRouter.zoom.getZoom(),l=o*s,c=t*s,d=r*s;this.$el.toggleClass("only-text",i),this.$el.toggleClass("flip-text",n);let p=Math.round(Math.abs(t-r));if(this.type==="vertical"&&p<11){this.hide();return}if(this.type==="horizontal"&&p<8){this.hide();return}this.length!==p&&this.updateLength(p),this.type==="horizontal"?this.$el.css({height:1,left:Math.min(c,d),width:Math.abs(c-d),top:l}):this.$el.css({width:1,top:Math.min(c,d),height:Math.abs(c-d),left:l}),this.$el.toggleClass("visible",!0)}hide(){this.$el.removeClass("visible")}},ia=class e{constructor(o){this.workspace=o,this.linePool=xo.default.map(["top","left","right","bottom"],t=>({direction:t,line:new Wu(o.$origin,t)}))}getMovedRects(o){let t=1/0,r=1/0,i=-1/0,n=-1/0;return xo.default.each(o,s=>{t=Math.min(t,s.latestPosSizeAngle.bb_left),r=Math.min(r,s.latestPosSizeAngle.bb_top),i=Math.max(i,s.latestPosSizeAngle.bb_left+s.latestPosSizeAngle.bb_width),n=Math.max(n,s.latestPosSizeAngle.bb_top+s.latestPosSizeAngle.bb_height)}),{bb_left:t,bb_top:r,bb_width:i-t,bb_height:n-r}}static rectIntersection(o,t,r){switch(r){case"top":case"bottom":{let[i,n]=o.bb_left<t.bb_left?[o,t]:[t,o],s=n.bb_left-i.bb_left<i.bb_width,l=r==="top"?o.bb_top>t.bb_top:o.bb_top+o.bb_height<t.bb_top;return s&&l}case"left":case"right":{let[i,n]=o.bb_top<t.bb_top?[o,t]:[t,o],s=n.bb_top-i.bb_top<i.bb_height;return(r==="left"?o.bb_left>t.bb_left:o.bb_left+o.bb_width<t.bb_left)&&s}}return!1}static rectDist(o,t,r){switch(r){case"left":return o.bb_left<t.bb_left+t.bb_width?1/0:o.bb_left-(t.bb_left+t.bb_width);case"right":return t.bb_left<o.bb_left+o.bb_width?1/0:t.bb_left-(o.bb_left+o.bb_width);case"top":return o.bb_top<t.bb_top+t.bb_height?1/0:o.bb_top-(t.bb_top+t.bb_height);case"bottom":return t.bb_top<o.bb_top+o.bb_height?1/0:t.bb_top-(o.bb_top+o.bb_height)}}getCloserRect(o,t,r){let i=xo.default.difference(o,t),n=this.getMovedRects(t),s=xo.default.filter(i,d=>!d.outofbox&&!d.model.get("fixed_position")&&e.rectIntersection(n,d.latestPosSizeAngle,r)),l=xo.default.filter(s,d=>isFinite(e.rectDist(n,d.latestPosSizeAngle,r))),c=xo.default.sortBy(l,d=>e.rectDist(n,d.latestPosSizeAngle,r))[0];return{softIntersection:!!s.length,closerRect:c&&c.latestPosSizeAngle}}static getOffset(o,t,r){switch(r){case"right":case"left":{if(!t)return o.bb_top+o.bb_height/2;let[i,n]=o.bb_top<t.bb_top?[o,t]:[t,o];return i.bb_top+i.bb_height>n.bb_top+n.bb_height?n.bb_top+n.bb_height/2:n.bb_top+(i.bb_top+i.bb_height-n.bb_top)/2}case"top":case"bottom":{if(!t)return o.bb_left+o.bb_width/2;let[i,n]=o.bb_left<t.bb_left?[o,t]:[t,o];return i.bb_left+i.bb_width>n.bb_left+n.bb_width?n.bb_left+n.bb_width/2:n.bb_left+(i.bb_left+i.bb_width-n.bb_left)/2}}}drawLine({line:o,direction:t},r,i,{closerRect:n,softIntersection:s},l,c,d){if(!n&&s){o.hide();return}let p=0,m=0;switch(t){case"right":{p=r.bb_left+r.bb_width,m=n?n.bb_left:i.width;break}case"left":{p=r.bb_left,m=n?n.bb_left+n.bb_width:0;break}case"top":{p=r.bb_top,m=n?n.bb_top+n.bb_height:0;break}case"bottom":{p=r.bb_top+r.bb_height,m=n?n.bb_top:i.pageHeight;break}}let u=!1;switch(t){case"top":case"bottom":m>i.top+i.height&&(u=!0),m<i.top&&(u=!0);break;case"left":case"right":}if(u){o.hide();return}o.update(l,p,m,c,d)}updateLine({line:o,direction:t},r,i){let n=this.getMovedRects(r),{closerRect:s,softIntersection:l}=this.getCloserRect(this.workspace.blocks,r,t);this.drawLine({line:o,direction:t},n,i,{closerRect:s,softIntersection:l},e.getOffset(n,s,t))}collectLines(o,t,r,i){let n=xo.default.chain(o).filter(g=>{let h=wl(g.latestPosSizeAngle,g.model.get("fixed_position"),i),[b,x]=["top","bottom"].includes(t)?["bb_left","bb_width"]:["bb_top","bb_height"];if(!(Math.abs(r[b]-h[b])<8&&r[x]===h[x]))return!1;switch(t){case"left":return h.bb_left+h.bb_width<r.bb_left;case"right":return h.bb_left>r.bb_left+r.bb_width;case"top":return h.bb_top+h.bb_height<r.bb_top;case"bottom":return h.bb_top>r.bb_top+r.bb_height}}).sortBy(g=>{let h=["left","top"].includes(t)?-1:1,b=["left","right"].includes(t)?"bb_left":"bb_top",x=wl(g.latestPosSizeAngle,g.model.get("fixed_position"),i);return h*x[b]}).value();if(n.length<2)return;let s=n[0],l=wl(s.latestPosSizeAngle,s.model.get("fixed_position"),i),c=wl(n[1].latestPosSizeAngle,n[1].model.get("fixed_position"),i),[d,p]=["left","right"].includes(t)?["bb_left","bb_width"]:["bb_top","bb_height"],m=l[d]-c[d]-c[p],u=!0;return{coord:l[d]+l[p]+m,block:s,inline:xo.default.filter(n,(g,h)=>{if(h>1&&u){let b=wl(g.latestPosSizeAngle,g.model.get("fixed_position"),i);u=wl(n[h-1].latestPosSizeAngle,n[h-1].model.get("fixed_position"),i)[d]-b[d]-b[p]===m}return u})}}deleteLinePool(){this.linePool.forEach(o=>{o.line.destroy()}),this.linePool=[]}checkIfFilteringIsNeeded({guide:o,guides:t,renderedDistances:r,movedRect:i,isTopBottomFiltering:n=!1,isLeftRightFiltering:s=!1}){let l=o.blockBox,c=n?"center":s?"middle":null;if(s){let d=l.bb_left>i.bb_left+i.bb_width,p=i.bb_left>l.bb_left+l.bb_width;if(!d&&!p)return!1}else if(n){let d=i.bb_top>l.bb_top+l.bb_height,p=l.bb_top>i.bb_top+i.bb_height;if(!d&&!p)return!1}return c&&[c].includes(o.type)?!r.includes(o):r.includes(o)?!1:!t.find(p=>{let m=p.blockBox;if(m.bb_height===l.bb_height&&m.bb_width===l.bb_width&&m.bb_top===l.bb_top&&m.bb_left===l.bb_left&&[c].includes(p.type))return!0})}generateLinePool(o,t){let r=[...this.linePool];o.forEach(i=>{let n=i.blockBox,s=t.bb_left>n.bb_left+n.bb_width,l=n.bb_left>t.bb_left+t.bb_width,c=t.bb_top>n.bb_top+n.bb_height,d=n.bb_top>t.bb_top+t.bb_height,p=null;if(["top","bottom","middle"].includes(i.type)?p=s?"left":l?"right":null:["left","right","center"].includes(i.type)&&(p=c?"top":d?"bottom":null),p){let m=new Wu(this.workspace.$origin,p);r.push({direction:p,line:m,cid:i.cid})}}),this.linePool=[...r]}updateForRect(o,t,r,i,n){let s=i?o:{...o,bb_left:r.x,bb_top:r.y},l=xo.default.filter(t,m=>m?.block&&["top","bottom","middle"].includes(m.type)),c=xo.default.filter(t,m=>m?.block&&["left","right","center"].includes(m.type)),d=[];this.deleteLinePool(),this.generateLinePool(l,s),this.generateLinePool(c,s);let p=[];xo.default.each(this.linePool,m=>{switch(m.direction){case"left":case"right":{let u=xo.default.chain(l).filter(g=>this.checkIfFilteringIsNeeded({guide:g,guides:l,renderedDistances:p,movedRect:s,isLeftRightFiltering:!0})).sortBy(g=>{let h=g.blockBox;return m.direction==="left"?h.bb_left:-h.bb_left+h.bb_width}).value();if(u.length){let g=xo.default.find(u,S=>S.type==="middle"),h=g&&g.block===u[0].block?g:u[0],b=h.blockBox,x=0;x=h.y,p.push(h),this.drawLine(m,s,n,{closerRect:b,softIntersection:!1},x,!0,h.type==="bottom");return}d.push(m);break}case"top":case"bottom":{let u=xo.default.chain(c).filter(g=>this.checkIfFilteringIsNeeded({guide:g,guides:c,renderedDistances:p,movedRect:s,isTopBottomFiltering:!0})).sortBy(g=>{let h=g.blockBox;return m.direction==="top"?h.bb_top:-h.bb_top+h.bb_height}).value();if(u.length){let g=xo.default.find(u,S=>S.type==="center"),h=g&&g.block===u[0].block?g:u[0],b=h.blockBox,x=h.x;p.push(h),this.drawLine(m,s,n,{closerRect:b,softIntersection:!1},x,!0);return}d.push(m);break}}}),this.destroyDynLines(),xo.default.each(d,m=>{m.line.hide()})}update(){}destroyDynLines(){this.dynLines&&(xo.default.each(this.dynLines,o=>{o.line.hide(),delete o.line}),this.dynLines=null)}hide(){this.destroyDynLines(),xo.default.each(this.linePool,o=>{o.line.hide()})}},wl=(e,o,t)=>{if(!o)return e;let r=e.bb_left,i=e.bb_top;switch(o){case"nw":case"n":case"ne":i+=t.top;break;case"e":case"c":case"w":i+=t.top+t.height/2-e.bb_height/2;break;case"sw":case"s":case"se":i=t.top+t.height-i-e.bb_height;break}switch(o){case"nw":case"w":case"sw":r-=(t.viewportWidth-t.width)/2;break;case"n":case"c":case"s":r+=t.width/2-e.bb_width/2;break;case"ne":case"e":case"se":r=t.width+(t.viewportWidth-t.width)/2-r-e.bb_width;break}return{...e,bb_left:r,bb_top:i}};Bo();tn();var Qk=Lt`
    <div class="baseline-group <%= pale ? 'pale' : '' %>" style="top: <%= top %>px; height: <%= height %>px;">
        <% if (left) { %>
        <div class="left-baseline" style="width: <%= left || 0 %>px;">
            <% if (fill) { %>
            <div class="fill"></div>
            <% } %>
            <svg viewBox="0 0 <%= left %> 2" xmlns="http://www.w3.org/2000/svg" class="left-stroke">
                <line x1="0" y1="1" x2="100%" y2="1" stroke-width="1"></line>
            </svg>         
        </div>
        <% } %>
        <div class="middle-baseline" style="left: <%= left || 0 %>px; right: <%= right || 0 %>px;">
            <% if (fill) { %>
            <div class="fill"></div>
            <% } %>
            <svg viewBox="0 0 <%= maxGuideWidth %> 2" xmlns="http://www.w3.org/2000/svg" class="middle-stroke">
                <line x1="0" y1="1" x2="100%" y2="1" stroke-width="1"></line>
            </svg>
        </div>
        <% if (right) { %>
        <div class="right-baseline" style="width: <%= right || 0 %>px;">
            <% if (fill) { %>
            <div class="fill"></div>
            <% } %>
            <svg viewBox="0 0 <%= right %> 2" xmlns="http://www.w3.org/2000/svg" class="right-stroke">
                <line x1="0" y1="1" x2="100%" y2="1" stroke-width="1"></line>
            </svg>          
        </div>
        <% } %>
    </svg>
`;Hx();Ho();Fs();var o1=B($t());Bo();var r1=B(Mo()),Vu=4,Uu=.25,Jn=[Uu,.5,1,1.25,2,Vu],PM=187,e1=189,t1=48,TM=2e3,IM=4e3,i1=r1.default.View.extend({className:"zoom-panel hidden",zoom:void 0,sizesPanelShown:!1,typographyPanelShown:!1,guidesPanelShown:!1,hideTimeoutId:void 0,isZoomEnabled:!Modernizr.firefox,isZoomScaleEnabled:!Modernizr.firefox,zoomBeforeGesture:void 0,mag:void 0,router:void 0,initialize(e,o,t){this.mag=o,this.router=e,this.isZoomEnabled&&(t.append(this.$el),this.render(),Re.listenTo(e,"changeViewport",this.onViewportChange.bind(this)),Re.on("panel:showed",this.onControlPanelToggle.bind(this,!0)),Re.on("panel:hidden",this.onControlPanelToggle.bind(this,!1)),Re.on("panel:hiddenGroup",this.onControlPanelToggleGroup.bind(this,!1)),Re.on("sizes:shown",this.setSizesPanel.bind(this,!0)),Re.on("sizes:hidden",this.setSizesPanel.bind(this,!1)),Re.listenTo(o.edit_params,"change:sizes",this.onSizesModeToggle.bind(this)),Re.listenTo(o,"change:desktopWidth",this.onViewportWidthChange.bind(this)),Re.listenTo(o,"change:phoneWidth",this.onViewportWidthChange.bind(this)),Re.listenTo(e,"pageChange",this.onPageChange.bind(this)),this.isZoomScaleEnabled&&Re.listenTo(o,"change:opts",(r,i)=>{let n=r.previous("opts");n&&i.scalableviewer!==n.scalableviewer&&this.onScaleLayoutToggle(i.scalableviewer),n&&i.scalewidth!==n.scalewidth&&this.onMaxScaleWidthChange(i.scalewidth)}),document.addEventListener("keydown",this.onZoomKey.bind(this,e)),Modernizr.safari?(document.addEventListener("gesturestart",this.onGesturePinchStart.bind(this)),document.addEventListener("gesturechange",this.onGesturePinch.bind(this,e))):document.addEventListener("wheel",this.onWheelPinch.bind(this,e),{passive:!1}),window.addEventListener("resize",this.onResize.bind(this)))},render(){return this.$el.html((0,o1.default)(`<div class="zoom-panel-content"><span class="zoom-panel-value">${Math.round(this.getZoom()*100)}</span>%${this.isScaledZoomEnabled()?" Scaled layout":""}</div>`)),this},showPanel(){this.$el.removeClass("hidden")},hidePanel(){this.$el.addClass("hidden")},getZoomLevels(){let e=this.getScaleRatio();return this.allowFullscreen()&&e!==1?[...Jn,e].sort():Jn},getZoom(){return this.isZoomEnabled&&this.zoom||1},setZoom(e){if(this.isZoomEnabled){let o=this.zoom;this.zoom=e,this.fullscreen=e===this.getScaleRatio(),this.render(),o&&o!==e&&this.togglePanel(!0),o!==e&&Re.trigger("zoom",e,this.isFullScreenOrMore());let t=document.documentElement.style;t.setProperty("--workspace-zoom",e),t.setProperty("--workspace-inverse-zoom",`${1/e}`),t.setProperty("--workspace-inverse-zoom-px",`${1/e}px`)}},togglePanel(e){window.clearTimeout(this.hideTimeoutId);let o=this.getZoom()!==1&&(!this.isBoundToScreenWidth()||this.typographyPanelShown||this.guidesPanelShown||this.isSizesPanelVisible()),t=this.isBoundToScreenWidth()&&(this.typographyPanelShown||this.guidesPanelShown||this.isSizesPanelVisible());(e||o)&&this.showPanel(),(!o||t)&&(this.hideTimeoutId=window.setTimeout(()=>this.hidePanel(),t?IM:TM))},getNextZoom(e,o){let t=this.getZoomLevels(),r=t.indexOf(e||1),i=r>-1?r+(o?-1:1):t.indexOf(this.getClosestZoom(e,o));return t[Math.max(Math.min(i,t.length-1),0)]},getClosestZoom(e,o){let t=this.getZoomLevels();return e===t[0]&&o||e===t[t.length-1]&&!o?e:t.reduce((r,i)=>r<e&&i>e?o?r:i:o?i:r,-1/0)},isFullScreenZoom(){return this.fullscreen},isFullScreenOrMore(){return this.getZoom()>=this.getScaleRatio()},isDefaultZoom(){return this.getZoom()===1},allowFullscreen(){return this.mag.get("opts").scalableviewer&&this.router.workspace&&this.router.workspace.viewport==="default"&&this.isZoomScaleEnabled},isScaledZoomEnabled(){return this.getZoom()===this.getScaleRatio()&&this.isFullScreenZoom()},isBoundToScreenWidth(){return this.allowFullscreen()&&this.isFullScreenZoom()},isSizesPanelVisible(){return this.sizesPanelShown&&this.mag.edit_params.get("sizes")},getCenter(e,o,t){let i=o.page.getViewportParam(o.viewport,"height");return o.getSelectedBlocks().length?dt.getBoundingBoxOfBlocks(o.getSelectedBlocks()):{left:t.scrollLeft/e+Math.min(o.mag.getViewportWidth(o.page.get("viewport"))*e,window.innerWidth)/2/e-10/2,top:t.scrollTop/e+Math.min(i*e,window.innerHeight)/2/e-10/2,width:10,height:10}},getCenteringOffset(e,o,t,r={}){return{left:Math.max((r.left+r.width/2)*e-t.offsetWidth/2,0),top:Math.max((r.top+r.height/2)*e-t.offsetHeight/2,0)}},zoomTo(e,o,t,r=void 0){if(this.setZoom(e),r){let{left:i,top:n}=this.getCenteringOffset(e,o,t,r);t.scrollLeft=i,t.scrollTop=n}window.dispatchEvent(new Event("resize"))},onZeroZoomKey(e){if(e.name!=="default")return;let o,t=this.getZoom(),r=this.allowFullscreen(),i=this.getScaleRatio();return t===i?o=1:t!==1?o=r?i:1:o=i,o},onZoomKey(e,o){let t=e.workspace.getViewports().find(i=>i.isCurrent),r=Modernizr.mac?o.metaKey:o.ctrlKey;if([e1,PM,t1].includes(o.keyCode)&&r){o.preventDefault();let i=o.keyCode===t1?this.onZeroZoomKey(t):this.getNextZoom(this.getZoom(),o.keyCode===e1);this.zoomTo(i,e.workspace,e.workspace.$container[0],this.getCenter(this.getZoom(),e.workspace,e.workspace.$container[0]))}},onWheelPinch(e,o){if(o.ctrlKey){o.preventDefault();let t=o.deltaY*.015;this.zoomTo(Math.min(Math.max(Jn[0],this.getZoom()-t),Jn[Jn.length-1]),e.workspace,e.workspace.$container[0],this.getCenter(this.getZoom(),e.workspace,e.workspace.$container[0]))}},onGesturePinchStart(e){e.preventDefault(),this.zoomBeforeGesture=this.getZoom()},onGesturePinch(e,o){if(o.preventDefault(),o.scale){let t=o.scale-1;this.zoomTo(Math.min(Math.max(Jn[0],this.zoomBeforeGesture+t),Jn[Jn.length-1]),e.workspace,e.workspace.$container[0],this.getCenter(this.getZoom(),e.workspace,e.workspace.$container[0]))}},onResize(){this.setZoom(this.isBoundToScreenWidth()?this.getScaleRatio():this.getZoom())},onMaxScaleWidthChange(e){this.isBoundToScreenWidth()&&(this.setZoom(this.getScaleRatio({maxScaleWidth:e})),window.dispatchEvent(new Event("resize")))},onViewportWidthChange(e,o){this.isBoundToScreenWidth()&&(this.setZoom(this.getScaleRatio({viewportWidth:o})),window.dispatchEvent(new Event("resize")))},onSizesModeToggle(e){e.get("sizes")!==e.previous("sizes")&&this.togglePanel()},onScaleLayoutToggle(e){e&&this.allowFullscreen()&&(this.isDefaultZoom()||!this.zoom)?(this.setZoom(this.getScaleRatio()),window.dispatchEvent(new Event("resize"))):!e&&this.isFullScreenZoom()&&(this.setZoom(1),window.dispatchEvent(new Event("resize"))),Re.trigger("zoom:fullscreen:toggle")},setSizesPanel(e){let o=this.sizesPanelShown!==e;this.sizesPanelShown=e,o&&this.togglePanel()},setTypographyPanel(e){let o=this.typographyPanelShown!==e;this.typographyPanelShown=e,o&&this.togglePanel()},setGuidesPanel(e){let o=this.guidesPanelShown!==e;this.guidesPanelShown=e,o&&this.togglePanel()},onControlPanelToggleGroup(e,o){o.includes("guides")&&this.setGuidesPanel(e)},onControlPanelToggle(e,o){o==="guides"&&this.setGuidesPanel(e)},onPageChange(){let e=this.getZoom();this.setZoom(this.allowFullscreen()?this.getScaleRatio():1);let o=this.getZoom();e!==o&&window.dispatchEvent(new Event("resize")),this.togglePanel()},onViewportChange(){this.setZoom(this.allowFullscreen()?this.getScaleRatio():1),window.dispatchEvent(new Event("resize"))},getScaleRatio({viewportWidth:e,minScaleWidth:o,maxScaleWidth:t}={}){return Sd.getLimitedRatio(e||this.mag.getViewportWidth(this.router.workspace?.viewport),t||this.mag.get("opts").scalewidth,o||Oe.dictionary.default.min_scale_width,!1)}});Ai();Wn();var Gu=class{constructor(o){z(this,"horizontalLines");z(this,"verticalLines");z(this,"maxStepForHardGridSnapping");z(this,"minStickingDistance");this.horizontalLines=[],this.verticalLines=[],this.maxStepForHardGridSnapping=o.maxStepForHardGridSnapping,this.minStickingDistance=o.minStickingDistance}setNearestHorizontalLine(o){this.horizontalLines.push(o)}setNearestVerticalLine(o){this.verticalLines.push(o)}removeLines(o=null){if(o){let t=[...this.verticalLines],r=[...this.horizontalLines];o==="baseline"?r=r.filter(i=>i.lineType!==o):o==="guideline"?t=t.filter(i=>i.lineType!==o):(t=t.filter(i=>i.lineType!==o),r=r.filter(i=>i.lineType!==o)),this.verticalLines=[...t],this.horizontalLines=[...r]}else this.verticalLines=[],this.horizontalLines=[]}findNearestGridLines({blockCoords:o,step:t,leftBorderX:r}){let i={x:Math.round(o.x),y:Math.round(o.y),width:Math.round(o.width),height:Math.round(o.height)},n=(i.x-r)%t,s=(i.x-r+i.width)%t,l=i.y%t,c=(i.y+i.height)%t;if(this.removeLines("baseline"),this.removeLines("guideline"),this.removeLines("gridLine"),this.maxStepForHardGridSnapping>t){let d=Math.min(s,t-s)<Math.min(n,t-n)?s:n,p=Math.min(l,t-l)<Math.min(c,t-c)?l:c,m=d<t-d?-d:t-d,u=p<t-p?-p:t-p;this.setNearestVerticalLine({x:Math.round(i.x+m),lineType:"gridLine",delta:d,isVerticalSnapping:!0}),this.setNearestHorizontalLine({y:Math.round(i.y+u),lineType:"gridLine",delta:p,isHorizontalSnapping:!0})}else{let d=n,p=t-n,m=s,u=t-s,g=l,h=t-l,b=c,x=t-c,S=d<p?-d:p,y=m<u?-m:u,C=g<h?-g:h,P=b<x?-b:x,v=Math.abs(S)<Math.abs(y)?S:y,T=Math.abs(C)<Math.abs(P)?C:P;Math.abs(v)<this.minStickingDistance&&this.setNearestVerticalLine({x:i.x+v,lineType:"gridLine",delta:Math.abs(v),isVerticalSnapping:!0}),Math.abs(T)<this.minStickingDistance&&this.setNearestHorizontalLine({y:i.y+T,lineType:"gridLine",delta:Math.abs(T),isHorizontalSnapping:!0})}}findNearestGuidelines({guidelines:o,blockCoords:t}){this.removeLines("gridLine"),this.removeLines("guideline"),o.forEach(r=>{let i=Math.abs(r-t.x),n=Math.abs(r-t.x-t.width);i<this.minStickingDistance&&this.setNearestVerticalLine({x:r,lineType:"guideline",delta:i,isLeftSnapping:!0}),n<this.minStickingDistance&&this.setNearestVerticalLine({x:r,lineType:"guideline",delta:n,isRightSnapping:!0})})}findNearestBaselines({baselines:o,blockCoords:t}){this.removeLines("gridLine"),this.removeLines("baseline"),o.forEach(r=>{let i=Math.abs(r.y-t.y),n=Math.abs(r.y-t.y-t.height);i<this.minStickingDistance&&this.setNearestHorizontalLine({y:r.y,lineType:"baseline",delta:i,isTopSnapping:!0}),n<this.minStickingDistance&&this.setNearestHorizontalLine({y:r.y,lineType:"baseline",delta:n,isBottomSnapping:!0})})}findNearestWidgetLines({widgetLines:o,blockCoords:t,movingFixeds:r}){this.removeLines("widgetLine");let[i,n]=uc(r[0]);o.forEach(s=>{let l=s.block&&s.block.model.get("fixed_position")||"",[c,d]=uc(l);switch(s.type){case"left":case"right":{if(c!==i)break;let p=Math.abs(s.x-t.x),m=Math.abs(s.x-t.x-t.width);p<this.minStickingDistance&&this.setNearestVerticalLine({x:s.x,lineType:"widgetLine",delta:p,isLeftSnapping:!0}),m<this.minStickingDistance&&this.setNearestVerticalLine({x:s.x,lineType:"widgetLine",delta:m,isRightSnapping:!0});break}case"top":case"bottom":{if(d!==n)break;let p=Math.abs(s.y-t.y),m=Math.abs(s.y-t.y-t.height);p<this.minStickingDistance&&this.setNearestHorizontalLine({y:s.y,lineType:"widgetLine",delta:p,isTopSnapping:!0}),m<this.minStickingDistance&&this.setNearestHorizontalLine({y:s.y,lineType:"widgetLine",delta:m,isBottomSnapping:!0});break}case"center":{if(c!==i)break;let p=Math.abs(s.x-t.x-Math.floor(t.width/2));p<this.minStickingDistance&&this.setNearestVerticalLine({x:s.x,lineType:"widgetLine",delta:p,isCenterSnapping:!0});break}case"middle":{if(d!==n)break;let p=Math.abs(s.y-t.y-Math.floor(t.height/2));p<this.minStickingDistance&&this.setNearestHorizontalLine({y:s.y,lineType:"widgetLine",delta:p,isMiddleSnapping:!0});break}}s.toggleOpacity(0)})}getLineForVerticalSnapping(o){let t=[...this.verticalLines];return t.sort((r,i)=>r.delta-i.delta),t.length>0?{...t[0]}:{...o}}getLineForHorizontalSnapping(o){let t=[...this.horizontalLines];return t.sort((r,i)=>r.delta-i.delta),t.length>0?{...t[0]}:{...o}}snapToLine({blockCoords:o,gridActivated:t,guidesActivated:r}){t||this.removeLines("gridLine"),r||(this.removeLines("guideline"),this.removeLines("baseline"));let i=o?.fixed_position&&o.fixed_position.length>0,n={x:i?o.x:Math.round(o.x),y:i?o.y:Math.round(o.y),width:i?o.width:Math.round(o.width),height:i?o.height:Math.round(o.height)},s={x:n.x,y:n.y},l={...s},c=this.getLineForVerticalSnapping(s),d=this.getLineForHorizontalSnapping(s);return c.isRightSnapping?l.x=c.x-n.width:c.isLeftSnapping?l.x=c.x:c.isCenterSnapping&&(l.x=c.x-Math.ceil(n.width/2)),d.isBottomSnapping?l.y=d.y-n.height:d.isTopSnapping?l.y=d.y:d.isMiddleSnapping&&(l.y=d.y-Math.ceil(n.height/2)),c.isVerticalSnapping&&(l.x=c.x),d.isHorizontalSnapping&&(l.y=d.y),{x:i?l.x:Math.round(l.x),y:i?l.y:Math.round(l.y)}}};ec();var n1=({deltaCorrectedX:e,deltaCorrectedY:o})=>{let t={right:!1,left:!1,top:!1,bottom:!1};return Math.abs(e)>Math.abs(o)?e<0?t.left=!0:e>0&&(t.right=!0):Math.abs(e)<Math.abs(o)&&(o<0?t.top=!0:o>0&&(t.bottom=!0)),t};function s1({step:e,leftBorderX:o,direction:t,correctedBox:r,originalBox:i,isSidePointProportional:n,fromCenter:s}){let l={...i},c=Math.round(o);function d({source:p,step:m}){let u=p%m;return u<m-u?-u:m-u}switch(t){case"n":{let p=d({source:r.top,step:e}),m=(r.height-p)/i.height,u=i.width/2-i.width*m/2;s?(l.height=r.height-p*2,l.top=r.top+p):(l.height=r.height-p,l.top=r.top+p),n&&!s&&(l.left=i.left+u);break}case"s":{let p=r.top+r.height,m=d({source:p,step:e}),u=(r.height+m)/i.height,g=i.width/2-i.width*u/2;s?(l.top=r.top-m,l.height=r.height+m*2):l.height=r.height+m,n&&!s&&(l.left=i.left+g);break}case"w":{let p=r.left-c,m=d({source:p,step:e}),u=(r.width-m)/i.width,g=i.height/2-i.height*u/2;s?(l.width=r.width-m*2,l.left=r.left+m):(l.width=r.width-m,l.left=r.left+m),n&&!s&&(l.top=i.top+g);break}case"e":{let p=r.left+r.width-c,m=d({source:p,step:e}),u=(r.width+m)/i.width,g=i.height/2-i.height*u/2;s?(l.left=r.left-m,l.width=r.width+m*2):l.width=r.width+m,n&&!s&&(l.top=i.top+g);break}case"nw":{let p=r.top,m=r.left-c,u=d({source:p,step:e}),g=d({source:m,step:e});s?(l.top=r.top+u,l.height=r.height-u*2,l.left=r.left+g,l.width=r.width-g*2):(l.top=r.top+u,l.height=r.height-u,l.left=r.left+g,l.width=r.width-g)}break;case"se":{let p=r.top+r.height,m=r.left+r.width-c,u=d({source:p,step:e}),g=d({source:m,step:e});s?(l.top=r.top-u,l.height=r.height+u*2,l.left=r.left-g,l.width=r.width+g*2):(l.height=r.height+u,l.width=r.width+g)}break;case"ne":{let p=r.top,m=r.left+r.width-c,u=d({source:p,step:e}),g=d({source:m,step:e});s?(l.top=r.top+u,l.height=r.height-u*2,l.left=r.left-g,l.width=r.width+g*2):(l.top=r.top+u,l.height=r.height-u,l.width=r.width+g);break}case"sw":{let p=r.top+r.height,m=r.left-c,u=d({source:p,step:e}),g=d({source:m,step:e});s?(l.top=r.top-u,l.height=r.height+u*2,l.left=r.left+g,l.width=r.width-g*2):(l.height=r.height+u,l.left=r.left+g,l.width=r.width-g);break}}return l.left=Math.ceil(parseFloat(l.left.toFixed(2))),l.top=Math.ceil(parseFloat(l.top.toFixed(2))),l.width=Math.floor(parseFloat(l.width.toFixed(2))),l.height=Math.floor(parseFloat(l.height.toFixed(2))),l}function ff({sticky:e,verticalLines:o,horizontalLines:t,leftBorderX:r,direction:i,correctedBox:n,originalBox:s,isSidePointProportional:l,fromCenter:c}){let d=c?2:1,p={left:Math.floor(parseFloat(n.left.toFixed(2))),top:Math.floor(parseFloat(n.top.toFixed(2))),width:Math.ceil(parseFloat(n.width.toFixed(2))),height:Math.ceil(parseFloat(n.height.toFixed(2)))},m={...s},u=o.find(h=>["nw","w","sw"].includes(i)&&Math.abs(h-n.left)<e||["ne","e","se"].includes(i)&&Math.abs(h-(n.left+n.width))<e)||null,g=t.find(h=>["nw","n","ne"].includes(i)&&Math.abs(h-n.top)<e||["sw","s","se"].includes(i)&&Math.abs(h-(n.top+n.height))<e)||null;switch(i){case"w":{if(u){let b=s.left-r-(u-r);if(m.left=u,m.width=s.width+b*d,l&&!c){let x=m.width/s.width,S=s.height/2-s.height*x/2;m.top=s.top+S,m.height=s.height+S}}else m={...p};break}case"e":{if(u){let h=s.left+s.width,b=u-r-(h-r);if(m.left=c?s.left-b:s.left,m.width=s.width+b*d,l&&!c){let x=m.width/s.width,S=s.height/2-s.height*x/2;m.top=s.top+S,m.height=s.height+S}}else m={...p};break}case"n":{if(g){let h=s.top,b=g-h;if(m.top=g,m.height=s.height-b*d,l&&!c){let x=m.height/s.height,S=s.width/2-s.width*x/2;m.left=s.left+S,m.width=s.width+S}}else m={...p};break}case"s":{if(g){let h=s.top+s.height,b=g-h;if(m.top=c?s.top-b:s.top,m.height=s.height+b*d,l&&!c){let x=m.height/s.height,S=s.width/2-s.width*x/2;m.left=s.left+S,m.width=s.width+S}}else m={...p};break}case"nw":{if(g||u){let h=s.left,b=s.top,x=g?g-b:0,S=u?h-r-(u-r):0,y=(s.width+S)/s.width,C=(s.height-x)/s.height,P=s.width-s.width*C,v=s.height*y-s.height;m.left=u||p.left,m.width=u?s.width+S*d:p.width,l&&!u&&(m.left=s.left+P,m.width=s.width-P*d),m.top=g||p.top,m.height=g?s.height-x*d:p.height,l&&!g&&(m.top=s.top-v,m.height=s.height+v*d)}else m={...p};break}case"sw":{if(g||u){let h=s.left,b=s.top+s.height,x=g?g-b:0,S=u?h-r-(u-r):0,y=(s.width+S)/s.width,C=(s.height+x)/s.height,P=s.width-s.width*C,v=s.height-s.height*y;m.left=u||p.left,m.width=u?s.width+S*d:p.width,l&&!u&&(m.left=s.left+P,m.width=s.width-P*d),m.top=g?c?s.top-x:s.top:p.top,m.height=g?s.height+x*d:p.height,l&&!g&&(m.height=s.height-v*d,c?m.top=s.top+v:m.top=s.top)}else m={...p};break}case"ne":{if(g||u){let h=s.left+s.width,b=s.top,x=g?g-b:0,S=u?u-r-(h-r):0,y=(s.width+S)/s.width,C=(s.height-x)/s.height,P=s.width*C;-s.width;let v=s.height*y-s.height;m.left=u?c?s.left-S:s.left:p.left,m.width=u?s.width+S*d:p.width,l&&!u&&(m.width=s.width-P*d,c?m.left=s.left+P:m.left=s.left),m.top=g||p.top,m.height=g?s.height-x*d:p.height,l&&!g&&(m.top=s.top-v,m.height=s.height+v*d)}else m={...p};break}case"se":{if(g||u){let h=s.left+s.width,b=s.top+s.height,x=g?g-b:0,S=u?u-r-(h-r):0,y=(s.height-x)/s.height,C=s.width*y,P=(s.width+S)/s.width,v=s.height-s.height*P;m.left=u?c?s.left-S:s.left:p.left,m.width=u?s.width+S*d:p.width,l&&!u&&(m.width=s.width-C*d,c?m.left=s.left+C:m.left=s.left),m.top=g?c?s.top-x:s.top:p.top,m.height=g?s.height+x*d:p.height,l&&!g&&(m.height=s.height-v*d,c?m.top=s.top+v:m.top=s.top)}else m={...p};break}}return{left:Math.ceil(m.left),top:Math.ceil(m.top),width:Math.floor(m.width),height:Math.floor(m.height)}}var MM=mc.default.View.extend({initialize:function(e){at.default.bindAll(this),at.default.extend(this,e),this.created=!1,this.setElement((0,Qn.default)("#gg")),this.distance=new ia((0,Qn.default)("#gg"))},create:function(){if(!Ze.isPermissionAllowed("GridsAndGuidesCanUse"))return;this.snap=this.mag.edit_params.get("snap"),this.expand=this.mag.edit_params.get("expand"),this.workspace=RM.constructorRouter.workspace,this.updateDims();let e=new Jk(null,{mag:this.mag}),o=new Gu({minStickingDistance:8,maxStepForHardGridSnapping:40});this.snapController=o,this.grid=new BM({el:this.$(".grid"),controller:this,enabled:this.mag.edit_params.get("grid"),snapController:o,models:e}),this.widget_lines=new zM({el:this.$(".lines"),controller:this,snapController:o}),this.guides=new p1({$guides:this.$(".guides"),$baselines:this.$(".baselines"),controller:this,snapController:o,enabled:this.mag.edit_params.get("guides"),models:e}),this.guides.hidden=!this.mag.edit_params.get("guides"),this.grid.hidden=!this.mag.edit_params.get("grid"),this.mag.edit_params.on("change:expand",this.onExpandChange),this.mag.edit_params.on("change:snap",this.onSnapChange),this.mag.edit_params.on("change:guides",this.guides.toggle),this.mag.edit_params.on("change:grid",this.grid.toggle),this.listenTo(this.mag,"change:desktopWidth",this.guides.renderColumns),this.listenTo(this.mag,"change:phoneWidth",this.guides.renderColumns),this.listenTo(this.mag,"change:tabletWidth",this.guides.renderColumns),this.onPageChange(this.workspace),this.router.on("pageChange",this.onPageChange),this.router.on("changeViewport",this.onViewportChange),(0,Qn.default)(window).on("resize",this.onResize),this.trigger("create"),this.created=!0},destroy(){this.stopListening(this.mag)},onResize:function(){this.updateDims(),this.guides.render.__debounced()},onViewportChange:function(){this.updateDims(),this.guides.changeViewport(),this.grid.changeViewport()},switchOn:function(e){let o=["guides","grid"];if(o.includes(e)){let t=o.filter(r=>r!==e);this.mag.edit_params.save(e,!0),t.forEach(r=>{this.mag.edit_params.save(r,!1)})}},onPageChange:function(e){if(!e){this.$el.detach();return}this.$el.appendTo(e.$el),this.workspace&&this.stopListening(this.workspace),this.workspace=e,this.listenTo(this.workspace,"workspace-resize",this.updateDims),this.updateDims(),setTimeout(at.default.bind(function(){this.updateDims(),this.guides.render()},this),450)},updateDims:function(){let e=this.mag.getViewportWidth(this.workspace.viewport),o=this.workspace.page.getViewportParam(this.workspace.viewport,"height"),t=this.workspace.viewport;if(this.$el.hide(),this.expand&&t=="default"){let i=this.workspace.$container.width()-this.workspace.$container[0].clientWidth,n=(0,Qn.default)("#main").width(),s=(0,Qn.default)("#main").height();this.dims={width:Math.max(n-i,e),height:Math.max(s,o),left:Math.min(Math.floor((e-n)/2),0),top:Math.min(Math.floor((o-s)/2),0)},this.workspace.$el.addClass("hide-border")}else this.dims={width:e,height:o,left:0,top:0},this.workspace.$el.removeClass("hide-border");this.$el.show();let r=RM.constructorRouter.zoom.getZoom();this.$el.css(at.default.mapObject(this.dims,i=>i*r)),this.mag.edit_params.get("guides")&&this.guides?this.guides.render():this.guides&&(this.guides.rendered=!1)},handleMoveStart:function(e,o){this._movingBlocks=e,this._duplicateMode=o;let t=!this.grid.hidden,r=!this.guides.hidden;this.widget_lines.loadLines({blocks:this.workspace.getActiveBlocks(),moving_blocks:this._movingBlocks,duplicateMode:o,gridActivated:t,guidesActivated:r})},handleMoveEnd:function(){this.widget_lines.hideLines()},onSnapChange:function(){this.snap=this.mag.edit_params.get("snap")},onExpandChange:function(){this.expand=this.mag.edit_params.get("expand"),this.updateDims(),this.guides.render()},hideLinesWithDelay:function(){this._hideLinesTimeout&&clearTimeout(this._hideLinesTimeout),this._hideLinesTimeout=setTimeout(()=>{this.widget_lines.hideLines(),this.workspace.distance.hide()},1e3)},handleSnapMove:function({position:e,width:o,height:t,duplicateMode:r,fromKeyboard:i,workspacePosition:n,prevBlockPostion:s}){let l=e.fixeds&&e.fixeds.length>0,c=this.workspace.mag.edit_params.get("sizes"),d=!this.grid.hidden,p=!this.guides.hidden,m=this.workspace.viewport;i&&(this._movingBlocks=this.workspace.getSelectedBlocks()),this._duplicateMode!==r?(this._duplicateMode=r,this.widget_lines.loadLines({blocks:this.workspace.getActiveBlocks(),moving_blocks:this._movingBlocks,duplicateMode:r,gridActivated:d,guidesActivated:p})):i&&this.widget_lines.loadLines({blocks:this.workspace.getActiveBlocks(),moving_blocks:this._movingBlocks,duplicateMode:r,gridActivated:d,guidesActivated:p});let u=at.default.chain(this._movingBlocks).map(x=>x.model.get("fixed_position")||"").uniq().value();if(u.length>1)return{x:0,y:0};this.widget_lines.findDataForSnapping({position:{x:e.x,y:e.y},width:o,height:t,movingFixeds:u}),p&&!i?this.guides.findDataForSnapping({position:e,width:o,height:t}):d&&!i&&this.grid.findDataForSnapping({position:e,width:o,height:t});let g=this.snapController.snapToLine({blockCoords:{x:e.x,y:e.y,width:o,height:t,fixed_position:e.fixeds},gridActivated:d,guidesActivated:p}),h=n1({deltaCorrectedX:e.x-s.x,deltaCorrectedY:e.y-s.y}),{sizeLines:b}=this.widget_lines.showSnapLines({corrected:i?{...e}:g,width:o,height:t,direction:h,fromKeyboard:i});return c&&RM.constructorRouter.workspace.distance.updateForRect({bb_top:e.y,bb_left:e.x,bb_width:o,bb_height:t,fixed:e.fixeds[0]},b,g,i,{...n,viewport:m}),{x:l?g.x-e.x:Math.round(g.x)-e.x,y:l?g.y-e.y:Math.round(g.y)-e.y}},handleSnapResize:function({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}){if(!this.snap)return o;let n=at.default.clone(e),s=this.guides.model&&!this.guides.model.get("baseline_height")&&!this.guides.model.get("columns");return!this.guides.hidden&&!s?n=this.guides.stickOnResize({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}):this.grid.hidden?n=this.widget_lines.stickOnResize({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}):n=this.grid.stickOnResize({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}),n}}),l1=mc.default.View.extend({created:!1,controller:void 0,model:void 0,initialize:function(e){this.controller=e.controller,this.models=e.models},getModelUrl:function(){return this.models.url+this.controller.router.workspace.viewport},create:function(e){this.created=!0,this.models.off("change",null,this),this.models.fetch({url:this.getModelUrl(),success:()=>{this.loadModel(),RM.constructorRouter.on("pageChange",this.loadModel),RM.constructorRouter.on("updateWorkspaceViewport",this.render),e&&this.show()}})},changeViewport:function(){let e=this.controller.router.workspace.page;this.model=this.models.getByPage(e);let o=this;!this.model||this.model.get("viewport")!==e.getCurrentViewport()?this.models.fetch({remove:!1,url:this.models.url+this.controller.router.workspace.viewport,success:function(){o.loadModel()}}):this.loadModel()},loadModel:function(e){if(e=e||this.controller.router.workspace,!this.controller.router)return;let o=this.model&&this.model.id;this.model=this.models.getByPage(e.page),this.model&&(this.model.id!=o&&(this.models.trigger("reload"),this.updateModel&&this.updateModel(this.model)),this.trigger("modelLoaded"),this.render())},show:function(){if(!this.created)return this.create(!0);this.rendered||this.render(),this.$el.fadeIn("fast"),this.hidden=!1}}),BM=l1.extend({step:8,count:8,hidden:!0,initialize:function(e){at.default.bindAll(this),at.default.extend(this,e),this.models=e.models,this.controller.mag.edit_params.on("change:grid_step",this.onGridChanged),this.controller.mag.edit_params.on("change:grid_count",this.onGridChanged),this.listenTo(this.controller.router.workspace,"workspace-resize",this.render),e.enabled?this.show():this.created||this.create(!1)},updateModel:function(e){this.model&&(this.model.off("change:grid_step",this.onGridChanged),this.model.off("change:grid_count",this.onGridChanged)),this.model=e,this.model.on("change:grid_step",this.onGridChanged),this.model.on("change:grid_count",this.onGridChanged),this.step=this.model.get("grid_step")||8,this.count=this.model.get("grid_count")||8,this.render()},show:function(){if(!this.created)return this.create(!0);this.rendered||this.render(),this.$el.fadeIn("fast"),this.hidden=!1},hide:function(){this.$el.fadeOut("fast"),this.hidden=!0},toggle:function(){this.controller.mag.edit_params.get("grid")?this.show():this.hide()},generateGridSVG:function(){let e=[],o=this.step*this.count,t="rgba(128, 128, 128, 1)",r="rgba(128, 128, 128, 0.4)",i=1/(window.devicePixelRatio||1)/RM.constructorRouter.zoom.getZoom();for(let n=1;n<this.count;n++)e.push('<rect width="'+i+'" height="'+o+'" x="'+n*this.step+'" y="0" style="fill:'+r+'"></rect>'),e.push('<rect height="'+i+'" width="'+o+'" y="'+n*this.step+'" x="0" style="fill:'+r+'"></rect>');return btoa('<?xml version="1.0" encoding="UTF-8"?><svg width="'+o+'px" height="'+o+'px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Line">'+e.join("")+'<rect width="'+i+'" height="'+o+'" x="0" y="0" style="fill:'+t+'"></rect><rect height="'+i+'" width="'+o+'" y="0" x="0" style="fill:'+t+'"></rect></g></svg>')},onGridChanged:function(){this.step=this.model.get("grid_step")||8,this.count=this.model.get("grid_count")||8,this.hidden&&this.controller.switchOn("grid"),this.render()},render:function(){let e=RM.constructorRouter.zoom.getZoom();this.$el.css({"background-size":this.step*this.count*e+"px "+this.step*this.count*e+"px","background-image":'url("data:image/svg+xml;base64,'+this.generateGridSVG()+'")'})},findDataForSnapping:function({position:e,width:o,height:t}){let r=this.controller.workspace.viewport,i=this.controller.mag.getViewportWidth(r),n=Oe.dictionary[r].width,s=0-Math.abs((i-n)/2),l={x:e.x,y:e.y,width:o,height:t};this.snapController.findNearestGridLines({blockCoords:l,step:this.step,leftBorderX:s})},stickOnResize:function({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}){let n=this.controller.workspace.viewport,s=this.controller.mag.getViewportWidth(n),l=Oe.dictionary[n].width,c=0-Math.abs((s-l)/2),d={...e},p=this.step,m=s1({step:p,leftBorderX:c,originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i});return d={...d,...m},d}}),zM=mc.default.View.extend({sticky:8,near:12,initialize:function(e){at.default.bindAll(this),at.default.extend(this,e),this.controller.mag.edit_params.on("change:snap",this.onSnapChange)},findDataForSnapping({position:e,width:o,height:t,movingFixeds:r}){this.snapController.findNearestWidgetLines({widgetLines:this.lines,blockCoords:{...e,width:o,height:t},movingFixeds:r})},showSnapLines({corrected:e,width:o,height:t,direction:r,fromKeyboard:i}){let n=[],s=at.default.uniq(this._movingBlocks?.map(l=>l.model.get("fixed_position")||""));return s.length===1&&this.getClosestLines({x:e.x,y:e.y,width:o,height:t},this.lines?.filter(c=>this.shouldSnapOnMove(s[0],c)),this.sticky).forEach(c=>{let d=!1;if(i){let p=c.blockBox;if(p){let m=e.x>p.bb_left+p.bb_width,u=p.bb_left>e.x+o,g=e.y>p.bb_top+p.bb_height,h=p.bb_top>e.y+t,b=e.y<=p.bb_top&&e.y+t>=p.bb_top||e.y>=p.bb_top&&e.y+t<=p.bb_top+p.bb_height||e.y<=p.bb_top+p.bb_height&&e.y+t>=p.bb_top+p.bb_height,x=e.x<=p.bb_left&&e.x+o>=p.bb_left||e.x>=p.bb_left&&e.x+o<=p.bb_left+p.bb_width||e.x<=p.bb_left+p.bb_width&&e.x+o>=p.bb_left+p.bb_width,S=Math.min(Math.abs(e.y-p.bb_top),Math.abs(e.y-(p.bb_top+p.bb_height))),y=Math.min(Math.abs(e.y+t-(p.bb_top+p.bb_height)),Math.abs(e.y+t-p.bb_top)),C=Math.min(Math.abs(e.x-p.bb_left),Math.abs(e.x-(p.bb_left+p.bb_width))),P=Math.min(Math.abs(e.x+o-(p.bb_left+p.bb_width)),Math.abs(e.x+o-p.bb_left)),v=(m||u)&&(S<=this.sticky||y<=this.sticky),T=(h||g)&&(C<=this.sticky||P<=this.sticky);(m||T||x)&&r.left?(n.push(c),d=!0):((u||T||x)&&r.right||(g||v||b)&&r.top||(h||v||b)&&r.bottom)&&(d=!0,n.push(c))}else d=!0,n.push(c)}else d=!0,n.push(c);d&&(c.opacity=1,c.calculateDimensions({x:e.x,y:e.y,width:o,height:t,fixed:s[0]}),c.render())}),{sizeLines:n}},getClosestLines(e,o=[],t){let r=S=>Math.abs(e.y-S.y),i=S=>Math.abs(e.y+e.height-S.y),n=S=>Math.abs(e.y+Math.floor(e.height/2)-S.y),s=S=>Math.abs(e.x-S.x),l=S=>Math.abs(e.x+e.width-S.x),c=S=>Math.abs(e.x+Math.floor(e.width/2)-S.x),d=o.filter(S=>["left","right"].includes(S.type)),p=o.filter(S=>["top","bottom"].includes(S.type)),m=at.default.min(p,r),u=at.default.min(p,i),g=at.default.min(o.filter(S=>S.type==="middle"),n),h=at.default.min(d,s),b=at.default.min(d,l),x=at.default.min(o.filter(S=>S.type==="center"),c);return at.default.compact([m&&r(m)<=t?m:void 0,u&&i(u)<=t?u:void 0,g&&n(g)<=t?g:void 0,h&&s(h)<=t?h:void 0,b&&l(b)<=t?b:void 0,x&&c(x)<=t?x:void 0])},stickOnResize:function({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}){let n=this.sticky,s=this.lines,l=this.controller.workspace.viewport,c=this.controller.mag.getViewportWidth(l),d=Oe.dictionary[l].width,p=0-Math.abs((c-d)/2),m={x:null,delta:1/0},u={y:null,delta:1/0};s?.forEach(b=>{b.toggleOpacity(0);let x=Math.abs(b.y-o.top),S=Math.abs(b.y-o.top-o.height),y=Math.abs(b.x-o.left),C=Math.abs(b.x-o.left-o.width);y<n&&["w","sw","nw"].includes(t)&&["left","right"].includes(b.type)?y<m.delta&&(m.delta=y,m.x=b.x):C<n&&["e","se","ne"].includes(t)&&["left","right"].includes(b.type)&&C<m.delta&&(m.delta=C,m.x=b.x),x<n&&["n","ne","nw"].includes(t)&&["top","bottom"].includes(b.type)?x<u.delta&&(u.delta=x,u.y=b.y):S<n&&["s","se","sw"].includes(t)&&["top","bottom"].includes(b.type)&&S<u.delta&&(u.delta=S,u.y=b.y)});let g=ff({sticky:n,verticalLines:[m.x],horizontalLines:[u.y],leftBorderX:p,direction:t,correctedBox:o,originalBox:e,isSidePointProportional:r,fromCenter:i});return this.getClosestLines({x:g.left,y:g.top,width:g.width,height:g.height},this.lines?.filter(b=>this.shouldSnapOnResize(b,t)),this.sticky).forEach(b=>{b.opacity=1,b.calculateDimensions({x:g.left,y:g.top,width:g.width,height:g.height}),b.render()}),g},loadLines:function({blocks:e,moving_blocks:o,duplicateMode:t,gridActivated:r,guidesActivated:i}){this.moving_ids=at.default.pluck(o,"id"),this._movingBlocks=o;let n=this.controller.router.workspace.getViewportPosition(),s=this.controller.router.workspace.viewport,l=Oe.dictionary[s].width,c=this.controller.router.workspace.mag.getViewportWidth(s),d=RM.constructorRouter.zoom.getZoom();this.hideLines(),this.lines=(0,at.default)(e).chain().filter(g=>{if(!t&&at.default.contains(this.moving_ids,g.id))return!1;if(g.model.get("fixed_position"))return!0;let h=g.latestPosSizeAngle;return(h.bb_top+h.bb_height)*d>n.top*d&&h.bb_top*d<n.top*d+window.innerHeight&&(h.bb_left+h.bb_width-(l-c)/2)*d>n.left*d&&(h.bb_left-(l-c)/2)*d<n.left*d+window.innerWidth}).map(g=>{let h=[],b=g.latestPosSizeAngle,x=g.model.get("fixed_position");if(x){let S=this.controller.workspace.viewport,y=this.controller.workspace.$container[0],C=RM.constructorRouter.zoom.getZoom(),{x:P,y:v}=rv({boxCoordinates:{x:b.bb_left||b.left,y:b.bb_top||b.top,w:b.width,h:b.height,fixed_position:x},scroller:{scrollTop:y.scrollTop,scrollLeft:y.scrollLeft},workspaceBox:{left:n.left,top:n.top,width:n.width,height:n.pageHeight},windowSize:{width:n.viewportWidth,height:n.height},viewportType:S,zoom:C});b={...b,bb_left:P,bb_top:v,fixed:x}}return g.model.get("type")==="background"?h:(h.push(this.newLine({x:b.bb_left,type:"left",block:g,blockBox:b})),h.push(this.newLine({x:b.bb_left+b.bb_width,type:"right",block:g,blockBox:b})),h.push(this.newLine({x:b.bb_left+Math.floor(b.bb_width/2),type:"center",block:g,blockBox:b})),h.push(this.newLine({y:b.bb_top,type:"top",block:g,blockBox:b})),h.push(this.newLine({y:b.bb_top+b.bb_height,type:"bottom",block:g,blockBox:b})),h.push(this.newLine({y:b.bb_top+Math.floor(b.bb_height/2),type:"middle",block:g,blockBox:b})),at.default.compact(h))}).flatten().value();let p=this.controller.dims;this.lines.push(this.newLine({hidden:!0,x:p.left,type:"left"})),this.lines.push(this.newLine({hidden:!0,x:p.left+p.width,type:"right"})),this.lines.push(this.newLine({hidden:!0,y:p.top,type:"top"})),this.lines.push(this.newLine({hidden:!0,y:p.top+p.height,type:"bottom"})),!r&&!i&&["center","left","right"].forEach(g=>{this.lines.push(this.newLine({x:l/2,type:g}))});let{top:m}=ct.mapFromViewportToElement({top:window.innerHeight/2,left:0},this.controller.workspace.$origin.get(0),1,d);!r&&!i&&["middle","top","bottom"].forEach(g=>{this.lines.push(this.newLine({y:m,type:g}))}),this.lines=at.default.compact(this.lines);let u=document.createDocumentFragment();this.lines?.forEach(g=>{let h=g.render();h&&u.appendChild(h[0])}),this.$el.append(u)},newLine:function(e){return new ju(at.default.extend(e,{$container:this.$el,controller:this.controller}))},onSnapChange:function(){this.controller.mag.edit_params.get("snap")||this.hideLines()},hideLines:function(){at.default.each(this.lines,function(e){e.remove()}),this.lines=[]},shouldSnapOnMove(e,o){let t=uc(e),r=uc(o.block?.model.get("fixed_position")),i=["left","right","center"].includes(o.type)&&t[0]===r[0],n=["top","bottom","middle"].includes(o.type)&&t[1]===r[1];return i||n},shouldSnapOnResize(e,o){let t=["left","right","center"].includes(e.type)&&["s","n"].includes(o),r=["top","bottom","middle"].includes(e.type)&&["e","w"].includes(o);return!t&&!r}}),ju=mc.default.View.extend({type:"",x:void 0,y:void 0,length:void 0,opacity:0,block:void 0,blockBox:void 0,initialize:function(e){at.default.bindAll(this),at.default.extend(this,e),this.x&&delete this.y,this.y&&delete this.x,this._opacities={}},toggle:function(e,o){let t=this.getOpacity(e,o);return this.toggleOpacity(t),t>0},toggleOpacity(e){this.opacity!==e&&(this.opacity=e,this.draw(this.opacity))},getOpacity:function(e,o){return e<o?o/2>e?1:(o-e)/(o/2):0},calculateDimensions(e){let o=this.blockBox,t={top:e.y,left:e.x,bottom:e.y+e.height,right:e.x+e.width},r=this.length||0,i={x:null,y:null};if(o&&["left","right","center"].includes(this.type)){let n={top:o.bb_top,bottom:o.bb_top+o.bb_height};t.bottom<=n.top?(i.y=t.top,r=n.bottom-t.top):t.top<=n.top&&t.bottom>n.top?(i.y=t.top,r=Math.max(n.bottom,t.bottom)-t.top):t.top>n.top&&t.bottom<=n.bottom?(i.y=n.top,r=n.bottom-n.top):(t.bottom>n.bottom&&t.top<=n.bottom||t.top>n.bottom)&&(i.y=n.top,r=t.bottom-n.top)}else if(o&&["top","bottom","middle"].includes(this.type)){let n={left:o.bb_left,right:o.bb_left+o.bb_width};t.right<=n.left?(i.x=t.left,r=n.right-t.left):t.left<=n.left&&t.right>n.left?(i.x=t.left,r=Math.max(n.right,t.right)-t.left):t.right<=n.right&&t.left>n.left?(i.x=n.left,r=n.right-n.left):(t.right>n.right&&t.left<=n.right||t.left>n.right)&&(i.x=n.left,r=t.right-n.left)}this.x=i.x?i?.x:this.x,this.y=i.y?i?.y:this.y,this.length=Math.abs(r)},show:function(){this.draw(1)},draw:function(e){this.$el.css({opacity:e})},drawByWidget:function(e,o,t){this._opacities[e]=this.getOpacity(o,t);let r=at.default.reduce(this._opacities,function(i,n){return Math.max(i,n)},0);this.draw(r)},remove:function(){this.rendered=!1,this.$el&&this.$el.remove()},render:function(){let e=!this.rendered;if(this.rendered=!0,this.hidden)return;e&&this.setElement((0,Qn.default)("<div></div>").addClass(this.type));let o=RM.constructorRouter.zoom.getZoom(),{dictionary:t}=Oe,r=t[this.controller.workspace.viewport].width,i={left:(this.x-this.controller.dims.left+Math.abs(r-this.controller.dims.width)/2)*o,top:(this.y-this.controller.dims.top)*o,width:["top","bottom","middle"].includes(this.type)&&this.length?this.length*o:void 0,height:["left","right","center"].includes(this.type)&&this.length?this.length*o:void 0};return i.opacity=this.opacity,this.$el.css(i),this.$el}}),a1=ju.extend({initialize:function(e){e.type="baseline",ju.prototype.initialize.call(this,e)},render:function(){let e=this.y-this.controller.dims.top,o=RM.constructorRouter.zoom.getZoom(),t=this.controller.workspace.viewport,r=(0,Qn.default)(Qk({maxGuideWidth:Mr.prototype.getViewportSetting("max_width",t)*Vu,top:e*o,left:this.margin.left*o||0,right:this.margin.right*o||0,height:this.height*o,pale:this.margin.top>e||this.controller.dims.height-this.margin.bottom<e,fill:!!this.fill}));r.appendTo(this.$container),this.setElement(r)},remove:function(){ju.prototype.remove.apply(this),this.$pale_left&&this.$pale_left.remove(),this.$pale_right&&this.$pale_right.remove(),this.$leftLine&&this.$leftLine.remove(),this.$middleLine&&this.$middleLine.remove(),this.$rightLine&&this.$rightLine.remove()}}),EM=8,p1=l1.extend({sticky:8,hidden:!1,initialize:function(e){at.default.bindAll(this),at.default.extend(this,e),this.models=e.models,e.enabled&&this.show(),this.render.__debounced=at.default.debounce(this.render,100)},create:function(e){this.created=!0;let o=this;o.models.off("change",null,o),this.models.fetch({url:this.getModelUrl(),success:function(){o.loadModel(),o.models.on("change",o.onGuidesChange),o.models.on("change:margin.top",o.onGuidesChange),RM.constructorRouter.on("pageChange",o.loadModel),RM.constructorRouter.on("updateWorkspaceViewport",o.render),e&&o.show()}})},switchOn:function(e){this.hidden&&(e.changed.padding||e.changed.columns||e.changed.margin||e.changed.baseline_height||e.changed.baseline_group)&&this.controller.switchOn("guides")},onGuidesChange:function(e){this.switchOn(e),this.render(),e.changed.pages&&e.changed.pages.indexOf&&e.changed.pages.indexOf(this.controller.router.workspace.page.id)>-1&&this.loadModel()},getColumnWidths:function(e,o,t,r,i,n){if(n)return[...Array(i)].map(()=>n);{let c=e-t-o+r,d=c/i-r,p=Math.floor(d),m=(p+r)*i,u=c-m,g=[];for(var s=0;s<i;s++)g[s]=p;for(var s=0;s<u;s++)g[Math.floor((i-u)/2)+s]=Math.ceil(d);return g}},render:function(e){this.renderColumns(),this.renderBaselines(),this.rendered=!0,e&&e.callback&&e.callback.call()},renderColumns(){if(!this.model)return;let e=this.controller.workspace.viewport,o=RM.constructorRouter.zoom.getZoom(),t=this.controller.mag.getViewportWidth(e),r=Oe.dictionary[e].width,i=this.model.toJSON();i.margin=at.default.clone(i.margin),i.columns<=0&&(i.margin={top:0,right:0,bottom:0,left:0}),this.$guides.empty().css({margin:"0 "+Math.round(i.margin.right*o)+"px 0 "+Math.round(i.margin.left*o)+"px",width:t*o-i.margin.right*o-i.margin.left*o+"px"});let n=this.getColumnWidths(t,i.margin.left,i.margin.right,i.padding,i.columns,i.columnWidth);this.$guideColumns=this.template(at.default.extend({},i,{zeroGutter:!i.padding,columnWidths:n.map(d=>d*o),offsetTop:i.margin.top*o,offsetBottom:i.margin.bottom*o,maxGuideHeight:Mr.prototype.getViewportSetting("max_height",e)*Vu})),this.$guides.html(this.$guideColumns),this.guidelines=[];let s=0-Math.abs(Math.round((t-r)/2)),l=r+Math.abs((t-r)/2),c=s+i.margin.left+this.controller.dims.left;for(let d=0;d<i.columns;d++)c=c+n[d],this.guidelines.push(c),i.padding&&(c+=i.padding,this.guidelines.push(c));at.default.each([s,s+i.margin.left,l-i.margin.right,l],function(d){this.guidelines.push(d+this.controller.dims.left)},this)},renderBaselines(){if(!this.model)return;this.$baselines.empty(),this.baselines=[];let e=this.model.toJSON();if(at.default.each([0,e.margin.top,this.controller.dims.height-e.margin.bottom+1,this.controller.dims.height],function(o){this.baselines.push(new a1({y:o+this.controller.dims.top,$container:this.$baselines,margin:e.margin}))},this),e.baseline_height>=EM)for(let o=1;o*e.baseline_height<=this.controller.dims.height;o++){let t=new a1({controller:this.controller,y:o*e.baseline_height+this.controller.dims.top,$container:this.$baselines,margin:e.margin,fill:o%e.baseline_group,height:e.baseline_height});t.render(),t.show(),this.baselines.push(t)}},show:function(){if(!this.created)return this.create(!0);this.rendered||this.render(),this.$guides.add(this.$baselines).fadeIn("fast"),this.hidden=!1},hide:function(){this.$guides.add(this.$baselines).fadeOut("fast"),this.hidden=!0},toggle:function(){this.controller.mag.edit_params.get("guides")?this.show():this.hide()},findDataForSnapping:function({position:e,width:o,height:t}){let r={x:e.x,y:e.y,width:o,height:t};this.snapController.findNearestBaselines({baselines:this.baselines,blockCoords:r}),this.snapController.findNearestGuidelines({guidelines:this.guidelines,blockCoords:r})},stickOnResize:function({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}){let n=this.controller.workspace.viewport,s=this.controller.mag.getViewportWidth(n),l=Oe.dictionary[n].width,c=this.sticky,d=this.baselines||[],p=this.guidelines||[],m=0-Math.abs((s-l)/2);return ff({sticky:c,verticalLines:p,horizontalLines:d?.map(g=>g.y),leftBorderX:m,direction:t,correctedBox:o,originalBox:e,isSidePointProportional:r,fromCenter:i})}}),uc=e=>(e=e||"",e.length===2?[e[1],e[0]]:e.length===0?["",""]:e==="c"?["c","c"]:["n","s"].includes(e)?["c",e]:[e,"c"]);p1.prototype.template=Kk["template-constructor-grid-guides-controller"];var c1=MM;var xl=B($t()),d1=B(Mo()),gc=B(pt());tn();var bf={"template-constructor-arrows":Lt`
	<div aria-label="Left navigation arrow" class="navigation-arrow left" style="display: <%= hidden ? 'none' : 'block'%>;"><div class="icon sprite" style="background-image: url('<%=icons.sprite%>')"></div></div>
	<div aria-label="Right navigation arrow" class="navigation-arrow right" style="display: <%= hidden ? 'none' : 'block'%>;"><div class="icon sprite" style="background-image: url('<%=icons.sprite%>')"></div></div>
`,"template-constructor-arrows-color-selector":Lt`
	<div class="arrow-color-selector">
		<div class="color-clip-wrapper">
			<div class="color-wrapper">
				<div class="color white"></div>
				<div class="color black"></div>
			</div>
		</div>
	</div>
`};kh();var AM=d1.default.View.extend({colorSelectorTemplate:bf["template-constructor-arrows-color-selector"],className:"constructor-navigation-arrows",events:{"click .navigation-arrow":"go","click .color-clip-wrapper":"toggleArrowsColor"},initialize:function(e){gc.default.bindAll(this),this.router=e.router,this.router.on("pageChange changePids page-order-change",this.onPageChange),this.render(),this.listenTo(this.router.mag,"change:opts change:viewport_phone_portrait change:viewport_tablet_portrait",()=>{this.render(),this.onPageChange(this.router.workspace)}),this.listenTo(this.router,"changeViewport",this.render)},render:function(){let e=bf["template-constructor-arrows"],o=this.router.workspace?.viewport||"default",t=o==="phone_portrait"||o==="tablet_portrait"?`viewport_${o}`:void 0,r=t?this.router.mag.get(t)?.opts?.viewertype||this.router.mag.get("opts").viewertype:this.router.mag.get("opts").viewertype;this.$el.toggleClass("is-vertical",r==="vertical"),this.$el.html(e({hidden:this.router.previewMode,icons:{sprite:Hs(`./common/navigation/sprite${Ox?"@2x":""}.png`)}})),(0,xl.default)("#constructor").prepend(this.$el),(0,gc.default)(this.$(".navigation-arrow")).each(function(i){(0,xl.default)(i).append(this.colorSelectorTemplate())}.bind(this))},go:function(e){if((0,xl.default)(e.target).closest(".arrow-color-selector").length)return;let o=(0,xl.default)(e.currentTarget).hasClass("left")?"prev":"next";this.router.go(o)},onPageChange:function(e){!e||this.router.previewMode||gc.default.defer(gc.default.bind(function(){let o=this.router.isCurrentPageLocked();this.$(".left").toggle(e.page.get("num")!=1).toggleClass("disabled",!!o),this.$(".right").toggle(e.page.get("num")!=this.router.mag.get("pids").length).toggleClass("disabled",!!o),this.updateArrowsColor(e.page.get("arrows_color"))},this))},updateArrowsColor:function(e){e=e||"white",(0,xl.default)("#constructor").removeClass("navigation-white-arrows").removeClass("navigation-black-arrows").addClass("navigation-"+e+"-arrows"),this.$(".arrow-color-selector").removeClass("white").removeClass("black").addClass(e)},toggleArrowsColor:function(){let e=this.router.workspace.page,o=this.$(".arrow-color-selector"),t=e.get("arrows_color")||"white",r=t=="white"?"black":"white";o.hasClass("disabled")||(this.$(".arrow-color-selector").addClass("disabled"),this.updateArrowsColor(r),e.save({arrows_color:r},{patch:!0,skipHistory:!0}).success(function(){this.updateArrowsColor(r)}.bind(this)).error(function(){this.updateArrowsColor(t)}.bind(this)).complete(function(){o.removeClass("disabled")}.bind(this)))},destroy(){this.stopListening(this.router.mag,"change:opts",this.render),this.stopListening(this.router,"changeViewport",this.render)}}),u1=AM;var e2=B(Mo()),qt=B(pt());st();Zd();Ho();var _1=B(H()),vf=B(pt());je();Wh();zp();Md();Ho();var es=B(H()),m1=B(pt());zp();fM();st();function g1(e,o){return e.reduce((t,r)=>{let i=r[o];return typeof i=="string"&&(t[i]=r),t},{})}function h1(e,o){let t=Cx(o||new Date,e),[r,i]=t.split(" ");if(i==="seconds")return"Now";let s={minutes:"min",hour:"h",day:"d",months:"mo",year:"y"}[i]||i[0];return`${r}${s} ago`}var vl={zoomedBox:8e3,expandedBubble:1e4},f1=(e,o,t=[],r=[])=>{let i=r.map(s=>s.author),n=[o].concat(t).concat(i);return m1.default.unique(n,"_id").filter(s=>!s.isPending&&!s.isSupport&&e._id!==s._id)};async function b1(e,o,t){let r=`${le.readymag_auth_host}/edit/${e}/${o}/comment/${t}`;await navigator.clipboard.writeText(r)}var w1=wk("resize",()=>({zoom:window.RM.constructorRouter?.zoom?.getZoom()||0}),()=>({zoom:window.RM.constructorRouter?.zoom?.getZoom()||0})),LM={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};function x1(e){let[o,t]=(0,es.useState)(LM),r=(0,es.useMemo)(()=>new ResizeObserver(i=>{if(i[0]){let{x:n,y:s,width:l,height:c,top:d,left:p,bottom:m,right:u}=i[0].contentRect;t({x:n,y:s,width:l,height:c,top:d,left:p,bottom:m,right:u})}}),[]);return(0,es.useEffect)(()=>{if(e)return r.observe(e),()=>{r.disconnect()}},[e]),o}var qu=(e,o)=>{let[t,r]=(0,es.useState)(null);return(0,es.useEffect)(()=>{if(e.current&&typeof IntersectionObserver=="function"){let i=s=>{r(s[0])},n=new IntersectionObserver(i,o);return n.observe(e.current),()=>{r(null),n.disconnect()}}},[e.current,o.threshold,o.root,o.rootMargin]),t};var wf="commentsModeState",xf="rm:comments-panel:height";var DM={comments:null},yf={viewTree:{},totalNew:0},[ts,S1]=lr(yf);function C1(e,o){let t={},r=0;return e.forEach(i=>{i.status!=="resolved"&&(i.author._id!==o&&!i.seen.includes(o)?(t[i._id]?t[i._id].isNew=!0:t[i._id]={isNew:!0,newChildren:0},i.parent&&(t[i.parent]?t[i.parent].newChildren+=1:t[i.parent]={isNew:!1,newChildren:1}),r+=1):t[i._id]={isNew:!1,newChildren:0})}),{viewTree:t,totalNew:r}}function OM(){let e=sessionStorage.getItem(wf);return e?!!parseInt(e):!1}function $M(e){sessionStorage.setItem(wf,`${e?1:0}`)}var[dn,Xu,HM]=lr(null),[go,hc,P1,kf]=lr(OM()),v1=!0,[FM,yl,os]=lr(DM),[T1,I1,NM]=lr("initial");function _f(e,o){NM()==="loading"&&I1("loaded");let t=g1(e,"_id"),i={...os().comments??{},...t};yl({comments:i});let n=Object.values(i||{});S1(C1(n,o)),v1&&(v1=!1,Re.trigger("comments:init"))}function M1(e){return(os().comments??{})[e]}function Sf({id:e,frontId:o,comment:t,userId:r}){let i=os().comments??{},n=i[e]??{},s={...i,[e]:{...n,...t}};if(o&&s[o]){delete s[o];let c=HM();if(c){let d={...c.comment};d.isTmp&&d._id===o&&(d._id=e,Xu({...c,comment:d}))}}yl({comments:s});let l=Object.values(s||{});S1(C1(l,r))}function Ku({parentCommentId:e,childCommentId:o}){let t=os().comments??{},r={...t};if(e&&o){let i={...t[e]};i.children=i?.children??[],i.children=i.children.filter(n=>n._id!==o),delete r[o],r={...r,[e]:i}}else e&&!o&&delete r[e];yl({comments:r})}function WM(e,o){return{...o,_id:e,projectId:window.RM.constructorRouter.mag.get("_id"),seen:[],status:"unresolved",author:{email:window.RM.constructorRouter.me?.attributes.email||"",name:window.RM.constructorRouter.me?.attributes.name||"",num_id:Number(window.RM.constructorRouter.me?.attributes.num_id)||0,_id:window.RM.constructorRouter.me?.attributes._id||""},attachments:[],createdDate:Px(new Date),isTmp:!0}}function B1(e){let o=os().comments??{};if(o[e]){let t={...o};delete t[e],yl({comments:t})}}function Zu(e){let o=Un(),t=os().comments??{},r=WM(o,e);return yl({comments:{...t,[o]:r}}),window.RM.constructorRouter.sockets.createComment(e,o),r}function R1({commentId:e,...o}){let t=os().comments??{},i={...t[e],...o};yl({comments:{...t,[e]:i}}),window.RM.constructorRouter.sockets.updateComment({commentId:e,...o})}function z1(e){Ku(e),window.RM.constructorRouter.sockets.deleteComment({commentId:e.childCommentId??e.parentCommentId})}function E1(e){window.RM.constructorRouter.sockets.deleteCommentsMany({widgetId:e})}function A1(){I1("loading"),window.RM.constructorRouter.sockets.getProjectComments()}var Yu=[],y1=0;function VM(){let e=[...Yu];Yu=[],window.RM.constructorRouter.sockets.viewManyComments({commentsIds:e})}function L1({comment:e,userId:o,remove:t}){let r={...e};t?r.seen=r.seen.filter(i=>i!==o):r.seen.push(o),Sf({id:r._id,comment:r,userId:o})}function D1({commentId:e,userId:o,remove:t}){let i=(os().comments??{})[e];L1({comment:i,userId:o,remove:t})}async function O1(e,o){Yu.includes(e._id)||(Yu.push(e._id),clearTimeout(y1),y1=setTimeout(VM,1500),setTimeout(()=>{L1({comment:e,userId:o})},0))}function Ju(e={status:"unresolved"}){let[o]=FM();return(0,_1.useMemo)(()=>{let t=Object.values(o.comments||{}),r=vf.default.where(t,e),i=vf.default.groupBy(r,s=>s.parent?s.parent:"parents"),n=[];return i.parents&&(n=[...i.parents].sort((s,l)=>new Date(l.createdDate).getTime()-new Date(s.createdDate).getTime())),Object.keys(i).length>1&&n.forEach(s=>{i[s._id]&&(s.children=i[s._id].sort((l,c)=>new Date(l.createdDate).getTime()-new Date(c.createdDate).getTime()))}),n},[o.comments,e.status,e.viewport,e.pageId])}kf(e=>{e||Xu(null),$M(e),e&&se(he.CommentsMode,{settingsType:"on"})});var[$1,UM]=lr(new Date);function GM(){UM(new Date)}setInterval(GM,60*1e3);Md();Ws();async function H1(e){return await Zt.post(`/api/mag/${e}/snapshots`)}async function F1(e,o){return await Zt.get(`/api/mag/${e}/snapshots`,void 0,o)}async function N1(e,o,t){return await Zt.post(`/api/mag/${e}/snapshots/${o}/restore`,void 0,t)}async function W1(e,o,t){return await Zt.post(`/api/mag/${e}/snapshots/${o}/copy`,void 0,t)}async function V1(e,o){return await Zt.get(`/api/mag/${e}/snapshots/last-copy`,void 0,o)}zp();function jM(e){let o=Bx(new Date,7);return Ix(e,o)||yx(e,o)}function qM(e){let o=Tx(e)?366:365;return kx(new Date,e)>=o}function U1(e){return yh(e)?`Today ${kr(e,"h:mm a")}`:Mx(e)?kr(e,"MMMM do"):kr(e,"MMMM do yyyy")}function YM(e){if(yh(e)){let o=kr(e,"h:mm a"),t=Sx(new Date,e),r=Math.floor(t/60),i=r?`${r}h ${t%60||1}m ago`:`${t%60||1} min ago`;return{category:"today",formatedDate:o,titlePrefix:"Today,",titlePostfix:i}}return Rx(e)?{category:"weekly",formatedDate:`Yesterday, ${kr(e,"MMM d, h:mm a")}`}:jM(e)?{category:"weekly",formatedDate:kr(e,"EEEE, MMM d, h:mm a")}:qM(e)?{category:"older",formatedDate:kr(e,"MMM d, yyyy, h:mm a")}:{category:"older",formatedDate:kr(e,"MMM d, h:mm a")}}function Qu(e){let o=_x(new Date,e);return Math.max(0,o)}function G1(e){return e.map(o=>({...o,metadata:YM(o.createdDate)}))}function j1(e){switch(e){case"today":return"Today";case"weekly":return"Last 7 days";case"older":return"Older ones";default:return""}}var q1={show:!1,status:"idle",versions:[],selectedVersion:null},[Cf,na,em]=lr(q1),[Y1,kl]=lr({show:!1});async function X1({projectId:e,signal:o}){let t=em();if(t.show)try{na({...t,status:"loading"});let r=await F1(e,{signal:o}),i=G1(r),n=i[0];na({...t,status:"loaded",versions:i,selectedVersion:n?{idx:0,value:n}:null})}catch{na({...t,status:"error"})}}function K1(){let e=em();na({...e,show:!0})}function Z1(){na(q1)}function J1(e){let o=em(),t=o.versions?.[e];t&&na({...o,selectedVersion:{idx:e,value:t}})}function Q1(e){let o=em(),t=o.versions?.findIndex(({_id:i})=>i===e),r=o.versions?.[t];r&&na({...o,selectedVersion:{idx:t,value:r}})}var t2=function(e,o,t,r){return this.num_id=e,this.hash=o,this.user=t,this.router=r,this};qt.default.extend(t2.prototype,e2.default.Events,{CONNECTION_TIMEOUT:5e3,CONNECTION_ATTEMPTS:5,initSocket:function(){if(!this.hash)return console.error("sockets hash not found for mag!");let o=window.location.origin===le.readymag_auth_host&&le.readymag_sockets_host?le.readymag_sockets_host:"",t=io(o,{timeout:this.CONNECTION_TIMEOUT,transports:["websocket"]});this.socket=t,this.attempts=0,t.on("connect",qt.default.bind(function(){RM.DEBUG&&console.log("socket.io connected :4095"),this.trigger("connect")},this)),t.on("disconnect",qt.default.bind(function(){RM.DEBUG&&console.log("socket.io disconnected :4095"),this.trigger("disconnect"),this.connected?this.isConnectionErrorRaised||setTimeout(()=>{t.connect()},1e3):this.onConnectionError()},this)),t.on("technical stream",r=>{console.log("technical stream input",r)}),t.on("client connect",qt.default.bind(this.onClientConnect,this)),t.on("client disconnect",qt.default.bind(this.onClientDisconnect,this)),t.on("page comments",qt.default.bind(this.onPageComments,this)),t.on("project comments",qt.default.bind(this.onProjectComments,this)),t.on("update comment",qt.default.bind(this.onUpdateComment,this)),t.on("delete comment",qt.default.bind(this.onDeleteComment,this)),t.on("delete comments many",qt.default.bind(this.onDeleteCommentsMany,this)),t.on("view many comments result",qt.default.bind(this.onViewManyComments,this)),t.on("create comment error",qt.default.bind(this.onCreateCommentError,this)),t.on("project restore",qt.default.bind(this.onProjectRestore,this)),t.io.on("connect_error",qt.default.bind(this.onConnectionError,this)),t.io.on("connect_timeout",qt.default.bind(this.onConnectionError,this)),t.io.on("reconnect",qt.default.bind(this.onReconnect,this)),this.on("connect",this.joinRoom,this),this.router.on("update_from_server",this.sendUpdate,this),A1()},getMagLockedPages:function(){this.socket.emit("get mag locked pages",{numId:this.num_id,userId:this.user.get("_id"),hash:this.hash})},getPageQueue:function(e){this.socket.emit("get page queue",{numId:this.num_id,pageId:e,userId:this.user.get("_id"),hash:this.hash})},getRedisStatus:function(){this.socket.emit("check redis status",{numId:this.num_id,userId:this.user.get("_id"),hash:this.hash})},joinRoom:function(){this.socket.emit("join mag",{num_id:this.num_id,hash:this.hash,user_id:this.user.id,user_data:this.user.pick("name","email","pic","_id")})},lockPage:function(e){this.socket.emit("lock page",{page_id:e})},takeOver:function(e){this.socket.emit("take over",{page_id:e})},leavePage:function(e){this.socket.emit("leave page",{page_id:e})},onLockChange:function(e){let o=[];qt.default.each(e&&e.unlocked,function(t){o.push({tp:"unlock",pageId:t.page_id,userId:t.user_id,user_data:this.users_list.get(t.user_id)})},this),qt.default.each(e&&e.locked,function(t){o.push({tp:"lock",pageId:t.page_id,userId:t.user_id,user_data:this.users_list.get(t.user_id)})},this),this.trigger("lockChange",o)},onTakeOver:function(e){this.trigger("takeOver",this.users_list.get(e.user_id))},onClientConnect:function(e){this.attempts=0,RM.DEBUG&&console.log("client connect",e),this.connected||(this.socket.on("message",qt.default.bind(this.onNewMessage,this)),this.socket.on("lock change",qt.default.bind(this.onLockChange,this)),this.socket.on("take over",qt.default.bind(this.onTakeOver,this)),this.socket.on("duplicate disconnect",qt.default.bind(this.onDuplicateDisconnect,this))),!this.isConnectionErrorRaised&&(this.connected=!0,e&&e.user_id===this.user.id&&this.router.workspace.page&&this.lockPage(this.router.workspace.page.id),e?.list&&(this.users_list=new j0(e.list,{parse:!0})),Re.trigger("sockets:connect",e))},onClientDisconnect:function(e){RM.DEBUG&&console.log("client disconnect",e),this.users_list&&this.users_list.remove(e.user_id),e.user_id&&this.trigger("client-disconnected",e.user_id)},onDuplicateDisconnect:function(){this.onConnectionError({duplicate:!0})},onConnectionError:function(e){RM.DEBUG&&console.log("socket connection error",e),this.attempts++,!(!e.duplicate&&this.attempts<this.CONNECTION_ATTEMPTS||this.isConnectionErrorRaised)&&(this.isConnectionErrorRaised=!0,this.errorRaisedAt=Date.now(),this.router.raiseSocketConnectionError())},onReconnect:function(e){RM.DEBUG&&console.log("socket reconnected",e),this.isConnectionErrorRaised&&(delete this.isConnectionErrorRaised,this.router.clearSocketConnectionError())},sendUpdate:function(e,o,t){RM.DEBUG&&console.log("send update",e,o),this.socket.emit("message",{type:"model_update",data:{modelName:e,viewport:t,data:o}})},onNewMessage:function(e){RM.DEBUG&&console.log("new socket message",e),e&&e.type==="model_update"&&this.router.updateFromSocket(e.data)},getAuthParams:function(){return{numId:this.num_id,userId:this.user.get("_id"),hash:this.hash,projectId:this.router.mag.get("_id")}},createComment:function({pageId:e,viewport:o,content:t,position:r,parent:i,attachments:n},s){this.socket.emit("create comment",{...this.getAuthParams(),pageId:e,viewport:o,content:t,position:r,parent:i,attachments:n},s)},updateComment:function({commentId:e,content:o,status:t,attachments:r}){this.socket.emit("update comment",{...this.getAuthParams(),commentId:e,content:o,status:t,attachments:r})},deleteComment:function({commentId:e}){this.socket.emit("delete comment",{...this.getAuthParams(),commentId:e})},viewComment:function({commentId:e,unview:o}){this.socket.emit("view comment",{...this.getAuthParams(),commentId:e,unview:o})},viewManyComments:function({commentsIds:e}){this.socket.emit("view many comments",{...this.getAuthParams(),commentsIds:e})},getPageComments:function(e,o){this.socket.emit("get page comments",{...this.getAuthParams(),pageId:e,viewport:o})},getProjectComments:function(){this.socket.emit("get project comments",{...this.getAuthParams()})},deleteCommentsMany:function({widgetId:e}){this.socket.emit("delete comments many",{...this.getAuthParams(),widgetId:e})},onPageComments:function({comments:e}){_f(e,this.user.get("_id"))},onProjectComments:function({comments:e}){_f(e,this.user.get("_id"))},onUpdateComment:function(e,o){Sf({id:e._id,frontId:o,comment:e,userId:this.user.get("_id")})},onDeleteComment:function(e){Ku(e,this.user.get("_id"))},onDeleteCommentsMany:function({deletedComments:e=[]}){e.forEach(o=>{Ku({parentCommentId:o})})},onViewManyComments:function(e){e?.notProcessed&&e?.notProcessed.length&&e.userId&&e.notProcessed.forEach(o=>D1({commentId:o,userId:e.userId,remove:!0}))},onCreateCommentError:function({error:e,uuid:o}){console.error("create comment error",e),o&&B1(o)},startProjectRestore:function({restoreId:e}){this.socket.emit("start project restoring",{...this.getAuthParams(),restoreId:e})},onProjectRestore:function({restoreId:e}){kl({show:!0,jobId:e})}});var o2=t2;var W=B(pt());So();var ht=B($t());je();Ai();Wn();Ho();ui();oI();Bo();df();var Pf=B(Mo()),Tf=B(Qo()),Qt=B(pt());gk();Uh();Wn();Ho();Vs();vt();Uo();vt();pr();lf();var XM=Pf.default.View.extend({className:"controls",attributes:{"aria-label":"Controls"},groupControls:{0:"common_pack",1:"common_unpack",2:"common_align",3:"common_arrange",4:"common_interactions",5:"common_position",6:"common_layer"},controls:[],groupControlsDividers:(e,o)=>o.viewport!=="default"&&!o.getSelectedBlocks().every(t=>t.model.get("is_global"))?["common_arrange"]:["common_align"],ICON_HEIGHT:30,ICON_PADDING:2,initialize:function(e){Qt.default.bindAll(this),this.workspace=e.workspace,this.workspace.on("deselect",this.hide),this.workspace.on("select",this.onSelect),this.$main.append(this.$el),this.$el.addClass(this.className),this.$el.append('<div id="controls-help-tour-tooltip"></div>'),this.selectedBlocks=[],this.tooltipIsMount=!1,Re.on("tips:show",this.showTip.bind(this))},getBlocksThatPassedRestrictionsCheck:function(e,o){let t=[],r=null;return e[0]&&e[0].has_parent_block?r=e[0].workspace:r=this.workspace,Qt.default.each(o,function(i){ea[i]&&ea[i].prototype.restrictions&&!ea[i].prototype.restrictions.call(this,r,e)||t.push(i)},this),t},setControls:function(e,o,t={}){let r=Qt.default.find(this.controls,function(m){return m.selected==!0});clearTimeout(this.hideTimeout);let i={},n={};Qt.default.isArray(o)||(o=[o]),!Qt.default.isArray(e)&&Qt.default.isString(e)&&(e=[e]);let s=this.getBlocksThatPassedRestrictionsCheck(o,e);Qt.default.each(this.controls,function(m){Qt.default.contains(s,m.name)?t.destroyAll?(i[m.name]=m.$el.position().top,m.destroy(!1)):n[m.name]=m:m.destroy(!0)},this),this.controls=[];let l=Qt.default.pluck(o,"model"),c=this.calculateDividersTotal(o,s),d=s.length*(this.ICON_HEIGHT+this.ICON_PADDING)-this.ICON_PADDING+c,p=-d/2;Qt.default.each(s,function(m){let u=n[m];if(u)u.moveToNewPos(p);else{let h=i[m]!=null;u=new ea[m]({blocks:o,models:l,master:this,$container:this.$el,appearanceAnimation:!h,fromY:h?i[m]:p,y:p})}u.moveToNewPos(p),p+=this.ICON_HEIGHT+this.ICON_PADDING;let g=this.getControlsByDividersField(o);g.length&&(p+=this.getDividerSize(g,m)),this.controls.push(u)},this),this.selectedBlocks=o,this.controls.indexOf(r)>-1&&!t.noSelect?this.select(r):Qt.default.invoke(this.controls,"removeFade"),this.workspace.trigger("controls-have-been-updated"),this.show(),this.$("div[data-alt]:not(.rmalttext)").RMAltText()},toggleHelpNotice:function(e){Nr(["TextWidgetSelect","PictureWidgetUse","TextWidgetOpenPanel","TextWidgetProperties","ButtonWidgetAdjustVisualProperties","ButtonWidgetAddLink","ButtonWidgetAddLinkType","AddAnimations","PositionControlClick"],e)},softUpdateControlsForBlocks:function(e){if(!e||!e.length)return;let o=this.getBlocksGroupControls(e),t=e.length===1?e[0].controls:o,r=this.getBlocksThatPassedRestrictionsCheck(e,t),i=this.controls?.map(s=>s.name);Qt.default.isEqual(i,r)||this.setControls(r,e,{destroyAll:!0})},onSelect:function(e){if(this.toggleHelpNotice({show:!1}),e.length===1&&e[0].model.get("hidden")){this.hide();return}let t=this.getBlocksGroupControls(e),r=e.length===1?e[0].controls:t;!e||!e.length||(e.length>1&&e.every(i=>i.isVector&&i.isVector())&&(r=this.replacePictureSettings(r)),this.setControls(r,e,{destroyAll:!0}))},getBlocksGroupControls:function(e){if(e.length>1){let t=e.map(s=>s.groupControls?Object.values(s.groupControls).length:0).reduce((s,l,c)=>l?Object.assign({},s,e[c].groupControls||{}):s,{}),r={},i={};Object.keys(t).forEach(s=>{i[t[s]]||(i[t[s]]=s,r[s]=t[s])});let n=Object.keys(r).map(s=>parseInt(s));if(n.length){let l=Object.keys(this.groupControls).map(p=>parseInt(p)).length+n.length,c=[],d=0;for(let p=0;p<l;p++)n.includes(p)?(d+=1,c.push(t[p])):c.push(d?this.groupControls[p-d]:this.groupControls[p]);return Qt.default.uniq(c)}}return Object.values(this.groupControls)},show:function(){setTimeout(()=>{this.renderHelpTourTooltip()},100),Qt.default.each(this.controls,function(o){o.render()},this);let e=this.selectedBlocks[0];e.settingsOnCreate&&e.model.created&&!e.model.settingsOpened&&!e.has_parent_block&&(e.onCreate?e.onCreate():this.selectFirst(),this.selectedBlocks[0].model.settingsOpened=!0)},hide:function(e){this.unmountHelpTourTooltip(),e?.fromAdd||this.toggleHelpNotice({show:!0}),this.hideTimeout=setTimeout(this.hideWithAnimation,0)},renderControlTooltip:function(){let e=this.$el.children("#controls-help-tour-tooltip")[0],o=this.tipsFromY?this.tipsFromY:this.controls[0]?.fromY;!e||!o||Xa({component:fu,domElement:e,model:new Pf.default.Model({position:this.eduTipForRender?"left":"top",indent:8,steps:["TextWidgetOpenPanel","ButtonWidgetAdjustVisualProperties"],styles:{position:"relative",top:this.eduTipForRender?o+this.ICON_HEIGHT/2:o},...this.eduTipForRender&&{eduTips:this.eduTipForRender}}),onRenderComplete:()=>{this.tooltipIsMount=!0,this.eduTipForRender&&(this.eduTipRendered=this.eduTipForRender,this.eduTipForRender=null),this.tipsFromY&&(this.tipsFromY=null)},onDestroy:()=>{Tf.default.unmountComponentAtNode(e),e&&e.parentNode&&e.parentNode.removeChild(e)}})},showTip:function(e){if(!zh.includes(e))return;this.eduTipForRender=e;let o=e.toLowerCase();setTimeout(()=>{let t;if(o.includes("color"))t=this.findControl("shape_color")||this.findControl("text_color");else if(o.includes("arrange"))t=this.findControl("common_arrange");else if(o.includes("typography"))t=this.findControl("text_typography");else if(o.includes("group"))t=this.controls[2];else if(o.includes("settings")&&(t=this.controls[0],t&&!t.selected)){this.renderControlTooltip();return}!t&&(t=this.controls[0],!t)||(this.tipsFromY=t.fromY,o.includes("settings")||this.renderControlTooltip())},300)},hideTip:function(){let e=T0();this.eduTipForRender===null&&zh.includes(e.message)&&window.RM.constructorRouter.trigger("notice:triggerEduTipClose")},renderHelpTourTooltip:function(){let{started:e}=Ht();e&&(this.tooltipIsMount&&this.unmountHelpTourTooltip(),this.renderControlTooltip())},unmountHelpTourTooltip:function(){if(!this.tooltipIsMount)return;let e=this.$el.children("#controls-help-tour-tooltip")[0];Tf.default.unmountComponentAtNode(e)&&(this.tooltipIsMount=!1)},canControlsBeClosed:function(e){let o=!0;return Qt.default.each(this.controls,function(t){o=!t.canControlBeClosed(e)&&o}),o},hideWithAnimation:function(){this.selectedBlocks=[],this.controls.length!==0&&(Qt.default.each(this.controls,function(e){let o=e instanceof Cv;e.destroy(!o)}),this.controls=[])},select:function(e){if(!e||e.rolePermission&&!Ze.isPermissionAllowed(e.rolePermission))return;e.trigger("selected",{control:e,state:!0}),e.select();let o=Qt.default.without(this.controls,e);Qt.default.each(o,function(t){t.fade()}),e.block&&e.block.isEditMode||this.hideTip()},deselect:function(){this.nextHelpTourStepAfterDeselect(),this.hideTip(),Qt.default.each(this.controls,function(e){e.trigger("selected",{control:e,state:!1}),e.deselect()})},nextHelpTourStepAfterDeselect:function(){let{started:e}=Ht();e&&(He(["TextWidgetSelect"]),He(["TextWidgetProperties"]),He(["TextWidgetOpenPanel","ButtonWidgetAddLink","ButtonWidgetAddLinkType"]),He(["PictureWidget","PictureWidgetClickOutside"],{fallback:!0}),He(["ButtonWidgetAdjustVisualProperties","ButtonWidgetAnchorLinkPosition"]),He(["PointerCursorUpload"]))},selectFirst:function(){this.select(this.controls[0])},selectSettingsControl:function(){this.controls[0]&&this.select(this.controls[0])},findControl:function(e){let o;return Qt.default.each(this.controls,function(t){t.name==e&&(o=t)}),o},getControlsHeight:function(){return Qt.default.isEmpty(this.controls)?0:this.controls.length*(this.ICON_HEIGHT+this.ICON_PADDING)-this.ICON_PADDING},getControlRelativePosition:function(e){let o=this.controls.indexOf(e);return o=o<0?0:o,o==0?o:o*(this.ICON_HEIGHT+this.ICON_PADDING)-this.ICON_PADDING/2},calculateDividersTotal:function(e,o){let t=0,r=this.getControlsByDividersField(e);for(let i of r)o.includes(i)&&(t+=this.getDividerSize(r,i));return t},replacePictureSettings(e){return[...e.join().replace("picture_settings","picture_color").split(",")]},getControlsByDividersField(e){let o=e.length===1?"controlsDividers":"groupControlsDividers",t=[];if(e[0][o]&&(Array.isArray(e[0][o])?t=[...e[0][o]]:typeof e[0][o]=="function"&&(t=[...e[0][o](e[0],this.workspace,Object.values(e[0].groupControls))]),e.length>1)){let r=typeof this.groupControlsDividers=="function"?this.groupControlsDividers(e[0],this.workspace,Object.values(e[0].groupControls)):this.groupControlsDividers;t.push(...r),e.every(i=>i.isVector&&i.isVector())&&(t=this.replacePictureSettings(t))}return t},getDividerSize:function(e,o){return e&&e.length&&e.includes(o)?22:0}}),i2=XM;gk();Ds();var un=B($t()),If=B(pt());Bo();ou();var n2=B(Qo());Vs();EI();var KM={props:{position:{type:String,default:null},indent:{type:Number,default:null},step:{type:String,default:null},modifiers:{type:Array,default:null},skidding:{type:Number,default:0},componentsProps:{type:Object,default:void 0}},mounted:function(){Xa({component:fu,domElement:this.$el,model:new Backbone.Model({position:this.position,indent:this.indent,steps:this.step,styles:{width:"100%",height:"100%"},skidding:this.skidding,modifiers:this.modifiers,componentsProps:this.componentsProps})})},beforeDestroy:function(){n2.default.unmountComponentAtNode(this.$el)}},ZM=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"help-tour-tooltip"})},JM=[],QM=void 0,eB=void 0,tB=void 0,oB=!1;function rB(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="helptour-tooltip.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var iB=rB({render:ZM,staticRenderFns:JM},QM,KM,eB,oB,tB,!1,void 0,void 0,void 0),Ni=iB;Ho();vt();var nB={components:{NumericInput:Vn,HelpTourTooltip:Ni},props:{workspace:Object,defaultZoom:{type:Number,default:1},defaultSticky:Boolean},data:function(){return{pageHeight:0,draggable:!1,viewport:"",nearHovered:!1,sX:0,sY:0,zoom:this.defaultZoom||1,relativeToScreen:this.defaultSticky,helpTourStep:"PageHeight",isHelpTourStep:!1}},computed:{minH:function(){return this.getViewport().min_height},maxH:function(){return this.getViewport().max_height},isSticky(){return this.relativeToScreen&&Modernizr.csspositionsticky||this.isHelpTourStep},isFixed(){return this.relativeToScreen&&!Modernizr.csspositionsticky},roundedPageHeight:{get(){return Math.round(this.pageHeight)},set(e){this.pageHeight=e}}},mounted:function(){(0,un.default)(document).on("mousemove",this.dragMove),(0,un.default)(document).on("mouseup",this.dragEnd),(0,un.default)(window).on("blur",this.onBlur),Re.on("zoom",this.onZoom),Re.on("helptour:update",this.handleCheckTourStep),window.RM.constructorRouter.on("pageChange",this.handleCheckTourStep)},destroy:function(){(0,un.default)(document).off("mousemove",this.dragMove),(0,un.default)(document).off("mouseup",this.dragEnd),(0,un.default)(window).off("blur",this.onBlur),Re.off("helptour:update",this.handleCheckTourStep),window.RM.constructorRouter.off("pageChange",this.handleCheckTourStep)},methods:{savePage:If.default.debounce(function(){this.workspace.page.saveHeight()},300),loadHeight:function(){this.viewport=this.workspace.viewport,this.pageHeight=this.workspace.page.getViewportParam(this.workspace.viewport,"height")},getViewport:function(){return If.default.find(Oe.viewports,e=>e.name===this.viewport)},dragMove:function(e){if(this.dragged){let o=this.pageHeight+(e.pageY-this.startY)/this.zoom,t=this.workspace.$window.height();o<t/this.zoom&&this.viewport==="default"&&(o+=(e.pageY-this.startY)/this.zoom),e.pageY/this.zoom+20>t/this.zoom?this.downInt||(this.downInt=setInterval(()=>{this.pageHeight+=20},100)):this.downInt&&(clearInterval(this.downInt),this.downInt=null),this.pageHeight=Math.min(Math.max(o,this.minH),this.maxH),this.startY=e.pageY}else this.nearHovered&&document.activeElement!==this.$refs.input.$el&&Math.pow(this.sX-e.screenX,2)+Math.pow(this.sY-e.screenY,2)>6e3&&(this.nearHovered=!1)},dragStart:function(e){this.dragged=!0,this.startY=e.pageY,(0,un.default)("body").addClass("ns-resize-cursor"),this.workspace.page.trigger("change-height-start")},dragEnd:function(){this.dragged=!1,(0,un.default)("body").removeClass("ns-resize-cursor"),this.downInt&&(clearInterval(this.downInt),this.downInt=null),this.workspace.page.trigger("change-height-end")},onBlur:function(){this.nearHovered=!1,this.dragEnd()},onZoom:function(e,o){this.zoom=e,this.relativeToScreen=o},handleCheckTourStep:function(){let{step:e}=Ht(),o=this.workspace.page.getPageId()===window.RM?.constructorRouter?.getCurrentPageId();this.isHelpTourStep=o&&e?.name==="PageHeight"}},watch:{pageHeight:function(e,o){if(this.workspace.page.getViewportParam(this.workspace.viewport,"height")===e)return;this.workspace.page.setViewportParam(this.workspace.viewport,"height",Math.round(this.pageHeight)),this.workspace.page.setViewportParam(this.workspace.viewport,"type","scroll");let t=this.workspace.$window.height();e>t/this.zoom&&e>o&&this.workspace.$container.scrollTop(this.workspace.$container.scrollTop()+Math.ceil((e-o)*this.zoom)),this.savePage(),He("PageHeight")},workspace:{handler:function(e,o){o&&(o.page.off("change:viewport",this.loadHeight),o.page.off("change:height",this.loadHeight),o.page.off("change:viewport_phone_portrait",this.loadHeight),o.page.off("change:viewport_tablet_portrait",this.loadHeight)),e.page.on("change:viewport",this.loadHeight),e.page.on("change:height",this.loadHeight),e.page.on("change:viewport_phone_portrait",this.loadHeight),e.page.on("change:viewport_tablet_portrait",this.loadHeight),this.loadHeight()},immediate:!0},nearHovered(e){this.workspace.toggleBorder({guidesOn:RM.constructorRouter.mag.edit_params.get("guides"),columnCount:RM.constructorRouter.gg.guides?.model?.get("columns"),margin:RM.constructorRouter.gg.guides?.model?.get("margin"),willResize:e})}}},sB=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{class:{"page-size-control":!0,sticky:e.isSticky,fixed:e.isFixed}},[t("transition",{attrs:{name:"page-size-fade"}},[e.nearHovered||e.isHelpTourStep?t("numeric-input",{ref:"input",staticClass:"size-input-readonly",attrs:{min:e.minH,max:e.maxH,autosize:!0,"thousand-delimiter":",","mouse-use":!1},model:{value:e.roundedPageHeight,callback:function(r){e.roundedPageHeight=r},expression:"roundedPageHeight"}}):e._e()],1),e._v(" "),e.isHelpTourStep?t("help-tour-tooltip",{attrs:{step:e.helpTourStep,position:"top",indent:56}}):e._e(),e._v(" "),t("div",{staticClass:"size-handle",on:{mousedown:e.dragStart,mouseover:function(r){e.sX=r.screenX,e.sY=r.screenY,e.nearHovered=!0}}})],1)},aB=[],lB=void 0,pB=void 0,cB=void 0,dB=!1;function uB(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="page-size.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var mB=uB({render:sB,staticRenderFns:aB},lB,nB,pB,dB,cB,!1,void 0,void 0,void 0),s2=mB;Eu();Fs();st();Cu();tf();su();Nh();yr();rM();pr();var yc=B(Mo());ef();$h();hM();var _l=B($t());Ds();var Pe=B(pt());Fs();var wi=B($t());ou();Ho();var Mf=B(pt());vt();var gB={components:{NumericInput:Vn,HelpTourTooltip:Ni},props:{space:Object,spaces:Array,workspace:Object,blockHovered:Boolean,defaultZoom:{type:Number,default:1}},data(){return{workspaceWidth:this.workspace.mag.getViewportWidth(this.workspace.viewport),windowWidth:(0,wi.default)(window).width(),nearHandleHovered:!1,handleY:0,dragged:!1,needSizes:this.workspace.mag.edit_params.get("sizes"),zoom:this.defaultZoom||1,helpTourStep:"SetBlocksDistance",interval:void 0}},computed:{isMobile(){return this.workspace.viewport!=="default"},sideMargin(){return Math.max((this.windowWidth-this.workspaceWidth*this.zoom)/2/this.zoom,0)},resizeSign(){return this.startHandle==="top"?-1:1},prevSpace(){return this.spaces[this.spaces.indexOf(this.space)-1]||null},topGroupHeight(){return this.prevSpace?(this.space.top-this.prevSpace.bottom)*this.zoom:0}},created(){this.onResizeEndDebounced=Mf.default.debounce(this.onResizeEnd,300),this.onHeightChangeDebounced=Mf.default.debounce(this.onHeightChange,300)},mounted(){(0,wi.default)(window).on("resize",this.onWinowResize),(0,wi.default)("body").on("mousemove",this.onDragMove),this.workspace.page.on("change:viewport",this.onChangeViewport),this.workspace.mag.edit_params.on("change:sizes",this.onToggleSizes),Re.on("zoom",this.onZoom)},beforeDestroy(){(0,wi.default)(window).off("resize",this.onWinowResize),(0,wi.default)("body").off("mousemove",this.onDragMove),this.workspace.page.off("change:viewport",this.onChangeViewport),this.workspace.mag.edit_params.off("change:sizes",this.onToggleSizes)},methods:{onChangeViewport(){this.workspaceWidth=this.workspace.mag.getViewportWidth(this.workspace.viewport)},onToggleSizes(){this.needSizes=this.workspace.mag.edit_params.get("sizes")},onHandleHover(){this.handleY=null,this.nearHandleHovered=!0,He("HoverBetweenBlocks")},onHandleLeave(e){this.handleY=e.screenY,this.nearHandleHovered=!0},onWinowResize(){this.windowWidth=(0,wi.default)(window).width()},onStartDrag(e){if(e.target.parentNode!==this.$el)return;this.startEvent=e;let o=(0,wi.default)("body");o.addClass("move-cursor"),o.on("mouseup",this.onDragEnd),o.on("mouseleave",this.onDragEnd),this.dragged=!0},onDragMove(e){if(this.dragged){let o=(e.clientY-this.startEvent.clientY)/this.zoom,t=Math.abs(window.innerHeight/this.zoom-e.pageY/this.zoom)<20,r=e.pageY/this.zoom<20;t&&o>=0&&!this.interval?this.interval=setInterval(()=>this.$emit("dragMove",this.space,o+20,e),100):r&&o<=0&&!this.interval?this.interval=setInterval(()=>this.$emit("dragMove",this.space,o-20,e),100):!t&&!r&&(this.interval&&(this.interval=clearInterval(this.interval)),this.$emit("dragMove",this.space,o,e)),this.startEvent=e}else this.handleY!==null&&Math.abs(e.screenY-this.handleY)>40&&(this.nearHandleHovered=!1)},onDragEnd(){He("DeselectAfterSetBlocksDistance"),this.dragged=!1,this.interval=clearInterval(this.interval);let e=(0,wi.default)("body");e.removeClass("move-cursor"),e.off("mousemove",this.onDragMove),e.off("mouseup",this.onDragEnd),e.off("mouseleave",this.onDragEnd),this.$emit("dragEnd",this.space)},onBottomMouseDown(e,o){this.startEvent=e,this.startHandle=o;let t=(0,wi.default)("body");t.addClass("ns-resize-cursor"),t.on("mousemove",this.mousemove),t.on("mouseup",this.mouseup)},mousemove(e){let o=(e.clientY-this.startEvent.clientY)/this.zoom;this.space.height+o<0&&(o=-this.space.height),o!==0&&(this.$emit("changeHeight",this.startHandle,this.space,o,e.shiftKey),this.startEvent=e)},onHeightChange(e){e&&(this.$emit("changeHeight","bottom",this.space,e-this.space.height,!1),this.onResizeEndDebounced(),e===80&&He("SetBlocksDistance"))},onResizeEnd(){this.$emit("resizeEnd",this.space)},mouseup(){let e=(0,wi.default)("body");e.removeClass("ns-resize-cursor"),e.off("mousemove",this.mousemove),e.off("mouseup",this.mouseup),this.$emit("resizeEnd",this.space)},onZoom:function(e){this.zoom=e}}},hB=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"space-highlighter",class:{isMobile:e.isMobile,isDesktop:!e.isMobile,"always-line":e.space.height<2,"always-plus":e.space.height<25},style:{top:e.space.top+"px",height:e.space.height+"px",left:-e.sideMargin+"px"},on:{mouseover:e.onHandleHover,mouseleave:e.onHandleLeave,mousedown:function(r){e.onStartDrag(r)}}},[t("div",{staticClass:"space-left",style:{"flex-basis":e.sideMargin+"px"}},[e.space.isLast?e._e():t("div",{staticClass:"handle handle-bottom",on:{mousedown:function(r){e.onBottomMouseDown(r,"bottom")}}}),e._v(" "),t("div",{staticClass:"add-widget",on:{click:function(r){return e.$emit("addWidget",e.space)}}}),e._v(" "),e.prevSpace&&e.blockHovered?t("div",{staticClass:"duplicate-widget",style:{top:-e.topGroupHeight/2+"px"},on:{click:function(r){return e.$emit("duplicateGroup",e.space)}}}):e._e(),e._v(" "),e.nearHandleHovered&&e.needSizes?t("div",{staticClass:"space-size",on:{click:function(r){r.stopPropagation()}}},[t("div",{staticStyle:{position:"relative",top:"10px"}},[t("help-tour-tooltip",{attrs:{step:e.helpTourStep,position:"right",indent:16}})],1),e._v(" "),t("numeric-input",{staticClass:"numeric",attrs:{autosize:!0,min:0,value:Math.round(e.space.height),"mouse-use":!1},on:{change:e.onHeightChangeDebounced}})],1):e._e()]),e._v(" "),t("div",{staticClass:"space-center",style:{"flex-basis":e.workspaceWidth+"px"}},[e.space.isLast?e._e():t("div",{staticClass:"handle handle-bottom",on:{mousedown:function(r){e.onBottomMouseDown(r,"bottom")}}})]),e._v(" "),t("div",{staticClass:"space-right",style:{"flex-basis":e.sideMargin+"px"}},[e.space.isLast?e._e():t("div",{staticClass:"handle handle-bottom",on:{mousedown:function(r){e.onBottomMouseDown(r,"bottom")}}})])])},fB=[],bB=void 0,wB=void 0,xB=void 0,vB=!1;function yB(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="space.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var kB=yB({render:hB,staticRenderFns:fB},bB,gB,wB,vB,xB,!1,void 0,void 0,void 0),a2=kB;Ai();Jt();var _B=co.extend(a2),SB=class tm{constructor(o){this.workspace=o,this._updateSpacesBinded=this.updateSpaces.bind(this),this._moveIntoSpacesBinded=this.moveIntoSpaces.bind(this),this._handleRotateBinded=this.resizeBlockHandler.bind(this),this._createWidgetHandlerBinded=this.createWidgetHandler.bind(this),this._removeWidgetHandlerBinded=this.removeWidgetHandler.bind(this),this._changeVisibilityHandlerBinded=this.changeVisibilityHandler.bind(this),this._undoRedoHandlerBinded=this.undoRedoHandler.bind(this),this._resizeBlockHandlerBinded=this.resizeBlockHandler.bind(this),this._resizePageHandlerBinded=this.resizePageHandler.bind(this),this._onMouseMoveBinded=this.onMouseMove.bind(this),this.refillGroupsDebounced=Pe.default.debounce(this.refillGroups.bind(this),100),this.currentSpaces=[],this.affectedBlocks=[],this._container=o.$el,o.page.on("widget:create",this._createWidgetHandlerBinded),o.page.on("widget:remove",this._removeWidgetHandlerBinded),o.page.on("change:viewport",this._updateSpacesBinded),o.page.on("change:height",this._resizePageHandlerBinded),this.initTimeout=setTimeout(()=>{Pe.default.each(this.workspace.blocks,t=>{t.on("resize",this._resizeBlockHandlerBinded),t.on("move",this._moveIntoSpacesBinded),t.model.on("change:hidden change:fixed_position",this._updateSpacesBinded),t.model.on("change:angle",this._handleRotateBinded),t.model.on("change",this._undoRedoHandlerBinded)}),this.updateSpaces()},0),Pe.default.each(o.getSelectedBlocks(),function(t){t.$el.removeClass("bundle-allow-top"),t.$el.removeClass("bundle-allow-bottom")}),o.$el.toggleClass("blocks-mode",!0),(0,_l.default)(document).on("mousemove",this._onMouseMoveBinded)}onMouseMove(o){let t=RM.constructorRouter.zoom.getZoom(),r=ct.mapPointerToElement(o,this.workspace.$origin[0],1,t);Pe.default.each(this.spaces,(i,n)=>{let s=this.spaces[n-1];if(s){let l={top:s.bottom,left:0,width:1/0,height:i.top-s.bottom};this.currentSpaces[n].blockHovered=r.top>l.top&&r.top<l.top+l.height}})}createWidgetHandler(o,t){Pe.default.each(this.workspace.blocks,r=>{r.off("resize",this._resizeBlockHandlerBinded),r.off("move",this._moveIntoSpacesBinded),r.model.off("change:hidden change:fixed_position",this._updateSpacesBinded),r.model.off("change:angle",this._handleRotateBinded),r.model.off("change",this._undoRedoHandlerBinded),r.on("resize",this._resizeBlockHandlerBinded),r.on("move",this._moveIntoSpacesBinded),r.model.on("change:hidden change:fixed_position",this._updateSpacesBinded),r.model.on("change:angle",this._handleRotateBinded),r.model.on("change",this._undoRedoHandlerBinded)}),this.pasteHandler(o,t),this.undoRedoHandler(o,t),this.duplicateGroupHandler(o,t)}duplicateGroupHandler(o,t){t.duplicateGroup&&this.refillGroupsDebounced()}refillGroups(){let o=this.workspace.filterAutolayoutBlocks(this.workspace.blocks);this.blocks=this.workspace.collectBlocks(o),this.packs=this.calcPackData(this.blocks),this.groupedBlocks=this.collectBlockGroups(this.blocks,this.packs,this.spaces),this.spaces=this.blocksGroupsToSpaces(this.groupedBlocks,this.spaces),this.redrawSpaces(!0)}pasteHandler(o,t){!t||!t.copy&&!t.clone||t.duplicateGroup||this.updateSpaces()}undoRedoHandler(o,t){!t||!t.undo&&!t.redo||this.updateSpaces()}removeWidgetHandler(o){let t=this.getGroupByModel(o);t&&(t.items=Pe.default.filter(t.items,r=>r.model!==o),this.recalcSpaces())}changeVisibilityHandler(){}resizePageHandler(o){let t=o.getViewportParam(this.workspace.viewport,"height"),r=Pe.default.last(this.spaces);r.height=Math.max(30,t-r.top),r.bottom=r.top+r.height,this.recalcSpaces()}resizeSpace(o,t,r="top"){if(!t)return;let i=this.groupedBlocks[o.groupIdx-1]||o.isLast&&Pe.default.last(this.groupedBlocks);if(r==="top"&&i){let n=i.bb.top+i.bb.height;t=Math.min(t,o.height),t=Math.max(t,n-o.top),o.top=Math.round(o.top+t),o.height=Math.round(o.height-t)}else r==="bottom"&&(o.height=Math.max(0,Math.round(o.height+t)))}resizeHandler(o,t,r,i){o==="top"?(this.resizeSpace(t,r,"top"),this.resizePageHandler(this.workspace.page)):o==="bottom"&&t.isLast?(this.resizeSpace(t,r,"bottom"),this.recalcSpaces()):i?(this.moveAllBlocksBottom(this.groupedBlocks,r,!0),this.resizePageHandler(this.workspace.page)):(this.moveBlocksBottom(this.groupedBlocks,t.groupIdx,r,!0),this.resizePageHandler(this.workspace.page))}resizeEndHandler(o){if(o.height<=1){let t=this.spaces.indexOf(o),r=this.groupedBlocks[o.groupIdx],i=this.groupedBlocks[o.groupIdx-1];i&&t>0&&(i.items.splice.apply(i.items,[i.items.length,0].concat(r.items)),this.spaces.splice(t,1),this.groupedBlocks.splice(o.groupIdx,1),Pe.default.each(this.spaces,(n,s)=>{t<=s&&n.groupIdx--}),i.spaceBottom=this.spaces[t])}this.recalcSpaces(),this.redrawSpaces(),this.saveChanges()}dragMoveSpace(o,t,r){let i=this.groupedBlocks[o.groupIdx-1];if(!i)return;o.top+t<i.bottom&&(t=i.bottom-o.top),this.moveBlocksBottom(this.groupedBlocks,o.groupIdx,t),Pe.default.each(this.spaces,p=>{p.groupIdx>=o.groupIdx&&(p.top+=t,p.bottom+=t)}),this.recalcSpaces();let n=RM.constructorRouter.zoom.getZoom();if(this.workspace.page.getViewportParam(this.workspace.viewport,"height")<window.innerHeight/n||t===0)return;let l=Math.abs(window.innerHeight/n-r.pageY/n)<20,c=r.pageY/n<20,d=this.workspace.$container;if(l&&t>0||c&&t<0){let p=d.scrollTop()+t*n;d.scrollTop(p)}}dragEndSpace(){let o=-1,t=-1;Pe.default.each(this.spaces,(n,s)=>{o===n.top&&(t=s),o=n.bottom});let r=this.spaces[t],i=this.spaces[t-1];t>-1&&this.groupedBlocks[i.groupIdx].items.length===0&&(i.height+=r.height,i.bottom=i.top+i.height,this.groupedBlocks.splice(i.groupIdx,1),this.groupedBlocks[i.groupIdx]&&(this.groupedBlocks[i.groupIdx].spaceTop=i),Pe.default.each(this.spaces,n=>{n.groupIdx>i.groupIdx&&n.groupIdx--}),this.spaces.splice(t,1)),this.recalcSpaces(),this.redrawSpaces(!0),this.saveChanges()}splitSpace(o,t,r){let i=Pe.default.clone(o),n=this.spaces.indexOf(o),s=this.groupedBlocks[o.groupIdx],l=Pe.default.clone(s),c=Math.round((o.height-t)/2);l?(l.spaceBottom=i,s.spaceTop=i,this.groupedBlocks.splice(o.groupIdx,0,l)):(l={spaceTop:o,spaceBottom:i},this.groupedBlocks.push(l)),this.spaces.splice(n+1,0,i),o.height=c,o.bottom=o.top+c,i.height=c,i.top=o.bottom+t,i.bottom=i.top+i.height,l.items=Pe.default.map(r,d=>({block:d,model:d.model,box:d.getBoxData({includeBoundingBox:!0})})),Pe.default.each(this.spaces,(d,p)=>{p>n&&(d.groupIdx+=1)}),this.recalcSpaces()}createWidgetAtSpace(o,t,r,i,n){let s=this.spaces.indexOf(o),l=this.spaces[s+1];l||(r=!1);let c=o.bottom;r&&isFinite(n)&&(c=n-360/2,c+360>l.top&&(c=l.top-360),c=Math.max(o.bottom,c)),this.customCreateWidget()&&n&&(c=n-360/2),RM.constructorRouter.workspace.addWidget({type:t,y:c},{useDefaults:!0,success:d=>{if(this.customCreateWidget()&&n){this.updateSpaces();return}let p=Pe.default.find(this.workspace.blocks,g=>g.id===d.id);i&&i.success(d);let m=d.get("h"),u=this.spaces[this.spaces.indexOf(o)+1];if(r){let g=c+m-u.top;g>0&&(this.moveBlocksBottom(this.groupedBlocks,o.groupIdx,g),Pe.default.each(this.spaces,(h,b)=>{b>s&&(h.top+=g,h.bottom+=g)})),this.groupedBlocks[o.groupIdx].items.push({block:p,model:p.model,box:p.getBoxData({includeBoundingBox:!0})})}else this.moveBlocksBottom(this.groupedBlocks,o.groupIdx,m+o.height,!0),this.splitSpace(o,m,[p]);this.redrawSpaces(),this.saveChanges()},error:d=>{i&&i.error(d)}}),this.workspace.save_group(this.getModelToSave(),{silent:!0})}customCreateWidget(){return this.spaces.length===1}addWidgetAtOffset(o,t,r){let i,n;Pe.default.each(this.spaces,s=>{s.top<t&&s.bottom>t&&(i=s),s.bottom<t&&(n=s)}),i?this.createWidgetAtSpace(i,o,!1,r,t):n&&this.createWidgetAtSpace(n,o,!0,r,t)}duplicateGroup(o){let t=this.spaces[this.spaces.indexOf(o)-1],r=Pe.default.clone(o),i=o.top-t.bottom+20,n=this.spaces.indexOf(o),s=this.groupedBlocks[o.groupIdx-1],l=Pe.default.clone(s),c=20,d=o.top-t.bottom;this.moveBlocksBottom(this.groupedBlocks,o.groupIdx,i,!0),l.spaceBottom=r,s.spaceTop=r,this.groupedBlocks.splice(o.groupIdx+1,0,l),this.spaces.splice(n+1,0,r),o.height=c,o.bottom=o.top+o.height,r.top=o.bottom+d,r.bottom=r.top+r.height,l.items=[],Pe.default.each(this.spaces,(p,m)=>{m>n&&(p.groupIdx+=1)}),this.recalcSpaces(),this.groupedBlocks[t.groupIdx].items.length&&this.workspace.cloneBlocks(Pe.default.map(this.groupedBlocks[t.groupIdx].items,function(p){return p.block}),{offset:{y:i},duplicateGroup:!0}),this.redrawSpaces(!0),this.saveChanges()}addWidgetIntoSpace(o){my({name:"widget-selector",payload:{y:o.top+(o.bottom-o.top)/2}})}static recalcBBoxes(o){o instanceof Array||(o=[o]),Pe.default.each(o,t=>{t.box=t.block.getBoxData({includeBoundingBox:!0})})}getBlocksToSave(){let o=Pe.default.chain(this.affectedBlocks).uniq().value();return this.affectedBlocks=[],o}getModelToSave(){return Pe.default.map(this.getBlocksToSave(),o=>o.model)}getGroupByBlock(o){return Pe.default.find(this.groupedBlocks,t=>Pe.default.find(t.items,r=>r.block===o))}getGroupByModel(o){return Pe.default.find(this.groupedBlocks,t=>Pe.default.find(t.items,r=>r.model===o))}getBlockOffsetInGroup(o,t){let r=Pe.default.reduce(t,(i,n)=>(i.top=Math.min(i.top,n.box.bb_y),i.bottom=Math.max(i.bottom,n.box.bb_y+n.box.bb_h),i),{top:1/0,bottom:-1/0});return{top:o.box.bb_y-r.top,bottom:r.bottom-o.box.bb_y-o.box.bb_h}}checkAllBlocksNear(o){let t=this.getGroupByModel(o[0].model);return Pe.default.reduce(o,(r,i)=>r&&t===this.getGroupByModel(i.model),!0)}getRestriction(o,t){let r=this.getGroupByModel(o);if(!r)return{canMoveTop:!0,canMoveBottom:!0};let i=Pe.default.find(r.items,c=>c.model===o),n=r.bb.top+r.bb.height,s=0,l=0;if(t.length>1){let c=this.getBlockOffsetInGroup(i,Pe.default.map(t,d=>{let p=this.getGroupByBlock(d);return Pe.default.find(p.items,m=>m.block===d)}));s=c.top,l=c.bottom}return{top:Math.min(r.spaceTop&&r.spaceTop.bottom||0,r.bb.top)+s,bottom:Math.max(r.spaceBottom.top,n)-l,canMoveTop:Math.round(i.box.bb_y)>Math.round(r.bb.top)||Pe.default.filter(r.items,c=>Math.round(r.bb.top)===Math.round(c.box.bb_y)).length>1,canMoveBottom:Math.round(i.box.bb_y+i.box.bb_h)<Math.round(n)||Pe.default.filter(r.items,c=>Math.round(n)===Math.round(c.box.bb_y+c.box.bb_h)).length>1}}shiftLayout(o){this.recalcGroupedBlocks();let t=0,r=[];Pe.default.each(this.spaces,i=>{let n=this.groupedBlocks[i.groupIdx-1],s=this.groupedBlocks[i.groupIdx];t&&n&&r.push({group:n,delta:t}),n&&(n===o?t+=n.bottom-i.top:t+=Math.max(0,n.bottom-i.top)),i.top+=t,i.bottom+=t,s&&s.spaceTop}),Pe.default.each(r,i=>{this.moveBlocksBottom([i.group],0,i.delta)}),this.recalcSpaces()}resizeBlockHandler(o,t){t?.autosize?(this.shiftLayout(o),this.saveChanges()):this.shiftLayout(o)}moveIntoSpaces(){this.recalcSpaces()}recalcBoxOnResize(o,t,r){let i=this.getGroupByModel(r);if(!i)return o;let n=t.boxOrig,s=t.DOTS_POS_X,l=t.DOTS_POS_Y,c=n.left+n.width*s,d=n.top+n.height*l,p=n.left+n.width/2,m=n.top+n.height/2,u=c-p,g=m-d,h=p+t.cosAngle*u+t.sinAngle*g,b=m+t.sinAngle*u-t.cosAngle*g,x=o.left+o.width*s,S=o.top+o.height*l,y=o.left+o.width/2,C=o.top+o.height/2,P=x-y,v=C-S,T=y+t.cosAngle*P+t.sinAngle*v,R=C+t.sinAngle*P-t.cosAngle*v,I=Pe.default.clone(o);I.left=o.left+(h-T),I.top=o.top+(b-R);let M=dt.calcBoundingBox(I),D=i.spaceTop.bottom-M.bb_top;if(D>0){let E=Math.sin(o.angle/180*Math.PI)*Math.cos(o.angle/180*Math.PI),A=E>0?o.height/o.width:o.width/o.height,$=Math.atan(A)+o.angle/180*Math.PI,j=M.bb_height-D,pe=E>0?$-Math.PI/2:Math.PI-$,ee=j/Math.abs(Math.cos(pe)),G=o.height/o.width,K=o.width-ee/Math.sqrt(1+G*G),we=K*G;o.top+=we,o.height-=we,o.width-=K}return o}recalcGroupedBlocks(){Pe.default.each(this.groupedBlocks,o=>{Pe.default.isEmpty(o.items)?(o.bb={top:o.spaceTop.bottom,height:o.spaceBottom.top-o.spaceTop.bottom},o.top=o.spaceTop.bottom,o.bottom=o.top):(tm.recalcBBoxes(o.items),o.bb=tm.commonBB(o.items),o.top=o.bb.top,o.bottom=o.bb.top+o.bb.height)}),this.packs=this.calcPackData(this.blocks)}recalcSpaces(){this.recalcGroupedBlocks(),Pe.default.each(this.spaces,t=>{t.bottom=t.top+t.height});let o=Math.round(Pe.default.last(this.spaces).bottom);this.workspace.page.setViewportParam(this.workspace.viewport,"height",o),this.workspace.page.setViewportParam(this.workspace.viewport,"type","scroll")}redrawSpaces(o){(this.spaces.length<this.currentSpaces.length||o)&&(Pe.default.each(o?this.currentSpaces:this.currentSpaces.slice(this.spaces.length),t=>{t.$destroy(),t.$el.remove()}),o&&(this.currentSpaces=[])),this.currentSpaces=Pe.default.map(this.spaces,(t,r)=>{if(this.currentSpaces[r])return this.currentSpaces[r].space=t,this.currentSpaces[r];let i=(0,_l.default)("<div>").appendTo(this._container),n=new _B({el:i.get(0),propsData:{space:t,workspace:this.workspace,spaces:this.spaces,defaultZoom:RM.constructorRouter.zoom.getZoom()}});return n.$on("changeHeight",this.resizeHandler.bind(this)),n.$on("addWidget",this.addWidgetIntoSpace.bind(this)),n.$on("duplicateGroup",this.duplicateGroup.bind(this)),n.$on("dragMove",this.dragMoveSpace.bind(this)),n.$on("dragEnd",this.dragEndSpace.bind(this)),n.$on("resizeEnd",this.resizeEndHandler.bind(this)),n})}calcPackData(o){let t={};return Pe.default.each(o,r=>{let i=r.model.get("pack_id");i&&(t[i]=t[i]||{top:r.box.bb_y,bottom:r.box.bb_y+r.box.bb_h},t[i].top=Math.min(t[i].top,r.box.bb_y),t[i].bottom=Math.max(t[i].bottom,r.box.bb_y+r.box.bb_h))}),t}updateSpaces(){let o=this.workspace.filterAutolayoutBlocks(this.workspace.blocks);this.blocks=this.workspace.collectBlocks(o),this.packs=this.calcPackData(this.blocks),this.groupedBlocks=this.collectBlockGroups(this.blocks,this.packs),this.spaces=this.blocksGroupsToSpaces(this.groupedBlocks),this.redrawSpaces(!0)}getGroupIdxByTop(o,t,r){let i=null,n=Pe.default.find(r,s=>i?i.bottom<=o&&s.top>=t:(i=s,!1));return n?n.groupIdx-1:null}getGroupSize(o,t){for(let r=0;r<t.length;r++)if(t[r].groupIdx===o)return{top:t[r].bottom,bottom:t[r+1].top};return{top:0,bottom:0}}collectBlockGroups(o,t,r){let i=-1,n=!1;return Pe.default.chain(o).reduce((s,l)=>{let c=l.model.get("pack_id"),d=c?t[c].top:l.box.bb_y,p=c?t[c].bottom:l.box.bb_y+l.box.bb_h,m=Pe.default.isEmpty(s)||d-s[s.length-1].bottom>=2;if(r&&!n){let u=this.getGroupIdxByTop(d,p,r);if(u===null)n=!0;else{if(m=u!==i,u-i>1)for(let g=i+1;g<u;g++)s.push(Pe.default.extend(this.getGroupSize(g,r),{items:[]}));i=u}}return m?s.push({top:d,items:[l],bottom:p}):(s[s.length-1].items.push(l),s[s.length-1].bottom=Math.max(s[s.length-1].bottom,p)),s},[]).map(s=>(s.bb=tm.commonBB(s.items),s)).value()}static commonBB(o){if(!o||Pe.default.isEmpty(o))return null;let t=1/0,r=-1/0,i=1/0,n=-1/0;return Pe.default.each(o,s=>{t=Math.min(t,s.box.bb_x),i=Math.min(i,s.box.bb_y),r=Math.max(r,s.box.bb_x+s.box.bb_w),n=Math.max(n,s.box.bb_y+s.box.bb_h)}),{left:Math.round(t),top:Math.round(i),width:Math.round(r-t),height:Math.round(n-i)}}blocksGroupsToSpaces(o,t){let r,i=Pe.default.find(RM.constructorRouter.workspace.getViewports(),c=>c.isCurrent).height,n=0,s=Pe.default.chain(o).map((c,d)=>{if(!d&&c.top<=0)return r=c,!1;let p={top:Math.floor(r&&r.bottom||0),bottom:Math.ceil(c.top),groupIdx:d};return t&&t[n]&&t[n].top>=p.top&&t[n].bottom<=p.bottom&&(p.top=t[n].top,p.bottom=t[n].bottom),p.height=p.bottom-p.top,c.spaceTop=p,r&&(r.spaceBottom=p),r=c,n++,p}).filter(c=>c).value(),l=Math.max(i-(r&&r.bottom||0),30);return s.push({top:r&&r.bottom||0,height:l,bottom:l+(r&&r.bottom||0),groupIdx:o.length||-1,isLast:!0,bbTop:r&&{top:-r.bb.height-1+"px",left:r.bb.left-1+"px",height:r.bb.height+"px",width:r.bb.width+"px"},bbBottom:null}),o.length&&(Pe.default.last(o).spaceBottom=Pe.default.last(s)),s}moveBlocksBottom(o,t,r,i){let n=null;Pe.default.each(o,(l,c)=>{c<t||(n=n||l.spaceTop,Pe.default.each(l.items,d=>{d.model.set("y",Math.round(d.model.get("y")+r)),d.box.bb_y=Math.round(d.box.bb_y+r),this.affectedBlocks.push(d.block)}),i&&(l.bb.top=Math.round(l.bb.top+r),l.bb.bottom=Math.round(l.bb.top+l.bb.height)))});let s=n?this.spaces.indexOf(n):this.spaces.length-1;i&&s>-1&&Pe.default.each(this.spaces,(l,c)=>{c===s?(l.height=Math.round(l.height+r),l.bottom=Math.round(l.bottom+r)):c>s&&(l.top=Math.round(l.top+r),l.bottom=Math.round(l.bottom+r))})}moveAllBlocksBottom(o,t,r){let i=t;Pe.default.each(o,n=>{Pe.default.each(n.items,s=>{s.model.set("y",Math.round(s.model.get("y")+i)),this.affectedBlocks.push(s.block)}),r&&(n.bb.top+=i,n.bb.bottom=n.bb.top+n.bb.height,n.spaceTop.height=Math.round(n.spaceTop.height+t),n.spaceTop.top=Math.round(n.spaceTop.top+i-t),n.spaceTop.bottom=n.spaceTop.top+n.spaceTop.height),i=Math.round(i+t)})}sizeBetweenSpaces(o){let t=o.spaceTop,r=this.spaces.indexOf(t),i=this.spaces[r+1];return i?i.top-(t&&t.bottom||0):null}moveBlockToGroup(o,t,r){let i=this.getGroupByModel(o.model),n=this.groupedBlocks.indexOf(i),s=this.groupedBlocks[t],l=n>t?-1:1,c=Pe.default.find(i.items,x=>x.block===o);if(!s||!i||s===i)return null;let d=this.getBlockOffsetInGroup(c,r),p=(o.model.get("angle")||0)*Math.PI/180,m=o.model.get("h"),u=m*Math.cos(p)+o.model.get("w")*Math.sin(p),g=u+d.top,h=Math.ceil((s.spaceTop&&s.spaceTop.bottom||0)+(u-m)/2+d.top),b=this.sizeBetweenSpaces(s);if(l<0&&b>g&&(h=Math.floor(s.spaceBottom.top-m-(u-m)/2-d.bottom)),o.latestPosSizeAngle.top=h,Pe.default.defer(()=>{o.model.set("y",h),o.redrawPosition(o.model,{forceRedraw:!0})}),s.items.push(c),i.items=Pe.default.without(i.items,c),b&&b<g){let x=g-b;this.moveBlocksBottom(this.groupedBlocks,this.groupedBlocks.indexOf(s)+1,x);let S=this.spaces.indexOf(s.spaceTop);Pe.default.each(this.spaces,(y,C)=>{C>S&&(y.top+=x,y.bottom+=x)})}return h}saveChanges(){this.workspace.page.saveHeight({skipHistory:!0}),this.workspace.save_group(this.getModelToSave())}moveBlocksToHighlighted(o){let t=this.groupedBlocks[this.highlightGroupIdx];this.highlight&&t&&(Pe.default.each(o,r=>{this.moveBlockToGroup(r,this.highlightGroupIdx,Pe.default.map(o,i=>{let n=this.getGroupByBlock(i);return Pe.default.find(n.items,s=>s.block===i)}))}),Pe.default.defer(()=>{this.recalcSpaces()}))}highlightGroup(o,t,r,i,n){if(i!==0)return;let s=r.reduce((m,u)=>{let g=u.getBoxData();return{top:Math.min(g.y,m.top?m.top:1/0),left:Math.min(g.x,m.left?m.left:1/0),right:Math.min(g.x+g.w,m.left?m.left:1/0),bottom:Math.min(g.y+g.h,m.top?m.top:1/0)}},{}),l=this.spaces[0];Pe.default.each(this.spaces,m=>{(n<0?m.top<s.top+n:m.bottom<s.bottom+n)&&(l=m)});let c=this.spaces[this.spaces.indexOf(l)+1],d=(0,_l.default)(window).width(),p=-Math.max((d-this.workspace.mag.getViewportWidth(this.workspace.viewport))/2,0);c&&(this.removeHighlight(),this.highlight=(0,_l.default)('<div class="space-highlighter green"/>').css({top:l.bottom,left:p,width:d,height:c.top-l.bottom}),this.highlight.appendTo(t.parent()),this.highlightGroupIdx=l.groupIdx)}needFreeze(o){return this.highlightGroupIdx!==this.groupedBlocks.indexOf(this.getGroupByBlock(o))}updateGhost(o,t,r,i,n){this.highlightGroup(n,i,o,t-this.prevdY,t),this.removeGhost(),this.ghostsContainers=Pe.default.map(o,s=>{let l=s.$el.clone(),c=this.groupedBlocks.indexOf(this.getGroupByBlock(s));return l.css({opacity:c!==this.highlightGroupIdx?1:".2","z-index":1e4,left:parseInt(l.css("left"),10)+r+"px",top:parseInt(l.css("top"),10)+t+"px"}),l.appendTo(i),c!==this.highlightGroupIdx&&s.$el.css({opacity:.2}),{ghost:l,source:s.$el}}),this.prevdY=t}removeGhost(){this.ghostsContainers&&(Pe.default.each(this.ghostsContainers,o=>{o.ghost.remove(),o.source.css({opacity:""})}),this.ghostsContainers=null)}removeHighlight(){this.highlight&&(this.highlight.remove(),this.highlight=null)}clearAll(){this.removeHighlight(),this.removeGhost()}destroy(){clearTimeout(this.initTimeout),this._container.find("> .space-highlighter").remove(),Pe.default.each(this.currentSpaces,o=>{o.$destroy()}),Pe.default.each(this.workspace.blocks,o=>{o.off("resize",this._resizeBlockHandlerBinded),o.off("move",this._moveIntoSpacesBinded),o.model.off("change:hidden change:fixed_position",this._updateSpacesBinded),o.model.off("change:angle",this._handleRotateBinded),o.model.off("change",this._undoRedoHandlerBinded)}),this.workspace.page.off("widget:create",this._createWidgetHandlerBinded),this.workspace.page.off("widget:remove",this._removeWidgetHandlerBinded),this.workspace.page.off("change:viewport",this._updateSpacesBinded),this.workspace.page.off("change:height",this._resizePageHandlerBinded),this.workspace.$el.toggleClass("blocks-mode",!1),(0,_l.default)("body").off("mousemove",this._onMouseMoveBinded)}},l2=SB;Wh();ro();bu();fk();var Nf=B(jp());qa();var Bl=B(H());var om=B(H());function p2(){let e=(0,om.useRef)(document.getElementById("main"));return(0,om.useLayoutEffect)(()=>(e.current.classList.add("comment-cursor"),()=>{e.current.classList.remove("comment-cursor")}),[]),null}var c2=B(H());k();var d2=(0,c2.forwardRef)(({children:e,width:o,height:t},r)=>a("div",{style:{width:o,height:t,top:0,left:0,right:0,margin:"0 auto",position:"absolute"},"data-testid":"comment-root",children:a("div",{ref:r,style:{zoom:"var(--workspace-inverse-zoom)"},children:e})}));var qr=B(H());N();Wr();var u2=B(H());Wr();k();var CB=(0,u2.forwardRef)((e,o)=>a("svg",{width:"26",height:"26",viewBox:"0 0 26 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:a("path",{d:"M25 13C25 19.6274 19.6274 25 13 25C9.41592 25 6.57143 25 1 25C0.999999 20.7143 1 16.0433 1 13C1 6.37258 6.37258 1 13 1C19.6274 1 25 6.37258 25 13Z",fill:"currentColor"})})),rm={rotate:[0,-45,0,-45,0],transition:{duration:1}},im=Dt(CB);var no=B(H()),$2=B(Js()),Cl=B(Sh());N();Ap();Fo();MI();BI();fe();Co();oe();N6();var x2=B(H()),v2=B(H());Wr();N();Ur();Wo();ln();oe();var nm=B(H());Wr();N();$0();oe();var g2=B(Js());gl();k();var Bf={type:"spring",damping:40,stiffness:280},Rf="rgba(0,0,0,.6)",PB=Dt(F(f)({width:"100vw",height:"100vh",position:"fixed",zIndex:99999,top:0,left:0})),TB=Dt(F(f)({width:"100%",height:"100%",position:"fixed",top:0,left:0,zIndex:1,backgroundColor:Rf,cursor:"zoom-out"})),m2=Dt(F(f)({width:"100%",height:"100%",backgroundPosition:"center center",backgroundRepeat:"no-repeat",backgroundSize:"contain",opacity:0}));function h2({imgSrc:e,thumbSrc:o,isVisible:t,onClose:r}){gr(g2.Key.Escape,r);let[i,n]=(0,nm.useState)(!1);return(0,nm.useEffect)(()=>{if(t){let l=new Image;l.src=e,l.decode().then(()=>n(!0))}return()=>n(!1)},[e,t]),a(Gd,{container:()=>document.getElementById("constructor"),children:a(No,{children:t&&a(PB,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:w(TB,{role:"presentation",animate:{backgroundColor:Rf},transition:Bf,onClick:l=>{l.stopPropagation(),r()},style:{width:"100%",height:"100%",position:"fixed",top:0,left:0,zIndex:1,backgroundColor:Rf,cursor:"zoom-out"},children:[a(m2,{role:"dialog",initial:{opacity:0},animate:{opacity:i?1:0},exit:{opacity:0},transition:Bf,style:{backgroundImage:`url(${e})`,zIndex:0}}),o&&a(m2,{initial:{opacity:1},animate:{opacity:i?0:1},exit:{opacity:0},transition:Bf,style:{backgroundImage:`url(${o})`,zIndex:1,filter:"blur(0.6px)"}})]})})})})}var f2=B(H());k();var b2=(0,f2.forwardRef)((e,o)=>a("svg",{width:"32",height:"32",viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:a("path",{d:"M23.0146 8C23.5669 8 24.0146 8.44772 24.0146 9V13.5858C24.0146 14.4767 22.9375 14.9229 22.3075 14.2929L20.7573 12.7426L18.2573 15.2426C17.8667 15.6332 17.2336 15.6332 16.8431 15.2426C16.4525 14.8521 16.4525 14.219 16.8431 13.8284L19.3431 11.3284L17.7217 9.70711C17.0918 9.07714 17.5379 8 18.4288 8H23.0146ZM9 24.0356C8.44772 24.0356 8 23.5879 8 23.0356V18.4499C8 17.559 9.07714 17.1128 9.70711 17.7428L11.2574 19.293L13.7574 16.793C14.1479 16.4025 14.781 16.4025 15.1716 16.793C15.5621 17.1835 15.5621 17.8167 15.1716 18.2072L12.6716 20.7072L14.2929 22.3285C14.9229 22.9585 14.4767 24.0356 13.5858 24.0356H9Z",fill:"currentColor"})}));k();var w2=F(Pt)`
  &:hover {
    color: ${e=>e.theme.colors.orange};
  }
`,sm=x2.default.memo(function({image:e,showRemove:o,onRemove:t}){let r=e.url,i=e.meta?.thumbUrl,n=()=>{t&&t()},{isHovered:s,...l}=Ke(!1),[c,d]=(0,v2.useState)(!1),p=()=>{d(!0)},m=()=>{d(!1)},u=g=>{g.stopPropagation(),p()};return w(q,{children:[w(f,{width:"100%",height:112,marginBottom:4,marginTop:8,borderRadius:4,backgroundImage:`url(${r})`,backgroundColor:"transparent",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative",borderWidth:1,borderStyle:"solid",borderColor:Me("darkGray",.15),...l,children:[o&&a(w2,{height:32,width:32,position:"absolute",top:-8,right:-8,hoverColor:"white",activeColor:"white",onClick:n,children:a(Nt,{})}),a(No,{children:s&&!o&&a(Dt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:a(w2,{height:32,width:32,position:"absolute",left:"50%",bottom:9,transform:"translateX(-50%)",hoverColor:"white",activeColor:"white",onClickCapture:u,children:a(b2,{})})})})]}),a(h2,{imgSrc:r,thumbSrc:i,isVisible:c,onClose:m})]})});var y2=B(H());k();var k2=(0,y2.forwardRef)((e,o)=>a("svg",{width:"26",height:"24",viewBox:"0 0 26 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.1313 3C17.5224 3 16.2182 4.30421 16.2182 5.91304C16.2182 7.52188 17.5224 8.82609 19.1313 8.82609C20.7401 8.82609 22.0443 7.52187 22.0443 5.91304C22.0443 4.30421 20.7401 3 19.1313 3ZM14.2182 5.91304C14.2182 3.19965 16.4179 1 19.1313 1C21.8447 1 24.0443 3.19964 24.0443 5.91304C24.0443 8.62645 21.8447 10.8261 19.1313 10.8261C16.4179 10.8261 14.2182 8.62644 14.2182 5.91304ZM10.7503 7.67753L15.9307 16.6501C16.3187 17.3222 17.2912 17.3154 17.6697 16.6379L19.0717 14.1287L22.9108 21L18.8129 21L18.8092 21L18.8067 21H3.05861L10.7503 7.67753ZM9.20062 6.36174C9.88939 5.16875 11.6113 5.16876 12.3001 6.36174L16.7825 14.1255L17.5095 12.8242C18.1924 11.602 19.951 11.602 20.6338 12.8242L24.8318 20.3377C25.4983 21.5305 24.636 23 23.2696 23H18.8129L18.8104 23L18.8067 23H2.69397C1.31643 23 0.455476 21.5088 1.14424 20.3158L9.20062 6.36174Z",fill:"currentColor"})}));var _2=B(H());k();var S2=(0,_2.forwardRef)((e,o)=>a("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:a("path",{d:"M11.7379 9.04793C13.4178 9.04793 14.493 10.3984 14.493 12.5758C14.493 14.7531 13.4178 16.1312 11.7111 16.1312C10.0849 16.1312 9.09041 14.7945 9.09041 12.5758C9.09041 10.3571 10.0715 9.04793 11.7379 9.04793ZM12.1949 1C5.5559 1 1 5.68544 1 12.5069C1 19.4937 5.46182 24 12.4233 24C14.0226 24 15.5547 23.7795 16.7104 23.3936V21.4368C15.9041 21.7813 14.2108 22.0156 12.5174 22.0156C6.77886 22.0156 3.09652 18.3361 3.09652 12.5758C3.09652 6.93948 6.81918 2.95686 12.047 2.95686C17.3286 2.95686 20.9035 6.29179 20.9035 11.2804C20.9035 14.4086 19.8955 16.4206 18.3097 16.4206C17.3958 16.4206 16.8852 15.8418 16.8852 14.8772V7.13241H14.6005V8.79988H14.372C13.8479 7.58718 12.6518 6.84302 11.2407 6.84302C8.49908 6.84302 6.61759 9.17196 6.61759 12.5207C6.61759 16.0072 8.48564 18.3499 11.281 18.3499C12.8534 18.3499 14.0226 17.592 14.587 16.2001H14.8155C15.0305 17.5368 16.2535 18.4326 17.8662 18.4326C21.011 18.4326 23 15.6351 23 11.1977C23 5.16177 18.5785 1 12.1949 1Z",fill:"currentColor"})}));var zf=B(H());k();var C2=(0,zf.forwardRef)((e,o)=>a("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:a("path",{d:"M11.1924 0.707108C11.5829 1.09763 11.5829 1.7308 11.1924 2.12132L7.36396 5.94975L11.1924 9.77818C11.5829 10.1687 11.5829 10.8019 11.1924 11.1924C10.8019 11.5829 10.1687 11.5829 9.77818 11.1924L5.94975 7.36396L2.12132 11.1924C1.7308 11.5829 1.09763 11.5829 0.707108 11.1924C0.316584 10.8019 0.316583 10.1687 0.707108 9.77818L4.53554 5.94975L0.707108 2.12132C0.316584 1.7308 0.316584 1.09763 0.707108 0.707108C1.09763 0.316584 1.7308 0.316584 2.12132 0.707108L5.94975 4.53554L9.77818 0.707108C10.1687 0.316584 10.8019 0.316584 11.1924 0.707108Z",fill:"currentColor"})})),P2=(0,zf.forwardRef)((e,o)=>a("svg",{width:"7",height:"12",viewBox:"0 0 7 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:a("path",{d:"M0.7072 0.7072C0.316676 1.09772 0.316675 1.73089 0.7072 2.12141L4.53566 5.94988L0.707271 9.77827C0.316747 10.1688 0.316746 10.802 0.707271 11.1925C1.09779 11.583 1.73096 11.583 2.12148 11.1925L6.65459 6.65938C6.75612 6.55785 6.83125 6.43992 6.87999 6.31412C7.02054 5.95529 6.94585 5.53164 6.65593 5.24172L2.12141 0.7072C1.73089 0.316676 1.09772 0.316676 0.7072 0.7072Z",fill:"currentColor"})}));Xp();st();var sa=B(H()),I2=B(Qo());Ik();N();oe();gl();var am=B(Js());k();Pd();var T2=(e="",o="")=>!e||o.toLowerCase().includes(e.toLowerCase()),IB=({items:e=[],search:o="",disabled:t,isOpen:r,isCaretAtSearch:i,onToggle:n,onChange:s,getKey:l,getLabel:c,trigger:d,dropdownContainer:p,children:m,...u})=>{let[g,h]=(0,sa.useState)(0),b=o?o.replace(/^@/,""):"",x=e.filter(S=>T2(b,c(S)));return gr(am.Key.ArrowDown,S=>{r&&(S.preventDefault(),h(Math.min(x.length-1,g+1)))},[g,x.length,r]),gr(am.Key.ArrowUp,S=>{r&&(S.preventDefault(),h(Math.max(0,g-1)))},[g,r]),gr(am.Key.Enter,S=>{if(r){S.preventDefault(),S.stopPropagation();let y=e.filter(C=>T2(b,c(C)));s(y[g]),n(!1)}},[g,e,r]),(0,sa.useEffect)(()=>{!t&&i&&n(x.length>0)},[x.length,i,t]),(0,sa.useEffect)(()=>{r||h(0)},[r]),a(ta,{onStateChange:({isOpen:S})=>{S!==void 0&&!t&&n(S)},highlightedIndex:g,itemToString:c,children:({getItemProps:S,getMenuProps:y,highlightedIndex:C,getRootProps:P,getToggleButtonProps:v})=>w(f,{...P(),...u,children:[r?void 0:(0,sa.cloneElement)(d,{...v,onClick:()=>n(t?!1:!r)}),r?I2.default.createPortal(a(f,{as:"ul",display:"flex",flexDirection:"column",gap:"4px 0",...y(),"data-testid":"mention-suggest",children:x.map((T,R)=>{let I=l(T);return Fx(f,{as:"li",...S({key:I,index:R,item:T}),onClick:M=>{M.stopPropagation(),s(T),n(!1)},key:I,display:"flex",alignItems:"center",height:"32px",lineHeight:"32px",padding:"0 8px",gap:"0 8px",borderRadius:"8px",background:C===R?Me("gray",.32):"none",cursor:"pointer",whiteSpace:"nowrap"},m(T))})}),p):void 0]})})},M2=IB;gl();var cm=B(H()),rs=B(Sh());var B2=B(Sh());Us();Ve();Li();var MB=F("span")`
  color: ${V.darkGray};
`,lm=MB;k();var fc="MENTION",BB=/\[@([^\]]+)]\(([^)]+)\)/g,RB=/\[@([^\]]+)]\(([^)]+)\)/,zB=/(\[@[^\]]+]\([^)]+\))/g,EB=(e,o)=>`[@${o}](${e})`,R2=e=>e.split(zB).map((o,t)=>{let[,r,i]=o.match(RB)||[];return r&&i?w(lm,{children:["@",r]},t):o}),z2=e=>{let o=[],t={},r=0,i=0,n=(l,c,d,p)=>{let m=r;return o.push({offset:p+i,length:c.length+1,key:m}),t[m.toString()]={type:fc,mutability:"IMMUTABLE",data:{key:d}},i=i+c.length+1-l.length,r++,"@"+c};return{blocks:e.replace(BB,n).split(`
`).map(l=>({text:l,type:"unstyled",entityRanges:o})),entityMap:t}},pm=e=>{let o=e.getCurrentContent();return o.getBlocksAsArray().reduce((t,r)=>{let i=r.getText(),n=0;return r.findEntityRanges(function(l){let c=l.getEntity(),d=c!==null?o.getEntity(c):void 0;return!!(d&&d.getType()===fc)},function(l,c){let d=r.getEntityAt(l),m=o.getEntity(d).getData()?.key||"",u=i.slice(l+n,c+n).replace(/^@/,""),g=EB(m,u);m&&(i=i.slice(0,l+n)+g+i.slice(c+n),n=n+g.length-u.length-1)}),t?t+`
`+i:i},"")},E2=(e,o,t)=>{let r=B2.Entity.create(fc,"IMMUTABLE",{key:t}),i=e,n=i.getSelection().isCollapsed()&&Ad(i)||"",[s,l]=Ld(e,-1);/^@/.test(n)&&!s&&!l&&(i=o0(i));let{startOffset:c}=r0(i),d=e0(i,1),p=d&&!/\s/.test(d);p&&(i=Ka({editorState:i,text:" "})),i=Ka({editorState:i,text:"@"+o,entityKey:r});let m=t0(i,1),u=m&&!/\s/.test(m);u&&(i=Ka({editorState:i,text:" "}));let g=c+(p?1:0)+1+o.length+(u?1:0),h=i.getSelection().merge({anchorOffset:g,focusOffset:g});return Ed(i,h)};Us();k();var A2=new rs.CompositeDecorator([{strategy:(e,o,t)=>{e.findEntityRanges(r=>{let i=r.getEntity();return i===null?!1:t.getEntity(i).getType()===fc},o)},component:({children:e})=>a(lm,{children:e})}]),Af=(0,cm.createContext)({items:[],isCaretAtSearch:!1,wordAtCaret:"",hasText:!1,editorState:rs.EditorState.createEmpty(),setEditorState(e){},clearContent(){},onMention(e){},getMarkdown:()=>"",getKey:e=>"",getLabel:e=>""}),AB=({markdown:e="",items:o,children:t,getLabel:r,getKey:i})=>{let n=z2(e),[s,l]=(0,cm.useState)(()=>rs.EditorState.createWithContent((0,rs.convertFromRaw)(n),A2)),c=S=>{let y=i(S);l(E2(s,r(S),y))},d=()=>pm(s),p=()=>{l(rs.EditorState.createEmpty(A2))},u=s.getSelection().isCollapsed()?Ad(s):"",[g,h]=Ld(s,-1),b=/^@/.test(u)&&!g&&!h,x=!!d();return a(Af.Provider,{value:{editorState:s,setEditorState:l,onMention:c,items:o,isCaretAtSearch:b,wordAtCaret:u,hasText:x,getMarkdown:d,clearContent:p,getKey:i,getLabel:r},children:t})},L2=AB;Us();var mn=B(H());k();var bc=(0,mn.createContext)({teammates:[],getTeammateKey:()=>"",getTeammateLabel:()=>"",userId:"",ownerId:"",viewState:yf,availableMentions:!0,availableAttachment:!0});function Sl({me:e,owner:o,projectTeam:t=[],viewState:r,children:i}){let n=(0,mn.useCallback)(p=>p?p.name||p.email:"",[]),s=(0,mn.useCallback)(p=>p?p.num_id.toString():"",[]),l=(0,mn.useMemo)(()=>f1(e,o,t),[e,o,t]),c=(0,mn.useMemo)(()=>({availableMentions:!!o.permissions.can_use_comment_mentions,availableAttachment:!!o.permissions.can_use_comment_attachments}),[o.permissions.can_use_comment_mentions,o.permissions.can_use_comment_attachments]),d=(0,mn.useMemo)(()=>({getTeammateLabel:n,getTeammateKey:s,teammates:l,viewState:r,userId:e._id,ownerId:o._id,...c}),[n,s,l,e._id,o._id,r,c]);return a(bc.Provider,{value:d,children:i})}k();var Lf=F("button")`
  box-sizing: border-box;
  width: 32px;
  height: 32px;
  padding: 0;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  border-radius: 50%;
  color: ${e=>e.theme.colors.black};
  background-color: transparent;
  cursor: pointer;

  &:hover {
    color: ${e=>e.theme.colors.orange};
  }

  &:disabled {
    color: ${e=>e.theme.colors.gray};
    pointer-events: none;
  }
`,D2=F(Lf)`
  border: 1px solid ${e=>Me(e.theme.colors.darkGray,.15)};

  &:hover {
    color: white;
  }

  ${e=>Td({submit:{"&:hover":{backgroundColor:e.theme.colors.orange}},close:{"&:hover":{backgroundColor:e.theme.colors.black}}})}
`,LB=e=>{let o=e.current,t=e.current?.editor;if(!o||!t)return;let r=i=>{i.preventDefault();let n=i.clipboardData?.getData("text/plain");n&&o.props?.handlePaste&&o.props.handlePaste(n,void 0,o?._latestEditorState)};return t.addEventListener("paste",r,!0),{unregister(){t.removeEventListener("paste",r,!0)}}},O2={editorSave:"editor-save"},DB=F(ve)`
  & .public-DraftEditorPlaceholder-root {
    color: ${({theme:e})=>e.colors.gray};
    position: absolute;
    pointer-events: none;
  }
`;function OB({defaultContent:e,image:o,textStyle:t,showCancel:r=!0,onCancel:i,onSubmit:n,disableMentions:s=!1,disableAttachments:l=!1,draftEditorRef:c,...d}){let p=(0,no.useRef)(null),m=(0,no.useRef)(!0),u=qu(p,{root:null,rootMargin:"0px",threshold:1}),[g,h]=(0,no.useState)(!1),[b,x]=(0,no.useState)(o||void 0),{items:S,onMention:y,hasText:C,isCaretAtSearch:P,wordAtCaret:v,clearContent:T,getMarkdown:R,getKey:I,getLabel:M,editorState:D,setEditorState:E}=(0,no.useContext)(Af),A=S.length>0,$=!A||s,j=(0,no.useRef)(null),[pe,ee]=(0,no.useState)(!1),[G,K]=(0,no.useState)(A&&P&&!$),we=(0,no.useRef)(null),xe=Wx(c,we);(0,no.useEffect)(()=>{let de=p.current,Se=u&&u.intersectionRatio<1;de&&Se&&m.current&&(m.current=!1,de.scrollIntoView({block:"end"}))},[u]);let _e=de=>{let Se=p.current,be=u&&u.intersectionRatio<1;Se&&be&&Se.scrollIntoView({block:"end"}),E(de)},ie=(0,no.useCallback)(async de=>{if(!l){if(de.size>le.UPLOAD_IMAGE_SIZE_LIMIT){window.alert(le.MSG_UPLOAD_IMAGE_SIZE_ERROR);return}if(!g){h(!0);try{let Se=await $n("comment-image",de);Se&&Se.picture&&x({url:Se.picture.url,originUrl:Se.picture.originUrls?.url,meta:{size:Se.size,thumbUrl:Se.picture.thumbUrl}})}catch(Se){console.error("upload image error",Se)}finally{h(!1)}}}},[g,l]),ze=()=>{x(null)};(0,no.useEffect)(()=>{if(we&&we.current!==null&&we.current.editor){let de=LB(we);return E(Cl.EditorState.moveFocusToEnd(D)),()=>{de?.unregister()}}},[we]);let ne=de=>{de.stopPropagation(),T(),i?.()},J=C||b,X=de=>{de&&de.stopPropagation(),J&&(n(R(),b),T())};function Q(de){return de.code==="Enter"&&!de.shiftKey?O2.editorSave:(0,Cl.getDefaultKeyBinding)(de)}function te(de){return de===O2.editorSave?(G||X(),"handled"):"not-handled"}let ye=(0,no.useCallback)((de,Se,be)=>{let Ae=Ka({editorState:be,text:de});return E(Ae),"handled"},[E]);return gr($2.Key.Escape,()=>{T(),i?.()},[T]),(0,no.useEffect)(()=>{$||K(P)},[P,$]),(0,no.useEffect)(()=>{C||K(!1)},[C]),w(f,{...d,ref:p,scrollMargin:30,"data-testid":"comment-editor",children:[b&&a(sm,{image:b,showRemove:!0,onRemove:ze}),a(DB,{as:"div",textStyle:t,cursor:"initial",onClick:de=>de.stopPropagation(),children:a(Cl.Editor,{ref:xe,placeholder:"Add a comment",editorState:D,onChange:_e,keyBindingFn:Q,handleKeyCommand:te,handlePaste:ye,"data-testid":"comment-input"})}),a(f,{marginTop:16,overflow:"hidden",children:a($B,{left:w(f,{display:"flex",gap:4,marginLeft:-4,children:[pe&&j.current&&a(M2,{title:A?void 0:"Add collaborator first",disabled:$,isOpen:G,isCaretAtSearch:P,onToggle:K,onChange:y,items:S,search:P?v:void 0,getKey:I,getLabel:M,trigger:a(f,{children:a(St,{text:"Upgrade to mention teammates",disabled:!s,children:a(f,{as:"span",children:a(Lf,{title:A?"Mention":void 0,disabled:$,"data-testid":"comment-mention-trigger",children:a(S2,{})})})})}),dropdownContainer:j.current,children:de=>w(q,{children:[a(Gt,{size:"xsmall",url:de.pic,name:de.name||de.email,flex:"none"}),a(ve,{textStyle:"small",overflow:"hidden",textOverflow:"ellipsis",children:de.name||de.email})]})}),G?void 0:a(St,{text:"Upgrade to upload images",disabled:!l,children:a("span",{children:a(Lf,{title:"Add image",disabled:g||l,children:a(Di,{accept:"image/*",dropFile:!1,readFileData:!1,onChange:ie,disabled:g,title:"Add image",children:a(f,{display:"flex",justifyContent:"center",alignItems:"center",children:g?a(mt,{color:"darkGray",bgColor:"transparent",size:24}):a(k2,{})})})})})})]}),right:G?void 0:w(f,{display:"flex",gap:8,role:"button",children:[r?a(D2,{onClick:ne,variant:"close",children:a(C2,{})}):void 0,a(D2,{onClick:X,disabled:!J,variant:"submit","data-testid":"submit-comment",children:a(P2,{})})]})})}),a(f,{ref:de=>{j.current=de,ee(!0)}})]})}var $B=({left:e,right:o,...t})=>w(f,{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",...t,children:[a(f,{children:e}),a(f,{children:o})]});function Pl({content:e,...o}){let{getTeammateKey:t=()=>"",getTeammateLabel:r=()=>"",teammates:i=[],availableMentions:n,availableAttachment:s}=(0,no.useContext)(bc);return a(L2,{markdown:e,items:i,getLabel:r,getKey:t,children:a(OB,{...o,disableMentions:!n,disableAttachments:!s})})}var wc=B(H());Ai();k();function H2(e,o,t=1){let r=ct.mapPointerToDocument(e,1,t),i=ct.mapElementToDocument(o,1,t);return ct.absoluteToRelative(r,i)}function F2({workspace:e,onCreate:o}){let[t,r]=(0,wc.useState)({width:0,height:0,top:0,left:0});(0,wc.useEffect)(()=>{function n(s,l){let c=window.RM.constructorRouter.zoom.getZoom(),d=s.$el.get(0),p=s.getBoxData({includeRotationData:!0}),m=H2(l,d,c),u=ct.rotate(m,{left:p.w/2,top:p.h/2},-p.angle);o({widgetId:s.model.id,placement:{x:u.left,y:u.top}})}return e.on("block:click",n),()=>{e.off("block:click",n)}},[e,o]),(0,wc.useEffect)(()=>{function n(){let s=window.RM.constructorRouter.zoom.getZoom(),l=e.getDocumentBox(),c=e.getOriginBox(),d={width:l.width,height:l.height,top:-c.top,left:-c.left};r(ct.resize(d,s))}return n(),e.on("workspace-resize",n),()=>{e.off("workspace-resize",n)}},[e]);function i(n){let s=window.RM.constructorRouter.zoom.getZoom(),l=H2(n.nativeEvent,e.$origin.get(0),s);o({placement:{x:l.left,y:l.top}})}return a("div",{onClick:i,style:{position:"absolute",...t}})}var xc=B(H());oe();N();Ai();k();var HB=27,FB=0,NB=F(f,{excludeProps:["placement","top","left","bottom","right","offsetTop","offsetLeft"]})`
  top: ${e=>Tl(e.placement.top)};
  left: ${e=>Tl(e.placement.left)};
  bottom: ${e=>Tl(e.placement.bottom)};
  right: ${e=>Tl(e.placement.right)};
  z-index: ${e=>e.zIndex||vl.zoomedBox};
  margin-top: ${e=>Tl(e.offsetTop)};
  margin-left: ${e=>Tl(e.offsetLeft)};
  transform: ${e=>WB(e.placement)};
`,dm=(0,xc.forwardRef)(({commentPosition:e,children:o,...t},r)=>{if(!e)return null;let i=e.y,n=e.x,s=e?.style?.right??0,l=e?.style?.bottom??0,c=e?.style?.marginTop??0,d=e?.style?.marginLeft??0;return a(NB,{...t,ref:r,offsetTop:c,offsetLeft:d,placement:{top:i,left:n,bottom:l,right:s},position:e?.style?.position??"absolute","aria-label":"comment",children:a(f,{marginTop:-HB,marginLeft:-FB,children:o})})});function um(e,o,t){let{zoom:r}=w1(),i=(0,xc.useMemo)(()=>{if(e)return t.getActiveBlocks().find(s=>s.id===e.widgetId)},[e]),n=i?.model?.get("sticked");return(0,xc.useMemo)(()=>{if(!e)return null;let s=o===t.getPageId();return i&&(s||i.model.get("is_global"))?qB(e.placement,i):s?e.placement:null},[e,i,n?r:void 0])}function Tl(e){return e?e==="auto"||typeof e=="string"&&e.endsWith("%")?e:`calc(${e}px * var(--workspace-zoom))`:""}function WB(e){return e.right&&e.bottom?"translate(100%, 100%)":e.right?"translateX(100%)":e.bottom?"translateY(100%)":"none"}function VB(e,o){let t=ct.rotate({left:e.x,top:e.y},{left:o.w/2,top:o.h/2},o.angle),r=t.left,i=t.top;return{x:r,y:i}}function Il(e){return e?e.endsWith("%")?e:parseFloat(e):0}function UB(e){let o=e.style;return{left:Il(o.left),top:Il(o.top),right:Il(o.right),bottom:Il(o.bottom),marginTop:Il(o.marginTop),marginLeft:Il(o.marginLeft)}}function GB(e,o,t,r){let i=UB(r),{top:n,left:s}=i;return["nw","w","sw"].includes(t)&&typeof s=="number"&&(s+=e.x),["nw","n","ne"].includes(t)&&typeof n=="number"&&(n+=e.y),["ne","e","se"].includes(t)&&typeof i.right=="number"&&(i.right+=o.w-e.x),["sw","s","se"].includes(t)&&typeof i.bottom=="number"&&(i.bottom+=o.h-e.y),["n","c","s"].includes(t)&&(i.marginLeft+=e.x),["w","c","e"].includes(t)&&(i.marginTop+=e.y),{y:n,x:s,style:{position:"fixed",...i}}}function jB(e,o){let t=ct.relativeToAbsolute({top:e.y,left:e.x},{left:o.x,top:o.y});return{y:t.top,x:t.left}}function qB(e,o){let t=o.getBoxData({includeBoundingBox:!0,includeRotationData:!0}),r=e.x>t.w?t.w:e.x,i=e.y>t.h?t.h:e.y,n=VB({x:r,y:i},t),s=o.model.get("fixed_position");if(s){let l=o.$el.get(0);return GB(n,t,s,l)}return jB(n,t)}var is=B(H());Eh();Q6();k();var YB=300,XB={name:"maxSize",enabled:!0,phase:"main",requiresIfExists:["offset","preventOverflow","flip"],fn({state:e,name:o,options:t}){let r=D0(e,t),{x:i,y:n}=e.modifiersData.preventOverflow||{x:0,y:0},{width:s,height:l}=e.rects.popper,[c]=e.placement.split("-"),d=c==="left"?"left":"right",p=c==="top"?"top":"bottom";e.modifiersData[o]={width:s-r[d]-i,height:l-r[p]-n}}},KB={name:"applyMaxSize",enabled:!0,phase:"beforeWrite",requires:["maxSize"],fn({state:e}){let{height:o}=e.modifiersData.maxSize;e.styles.popper.maxHeight=`${o}px`}},Df=(e={})=>({rootBoundary:"document",boundary:document.body,padding:30,...e});function mm({children:e}){let[o,t]=(0,is.useState)(null),[r,i]=(0,is.useState)(null),{height:n}=x1(r),s=nl(o,r,{modifiers:[{name:"preventOverflow",options:Df()},{name:"offset",options:{offset:[0,16]}},{name:"flip",options:Df({padding:{right:YB}})},{...XB,options:Df()},KB],placement:"right"}),{styles:l,attributes:c}=s;(0,is.useEffect)(()=>{n!==0&&s?.update?.()},[n]);let d=(0,is.useCallback)(m=>{t(m)},[]),p=(0,is.useCallback)(m=>{i(m)},[]);return a(q,{children:e({setReferenceElementRef:d,setPopperElementRef:p,styles:l,attributes:c})})}Be();gl();var N2=B(Js());Us();k();function W2({workspace:e,onDone:o}){let[t,r]=(0,qr.useState)(null),i=um(t,e.getPageId(),e),[n,s]=dn(),l=(0,qr.useRef)(null),{me:c,owner:d,projectTeam:p}=(0,qr.useContext)(ce),m=z0(),u=(0,qr.useCallback)((b=!0)=>{let x="";if(l.current?.props.editorState){x=pm(l.current.props.editorState);let y=Ed(l.current.props.editorState,Qx({content:l.current.props.editorState.getCurrentContent()}));l.current.props.onChange(y)}let S=x.length===0;return!S&&b&&m.start("shake"),S},[]);gr(N2.Key.Escape,()=>{u(!1)&&r(null)},[u]),(0,qr.useEffect)(()=>{n!==null&&i!==null&&r(null)},[n,i]);function g(b){if(n){s(null);return}if(t){u()&&r(null);return}r(b)}function h(b,x){t&&o({position:t,content:b,commentImage:x}),r(null)}return w(qr.Fragment,{children:[a(dm,{commentPosition:i,zIndex:vl.expandedBubble,children:a(mm,{children:({setPopperElementRef:b,setReferenceElementRef:x,attributes:S,styles:y})=>w(q,{children:[a(f,{color:"orange",ref:x,children:a(im,{animate:m,variants:{shake:rm},initial:{rotate:0},exit:{rotate:0,transition:{duration:.2}},style:{transformOrigin:"bottom left"},stroke:"white",strokeWidth:2,filter:"drop-shadow(0px 2px 12px rgba(0, 0, 0, 0.16))"})}),a(f,{ref:b,style:y.popper,...S.popper,children:a(Sl,{me:c,owner:d,projectTeam:p,children:a(Pl,{onSubmit:h,width:224,padding:"12px 16px 16px 16px",boxShadow:"0px 2px 16px rgba(0, 0, 0, 0.16)",backgroundColor:"white",cursor:"initial",showCancel:!1,borderRadius:8,draftEditorRef:l})})})]})})}),a(F2,{onCreate:g,workspace:e})]})}var gn=B(H());N();Be();var eo=B(H());VI();Wo();N();var V2=B(H());N();oe();k();var ZB=F(f,{excludeProps:["dense"]})(({dense:e})=>({display:"flex",position:"relative",flexDirection:"column",padding:e?"0":"12px 8px"})),JB=F(f,{excludeProps:["dense"]})(({selected:e,dense:o})=>({display:"flex",borderRadius:"8px",position:"relative",flexDirection:"column",padding:o?"0":"12px 8px 16px 8px",cursor:"pointer",backgroundColor:e?"white":"inherit",boxShadow:e?"0px 2px 16px rgba(0, 0, 0, 0.08)":"none","&:hover":{backgroundColor:"white"}})),Of=(0,V2.forwardRef)(({children:e,disableSelectable:o=!1,selected:t,...r},i)=>a(o?ZB:JB,{selected:t,ref:i,...r,children:e}));var U2=B(H()),aa=(0,U2.createContext)({selected:!1,hover:!1,commentRef:null,isTread:!1,readonly:!1});var gm=B(H());N();fe();oe();Jh();Ur();rc();oe();k();var QB=F(f)({display:"flex",gap:"8px",width:"100%",alignItems:"center"});function G2({author:e,actions:o,description:t,disableActions:r}){let{hover:i}=(0,gm.useContext)(aa),[n,s]=(0,gm.useState)(!1),{name:l,pic:c}=e,d=i||n;return(r||o.length===0)&&(d=!1),w(QB,{children:[w(f,{position:"relative",height:24,children:[a(Gt,{size:"xsmall",type:"commentsUser",name:l,url:c}),c?null:a(f,{position:"absolute",top:0,width:24,height:24,borderRadius:"50%",boxShadow:"0 0 0 1px inset rgba(133, 133, 133, 0.16)"})]}),a(ve,{textStyle:"small",color:"darkGray",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",as:"div",children:i?t:l}),d?a(f,{marginLeft:"auto",as:"span",children:a(ml,{width:224,zIndex:9999,popperOffset:[-84,26],listItems:o,container:document.body,border:"none",borderRadius:8,boxShadow:"0px 2px 16px rgba(0, 0, 0, 0.16)","data-testid":"comment-context-menu",onToggleDropdown:s,role:"menu",children:({toggleDropdown:p})=>a(Pt,{"aria-haspopup":!0,height:24,width:24,color:"transparent",activeColor:"lightGray",hoverColor:"lightGray","data-testid":"comment-context-menu-trigger",borderWidth:1,borderStyle:"solid",borderColor:n?"transparent":Me("darkGray",.15),borderRadius:"50%",backgroundColor:n?"lightGray":"transparent",marginRight:0,onClick:m=>{m.stopPropagation(),p()},"aria-expanded":n?"true":"false",children:a(Tr,{color:"black"})})})}):null]})}var Rr=B(H());N();fe();oe();k();var e7=20,t7=8,o7=F(f)({marginTop:4,paddingLeft:32}),$f=F(ve)`
  display: block;
  overflow: hidden;
  white-space: pre-wrap;
  overflow-wrap: break-word;
`;$f.defaultProps={textStyle:"regular"};var r7=F($f)`
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 8;
  text-overflow: ellipsis;
`,i7=(0,Rr.forwardRef)(({children:e,collapsed:o},t)=>a(o?$f:r7,{ref:t,children:e}));function j2({content:e,image:o,edit:t,onEdit:r,onCloseEdit:i}){let[n,s]=(0,Rr.useState)(!1),{readonly:l}=(0,Rr.useContext)(aa);function c(m){m.stopPropagation(),s(!0)}return a(o7,{cursor:l?"inherit":"pointer",children:t?a(Pl,{content:e,image:o,onCancel:i,onSubmit:r,textStyle:"regular"}):a(n7,{image:o,content:e,collapsed:n,onShowContent:c})})}function n7({image:e,content:o,collapsed:t=!1,onShowContent:r}){let i=(0,Rr.useRef)(null),[n,s]=(0,Rr.useState)(0);(0,Rr.useLayoutEffect)(()=>{i.current&&s(i.current.getBoundingClientRect().height/e7)},[o]);let l=(0,Rr.useMemo)(()=>R2(o),[o]);return w(f,{children:[e&&a(sm,{image:e}),a(i7,{ref:i,collapsed:n===0||t,children:a(Gx,{color:"darkGray",target:"_blank",children:l})}),n>t7&&!t?a(ve,{display:"block",role:"button",color:"darkGray",cursor:"pointer",onClick:r,children:"Show more"}):null]})}var q2=B(H());N();k();var Hf=(0,q2.memo)(function({color:o,children:t,...r}){return a(f,{display:"flex",flexDirection:"column",gap:16,paddingBottom:16,color:o,...r,children:t})});var hm=B(H());N();fe();Ks();oe();ok();k();var s7=F(f)`
  display: flex;
  flex-direction: column;
  margin-top: 16px;
  scroll-margin: 60px;
  gap: 16px;
`;function Ff({open:e,onClick:o,repliesCount:t,children:r}){let i=(0,hm.useRef)(null),n=Bu(t);return(0,hm.useEffect)(()=>{n&&n<t&&i?.current?.scrollIntoView({block:"end",behavior:"smooth"})},[t,n]),w(q,{children:[w(l7,{open:e,onClick:o,"data-testid":"comment-reply-toggle",children:[t," repl",t>1?"ies":"y"]}),e?a(s7,{role:"list",ref:i,children:r}):null]})}var a7=F(f)`
  gap: 8px;
  display: flex;
  align-items: center;
  margin-top: 24px;

  &:hover {
    color: ${({theme:e})=>e.colors.orange};
  }
`;function l7({open:e,children:o,onClick:t,...r}){return w(a7,{role:"button",onClick:t,...r,children:[a(zo,{transform:e?"rotate(0deg)":"rotate(-90deg)",transition:"transform 0.3s"}),a(ve,{textStyle:"small",userSelect:"none",children:o})]})}var Y2=B(H());N();$e();oe();k();var p7=F(f)({marginTop:20,paddingLeft:32});function X2({onSubmit:e}){let[o,t]=(0,Y2.useState)(!1);function r(){t(!0)}function i(){t(!1)}function n(c,d){t(!1),e(c,d)}return a(p7,{children:o?a(Pl,{width:"100%",position:"relative",onSubmit:n,onCancel:i,textStyle:"regular"}):a(c7,{onClick:r})})}function c7(e){return a(Ue,{variant:"primary",color:"orange","data-testid":"reply-to-comment",...e,children:"Reply"})}Bo();je();var K2=B(H());N();oe();k();var d7=F("span")({position:"relative"}),u7=F(f)(({theme:e,offset:o=[0,0]})=>({top:o[0]??0,left:o[1]??0,width:6,height:6,position:"absolute",borderRadius:"50%",backgroundColor:e.colors.orange})),Wi=(0,K2.memo)(function({show:o,offset:t,children:r}){return w(d7,{children:[o?a(u7,{offset:t,title:"A new comment"}):null,r]})});k();var vc=(0,eo.memo)(function(o){let{comment:t,page:r,projectNumId:i,selected:n=!1,onStartEditing:s,onClick:l,isTread:c=!1,parentComment:d,readonly:p=!1,disableSelectable:m=!1,isLast:u=!1}=o,{userId:g,ownerId:h,viewState:b}=(0,eo.useContext)(bc),[x]=$1(),[S,y]=(0,eo.useState)(!1),[C,P]=(0,eo.useState)(!1),{isHovered:v,...T}=Ke(),R=(0,eo.useRef)(null),I=qu(R,{root:null,rootMargin:"0px",threshold:1}),M=(0,eo.useRef)(!1),{author:D,createdDate:E,viewport:A,isTmp:$}=t,j=g===D._id,pe=h===g,ee=!!b?.viewTree[t._id]?.isNew,G=!!b?.viewTree[t._id]?.newChildren;(0,eo.useEffect)(()=>{v&&ee&&!j&&g&&O1(t,g)},[t,v,ee,j,g]),(0,eo.useEffect)(()=>{if(!c)if(n){let be=I&&I.intersectionRatio>0;I&&I.intersectionRatio===0&&!M.current?(R.current?.scrollIntoView(),M.current=!0):be&&!M.current&&(M.current=!0)}else M.current=!1},[n,c,I]);let K=be=>{be.stopPropagation(),l?.({comment:t,parentComment:d},n?"selected":"regular")},we=(0,eo.useCallback)(be=>{be&&be.stopPropagation(),!(S||!j||$||p)&&(y(!0),s&&s({comment:t,parentComment:d}))},[j,S,$,p,t,d,s]),xe=Ry({onClick:K,onDoubleClick:we}),_e=(0,eo.useCallback)(be=>{be.stopPropagation(),P(Ae=>!Ae)},[]),ie=(be,Ae)=>{y(!1);let Qe=Ae?[{type:"image",...Ae}]:Ae===null?[]:void 0;R1({commentId:t._id,content:be,attachments:Qe})},ze=(be,Ae)=>{let Qe=Ae?[{type:"image",...Ae}]:void 0,O=d||t;Zu({pageId:r._id,viewport:t.viewport,content:be,parent:O._id,attachments:Qe}),se(he.CommentAdd,{type:"reply"})},ne=()=>{y(!1)},J=(0,eo.useCallback)(be=>{be.stopPropagation();let Ae=d||t;b1(i,r?.num,Ae._id)},[i,r,t,d]),X=(0,eo.useCallback)(be=>{be.stopPropagation();let Ae=d||t,Qe=d?t:void 0;z1({parentCommentId:Ae._id,childCommentId:Qe?._id})},[t,d]),Q=(0,eo.useMemo)(()=>{let be=h1(new Date(E),x),Ae=Ep[A],Qe=r.pageNestedNum??r.num;return`${be}, P.${Qe}, ${Ae}`},[A,E,x,r]),te=(0,eo.useMemo)(()=>{let be=[];return j&&be.push({title:"Edit",onClick:we,closeOnClick:!0,props:{paddingLeft:"48px"}}),(j||pe)&&be.push({title:t.children?"Delete thread":"Delete",onClick:X,closeOnClick:!0,props:{paddingLeft:"48px"}}),c||be.push({title:"Copy link",onClick:J,closeOnClick:!0,props:{paddingLeft:"48px"}}),be},[j,c,pe,t.children,we,J,X]),ye=n&&!c&&!t.children||!c&&C,de=(0,eo.useMemo)(()=>({selected:n,hover:v,commentRef:R,isTread:c,readonly:p}),[n,v,c,p]),Se={disableSelectable:m,selected:n,ref:R,dense:!1,...T};return c&&(Se.dense=!0),a(aa.Provider,{value:de,children:w(Of,{role:"comment",...Se,marginBottom:u&&S?16:0,children:[w(f,{...xe,children:[a(Wi,{offset:[-5,0],show:ee,children:a(G2,{author:D,actions:te,description:Q,disableActions:S||p})}),a(j2,{edit:S,content:t.content,image:t.attachments?.[0],onCloseEdit:ne,onEdit:ie})]}),t.children?.length?a(Wi,{offset:[29,0],show:!C&&G,children:a(Ff,{open:C,onClick:_e,repliesCount:t.children.length,children:t.children.map((be,Ae,Qe)=>a(vc,{...o,isTread:!0,disableSelectable:!0,comment:be,parentComment:t,isLast:Ae+1===Qe.length},be._id))})}):null,!p&&ye?a(X2,{onSubmit:ze}):null]})})});var Ml=B(H());N();oe();ok();k();var g7=F(f)(({theme:e})=>({width:224,padding:8,borderRadius:8,cursor:"initial",backgroundColor:e?.colors.lightGray})),h7=F(f)({overflowY:"auto"}),Z2=(0,Ml.forwardRef)(({onClose:e,replies:o,maxHeight:t,children:r,...i},n)=>{let s=(0,Ml.useRef)(null),l=Bu(o);return(0,Ml.useEffect)(()=>{if(l&&l<o){let c=s.current;c.scrollTop=c.scrollHeight-c.scrollTop}},[o,l]),a(g7,{ref:n,...i,children:a(h7,{ref:s,maxHeight:t,children:r})})});Ai();k();var f7=306;function J2({comments:e,workspace:o}){let[,t]=dn();function r(){t(null)}return a(q,{children:e.map(i=>a(b7,{comment:i,workspace:o,onClose:r},i._id))})}function b7({comment:e,workspace:o,onClose:t}){let[r,i]=dn(),n=um(e.position,e.pageId,o),{pages:s,me:l,owner:c,projectTeam:d,project:p}=(0,gn.useContext)(ce),[m]=ts(),u=(0,gn.useRef)(null),g=w7(u,o,window.RM.constructorRouter.zoom),h=r?.comment._id===e._id,x=h&&r?.fromList&&!r?.comment.isTmp;(0,gn.useEffect)(()=>{h&&g()},[h]);let S=(0,gn.useCallback)(()=>{e._id===r?.comment._id?i(null):i({comment:e,commentElem:u.current,fromList:!1})},[e,r,i]);return a(dm,{commentPosition:n,zIndex:h?vl.expandedBubble:void 0,ref:u,"data-testid":"comment-bubble",children:a(mm,{children:({setReferenceElementRef:y,setPopperElementRef:C,styles:P,attributes:v})=>w(q,{children:[a(f,{cursor:"pointer",position:"relative",ref:y,color:h?"orange":"white",children:a(im,{animate:x?rm:void 0,initial:{rotate:0},exit:{rotate:0,transition:{duration:.2}},style:{transformOrigin:"bottom left"},stroke:h?"white":"orange",strokeWidth:2,onClick:S,filter:"drop-shadow(0px 2px 12px rgba(0, 0, 0, 0.16))"})}),h&&!r?.fromList?a(Sl,{me:l,owner:c,projectTeam:d,viewState:m,children:a(Z2,{ref:C,style:P.popper,onClose:t,replies:e?.children?.length??0,maxHeight:`calc(${P.popper.maxHeight} - 16px)`,...v.popper,children:a(vc,{selected:!0,disableSelectable:!0,comment:e,projectNumId:p.num_id,page:s.find(T=>T._id===e.pageId)})})}):null]})})})}function w7(e,o,t){let[r,i]=[0,window.innerWidth-f7];return(0,gn.useCallback)(()=>{let n=e.current;if(!n)return;let s=n;if(Modernizr.firefox){s.scrollIntoView({block:"center",behavior:"smooth"});return}let l=ct.mapElementToViewport(s,1,1),c=t.getZoom();function d(){let p=l.left,m=l.left+l.width;(p<r||m>i)&&c>Uu?(t.zoomTo(Math.max(Uu,c-=.08),o,o.$container[0],t.getCenter(t.getZoom(),o,o.$container[0])),l=ct.mapElementToViewport(s,1,1),requestAnimationFrame(d)):s.scrollIntoView({block:"center",behavior:"smooth"})}requestAnimationFrame(d)},[o,r,i])}Be();Bo();je();k();function Q2({workspace:e,router:o}){let[t,r]=(0,Bl.useState)(()=>e.viewport),[,i]=dn(),n=(0,Bl.useMemo)(()=>({viewport:t,status:"unresolved"}),[t]),s=Ju(n);(0,Bl.useEffect)(()=>{let m=e.mag.pages;function u(){r(e.viewport)}return m.on("change:viewport",u),()=>{m.off("change:viewport",u)}},[e,o]);function l(m){let u=e.getPageId(),g=m.commentImage?[{type:"image",...m.commentImage}]:void 0,h=Zu({position:m.position,content:m.content,pageId:u,viewport:t,attachments:g});i({comment:h,fromList:!0}),se(he.CommentAdd,{type:"origin"})}let c=e.viewport,d=e.page.getViewportParam(e.viewport,"height"),p=Oe.dictionary[c].width;return w(d2,{width:p,height:d,children:[a(p2,{}),w(rl,{project:e.mag,router:o,children:[a(J2,{workspace:e,comments:s}),a(W2,{workspace:e,onDone:l})]})]})}k();function e_(e,o){let t=Nf.default.createRoot(e);function r(){t.render(a(Fr,{withGlobalStyles:!1,children:a(Q2,{workspace:o.workspace,router:o.router})}))}function i(){t.unmount(),t=Nf.default.createRoot(e)}return{render:r,unmount:i}}Zp();var x7=Nn.extend({idAttribute:"pack_id",urlRoot:"/api/pack/",name:"Pack"}),la=x7;ec();yy();vt();wM();uI();var t_=20,Wf=class extends yc.default.View{constructor(t){super();z(this,"mag");z(this,"blocks",[]);z(this,"page");z(this,"packs",{});z(this,"$origin");z(this,"$scroller");z(this,"$frame");z(this,"$border");z(this,"$window");z(this,"$container");z(this,"loader");z(this,"$bottomShiftLine");z(this,"workspaceContainer");z(this,"position",{top:0,left:0});z(this,"locked",!1);z(this,"visible",!1);z(this,"eCommerceManager");z(this,"spacesController");z(this,"syncManager");z(this,"controls");z(this,"distance");z(this,"pagesize");z(this,"block");z(this,"common_layer");z(this,"rendered",!1);z(this,"bottomBlocksToMove");z(this,"movingBlocks");z(this,"movingDelta");z(this,"isDragActive",!1);z(this,"isBlockMovementActive",!1);z(this,"animationMode",!1);z(this,"cachedSizes");z(this,"animationSteps");z(this,"disableDragging");z(this,"disableBlocksInteractive");z(this,"disabledSelectMultiple");z(this,"saveGroupDebounced");z(this,"unsubscribeCommentMode");z(this,"previousObjectsUnderCursor",[]);z(this,"previousIgnoreWidgetPacks");z(this,"oldParams");z(this,"bundleDragTimeout");z(this,"blocksToClone",{});z(this,"redrawPacksFramesHolded",!1);z(this,"cloneBlocksDebounced");z(this,"restoreFocusForCopyPasteDebounced");z(this,"triggerSelectOnSelectedBlockDebounced");z(this,"viewportScrolls",{});z(this,"viewportScroll",0);z(this,"_unselectedBlocksForBottomLine");z(this,"widgetResizingOrRotating");z(this,"commentsRoot");z(this,"isActiveCommentMode",P1());z(this,"deletedWidgetsCount",0);z(this,"_enableCommentMode",t=>{this.isActiveCommentMode&&!t?.force||(window.RM.constructorRouter.changeEditorMode("member"),window.RM.constructorRouter.changeBlocksMode(!1),this.disableDragging=!0,this.disabledSelectMultiple=!0,this.disableBlocksInteractive=!0,this.trigger("deselect"),this.getAllPacks().forEach(r=>{r.frame.setFrameBorderVisible(!1)}),this.blocks.forEach(r=>{r.frame?.toggleFrameColor("orange-border",!0)}),this.commentsRoot.render())});z(this,"_disableCommentMode",()=>{this.isActiveCommentMode&&(this.disableDragging=!1,this.disabledSelectMultiple=!1,this.disableBlocksInteractive=!1,this.getAllPacks().forEach(t=>{t.frame.setFrameBorderVisible(!0)}),this.blocks.forEach(t=>{t.frame?.toggleFrameColor("orange-border",!1)}),this.commentsRoot.unmount())});z(this,"getCommentModeState",()=>this.isActiveCommentMode);z(this,"onMouseLeave",()=>{this.updateBlocksHighlight({cursorX:0,cursorY:0,disableAllHighlights:!0})});z(this,"onMouseMove",t=>{let r=window.Modernizr?.mac?"metaKey":"ctrlKey",i=t[r];this.updateBlocksHighlight({cursorX:t.clientX,cursorY:t.clientY,ignoreWidgetPacks:i})});z(this,"updateBlocksHighlight",({cursorX:t,cursorY:r,ignoreWidgetPacks:i,disableAllHighlights:n})=>{if(this.previousObjectsUnderCursor=this.previousObjectsUnderCursor||[],!this.isBlocksHighlightActive()||n){this.previousObjectsUnderCursor.forEach(u=>u.triggerMouseLeave?.()),this.previousObjectsUnderCursor=[];return}let l=this.getBlocksByAbsoluteCoords({x:t,y:r,ignoreWidgetPacks:i}),c=this.getTopmostBlock({blocks:l}),d=c?[c]:[];(this.previousIgnoreWidgetPacks!==i?this.previousObjectsUnderCursor:W.default.difference(this.previousObjectsUnderCursor,d)).forEach(u=>u.triggerMouseLeave?.()),(this.previousIgnoreWidgetPacks!==i?d:W.default.difference(d,this.previousObjectsUnderCursor)).forEach(u=>u.triggerMouseEnter?.({metaKey:i})),this.previousObjectsUnderCursor=d,this.previousIgnoreWidgetPacks=i});z(this,"getTopmostBlock",({blocks:t})=>{let r=t,{topBlock:i}=r.reduce((n,s)=>{let l=s instanceof tc?s.blocks[0].currentZ:s.currentZ;return l>n.maxZ?{maxZ:l,topBlock:s}:n},{maxZ:0,topBlock:void 0});return i});z(this,"getBackground",()=>W.default.findWhere(this.blocks,{name:"Background"}));z(this,"getBlocksByAbsoluteCoords",({x:t,y:r,ignoreWidgetPacks:i})=>{let n=this.getSelectableBlocks(),s=i?[]:this.getAllPacks(),l=n.concat(s);return l=l.filter(c=>{let d=this.getBlockPositionInWindow(c);return d.left<=t&&d.left+d.width>=t&&d.top<=r&&d.top+d.height>=r}).filter(c=>!c.latestPosSizeAngle?.angle||c.contains({x:this.convertX(t,"workspace"),y:this.convertY(r,"workspace")})),l});z(this,"getBlockPositionInWindow",t=>{let r=window.RM.constructorRouter.zoom.getZoom(),i=this.viewport==="default",n=this.getCachedSizes(),s,l={left:t.latestPosSizeAngle.bb_left,top:t.latestPosSizeAngle.bb_top,width:t.latestPosSizeAngle.bb_width,height:t.latestPosSizeAngle.bb_height};if(t.isFixed())if(t instanceof tc)s={left:l.left*r+this.position.left,top:l.top*r+this.position.top,width:l.width*r,height:l.height*r};else{let c;i?(c=Pr.getFixedPositionBox(t.model.get("fixed_position"),{x:l.left,y:l.top,w:l.width,h:l.height},r,{width:n.width,height:n.height}),s=c):(c=Pr.getFixedPositionBox(t.model.get("fixed_position"),{x:l.left,y:l.top,w:l.width,h:l.height},r,{width:n.elWidth,height:(n.height||0)-this.position.top-(this.position.bottom||0)}),s={left:c.left+this.position.left,top:c.top+this.position.top,width:c.width,height:c.height})}else s={left:this.convertX(l.left,"absolute"),top:this.convertY(l.top,"absolute"),width:l.width*r,height:l.height*r};return s});z(this,"isBlocksHighlightActive",()=>this.isActiveCommentMode?!0:!this.isDragActive&&!this.isBlockMovementActive&&!window.RM.constructorRouter.isPageLocked(this.getPageId()));z(this,"convertX",(t,r)=>{let i=window.RM.constructorRouter.zoom.getZoom(),n=this.viewport,s=Oe.dictionary[n].width,l=this.mag.getViewportWidth(n);switch(r){case"absolute":return Math.max((window.innerWidth-l*i)/2,0)+(t+(l-s)/2)*i-(this.$container.scrollLeft()||0);case"workspace":return(t-Math.max((window.innerWidth-l*i)/2,0)-(l-s)/2*i+(this.$container.scrollLeft()||0))/i;default:return t}});z(this,"convertY",(t,r)=>{let i=window.RM.constructorRouter.zoom.getZoom();switch(r){case"absolute":return t*i+this.position.top*i-(this.$container.scrollTop()||0);case"workspace":return(t-this.position.top+(this.$container.scrollTop()||0))/i;default:return t}});z(this,"getWorkspaceBox",()=>({...this.position,...this.getWorkspaceSize()}));z(this,"getOriginBox",()=>{let t=this.viewport,r=this.getWorkspaceBox(),i=jr.getViewportSetting("width",t),n={left:(r.width-i)/2,top:0,width:i,height:r.height};return ct.relativeToAbsolute(n,this.position)});z(this,"getDocumentBox",()=>{let t=this.viewport,r=this.getCachedSizes(),i={width:r.clientWidth,height:r.height,left:0,top:0},n=this.mag.getViewportWidth(t),s=this.page.getViewportParam(this.viewport,"height"),l=window.RM.constructorRouter.zoom.getZoom(),c=ct.mapFromViewportToDocument(i,1,l);return{left:0,top:0,width:Math.max(c.width,n),height:Math.max(c.height,s)}});z(this,"getParameters",()=>({workspaceSize:this.getWorkspaceSize(),windowSize:this.getClientSize(),viewport:this.viewport,zoom:window.RM.constructorRouter.zoom.getZoom(),scroller:this.$scroller[0]}));z(this,"listenToGuides",()=>{this.stopListeningToGuides(),window.RM.constructorRouter.gg.guides?.models&&window.RM.constructorRouter.gg.guides?.model&&(this.toggleBorder({guidesOn:this.mag.edit_params.get("guides"),columnCount:window.RM.constructorRouter.gg.guides.model.get("columns"),margin:window.RM.constructorRouter.gg.guides.model.get("margin")}),this.listenTo(window.RM.constructorRouter.gg.guides.models,"change:columns",(t,r)=>this.toggleBorder({guidesOn:this.mag.edit_params.get("guides"),columnCount:r,margin:t.get("margin")})),this.listenTo(window.RM.constructorRouter.gg.guides.models,"change:margin",(t,r)=>this.toggleBorder({guidesOn:this.mag.edit_params.get("guides"),columnCount:t.get("columns"),margin:r})),this.listenTo(window.RM.constructorRouter.gg.guides,"modelLoaded",()=>{this.toggleBorder({guidesOn:this.mag.edit_params.get("guides"),columnCount:window.RM.constructorRouter.gg.guides.model.get("columns"),margin:window.RM.constructorRouter.gg.guides.model.get("margin")})}),this.listenTo(this.mag.edit_params,"change:guides",(t,r)=>{this.toggleBorder({guidesOn:r,columnCount:window.RM.constructorRouter.gg.guides.model.get("columns"),margin:window.RM.constructorRouter.gg.guides.model.get("margin")})}))});z(this,"stopListeningToGuides",()=>{this.stopListening(window.RM.constructorRouter.gg.guides),this.stopListening(window.RM.constructorRouter.gg.guides?.models),this.stopListening(this.mag.edit_params)});z(this,"show",(t={})=>{this.$el.show().css({opacity:"1"}).addClass("current"),this.onResize(),this.rendered||this.render(),this.visible=!0,t.switchToViewport&&this.setViewport(t.switchToViewport,{...t,doNotSaveScroll:!0}),this.renderGlobalBlocks(),this.trigger("show"),this.controls?.$el.show(),this.restoreViewportScroll(this.viewport),this.updateLockState(),this.$border.toggleClass("fullscreen",window.RM.constructorRouter.zoom.isFullScreenOrMore()&&this.page.get("height")*window.RM.constructorRouter.zoom.getZoom()>=window.innerHeight),this.$border.toggleClass("ghost",this.viewport!=="default"&&!this.mag.edit_params.get("guides")),Ge("constructor.borderAlwaysVisible")&&this.updateBorder(),window.RM.constructorRouter.gg.guides?.models?.length?this.listenToGuides():window.RM.constructorRouter.gg?.guides?this.listenToOnce(window.RM.constructorRouter.gg.guides,"modelLoaded",()=>{this.listenToGuides()}):(this.mag.edit_params.get("guides")||this.toggleBorder({guidesOn:!1,margin:{}}),this.listenToOnce(window.RM.constructorRouter.gg,"create",()=>{this.listenToOnce(window.RM.constructorRouter.gg.guides,"modelLoaded",()=>{this.listenToGuides()})})),this.isActiveCommentMode&&requestAnimationFrame(()=>{this._enableCommentMode({force:!0})}),this.workspaceContainer.addEventListener("mousemove",this.onMouseMove,{passive:!0}),this.workspaceContainer.addEventListener("mouseleave",this.onMouseLeave),Ge("constructor.mobileBrokenChange")&&Sv.setWorkspace(this)});z(this,"hide",()=>{this.isActiveCommentMode&&this._disableCommentMode(),this.removeGlobalBlocks(),this.visible=!1,this.$el.css({opacity:"0"}).hide().removeClass("current"),this.trigger("hide"),this.controls?.$el.hide(),this.saveViewportScroll(this.viewport),this.trigger("deselect"),this.stopListeningToGuides(),this.workspaceContainer.removeEventListener("mousemove",this.onMouseMove),this.workspaceContainer.removeEventListener("mouseleave",this.onMouseLeave)});z(this,"render",()=>{this.rendered=!0;let t=i2.extend({$main:(0,ht.default)("#constructor")});if(this.controls=new t({workspace:this}),this.common_layer=new ea.common_layer({master:this.controls,noInit:!0}),W.default.each(this.blocks,function(i){try{this.renderBlock(i)}catch(n){console.error(n.message,n.stack)}},this),this.page.from_template){let i=this.page.getUsedFonts({includeCustom:!1});i&&window.RM.constructorRouter.fonts.addFonts(i,"template")}let r=co.extend(s2);return this.pagesize=new r({el:this.$el.find(".page-size-control").get(0),propsData:{workspace:this,defaultSticky:window.RM.constructorRouter.zoom.isFullScreenOrMore(),defaultZoom:window.RM.constructorRouter.zoom.getZoom()}}),this.redrawPacksFrames(),setTimeout(()=>{this.$el.find(".page-size-control").css({bottom:"22px"})},100),this.page.on("change:viewport",()=>{setTimeout(()=>{this.$el.find(".page-size-control").css({bottom:""}),setTimeout(()=>{this.$el.find(".page-size-control").css({bottom:"22px"})},100)},100)}),this.toggleBlocksEditParams(),this});z(this,"onGlobalAppear",t=>{!this.visible||W.default.find(this.blocks,function(i){return i.model.id===t.id})||this.renderGlobalBlock(t)});z(this,"onGlobalDisappear",t=>{t.get("pid")!==this.page.id&&this.removeGlobalBlock(t)});z(this,"renderGlobalBlock",t=>{t.collection=window.RM.constructorRouter.workspace.page.widgets,t.setViewport(this.viewport),t.clearChanges(),this.createBlock(t,{instant:!0})});z(this,"renderGlobalBlocks",()=>{this.mag.globalWidgets.each(t=>this.renderGlobalBlock(t))});z(this,"removeGlobalBlock",t=>{this.removeBlock(t)});z(this,"removeGlobalBlocks",()=>{this.mag.globalWidgets.each(t=>this.removeGlobalBlock(t))});z(this,"switchOnAnimationMode",t=>{this.animationMode=!0,this.animationSteps=t});z(this,"switchOffAnimationMode",()=>{this.animationMode=!1,delete this.animationSteps});z(this,"onclick",t=>{this.locked||this.visible&&(window.suppressClick&&window.suppressClick>+new Date||this.$el[0].contains(t.target)&&!t.target?.isSameNode(this.$el[0])&&!t.target?.isSameNode(this.$origin[0])||(0,ht.default)(t.target).hasClass("page-size-control")||(0,ht.default)(t.target).closest(".page-size-control").length||(0,ht.default)(t.target).hasClass("add-widget")||(0,ht.default)(t.target).closest(".add-widget").length||(window.RM.constructorRouter.trigger("notice:triggerEduTipClose",{context:"clickOnWorkSpace"}),(!this.controls||this.controls.canControlsBeClosed())&&(this.widgets_in_widgets_deselected()&&this.trigger("deselect"),W.default.defer(function(){this.getSelectedBlocks().length===0&&this.trigger("whitespace_click")}.bind(this)))))});z(this,"onBlockMouseEnter",t=>{this.trigger("block:mouseenter",(0,ht.default)(t.currentTarget).data("id"))});z(this,"onBlockMouseLeave",t=>{this.trigger("block:mouseleave",(0,ht.default)(t.currentTarget).data("id"))});z(this,"widgets_in_widgets_deselected",()=>{let t=this.getSelectedBlocks(),r=[];return t.forEach(function(i){i.child_workspace&&(r=r.concat(i.child_workspace.getSelectedBlocks()))}),r.length?(t.forEach(function(i){i.child_workspace&&i.child_workspace.trigger("deselect")}),this.controls?.onSelect(t),!1):!0});z(this,"onDragStart",(t,r)=>{if(!Ze.isPermissionAllowed("BaseWidgetCanSelectMultiple")||this.disabledSelectMultiple)return;let i=(0,ht.default)(t.target);if(i.closest(".controls").length>0||i.closest(".page-size-control").length>0||i.closest(".space-highlighter").length>0)return!1;let n=(0,ht.default)(window).width()||0;if(r.startX+18>n)return!1;this.$frame.show(),r.scrollTop=this.$container.scrollTop()||0,this.isDragActive=!0});z(this,"onDrag",(t,r)=>{if(!Ze.isPermissionAllowed("BaseWidgetCanSelectMultiple")||this.disabledSelectMultiple)return;let i=window.RM.constructorRouter.zoom.getZoom(),n=r.drag,s=r.startY/i+r.scrollTop/i,l=t.pageY/i+(this.$container.scrollTop()||0)/i,c={top:Math.min(s,l)-this.position.top,left:Math.min(t.pageX/i,r.startX/i)-this.position.left+n.scrollLeft/i,height:Math.abs(s-l),width:Math.abs(t.pageX/i-r.startX/i)};et.autoWindowScroll(t,this.$container,function(){this.onDrag(t,r)}.bind(this)),this.$frame.css(c)});z(this,"onDragEnd",t=>{if(!Ze.isPermissionAllowed("BaseWidgetCanSelectMultiple")||this.disabledSelectMultiple)return;et.autoWindowScrollClear();let r=this.getFramePosition();this.selectBlocks(r,{merge:t.shiftKey}),this.$frame.hide(),this.isDragActive=!1});z(this,"checkBundleDragMode",(t,r)=>{let i=t.keyCode===ht.default.keycodes.v||t.keyCode===ht.default.keycodes.f||!!r;if(this.canEnterBundleDrag()&&i&&!t.metaKey){let n,s;t.keyCode===ht.default.keycodes.v&&(n=t.type==="keydown",s=this.bottomBlocksToMove?this.bottomBlocksToMove.fPressed:!1),t.keyCode===ht.default.keycodes.f&&(n=this.bottomBlocksToMove?this.bottomBlocksToMove.vPressed:!1,s=t.type==="keydown");let l=n||s;r&&(n=r==="bottom",s=r==="top");let c=n||s;this.bottomBlocksToMove?(this.bottomBlocksToMove.vPressed!==n||this.bottomBlocksToMove.fPressed!==s||this.bottomBlocksToMove.kbActivate!==l||this.bottomBlocksToMove.mouseActivate!==r)&&(this.bottomBlocksToMove.active=c,this.bottomBlocksToMove.vPressed=n,this.bottomBlocksToMove.fPressed=s,this.bottomBlocksToMove.kbActivate=l,this.bottomBlocksToMove.mouseActivate=r,delete this.bottomBlocksToMove.list,this.redrawBottomShiftLine({tp:c?"show":"hide"})):(this.bottomBlocksToMove={active:c,mouseActivate:r,kbActivate:l,vPressed:n,fPressed:s},this.redrawBottomShiftLine({tp:"show"}))}this.bottomBlocksToMove&&this.bottomBlocksToMove.active&&i&&t.metaKey&&(clearTimeout(this.bundleDragTimeout),this.bundleDragTimeout=setTimeout(function(){delete this.bottomBlocksToMove,this.redrawBottomShiftLine({tp:"hide"})}.bind(this),250))});z(this,"canEnterBundleDrag",()=>!this.animationMode&&!this.spacesController&&!this.getSelectedBlocks().find(t=>t.cropmode));z(this,"onFileDrop",async t=>{let r=!!t.target.closest(".can-drop"),i=t.dataTransfer?.files?.[0];if(!(r||!i)&&!/^image/.test(i.type)&&/^video/.test(i.type))try{let n=await new Promise((l,c)=>this.addWidget({...vk.defaults,type:"video"},{success:l,error:c}));this.findBlock(n.id).uploadFile?.(i)}catch{alert(le.VIDEO_WIDGET_GENERIC_ERROR_TEXT)}});z(this,"bindUploader",()=>{if(this.el.addEventListener("drop",this.onFileDrop),!Ze.isPermissionAllowed("BaseWidgetCanAdd")||window.RM.constructorRouter.$uploader)return;let t,r,i;window.RM.constructorRouter.$uploader=(0,ht.default)("#workspaceUpload").fileupload({dataType:"json",dropZone:(0,ht.default)("#main"),pasteZone:(0,ht.default)(document),fileInput:(0,ht.default)("#workspaceUpload"),replaceFileInput:!1,singleFileUploads:!0,sequentialUploads:!0}).bind("fileuploaddragover",function(n){t=window.RM.constructorRouter.workspace;let s=n.delegatedEvent,l=(0,ht.default)(s.target),c=l.closest(".block.picture:not(.no-drag)"),d=l.closest(".block.shots"),p=!1;if(c.length){if(clearTimeout(i),i=setTimeout(function(){t.$(".picture.replace")&&t.$(".picture.replace").removeClass("replace")},500),c.hasClass("replace"))return;t.$(".picture").removeClass("replace"),c.addClass("replace"),p=!0}else if(d.length){if(clearTimeout(i),i=setTimeout(function(){t.$(".shots.replace").removeClass("replace")},500),d.hasClass("replace"))return;t.$(".shots").removeClass("replace"),d.addClass("replace"),p=!0}else{if(!p)return;t.$(".picture.replace")&&t.$(".picture.replace").removeClass("replace"),p=!1}}).bind("fileuploaddrop",function(n){if(t.$(".picture.replace")&&t.$(".picture.replace").removeClass("replace"),(0,ht.default)(n.delegatedEvent.target).closest(".block.can-drop").length)return!1}).bind("fileuploadpaste",function(){let n=window.RM.constructorRouter;if(n.previewMode)return!1;t=n.workspace}).bind("fileuploadadd",function(n,s){let l=s.files&&s.files[0].size,c=s.files&&s.files[0].type;if(s.allowUpload=!1,/^video/.test(c))return;let d=n.delegatedEvent,p=(0,ht.default)(d.target),m=p.closest(".block.picture:not(.no-drag)"),u=p.closest(".block.shots");if(s.files[0].$picture=m,m.length&&(s.files[0].block=(0,W.default)(t.getAllBlocks("picture")).find(function(g){return g.id===m.data("id")})),s.originalFiles.length>1&&s.files[0].block)return alert(le.MSG_UPLOAD_ONLY_SINGLE_FILE),!1;if(!Ge("constructor.newUploadLimits")){if(u.length)return l>le.UPLOAD_SHOTS_SIZE_LIMIT?(alert(s.files[0].uploadError=le.MSG_UPLOAD_SHOTS_SIZE_ERROR),!1):!0}l>le.UPLOAD_IMAGE_SIZE_LIMIT?alert(s.files[0].uploadError=le.MSG_UPLOAD_IMAGE_SIZE_ERROR):Yn.MimeTypeRegExp.test(c)?(s.files[0].name||(s.files[0].name="pasteimage."+c.split("/")[1]),s.allowUpload=!0):alert(s.files[0].uploadError=le.MSG_UPLOAD_IMAGE_SUPPORTED_ERROR)}).bind("fileuploadsubmit",function(n,s){if(!s.allowUpload)return!1;s.files[0].uploading=!0,r=!1,s.files[0].setPictureCallback=W.default.after(2,function(){if(s.files[0].uploading=!1,r)t.page.removeWidgets([s.files[0].wid]);else{let c=t.findBlock(s.files[0].wid);c&&c.changePicture(s.files[0].result,{skipHistory:!0})}clearTimeout(s.files[0].loaderTimeout)});let l=s.files[0].block;l&&(l.showIconLoader(),t.$(".picture.replace")&&t.$(".picture.replace").removeClass("replace")),s.formData={name:"Picture",uploadType:"picture",id:l?l.model.id:"p"+t.page.id,mid:t.mag.get("num_id"),unique:!0}}).bind("fileuploadsend",function(n,s){let l=s.files[0].block;if(l)t.setTempPicture(s.files,l);else{let c={success:function(d){s.files[0].wid=d.id,s.files[0].setPictureCallback();let p=t.findBlock(d.id);p&&(p.skipShowPanel=!0,t.setTempPicture(s.files,p))},error:function(){r=!0,s.files[0].setPictureCallback()}};if(t.spacesController){let d=t.$el,p=d?d.offset():void 0,m=n.delegatedEvent.pageY-(p?p.top:0);t.spacesController.addWidgetAtOffset("picture",m,c)}else{let d={type:"picture",hiddenBeforeUpload:!1};d.hiddenBeforeUpload=!0,t.addWidget(d,c)}}}).bind("fileuploaddone",function(n,s){if(!s||!s.result){console.error("error file upload!");return}let l=s.files[0].block;if(l){l.model.created=!0,l.changePicture(s.result,{save:!1,toHistory:!0}),l=null;let c=t.controls?.findControl("picture_crop");c?.master.select(c)}else s.files[0].result=s.result,s.files[0].setPictureCallback()}).bind("fileuploadfail",function(n,s){(s&&s.jqXHR&&s.jqXHR.status)===500&&alert(le.MSG_UPLOAD_IMAGE_SUPPORTED_ERROR),window.RM.constructorRouter.workspace.hideLoader(),r=!0,s.files[0].setPictureCallback()})});z(this,"getFramePosition",()=>{let t=this.viewport,r=this.mag.getViewportWidth(t),i=Oe.dictionary[t].width;return{x:this.$frame.position().left-(r-i)/2,y:this.$frame.position().top,w:(this.$frame.width()||0)+2,h:(this.$frame.height()||0)+2}});z(this,"getAllBlocks",t=>{let r=W.default.filter(this.blocks,function(n){return!t||n.model.get("type")===t}),i=[];return W.default.each(this.blocks,function(n){W.default.isEmpty(n.child_workspace)||W.default.each(n.child_workspace?.blocks,function(s){(!t||s.model.get("type")===t)&&i.push(s)})}),r.concat(i)});z(this,"getFirstSelectableBlock",t=>this.getAllBlocks(t).filter(n=>n.isSelectable())[0]);z(this,"getAllPacks",()=>Object.entries(this.packs||{}).map(([t,r])=>r));z(this,"getPack",t=>this.packs[t]);z(this,"onResize",()=>{let t=window.RM.constructorRouter.zoom.getZoom(),r=this.mag.getViewportWidth(this.viewport),i=this.page.getViewportParam(this.viewport,"height")*t,n=this.$window.height()||0,s=this.$window.width()||0,l=this.viewport,c=Math.floor(Math.max(Math.ceil((s-r*t)/2),0)/t),d=0,p=0,m=cl();if(l==="default")p=Math.max(Math.ceil((n-i)/2),0)/t,this.$el.css({top:p,left:c,"border-top":"","border-bottom":""});else if(m){let{height:u}=Pr.fitToDevice(r,this.viewport,m);p=Math.max(Math.ceil((n-(t<1?i:u))/2),0)/t,d=Math.max(Math.floor((n-(t<1?i:u))/t)-p,0),this.$el.css({top:0,left:c,"border-top":p+"px solid transparent","border-bottom":d+"px solid transparent"}),document.documentElement.style.setProperty("--phone-viewport-height",`${u}px`)}if(this.position.left=c,this.position.top=p,this.position.bottom=d,this.cachedSizes=void 0,W.default.defer(function(){this.trigger("workspace-resize",this.position)}.bind(this)),W.default.any(this.blocks,function(u){return u.model.get("fixed_position")})){this.redrawPacksFrames(),this.redrawBottomShiftLine();let u=W.default.filter(this.blocks,g=>g.model.get("fixed_position"));this.viewport!=="default"&&u.forEach(g=>g.redrawPosition(void 0,{skipTriggerRedraw:!0})),W.default.invoke(u,"recalcFixedLine")}});z(this,"moveSelected",(t,r)=>{if(this.animationMode){this.animationSteps.moveSelected(t,r);return}let i=t.shiftKey,n=W.default.filter(this.movingBlocks||this.getSelectedBlocks(),p=>!p.isLocked());if(W.default.isEmpty(n))return!1;if(W.default.any(n,function(p){return p.isFullWidth()})&&(0,W.default)(["left","right"]).contains(r)||W.default.any(n,function(p){return p.isFullHeight()})&&(0,W.default)(["up","down"]).contains(r))return;let c=i?10:1,d={deltaY:0,deltaX:0,isClone:!1,isCloneByKeys:!1};switch(r){case"up":d.deltaY=-c;break;case"right":d.deltaX=c;break;case"down":d.deltaY=c;break;case"left":d.deltaX=-c;break}if(this.movingBlocks||(this.movingBlocks=t.altKey?n:void 0,this.movingBlocks&&W.default.each(n,function(p){p.clone()})),this.movingBlocks&&(d.isClone=!0,d.isCloneByKeys=!0,this.movingDelta?(this.movingDelta.deltaX+=d.deltaX,this.movingDelta.deltaY+=d.deltaY):this.movingDelta=W.default.clone(d),this.movingDelta&&(this.movingDelta.deltaXOrig=d.deltaX,this.movingDelta.deltaYOrig=d.deltaY)),!this.movingBlocks&&n.length&&n[0].model.get("type")==="hotspot"&&n[0].tip_workspace.workspaceEditMode)return n[0].moveTip(d);if(n.length===1&&n[0]?.model?.get("type")==="picture"&&n[0].cropmode){n[0].onCropResizeUsingKeyboard&&n[0].onCropResizeUsingKeyboard(t,d),t.stopPropagation(),t.preventDefault();return}if(t.metaKey||t.ctrlKey?(Ru.prototype.resizeBlocks(this,n,d,t,{hideFrameMs:500}),t.stopPropagation(),t.preventDefault()):Ru.prototype.moveBlocks(this,n,this.movingDelta||d,t),this.movingBlocks)this.cloneBlocksDebounced(this.movingBlocks);else{this.redrawPacksFrames({tp:"move"}),this.redrawBottomShiftLine({tp:"move"});let p=this.bottomBlocksToMove;n=[...n,...p&&p.tosave||[]];let m=W.default.map(n,function(u){return W.default.extend({_id:u.id},u.getBoxData())});this.set_group(m),this.saveGroupDebounced(W.default.pluck(n,"model"))}return t.stopPropagation(),t.preventDefault(),this.clearBottomBlocksToMove(),!0});z(this,"changeBlocksOpacity",t=>{let r=W.default.map(this.getSelectedBlocks(),i=>i.model);t===0&&(t=10),W.default.each(r,i=>{switch(i.get("type")){case"button":if(!Ze.isPermissionAllowed("ButtonCanChangeSettings"))break;i.set("background-color-opacity",t*10);break;case"shape":if(!Ze.isPermissionAllowed("ShapeCanChangeSettings"))break;i.set("bg_opacity",t*.1);break;case"picture":if(!Ze.isPermissionAllowed("PictureCanChangeSettings"))break;i.set("opacity",t*.1)}}),this.save_group(r)});z(this,"setViewport",(t,r)=>{if(t===this.viewport)return;this.locked&&(t="default");let i=this.page.get("viewport_"+t);i=i||{};let n=Jp[i.enabled||t==="default"?t:this.viewport]||"Desktop";if(nu(n),!i.enabled&&t!=="default"){window.sessionStorage&&window.sessionStorage.removeItem("constructorViewport");return}let s=this.getSelectedBlocks();this.trigger("deselect",{deselectOnViewportChange:!0});let l=!!this.spacesController;this.spacesController&&this.toggleBundleBlocks(!1),this.page.set("viewport",t,r),l&&this.toggleBundleBlocks(!0),s.length>0&&W.default.defer(()=>{s.map(c=>c.select(!1,{noFrame:s.length>0})),this.trigger("select",s)}),window.sessionStorage.setItem("constructorViewport",t)});z(this,"showUsedViewport",()=>{let t=window.sessionStorage.getItem("constructorViewport")||"default",r=t==="default"||this.page.get(`viewport_${t}`)?.enabled;this.setViewport(r?t:"default")});z(this,"isViewportEnabled",t=>t==="default"||this.page.get(`viewport_${t}`)?.enabled);z(this,"suspendAllBlocks",()=>{for(let t of this.blocks)t.model.suspend()});z(this,"resumeAllBlocks",()=>{for(let t of this.blocks)t.model.resume()});z(this,"onChangeViewport",(t,r)=>{this.updateWorkspaceViewport(t),this.blocks.forEach(i=>i.model.setViewport(r)),window.RM.constructorRouter.trigger("changeViewport",r),this.blocks.filter(i=>i.isFixed()).forEach(i=>i.onFixPosition()),this.blocks.filter(i=>!!i.model.get("sticked")).forEach(i=>i.setStickedDims()),this.checkOneWidgetPacks()});z(this,"saveViewportScroll",t=>{t&&(this.viewportScrolls["scroll-viewport-"+t]=this.$container.scrollTop()||0)});z(this,"saveScroll",()=>{this.viewportScroll=this.$container.scrollTop()||0});z(this,"restoreViewportScroll",t=>{t&&this.$container.scrollTop(this.viewportScrolls["scroll-viewport-"+t]||0)});z(this,"restoreScroll",()=>{this.$container.scrollTop(this.viewportScroll)});z(this,"getScrollTop",()=>this.$container.scrollTop());z(this,"updateWorkspaceViewport",t=>{let r={width:this.mag.getViewportWidth(this.viewport),height:this.page.getViewportParam(this.viewport,"height"),min_height:jr.getViewportSetting("min_height",this.viewport),viewport:this.viewport,device:cl()};if(W.default.isEqual(r,this.oldParams))return;this.$el.attr("data-viewport",r.viewport),r.viewport==="phone_portrait"&&document.documentElement.style.setProperty("--phone-viewport-width",`${r.width}px`),this.$el.css({width:r.width,height:r.height}),this.$origin.css({width:Oe.dictionary[this.viewport].width,height:r.height}),this.onResize(),(!t||!t.hasChanged("viewport"))&&window.RM.constructorRouter.trigger("updateWorkspaceViewport");let i=W.default.findWhere(this.blocks,{name:"Background"});i&&i.onViewportUpdate&&i.onViewportUpdate(r),this.oldParams=r});z(this,"getTriggeredBlocks",t=>t?t.reduce((r,i)=>{let n=this.blocks.filter(s=>{let l=s.getAllAnimationTriggers(),c=s.model.get("triggers");return l.includes(i)||c&&c.includes(i)});return[...r,...n]},[]):[]);z(this,"onWidgetsRemove",t=>{let r=this.getTriggeredBlocks(t);W.default.each(r,i=>{t.indexOf(i.id)===-1&&i.blink(!0)})});z(this,"onWidgetsContextChange",t=>{t=t||[];let r=W.default.map(t,"id"),i=this.getTriggeredBlocks(r),n=t.concat(i),s=[];W.default.each(n,function(l){let c=l.getTriggerBlocks();W.default.each(c,function(d){d&&!Qy.canBeExternalTrigger(d)&&(d.blink(!0),l.removeAllAnimationTriggers(),s.push(l))})}.bind(this))});z(this,"createWidget",(t,r={})=>{if(this.spacesController&&r.y!==void 0)this.spacesController.addWidgetAtOffset(t,r.y);else if(this.spacesController){let i=Math.floor((this.$el.offsetParent()?.height()||0)/2)-(this.$el?.offset()?.top||0);this.viewport!=="default"&&(i-=203),this.spacesController.addWidgetAtOffset(t,i)}else this.addWidget({type:t},{useDefaults:!0})});z(this,"addWidget",(t,r)=>{if(r=r||{},r.group||this.trigger("deselect",{fromAdd:!0}),r.copy&&!r.disableDeleteViewportAttributes&&W.default.each(Oe.viewport_list,s=>{let l=this.page.get(s);W.default.isEmpty(l)&&delete t[s]}),t||(t={}),!t.type){console.error("creating widget with no type");return}r.isMultiple||(window.RM.constructorRouter.trigger("notice:triggerMetrics","countWidgetCreated"),t.type==="text"&&window.RM.constructorRouter.trigger("notice:triggerMetrics","countTextWidgetCreated"),W.default.isEmpty(this.packs)||window.RM.constructorRouter.trigger("notice:triggerMetrics","widgetsGrouped"));let i=t.type.toLowerCase(),n=Eo[i];return r&&r.useDefaults&&W.default.defaults(t,W.default.mapObject(nt(n.defaults),function(s){return W.default.isFunction(s)?s():s})),Oe.types.forEach(s=>{let l=(r.cloningWidgetZIndex||this.getMaxZIndex(s))+1;Object.assign(t,_y(t,{z:l},s))}),t.y=t.y===void 0?this.getDefaultY(t):t.y,t.x=t.x&&t.x==="center"?this.getCenterX(t):t.x,t.y=n.yOffsetOnCreate&&typeof n.yOffsetOnCreate=="number"&&t.y!==void 0?t.y+n.yOffsetOnCreate:t.y,this.page.addWidget(t,r),this.mag.increaseWidgetAddCounter(),t});z(this,"getMaxZIndex",t=>{let i=this.blocks.filter(n=>!n.outofbox).map(n=>{if(t){let s=n.model.toJSON();return t==="default"?s.z:s[t]?.z??s.z}return parseInt(n.model.get("z"))}).reduce((n,s)=>Math.max(s,n),-1/0);return i<=0&&(i=99),i});z(this,"getDefaultY",(t={})=>{let r=t.h||le.widget.defaults.h,i=this.getCachedSizes(),n=window.RM.constructorRouter.zoom.getZoom(),s=i.windowClientHeight||0;return Math.round(s/2/n-r/2+(this.$container.scrollTop()||0)/n-this.position.top)});z(this,"getCenterX",t=>{t=t||{};let r=t.w||le.widget.defaults.w,i=this.$el.width()||0,n=this.$window.width()||0,s=window.RM.constructorRouter.zoom.getZoom();return i*s<=n?Math.round(i/2-r/2):Math.round(n/2/s-r/2+(this.$container.scrollLeft()||0)/s)});z(this,"getViewportPosition",()=>{let t=this.$el.offset()||{left:0,top:0},r=parseFloat(this.$el.css("border-top-width"));return{top:t.top||r?-t.top-r:0,left:t.left?-t.left:0,height:this.$el.parent().height(),width:this.$el.width(),viewportWidth:this.$el.parent().width(),pageHeight:this.page.get("height")}});z(this,"createBlock",(t,r)=>{if(r=r||{},!!W.default.find(this.blocks,function(l){return l.model.id===t.id}))return;let n=this.addBlock(t,r),s=this.blocksToClone&&this.blocksToClone[t.id];this.renderBlock(n,s,{isNew:!0,invisible:r.invisible}),s&&(delete s.$cloneEl,delete this.blocksToClone[t.id]),t._nestedWidgetsJSON&&this.createNestedBlocks(n,t._nestedWidgetsJSON,function(){delete t._nestedWidgetsJSON}),t.isGlobal()||this.trigger("redraw"),!r.undo&&!r.redo&&!r.group&&(!t.isGlobal()||r.is_new_global)&&!r.invisible&&(n.select(!1,{noFrame:r.isMultiple}),this.triggerSelectOnSelectedBlockDebounced()),n?.model&&n.model.get("type")==="picture"&&r?.copy&&n.checkLambdaUrlSetCorrectly&&n.checkLambdaUrlSetCorrectly({func:"createBlock-pasteBlock"})});z(this,"triggerSelectOnSelectedBlock",()=>{let t=this.getSelectedBlocks();!t||!t.length||this.trigger("select",t)});z(this,"renderMissedWidgets",()=>{this.page.widgets.chain().reject(t=>t.isGlobal()||!this.page.get("wids").includes(t.id)).map(t=>{let r=this.findBlock(t.get("_id"));r||(r=this.addBlock(t),this.renderBlock(r))})});z(this,"addBlock",(t,r)=>{let i=Eo[t.get("type")],n=hi({target:t,viewport:r?.viewport||this.viewport,pageId:this.page.id,disposable:!1,minimalViewports:et.canUseMinimalViewport()}),s=new i(n,this);return r?.invisible&&s.$el.addClass("invisible"),this.blocks.push(s),this.trigger("block:create",s,r),s});z(this,"renderBlock",(t,r,i)=>{if(t.render(i),i?.invisible&&t.$el.addClass("invisible"),t.model.get("sticked")){let n=t.getStickedDims();t.model.set({x:n.x,y:n.y})}t.outofbox||t.redrawPosition(t.model,{forceRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),r&&W.default.isObject(r)&&(r.$cloneEl&&r.$cloneEl.remove(),r.name==="Shape"&&r.redrawShape(r.model.get("w"),r.model.get("h")))});z(this,"removeBlock",t=>{let r=W.default.find(this.blocks,function(i){return i.model.id===t.id});r&&(this.blocks=W.default.without(this.blocks,r),this.trigger("block:remove",r),r.destroy(),r.model.stopListening(),this.redrawPacksFrames({tp:"remove"}),this.redrawBottomShiftLine({tp:"remove"}))});z(this,"selectAllBlocks",()=>{Ze.isPermissionAllowed("BaseWidgetCanSelectMultiple")&&(this.disabledSelectMultiple||this.selectBlocks({x:-5e4,y:-5e4,w:1e5,h:201600},{merge:!1}))});z(this,"selectListBlocks",(t,r)=>{if(!Ze.isPermissionAllowed("BaseWidgetCanSelectMultiple")||this.disabledSelectMultiple)return;let i=W.default.flatten(W.default.difference(W.default.intersection(t,r),r));W.default.each(i,function(n){n.deselect()}),W.default.each(t,function(n){n instanceof Array?n[0].selectFromWidgetBar({shiftKey:!0},!0):n.select(!0)}),this.trigger("select",this.getSelectedBlocks(),W.default.flatten(i))});z(this,"selectBlocks",(t,r)=>{r=r||{};let i=6,n=this.viewport,s=W.default.filter(this.blocks,function(u){return u.isSelectable()&&u.inArea(t)});if(s=W.default.filter(s,function(u){return!!(!u.isLocked()||r?.includeLocked)}),n!=="default"&&s.length>1&&window.RM.constructorRouter.trigger("notice:triggerMetrics","mobileGroupSelected"),r?.selectOnlyFrontmostBlock&&s.length>0){let u=s.reduce((g,h)=>h.currentZ>g.currentZ?h:g);u&&(s=[u])}let l=["Shape","Picture","Button","Text"],c=W.default.map(s,u=>u.name),d=W.default.uniq(c);c.length>=2&&d.length===1&&l.includes(d[0])&&n==="default"&&window.RM.constructorRouter.trigger("notice:triggerMetrics","multipleWidgetsOfSameTypeSelected");let p=W.default.filter(this.packs||{},function(u){let g=u.getBoxData(),h=g.y,b=g.b;if(u.isFixed()){let x=this.$container.scrollTop();h+=x,b+=x}return Math.max(t.x,g.x)<Math.min(t.x+t.w,g.r)&&Math.max(t.y,h)<Math.min(t.y+t.h,b)}.bind(this));if(r?.selectOnlyFrontmostBlock&&p.length>0){let u=p.reduce((g,h)=>{let b=h.blocks.reduce((S,y)=>y.currentZ>S.currentZ?y:S),x={pack:h,maxZIndex:b.currentZ};return x.maxZIndex>g?.maxZIndex?x:g},{pack:{},maxZIndex:-1/0});Object.keys(u.pack).length>0&&u.maxZIndex>-1/0&&(p=[u.pack],s=[])}W.default.each(p,W.default.bind(function(u){s=W.default.union(s,W.default.filter(this.getPackBlocks(u.id),function(g){return!!(!g.isLocked()||r?.includeLocked)}))},this)),s=W.default.uniq(s);let m;r.merge||(W.default.isEmpty(s)?this.getSelectedBlocks().length?(m=this.controls?.canControlsBeClosed(),(!this.controls||m)&&this.trigger("deselect")):t.w<=i&&t.h<=i&&this.trigger("whitespace_click"):this.trigger("deselect")),W.default.defer(function(){let u=[],g=r?.merge?s.length-W.default.filter(s,x=>x.selected).length>1:s.length>1;W.default.each(s,function(x){r?.merge&&x.selected?(x.deselect(),u.push(x)):x.select(!1,{noFrame:g})});let h=r?.merge?this.getSelectedBlocks():s,b=this.redefineSelection(h,u);W.default.isEmpty(b.selected)?(!this.controls||m===null&&this.controls.canControlsBeClosed()||m)&&this.trigger("deselect"):this.trigger("select",b.selected,b.deselected)}.bind(this))});z(this,"onPackClick",t=>{let r=window.RM.constructorRouter.zoom.getZoom(),i=this.getCachedSizes(),n=this.viewport,s=Oe.dictionary[n].width;this.selectBlocks({x:(t.pageX-((i.width||0)-s*r)/2)/r,y:(t.pageY+(this.$container.scrollTop()||0)-this.position.top)/r,w:1,h:1},{merge:t.shiftKey,includeLocked:!0,selectOnlyFrontmostBlock:!0})});z(this,"redefineSelection",(t,r,{ignorePacks:i=!1}={})=>{if(!Ze.isPermissionAllowed("BaseWidgetCanSelectMultiple"))return{selected:[t[0]],deselected:[]};if(this.disabledSelectMultiple)return{selected:[t[0]],deselected:[]};if(t&&!W.default.isArray(t)&&(t=[t]),r&&!W.default.isArray(r)&&(r=[r]),t=t||[],r=r||[],i)return{selected:W.default.difference(t,r),deselected:r};let n=W.default.uniq(W.default.compact(W.default.map(t,function(c){return c.model.get("pack_id")}))),s=[];W.default.each(n,W.default.bind(function(c){s=W.default.union(s,this.getPackBlocks(c))},this)),s=W.default.difference(s,t),W.default.each(s,function(c){c.select(!1,{noFrame:!0})}),t=W.default.union(t,s);let l=W.default.uniq(W.default.compact(W.default.map(r,function(c){return c.model.get("pack_id")})));return s=[],W.default.each(l,W.default.bind(function(c){s=W.default.union(s,this.getPackBlocks(c))},this)),W.default.each(s,function(c){c.deselect()}),r=W.default.union(r,s),t=W.default.difference(t,r),{selected:t,deselected:r}});z(this,"redrawPacksFrames",(t={})=>{Ze.isPermissionAllowed("BaseWidgetCanSelectMultiple")&&(this.disabledSelectMultiple||this.redrawPacksFramesHolded||(this.redrawPacksFramesHolded=!0,window.requestAnimationFrame(()=>this._redrawPacksFrames(t))))});z(this,"_redrawPacksFrames",(t={})=>{this.redrawPacksFramesHolded=!1;let r=this.getSelectableBlocks(),i={},n=W.default.map(this.packs,function(m){return m.export()}),s=(m,u)=>{if(!i[m]){let h=this.packs[m];h?(h.reset(),i[m]=h):i[m]=new tc({id:m,workspace:this})}i[m].addBlock(u,{noSizeConstraints:t.tp&&["move","select"].includes(t.tp)})};W.default.each(r,function(m){let u=m.model.get("pack_id");m.selected&&this.getSelectedBlocks().length>1&&s("selected",m),u&&s(u,m)},this);let l=W.default.map(i,function(m){return m.export()}),c=W.default.any(this.blocks,function(m){return m.model.get("fixed_position")});if(W.default.isEqual(n,l)&&!c)return;let d=this.$el.children().first();W.default.each(this.packs,function(m){W.default.has(i,m.id)||m.destroy()}.bind(this));let p=m=>m.blocks.every(u=>i.selected?.blocks.find(g=>g===u));W.default.each(i,function(u){u.rendered||(d.append(u.render()),this.listenTo(u,"click",this.onPackClick.bind(this))),u.update({isInSelectionWithOthers:u.id!=="selected"&&p(u)})}.bind(this)),this.packs=i,this.checkBundleDragAbility()});z(this,"getPackBlocks",t=>W.default.filter(this.blocks,function(r){return r.model.get("pack_id")===t}));z(this,"checkOneWidgetPacks",()=>{let t=W.default.groupBy(this.getExistingWidgets(),function(r){return r.get("pack_id")?r.get("pack_id"):0});W.default.each(t,function(r,i){i!=="0"&&r.length===1&&r[0].save("pack_id",null,{patch:!0})})});z(this,"onSelect",()=>{this.redrawPacksFrames({tp:"select"}),this.redrawBottomShiftLine({tp:"select"});let t=Ht();t.step?.name==="MobileMenuVisible"&&!this.getSelectedBlocks()[0].model.get("hidden")&&He(["MobileMenuVisible"]),t.step?.name==="FixMenuClickOutside"&&He(["FixMenuClickOutside"]),t.step?.name==="BeforeAddAnimations"&&this.getSelectedBlocks().length===2&&He(["BeforeAddAnimations"])});z(this,"onDeselect",t=>{let r=Ht();W.default.chain(this.blocks).where({selected:!0}).invoke("deselect",t),W.default.defer(function(){this.redrawPacksFrames({tp:"deselect"}),this.redrawBottomShiftLine({tp:"deselect"}),r.started&&r.step?.name==="EverythingInItsRightPlace"&&He(["EverythingInItsRightPlace"]),r.started&&r.step?.name==="DeselectAfterSetBlocksDistance"&&He(["DeselectAfterSetBlocksDistance"]),this.restoreFocusForCopyPaste()}.bind(this))});z(this,"restoreFocusForCopyPaste",()=>{(0,ht.default)(".copyhack").selectText()});z(this,"preloadBlocks",()=>{this.blocks.forEach(t=>t.preload?.())});z(this,"getSelectedBlocks",()=>W.default.filter(this.blocks,function(t){return t.selected}));z(this,"deselectBlocksExcept",t=>{this.getSelectedBlocks().filter(r=>r!==t).forEach(r=>r.deselect())});z(this,"getActiveBlocks",()=>this.blocks.filter(function(t){return!t.model.get("hidden")}));z(this,"getSelectableBlocks",()=>this.blocks.filter(function(t){return!t.model.get("hidden")&&!t.outofbox}));z(this,"getExistingWidgets",()=>(0,W.default)(this.blocks).chain().pluck("model").value());z(this,"save_group",(t,r)=>{this.set_group(t,r,!0)});z(this,"set_group",(t,r,i)=>{let n=this.viewport;if(Ge("constructor.saveMixedGroup")){let s=t;if(Array.isArray(t)){let l=t.map(c=>{if(c?.getWidget)return{update:c.getWidget()};if(c instanceof yc.default.Model)return{update:c};{let d=c,p=d._id,m;for(let u of this.blocks||[])if(u.model.id===p){m=u?.model;break}else if(u.child_workspace){let g=u.child_workspace?.blocks?.find(h=>h.model.id===p);if(g){m=g?.model;break}}return Ge("widget.anomalyMonitoring")&&m&&m.viewport==="default"&&n!==m.viewport&&sc.sendEvent({type:"setInMismatchedViewport",widget:m.toJSON(),payload:d}),m?m.normalizeUpdate(d,r):{update:d}}});s=l.map(({update:c})=>c),r=l[0]?.options?l[0].options:r}else s=t;i?this.syncManager.saveGroup(s,r):this.syncManager.setGroup(s,r)}else{let s=t;if(Array.isArray(t)&&t[0]?.getWidget)s=t.map(l=>l.getWidget());else if(Array.isArray(t)&&t.length&&!(t[0]instanceof yc.default.Model)){let l=t.map(c=>{let d=c._id,p;for(let m of this.blocks||[]){let u=m.model.id===d;if(u){p=m?.model;break}else if(!u&&m.child_workspace){let h=m.child_workspace?.blocks?.find(b=>b.model.id===d);if(h){p=h?.model;break}}}return Ge("widget.anomalyMonitoring")&&p&&p.viewport==="default"&&n!==p.viewport&&sc.sendEvent({type:"setInMismatchedViewport",widget:p.toJSON(),payload:c}),p?p.normalizeUpdate(c,r):{update:c}});s=l.map(c=>c.update),r=l.length?l[0].options:r}i?this.syncManager.saveGroup(s,r):this.syncManager.setGroup(s,r)}});z(this,"changeVisibilityForSelectedBlocks",()=>{let t=this.getSelectedBlocks(),r=[],i=!1;t.forEach(n=>{let s=n.model.get("hidden");s&&(i=!0),r.push({_id:n.model.get("_id"),hidden:s})}),i?r.forEach(n=>n.hidden=!1):r.forEach(n=>n.hidden=!0),this.save_group([...r]),this.selectListBlocks(t,[])});z(this,"changeLockForSelectedBlocks",()=>{let t=this.getSelectedBlocks(),r=[],i=!1;for(let n of t){let s=n.model.get("is_locked"),l=n.model.get("_id");s&&(i=!0),r.push({_id:l,is_locked:s})}i?r.forEach(n=>n.is_locked=!1):r.forEach(n=>n.is_locked=!0),this.save_group(r)});z(this,"toggleWidgets",t=>{t=t||{};let r=[],i=[];W.default.each(t.wids||[],W.default.bind(function(s){let l=this.page.widgets.get(s)||this.mag.globalWidgets.get(s);l&&r.push({_id:l.get("_id"),hidden:!!t.hidden})},this));let n=this.getBlocksThatOnlyOnesInGroupByChangeset(r);n.length>0&&(i=n.map(s=>({_id:s.get("_id"),pack_id:null}))),this.save_group([...r,...i])});z(this,"deleteSelectedBlocks",()=>{if(!Ze.isPermissionAllowed("BaseWidgetCanDelete"))return;if(this.animationMode){this.animationSteps.removeSelected();return}let t=Ht(),r=this.getSelectedBlocks();this.deleteBlocks(r),this.deletedWidgetsCount=this.deletedWidgetsCount+r.length,t.step?.name==="SelectBlocksAndDelete"&&this.deletedWidgetsCount>=6&&He("SelectBlocksAndDelete"),He(["DeleteBlocks"]),r.forEach(n=>{this.deleteCommentsFromBlock(n.model.get("_id"))})});z(this,"getBlocksThatOnlyOnesInGroupByChangeset",t=>{let r=[];return t.forEach(n=>{let s=this.blocks.findIndex(l=>l.model.get("_id")===n._id);s!==-1&&r.push(this.blocks[s])}),this.getBlocksThatOnlyOnesInGroup(r)});z(this,"getBlocksThatOnlyOnesInGroup",(t,r=!1)=>{let i=[],n={};t?.forEach(s=>{let l=s.model.get("_id"),c=s.getPack();s.model.isGlobal()||c&&(n[c.model.cid]?n[c.model.cid]=n[c.model.cid].filter(d=>d.model.get("_id")!==l):n[c.model.cid]=[...c.blocks.filter(d=>d.model.get("_id")!==l)])});for(let s in n)if(n[s].length===1){let l=n[s][0];l.model&&r&&l.model.set({pack_id:null}),i.push(l.model)}return i});z(this,"deleteBlocks",(t,r={})=>{if(!Ze.isPermissionAllowed("BaseWidgetCanDelete"))return;let i=this.viewport,n=W.default.pluck(t,"model"),s={},l=new yc.default.Collection,c=!1;(0,W.default)(n).each(function(p){let m=!1;r.forceRemove||(m=p.isGlobal()&&i!=="default");let u=m?this.page:this.mag.getPage(p.get("pid"));u&&(l.add(u),s[u.id]=(s[u.id]||[]).concat(p.id),p.get("type")==="ecommercecart"&&!m&&(c=!0))},this),W.default.each(s,function(p,m){this.mag.getPage(m).removeWidgets(p,{nosave:!0,viewport:this.viewport,...r})},this),c&&this.eCommerceManager.setCartWidgetExistState(!1);let d=i==="default"?this.getBlocksThatOnlyOnesInGroup(t,!0):[];l.isEmpty()||this.save_group([...l.models,...d],{page:this.page.id})});z(this,"pastePreset",(t,r={})=>{let i=nt(t),n=this.viewport;if(r.customLayersName){let d=r.customLayersName,p=[...i.blocks.filter(m=>!m.pack_id),...i.packs??[]];for(let m of p)m.name=d}let{left:s,top:l}=ct.mapFromViewportToElement({top:window.innerHeight/2,left:window.innerWidth/2},this.$origin.get(0),1,window.RM.constructorRouter.zoom.getZoom()),c=d=>{let p={t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY};return d.forEach(m=>{p.t=Math.min(p.t,m.y),p.l=Math.min(p.l,m.x),p.b=Math.max(p.b,m.y+m.h),p.r=Math.max(p.r,m.x+m.w)}),{x:p.l,y:p.t,w:p.r-p.l,h:p.b-p.t}};Oe.viewport_listall.forEach(d=>{let p=i.blocks.filter(m=>{let u=d==="viewport_default"?m:m[d]??m;return!u.hidden&&!u.fixed_position});if(p.length){let m=c(p.map(b=>{let x=d==="viewport_default"?b:b[d]??b;return{h:x.h??b.h,w:x.w??b.w,x:x.x??b.x,y:x.y??b.y}})),u=m.x,g=m.y;d===`viewport_${n}`&&(u-=s-m.w/2,g-=l-m.h/2),i.blocks.forEach(b=>{d!=="viewport_default"&&!b[d]&&(b[d]={x:b.x,y:b.y,pack_id:b.pack_id});let x=d==="viewport_default"?b:b[d];x.fixed_position||(x.y=Math.floor((x.y??b.y)-g),x.x=Math.floor((x.x??b.x)-u))})}}),this.pasteBlocks(i,{disablePositionY:!0,...r})});z(this,"pasteBlocks",(t,r={})=>{let i=t.object==="rm_figma_pastedata";if(!Ze.isPermissionAllowed("BaseWidgetCanAdd"))return;let n=[...t.blocks],s=n&&n.length&&n.length>1,l=10,c=n[0].pid===this.page.get("_id"),d=t.mag_num_id!==this.mag.get("num_id");if(this.trigger("deselect"),!n||!n.length){console.error("cannot paste empty array of blocks!");return}let p=n.reduce((C,P)=>(C.push(P.pack_id),C.push(P.viewport_phone_portrait?.pack_id),C.push(P.viewport_tablet_portrait?.pack_id),C),[]).filter(Boolean),u=W.default.unique(p).reduce((C,P)=>(C[P]=et.generateUUID(),C),{}),g={},h={},b={},x={viewport_default:[],viewport_phone_portrait:[],viewport_tablet_portrait:[]};n=W.default.sortBy(n,function(C){return C.z}),n.forEach(C=>{C?._id||(C._id=Un()),x.viewport_default.push(C._id)}),Oe.viewport_list.forEach(C=>{W.default.sortBy(t.blocks,v=>v[C]?.z??v.z).forEach(v=>{x[C].push(v._id)})}),d&&(this.mag.mergeEditParams(t.mag_edit_params),t.mag_edit_params&&_u({newTextStyles:t.mag_edit_params.textStyles||[],newLinkStyles:t.mag_edit_params.linkStyles||[],newListStyles:t.mag_edit_params.listStyles||[]}));let S=nf(n),y=W.default.bind(function(C){try{let P=n[C];P&&P.type==="text"&&P.version!==3&&(P=bk(P));let v=P?._id,T=nt(P);if(!T){if(this.page.groupSaveWids(this.getExistingWidgets()),this.handleAnimationTriggerClone(S,b),this.handleRestoreViewportIndex(x),i){let A=Object.values(b);this.blocks.filter(j=>A.includes(j.id)).forEach(j=>{j.$el.removeClass("invisible"),j.select()}),this.triggerSelectOnSelectedBlockDebounced()}r?.onComplete?.();return}let I=this.getDefaultY(T);delete T._id,delete T.id,delete T.__v,delete T.pid,r.disableDeleteGlobalAttributes||(delete T.is_global,delete T.is_above),T.pack_id&&(T.pack_id=u[T.pack_id]),W.default.each(Oe.viewport_list,A=>{let $=T[A];if($){let j=$.pack_id;$.pack_id=u[j]}});let M=T.hotspots_group_id;M&&(g[M]=g[M]||et.generateUUID(),T.hotspots_group_id=g[M]),this.handleAnimationGroups(T,h),r.disablePositionY||(T._variationY!==void 0&&!T.fixed_position&&(T.y=I+T._variationY,delete T._variationY),c&&T.x!==void 0&&T.y!==void 0&&(T.x+=l,T.y+=l,W.default.each(Oe.viewport_list,A=>{let $=T[A];$&&($.x+=l,$.y+=l)})));let D=nt(T._nestedWidgetsJSON);delete T._nestedWidgetsJSON;let E=function(A){D&&(A._nestedWidgetsJSON=D,this.createNestedBlocks(this.findBlock(A.id),D,function(){delete A._nestedWidgetsJSON})),b[v]=A.id,Oe.viewport_listall.forEach($=>{let j=x[$].indexOf(v);x[$][j]=A.id}),y(C+1)}.bind(this);this.addWidget(nt(T),{copy:!0,group:!0,isMultiple:s,success:E,error:E,...r}),r?.onBlockAdded?.()}catch(P){throw r?.onError?.(),P}},this);if(y(0),t.packs?.length){let C=t.packs.map(P=>({...P,pack_id:u[P.pack_id],_id:void 0,mid:this.mag.id}));C.filter(P=>P.name||P.atomic).map(P=>{new la(P).save()}),this.mag.set("packs",this.mag.get("packs").concat(C))}});z(this,"handleRestoreViewportIndex",t=>{let i=t.viewport_default.map(b=>this.findBlock(b)).filter(Boolean).map(b=>b.model),n=this.page,s=n.getViewportParam("tablet_portrait","enabled"),l=n.getViewportParam("phone_portrait","enabled"),c=[],d=[];s&&c.push("tablet_portrait"),l&&c.push("phone_portrait");let p=t.viewport_default||[],m=t.viewport_tablet_portrait||[],u=t.viewport_phone_portrait||[];$s(p,m)&&d.push("tablet_portrait"),$s(p,u)&&d.push("phone_portrait"),[{viewport:"phone_portrait",key:"viewport_phone_portrait"},{viewport:"tablet_portrait",key:"viewport_tablet_portrait"}].forEach(({viewport:b,key:x})=>{let S=t[x],y=c.includes(b);d.includes(b)&&!y||(y||window.RM.constructorRouter.indexController.addWidgetsToDisabledViewport(n.id,i,b),S.forEach((C,P)=>{let v=i.find(I=>I.get("_id")===C),T=v.toJSON(),R=(T[x]?.z??T.z)+P;window.RM.constructorRouter.indexController.moveWidget(n,[v],R,b)}))});let h=window.RM.constructorRouter.indexController.getFullOrder()[n.id];h&&n.save({order:nt(h)},{silent:!0,skipHistory:!0,patch:!0})});z(this,"cloneBlocks",(t,r)=>{if(!Ze.isPermissionAllowed("BaseWidgetCanAdd"))return;if(delete this.movingBlocks,delete this.movingDelta,!t||!t.length)return console.error("cannot clone empty array of blocks");W.default.each(t,d=>{let p=window.RM.constructorRouter.indexController.getZIndex(d.model.id,this.page.id,this.viewport);d._z=p||d.model.get("z")}),t=W.default.sortBy(t,d=>d._z),this.blocksToClone=this.blocksToClone||{};let i={},n={},s={};r=r||{};let l=nf(t),c=W.default.bind(function(d){let p=t[d],m=p&&p.id;if(!p){this.page.groupSaveWids(this.getExistingWidgets(),W.default.extend(W.default.clone(r),{clone:!0})),this.handleAnimationTriggerClone(l,s);return}let u=p.model.cloneJSON();u=W.default.omit(u,W.default.union(["_id","id","__v"])),p._z&&(u.z=p._z,delete p._z),u.is_global&&(u.is_global=!1),u.is_above&&(u.is_above=!1),W.default.each(Oe.viewport_list,function(b){if(!u[b])return;let x=u[b].pack_id;x&&(i[x]=i[x]||et.generateUUID(),u[b].pack_id=i[x])});let g=u.pack_id;if(g&&(i[g]=i[g]||et.generateUUID(),u.pack_id=i[g]),this.handleAnimationGroups(u,n),p.$cloneEl||r?.offset){let b=p.getBoxData({includeRotationData:!0}),x,S,y;p.$cloneEl&&(x=p.$el.offset(),S=p.$cloneEl.offset()),W.default.each(Oe.viewport_listall,function(C){if(C==="viewport_default")y=u;else{if(!u[C])return;y=u[C]}let P,v;if(p.$cloneEl?(P=(S.left-x.left)*(y.fixed_position&&y.fixed_position.indexOf("e")>-1?-1:1),v=(S.top-x.top)*(y.fixed_position&&y.fixed_position.indexOf("s")>-1?-1:1)):(P=r?.offset.x??0,v=r?.offset.y??0),"x"in y||(y.x=b.x),"y"in y||(y.y=b.y),y.x+=P,y.y+=v,(y.type==="hotspot"&&y.flags?.tipFreePosition||!1)&&(y.tip_x+=P,y.tip_y+=v),y.sticked){let I=y.sticked==="left"||y.sticked==="right"?S.left-x.left:S.top-x.top;(y.sticked==="right"||y.sticked==="bottom")&&(I*=-1),y.sticked_margin=(y.sticked_margin||0)+I}})}let h=function(b){p.getNestedWidgetsJSON&&(b._nestedWidgetsJSON=p.getNestedWidgetsJSON(!0)),s[m]=b.id,c(d+1)}.bind(this);this.addWidget(u,W.default.extend(W.default.clone(r),{silent:!0,clone:!0,group:!0,cloningWidgetZIndex:u.z||p.attributes.z,success:W.default.bind(function(b){this.blocksToClone[b.id]=p,h(b)},this),error(b){h(b),p.$cloneEl&&p.$cloneEl.remove(),delete p.$cloneEl}}))},this);this.trigger("deselect"),c(0)});z(this,"handleAnimationGroups",(t,r)=>{Oe.viewport_listall.forEach(i=>{let n=i==="viewport_default"?t.animation:t[i]&&t[i].animation;if(n){let s=ll.normalizeAnimations(n).map(l=>l.UUID?(r[l.UUID]=r[l.UUID]||et.generateUUID(),{...l,UUID:r[l.UUID]}):l);i==="viewport_default"?t.animation=s:t[i].animation=s}})});z(this,"handleAnimationTriggerClone",(t,r,i)=>{if(t.length){let n=Jy(t,r,i||this.blocks);W.default.each(n,function(l){l.selected&&l.model.trigger("animation:trigger:add")});let s=n.map(l=>l.model);Promise.all(s.map(l=>this.syncManager.whenModelReady(l))).then(()=>this.save_group(s,{skipHistory:!0}))}});z(this,"onReturnFromPreview",()=>{this.$("svg").hide(),W.default.delay(W.default.bind(function(){this.$("svg").show()},this))});z(this,"clearBottomBlocksToMove",()=>{this.bottomBlocksToMove&&(delete this.bottomBlocksToMove.list,delete this.bottomBlocksToMove.tosave,delete this.bottomBlocksToMove.deltaYcorrection,delete this.bottomBlocksToMove.prevDeltaY)});z(this,"redrawBottomShiftLine",t=>{let r=()=>{this.$bottomShiftLine&&this.$bottomShiftLine.remove(),delete this.$bottomShiftLine},i=c=>{this.$bottomShiftLine||(this.$bottomShiftLine=(0,ht.default)('<div class="bottom-shift-line"></div>').appendTo(this.$el.children().first())),this.$bottomShiftLine.css("top",c)};t=t||{};let n=this.bottomBlocksToMove;if(!n||!n.active||t.hide){r();return}t.tp==="move-unselected-start"&&(this._unselectedBlocksForBottomLine=t.blocks),t.tp==="move-unselected-end"&&delete this._unselectedBlocksForBottomLine;let s=this._unselectedBlocksForBottomLine||W.default.filter(this.getSelectedBlocks(),function(c){return!c.isLocked()});if(s.length===1&&(s[0].frame.rotationState||s[0].animationMode)){r();return}let l=W.default.reduce(s,function(c,d){return!d.model.get("fixed_position")&&!d.outofbox?n.fPressed?Math.min(c||99999999,d.latestPosSizeAngle.bb_top):Math.max(c||-99999999,d.latestPosSizeAngle.bb_top+d.latestPosSizeAngle.bb_height-1):c},void 0);l===void 0?r():i(l)});z(this,"checkBundleDragAbility",()=>{if(this.spacesController)return;let t=this.blocks.filter(u=>!u.model.get("pack_id")).concat(this.getAllPacks()),r=this.getAllPacks().filter(u=>u.isSelected()),i=this.getSelectedBlocks().concat(r),n,s,l=999999,c=0,d=W.default.map(i,function(u){return{b:u,bb:u.getBoxData({includeBoundingBox:!0})}});W.default.each(d,function(u){l>u.bb.bb_y&&(l=u.bb.bb_y,n=u),c<u.bb.bb_y+u.bb.bb_h&&(c=u.bb.bb_y+u.bb.bb_h,s=u)});let p=!1,m=!1;W.default.each(t,function(u){if(u.model.get("fixed_position")||u.model.get("sticked")||u.outofbox||W.default.contains(i,u))return;let g=u.getBoxData({includeBoundingBox:!0});g.bb_y>c&&(m=!0),g.bb_y>l&&(p=!0)}),W.default.each(d,function(u){u.b.$el.removeClass("bundle-allow-top"),u.b.$el.removeClass("bundle-allow-bottom"),p&&n&&Math.abs(n.bb.bb_y-u.bb.bb_y)<.1&&u.b.$el.addClass("bundle-allow-top"),m&&s&&Math.abs(s.bb.bb_y+s.bb.bb_h-(u.bb.bb_y+u.bb.bb_h))<.1&&u.b.$el.addClass("bundle-allow-bottom")})});z(this,"calcBottomBlocksToMove",(t,r)=>{let i=[],n=[],s=W.default.reduce(t,function(c,d){return!d.model.get("fixed_position")&&!d.outofbox?r.fPressed?Math.min(c||99999999,d.latestPosSizeAngle.bb_top):Math.max(c||-99999999,d.latestPosSizeAngle.bb_top+d.latestPosSizeAngle.bb_height):c},void 0),l=jr.getViewportSetting("min_height",this.viewport);if(s!==void 0){i=W.default.filter(this.blocks,function(p){return p.model.get("fixed_position")||p.model.get("sticked")||p.model.get("is_locked")||p.outofbox||W.default.contains(t,p)?!1:s>p.latestPosSizeAngle.bb_top?(p.model.get("hidden")||(l=Math.max(p.latestPosSizeAngle.bb_top+p.latestPosSizeAngle.bb_height,l)),!1):(n.push(p.getBoxData({includeBoundingBox:!0})),!0)}),i=i.filter(p=>{let m=p.model.get("pack_id"),u=this.packs[m];return!u||u.blocks.length===i.filter(g=>g.model.get("pack_id")===m).length}),n=i.map(p=>p.getBoxData({includeBoundingBox:!0})),l=Math.round(l);let c=W.default.uniq(W.default.compact(W.default.map(i,function(p){return p.model.get("pack_id")}))),d=[];W.default.each(c,W.default.bind(function(p){d=W.default.union(d,this.getPackBlocks(p))},this)),d=W.default.difference(d,i),d=W.default.filter(d,function(p){return p.model.get("fixed_position")||p.outofbox||p.model.get("sticked")||p.model.get("is_locked")?!1:(n.push(p.getBoxData({includeBoundingBox:!0})),!0)}),i=W.default.union(i,d)}return{list:i,minPageHeight:l,initPageHeight:this.page.getViewportParam(this.viewport,"height"),initial:n}});z(this,"onSpecialKey",t=>{this.checkBundleDragMode(t),!this.widgetResizingOrRotating&&Ze.isPermissionAllowed("BaseWidgetCanAdd")&&(t.type==="keydown"&&t.altKey&&(0,ht.default)("html").addClass("alt-key-pressed"),t.type==="keyup"&&t.keyCode===ht.default.keycodes.alt&&(0,ht.default)("html").removeClass("alt-key-pressed"))});z(this,"findBlock",t=>W.default.find(this.blocks,function(r){return r.model.id===t}));z(this,"getPageNum",()=>this.mag.getPageNum(this.page.id));z(this,"getPageId",()=>this.page.id);z(this,"findPage",t=>{let r=this.getPageNum()??1;return t==="next"&&(r+=1),t==="prev"&&(r-=1),this.mag.getPageId(r.toString(),{onlyActive:!0})});z(this,"showLoader",t=>{this.loader.css(t).fadeIn(100)});z(this,"insertLoaderToElem",(t,r)=>this.loader.clone().css(W.default.extend({position:"absolute"},r)).prependTo(t).fadeIn(100));z(this,"hideLoader",()=>{this.loader.fadeOut(100),this.trigger("hideLoader")});z(this,"getTemplateJSON",(t={})=>{let r=[],i=[],n=W.default.chain(this.page.toJSON()).omit("__v","num_id","hidden","custom_shares","seo").value();return t.withGlobalWidgets&&(n.wids=n.wids?W.default.uniq(n.wids.concat(this.mag.globalWidgets.map(l=>l.get("_id")))):[]),t.withGlobalWidgets?W.default.each(n.wids||[],l=>{let c=(0,W.default)(this.blocks).find(function(p){return p.id===l&&!p.model.isGlobal()});c&&r.push(s(c));let d=(0,W.default)(this.blocks).find(function(p){return p.id===l&&p.model.isGlobal()});d&&!i.map(p=>p.id).includes(d.id)&&i.push(s(d))}):W.default.each(n.wids||[],l=>{let c=(0,W.default)(this.blocks).find(function(d){return d.id===l&&!d.model.isGlobal()});c&&r.push(s(c))}),n.wids=r,n.globalWids=i,n.mag_num_id=this.mag.get("num_id"),n.has_globals=!this.mag.globalWidgets.isEmpty(),n.options=t,n;function s(l){let c=l.model,d=W.default.chain(c.toJSON()).omit("__v","pid").value();return l.getNestedWidgetsJSON&&(d.wids=l.getNestedWidgetsJSON(!0)),d}});z(this,"toggleBorder",({guidesOn:t=!1,columnCount:r=0,margin:i={},willResize:n=!1})=>{this.$border.toggleClass("ghost",!t);let s=Ge("constructor.borderAlwaysVisible")?!window.RM.constructorRouter.zoom.isScaledZoomEnabled():!1;t?this.$border.css({opacity:"","border-top":r&&!i.top?"none":"","border-right":r&&!i.right?"none":"","border-bottom":r&&!i.bottom?"none":"","border-left":r&&!i.left?"none":""}):this.viewport!=="default"||n||s?this.$border.css({opacity:1,"border-top":"","border-right":"","border-bottom":"","border-left":""}):this.$border.css({opacity:0})});z(this,"toggleBlocksEditParams",()=>{if(!this.rendered)return;this.triggerNextHelpTourStep();let t=!!this.mag.edit_params.get("blocks");t&&se(he.BlocksMode,{settingsType:"on"}),this.toggleBundleBlocks(t)});z(this,"toggleBundleBlocks",t=>{t=t===void 0?!this.spacesController:t,!t&&this.spacesController?(this.spacesController?.destroy(),this.spacesController=void 0):t&&!this.spacesController&&(this.spacesController=new l2(this))});z(this,"onGuidesChange",()=>{this.triggerNextHelpTourStep()});z(this,"triggerNextHelpTourStep",()=>{let t=Ht();t.started&&t.step?.name==="DisableBlocksAndGrid"&&!(this.mag.edit_params.get("blocks")||this.mag.edit_params.get("guides"))&&He("DisableBlocksAndGrid")});z(this,"updateLockState",()=>{let t=this.page.get("_id");this.locked=!!window.RM.constructorRouter.isPageLocked(t),this.$origin.toggleClass("locked",this.locked),this.controls?.$el.toggle(!this.locked)});z(this,"scrollToTop",()=>{this.$container.scrollTop(0)});z(this,"scrollToBottom",()=>{let t=this.page.getViewportParam(this.viewport,"height");this.$container.scrollTop(t)});z(this,"getViewports",()=>W.default.map(Oe.viewports,function(r){let i=r.name==="default"||this.page.get("viewport_"+r.name),n=r.name!=="tablet_portrait"?!1:!(this.page.getViewportParam("tablet_portrait","enabled")||this.page.getViewportParam("tablet_portrait","isHidden")===!1);return{name:r.name,min_height:r.min_height,max_height:r.max_height,isCurrent:r.name===this.viewport,enabled:!!(r.name==="default"||i&&this.page.getViewportParam(r.name,"enabled")),height:i?this.page.getViewportParam(r.name,"height"):r.min_height,noDisable:r.name==="default",isHidden:n}}.bind(this)));z(this,"restoreDesktopComposition",(t=[],{resetAllKeys:r=!1,preserveFixedPosition:i=!1}={})=>{let n=this.viewport,s=1024,l=this.mag.getViewportWidth(n),c=(s-l)/2,d=["x","y","w","h","z","angle","pack_id","sticked","scale"];i||d.push("fixed_position"),t.forEach(p=>{let m=p.model,u=ky(m.get("type"),m.get("version"),et.canUseMinimalViewport()),g=Object.keys(p.model.getOverrides(n)),h=r?Object.fromEntries(g.map(b=>u.includes(b)?[b,p.model.viewport_default[b]]:[b,void 0])):{};if(h=W.default.reduce(p.model.viewport_default,function(b,x,S){return d.indexOf(S)>=0&&(b[S]=x),b},h),p.model.viewport_default.is_full_width){h.w=p.model.get("full_width_initial_w"),h.x=p.model.get("full_width_initial_x"),h.is_full_width=!1;let b=p.model.get("originalH"),x=p.model.get("originalW");b&&x&&(h.h=Math.round(h.w/x*b))}if(p.model.viewport_default.is_full_height){h.h=p.model.get("full_height_initial_h"),h.y=p.model.get("full_height_initial_y"),h.is_full_height=!1;let b=p.model.get("originalH"),x=p.model.get("originalW");b&&x&&(h.w=Math.round(h.h/b*x))}if(p.model.viewport_default.fixed_position||(h.x-=c),p.model.get("type")==="text"&&p.model.get("version")===3&&(h.blocksMeta=p.model.viewport_default.blocksMeta,h.styles=p.model.viewport_default.styles,h.entityMap=p.model.viewport_default.entityMap,h.bgColor=p.model.viewport_default.bgColor,p.model.viewport_default.columns&&(h.columns=p.model.viewport_default.columns)),p.model.get("type")==="slideshow"&&(h.captions_h=p.model.viewport_default.captions_h,h.images_h=p.model.viewport_default.images_h),p.model.get("type")==="picture"&&(h.border_size=p.model.viewport_default.border_size),(p.model.get("type")==="shape"||p.model.get("type")==="hotspot")&&(h.borders=p.model.viewport_default.borders),p.model.get("type")==="button"&&(h["font-size"]=p.model.viewport_default["font-size"],h["letter-spacing"]=p.model.viewport_default["letter-spacing"],h.icon_h=p.model.viewport_default.icon_h,h.icon_w=p.model.viewport_default.icon_w,h["border-width"]=p.model.viewport_default["border-width"]),p.model.get("type")==="form"){let b=`style-${p.model.viewport_default.style}`;h.style=p.model.viewport_default.style,h.layout=p.model.viewport_default.layout,h[`${b}-fields`]={...p.model.viewport_default[`${b}-fields`]},h[`${b}-button-default`]={...p.model.viewport_default[`${b}-button-default`]},h[`${b}-button-hover`]={...p.model.viewport_default[`${b}-button-hover`]}}if(p.model.get("type")==="addtocart"&&(h.attributes_margin=p.model.viewport_default.attributes_margin,h.select_btn_margin=p.model.viewport_default.select_btn_margin,h["attrs-icon-h"]=p.model.viewport_default["attrs-icon-h"],h["attrs-icon-w"]=p.model.viewport_default["attrs-icon-w"],h["attrs-border-width"]=p.model.viewport_default["attrs-border-width"],h["border-width"]=p.model.viewport_default["border-width"],h["hover-border-width"]=p.model.viewport_default["hover-border-width"],h["attrs-font-size"]=p.model.viewport_default["attrs-font-size"],h["font-size"]=p.model.viewport_default["font-size"]),p.model.set(h),p.model.viewport_default.fixed_position){let{x:b,y:x}=Ru.getViewportDefaults(p.model,n);p.model.set({x:b,y:x})}p.model.get("type")==="text"&&p.model.get("version")===3&&p.onRestoreLayout()}),window.RM.constructorRouter.indexController.restoreViewportToDefault(this.page,this.viewport)});z(this,"eliminateBlockIntersections",(t=[],{excludeStickyBottom:r,space:i}={space:t_})=>{let n=dt.getBoundingBoxOfBlocks(t),s={up:[],down:[]};this.blocks.forEach(d=>{if(d.model.get("type")==="background"||d.model.get("is_global")||d.model.get("hidden")||d.model.get("fixed_position")||!r||d.model.get("sticked")==="bottom"||t.find(m=>m.model.get("_id")===d.model.get("_id")))return;let p=dt.calcBoundingBoxForBlock(d,!0,!1);p.top<n.top&&p.top+p.height>n.top&&s.up.push(d),p.top>=n.top&&s.down.push(d)});let l=n.top;if(s.up.length&&s.up.forEach(d=>{let p=dt.calcBoundingBoxForBlock(d,!0);p.top+p.height>l&&(l=p.top+p.height+i)}),l){let d=l-n.top;t.forEach(p=>p.model.set({y:p.model.get("y")+d})),n=dt.getBoundingBoxOfBlocks(t)}let c=0;return s.down.length&&(s.down.forEach(d=>{let p=dt.calcBoundingBoxForBlock(d,!0);if(p.top<=n.bottom){let m=n.bottom+i-p.top;m>c&&(c=m)}}),c&&s.down.forEach(d=>d.model.set({y:d.model.get("y")+c}))),!!c});z(this,"collapseEmptySpace",(t=[],r=20)=>{let i=dt.getBoundingBoxOfBlocks(t),n=W.default.chain(this.blocks).filter(s=>s.model.get("type")==="background"||s.model.get("is_global")||s.model.get("hidden")||s.model.get("fixed_position")||s.model.get("sticked")||t.find(c=>c.model.get("_id")===s.model.get("_id"))?!1:dt.calcBoundingBoxForBlock(s,!0).top>i.bottom).sortBy(s=>s.getBoxData().y).value();if(n.length){let s=n[0],l=dt.calcBoundingBoxForBlock(s,!0);if(l.top-i.bottom>r){let c=l.top-i.bottom-r;n.forEach(d=>d.model.set({y:d.model.get("y")-c}))}}return!!n.length});z(this,"shiftStickyBottom",(t=[],{space:r}={space:t_})=>{let i=this.blocks.filter(p=>p.model.get("sticked")==="bottom"),n=dt.getBoundingBoxOfBlocks(t),s=dt.getBoundingBoxOfBlocks(i);if(ct.intersection(n,s).height===0)return;let c=this.page.getViewportParam(this.viewport,"height"),d=n.top+n.height-s.top+r;d<=0||this.page.setViewportParam(this.viewport,"height",Math.ceil(c+d))});z(this,"singleColumnLayout",(t=[],{topMargin:r=20,rightMargin:i=20,bottomMargin:n,leftMargin:s=20,verticalGap:l=20,includeHidden:c=!1,includeGlobal:d=!1,includeFixed:p=!1,includeAboveAll:m=!1,preserveGroups:u=!0,includeAtomic:g=!1}={})=>{let h=!!this.spacesController;this.toggleBundleBlocks(!1);let b=this.viewport,x=jr.getViewportSetting("width",b),S=this.mag.getViewportWidth(b),y=S-s-i,C=(x-S)/2+s,P=this,v=W.default.isEqual(t.map(G=>G.id).sort(),this.blocks.map(G=>G.id).sort()),T=this.mag.pages.filter(G=>(G.get("viewport_"+b)||{}).enabled&&G!==P.page).length>0,R=d||!T,I=[],M=this.filterAutolayoutBlocks(t,{includeHidden:c,includeGlobal:d,includeFixed:p,includeAboveAll:m,includeAtomic:g}),D=dt.getBoundingBoxOfBlocks(M),E=v?r:D.top;this.restoreDesktopComposition(M,{preserveFixedPosition:!0});let A=this.collectBlocks(M,{fitText:!0,preserveGroups:u});if(A.length===0){h&&this.toggleBundleBlocks(!0);return}if(!R){let G=A.filter(K=>K.model?.get("is_global"));A=W.default.difference(A,G),I=W.default.reduce(G,(K,we)=>{if(!K.length)K.push({from:we.box.bb_y,to:we.box.bb_y+we.box.bb_h});else{let xe=W.default.last(K);if(!xe)return K;xe.to>we.box.bb_y?K.push({from:we.box.bb_y,to:we.box.bb_y+we.box.bb_h}):xe.to=we.box.bb_y+we.box.bb_h}return K},[])}let $=function(G,K){let we=K*Math.sqrt(G.height*G.height+G.width*G.width)/G.bb_width,xe=G.height/G.width,_e=we/Math.sqrt(xe*xe+1),ie=Math.floor(_e*xe);return W.default.extend(G,dt.calcBoundingBox(W.default.extend(G,{width:_e,height:ie})))},j=function(G,K,we){let xe,_e;return W.default.each(G,ie=>{ie.from<K&&ie.to>K&&(xe=ie),ie.from<K+we&&ie.to>K+we&&(_e=ie),ie.from>K&&ie.to<K+we&&(_e=ie)}),!xe&&!_e?K:_e?j(G,_e.to,we):xe?j(G,xe.to,we):0},pe=G=>{G.get("fixed_position")&&G.set("fixed_position",""),G.get("is_full_width")&&G.set("is_full_width",!1),G.get("is_full_height")&&G.set("is_full_height",!1)};W.default.each(A,(G,K)=>{let we=!!G.pack_id,xe=G.model;if(we){let Se=G.w;Se.forEach(O=>pe(O.block.model));let be={width:y,left:C,top:E},Ae=this.scaleBlocksGroup(Se.map(O=>O.block),be,{widgetPackId:G.pack_id,downsizeOnly:!0}),Qe=0;Ae.top!==E&&(Qe=E-Ae.top,Ae.top=E),Se.forEach(O=>{let U={...O.block.getSaveBoxData({resizeContent:!0})};U.y+=Qe,O.model.set(U)}),E+=Ae.height,G.groupBox=Ae,E=Math.ceil(j(I,E,Ae.height))+l;return}let _e=G.block,ie=G.box,ze={width:ie.w,height:ie.h},ne={height:ie.h,width:ie.w,top:ie.y,left:ie.x,bb_width:ie.bb_w,bb_height:ie.bb_h,bb_top:ie.bb_y,bb_left:ie.bb_x,angle:xe.get("angle")||0,flip_v:!!xe.get("flip_v"),flip_h:!!xe.get("flip_h"),sinAngle:Math.sin(-(xe.get("angle")||0)*Math.PI/180),cosAngle:Math.cos(-(xe.get("angle")||0)*Math.PI/180)};ne.bb_width>y&&(ne=_e.frame.applyConstraints($(ne,y))),pe(xe);let J=Math.round(ne.width),X=Math.round(ne.height),Q=ne.angle?C-(ne.bb_left-ne.left):C;if(xe.set({x:Q,w:J,h:X}),_e instanceof Eo.text){_e.scaleContent?.({width:J,height:X},ze,{resizeText:!1,resizePaddings:!0});let Se=_e.getRealContentHeight?.(!0,J);xe.set("h",Se)}let te=Number(xe.get("ratio")),ye=Number(xe.get("scale"));if(ye&&te){let Se=te<1?ie.h/X:ie.w/J,be=ye/Se;if(ye!==be)xe.set({scale:be});else{let Ae=xe.viewport_default&&Number(xe.viewport_default.scale),Qe=xe.viewport_default&&Number(xe.viewport_default.w),O=xe.viewport_default&&Number(xe.viewport_default.h);if(Ae===be&&(Qe!==J||O!==X)){let U=te<1?O/X:Qe/J,Y=Ae/U;ye!==Y&&xe.set({scale:Y})}}}_e instanceof Eo.picture&&_e.onSingleColumnLayout({width:xe.get("w"),height:xe.get("h")}),_e instanceof Eo.text&&(_e.fitContentToBox(),ne=W.default.extend(ne,{left:xe.get("x"),top:xe.get("y"),width:xe.get("w"),height:xe.get("h"),angle:xe.get("angle")||0,flip_v:!!xe.get("flip_v"),flip_h:!!xe.get("flip_h"),sinAngle:Math.sin(-(xe.get("angle")||0)*Math.PI/180),cosAngle:Math.cos(-(xe.get("angle")||0)*Math.PI/180)}),ne=W.default.extend(ne,dt.calcBoundingBox(ne))),E=Math.ceil(j(I,E,ne.bb_height)),ne.angle?xe.set({y:E-(ne.bb_top-ne.top)}):xe.set({y:E});let de=_e.getSaveBoxData();xe.set(de),E+=ne.bb_height+(K<A.length-1?l:0)}),this.page.set({used_autolayout:!0});let ee=!1;if(!v){let G=[];A.forEach(K=>{if(K.pack_id){let we=K.w.map(xe=>xe.block);G=G.concat(we)}else G.push(K.block)}),ee=this.eliminateBlockIntersections(G,{excludeStickyBottom:!0,space:l}),this.shiftStickyBottom(G,{space:l}),ee||(ee=this.collapseEmptySpace(G,l))}this.redrawPacksFrames(),this.storeAutolayoutBlocks(A,{updateHeight:v||ee,considerStickedBottom:!v,updateStickyBottomMargin:!0,previousBoundingBox:D,bottomMargin:n,patch:!1}),h&&this.toggleBundleBlocks(!0)});z(this,"restoreDesktopLayout",(t=[],{resetAllKeys:r=!1,includeHidden:i=!1,includeFixed:n=!1,includeGlobal:s=!1,includeAboveAll:l=!1,includeAtomic:c=!1}={})=>{let p=W.default.isEqual(t.map(x=>x.id).sort(),this.blocks.map(x=>x.id).sort()),m=this.filterAutolayoutBlocks(t,{includeHidden:i,includeGlobal:s,includeFixed:n,includeAboveAll:l,includeAtomic:c}),u=dt.getBoundingBoxOfBlocks(m),g=!!this.spacesController,h=!1;if(this.toggleBundleBlocks(!1),this.restoreDesktopComposition(m,{resetAllKeys:r}),!p){let x=dt.getBoundingBoxOfBlocks(m),{top:S,left:y}=ct.absoluteToRelative(u,x),C=ct.center(x,this.getWorkspaceBox()),{left:P}=ct.absoluteToRelative(C,u);m.forEach(v=>{v.model.set({x:v.model.get("x")+y+P,y:v.model.get("y")+S})})}p||(h=this.eliminateBlockIntersections(m,{excludeStickyBottom:!0,space:20}),this.shiftStickyBottom(m,{space:20}),this.redrawPacksFrames(),h||(h=this.collapseEmptySpace(m,20)));let b=m.map(x=>({block:x,model:x.model}));this.storeAutolayoutBlocks(b,{updateHeight:p||h,dontUseViewportMinimal:!0,patch:!1}),g&&this.toggleBundleBlocks(!0)});z(this,"desktopLayoutFitMobile",(t=[],{resetAllKeys:r=!1,includeHidden:i=!1,includeGlobal:n=!1,includeFixed:s=!1,includeAboveAll:l=!1,includeAtomic:c=!1}={})=>{let m=this.viewport,u=jr.getViewportSetting("width",m),g=this.mag.getViewportWidth(m),h=g-2*20,b=(u-g)/2+20,x=W.default.isEqual(t.map(E=>E.id).sort(),this.blocks.map(E=>E.id).sort()),S=this.filterAutolayoutBlocks(t,{includeHidden:i,includeGlobal:n,includeFixed:s,includeAboveAll:l,includeAtomic:c}),y=this.getWorkspaceBox().top,C=dt.getBoundingBoxOfBlocks(S),P=Math.max(y>0?-y:0,x?20:C.top),v={considerStickedBottom:!0,updateHeight:!1,restoreFullHeight:!1},T=this.mag.getViewportWidth("default"),R=!!this.spacesController;this.toggleBundleBlocks(!1),this.restoreDesktopComposition(S,{resetAllKeys:r});let I=S.map(E=>({block:E,model:E.model})),M=I.map(E=>E.block);if(x&&M.length===1){let E=dt.getBoundingBoxOfBlocks(M);if(E.width>h){this.scaleBlocksGroup(M,{width:h,top:E.top,left:b});let A={...M[0].getSaveBoxData({resizeContent:!0})};M[0].model.set(A)}else M[0].model.set("x",20);this.storeAutolayoutBlocks(I,{updateHeight:!1,patch:!1});return}this.scaleBlocksGroup(M.filter(E=>!E.model.get("fixed_position")),{width:h,top:P,left:b}),M.filter(E=>E.model.get("fixed_position")).forEach(E=>{let A=g/T,$={width:E.model.viewport_default.w*A,top:E.model.viewport_default.y*A,left:E.model.viewport_default.x*A};this.scaleBlocksGroup([E],$)}),I.forEach(E=>{let A={...E.block.getSaveBoxData({resizeContent:!0})};E.model.viewport_default?.is_full_width&&(A.w=g,A.x=0,E.model.get("is_full_width")&&(A.is_full_width=!1)),E.model.viewport_default?.is_full_height&&(v.restoreFullHeight=!0,E.model.get("is_full_height")&&(A.is_full_height=!1));let $=E.model.viewport_default?.sticked;$&&["top","right","left"].includes($)&&(A.sticked=void 0),E.model.set(A)});let D=!1;x||(D=this.eliminateBlockIntersections(M,{excludeStickyBottom:!0,space:20}),this.shiftStickyBottom(M,{space:20}),this.redrawPacksFrames(),D||(D=this.collapseEmptySpace(M,20))),v.updateHeight=x||D,this.storeAutolayoutBlocks(I,{...v,patch:!1}),R&&this.toggleBundleBlocks(!0)});z(this,"storeAutolayoutBlocks",(t,r={updateHeight:!0,considerStickedBottom:!1,updateStickyBottomMargin:!1,patch:!0})=>{let i=this.blocks.filter(u=>u.model.get("sticked")==="bottom"),n=i.filter(u=>{let g=u.model;return!r.previousBoundingBox||g.get("y")>r.previousBoundingBox.top+r.previousBoundingBox.height}),s=W.default.reduce(n,(u,g)=>{let h=g.model;return Math.max(u,h.get("h")+h.get("sticked_margin"))},0),l=W.default.reduce(this.blocks,(u,g)=>{let h=g.model;if(!h.get("fixed_position")&&h.get("type")!=="background"&&(!r.considerStickedBottom||!h.get("sticked"))){let b=g.getBoxData({includeBoundingBox:!0});return Math.max(u,b.bb_y+b.bb_h)}else return u},0),c=jr.getViewportSetting("min_height",this.viewport),d=Math.max(l+(r.bottomMargin??86)+(r.considerStickedBottom?s:0),c),p=r.updateHeight?d-this.page.getViewportParam(this.viewport,"height"):0,m=[];this.blocks.forEach(u=>{m.push(u.model),r.restoreFullHeight&&u.model.viewport_default?.is_full_height&&(u.model.set("y",0),u.model.set("h",d||this.page.get(`viewport_${this.viewport}`).height))}),r.updateStickyBottomMargin&&i.filter(u=>{let g=u.model.get("sticked_margin");u.model.set("sticked_margin",g+p)}),this.save_group(m,{...W.default.pick(r,"dontUseViewportMinimal"),byStoreAutolayoutBlocks:!0,patch:r.patch??!0}),t.forEach(u=>{let g=u.block;g instanceof Eo.picture&&g.setScaledImage(null,{skipHistory:!0,isGroupResize:!0}),g instanceof Eo.text&&g.refreshState&&g.refreshState(g.model)}),(r.updateHeight&&d||d>this.page.getViewportParam(this.viewport,"height"))&&(this.page.setViewportParam(this.viewport,"height",Math.ceil(d)),this.page.setViewportParam(this.viewport,"type","scroll"),this.page.saveHeight()),r.updateStickyBottomMargin&&i.forEach(u=>u.recalcStickedLine()),this.trigger("autoLayout")});z(this,"destroyAllBlocks",()=>{this.blocks.forEach(t=>{t.destroy()})});z(this,"destroy",()=>{this.el.removeEventListener("drop",this.onFileDrop),this.stopListening(this.page),this.stopListening(this.mag),this.stopListeningToGuides(),Re.off("zoom"),Re.off("global_appear:widget"),Re.off("global_disappear:widget"),this.off("widget:context:change",this.onWidgetsContextChange),this.mag.edit_params.off("change:blocks",this.toggleBlocksEditParams),this.mag.edit_params.off("change:guides",this.onGuidesChange),this.pagesize&&this.pagesize.$destroy&&this.pagesize.$destroy(),this.$el.off("mouseenter",".block",this.onBlockMouseEnter),this.$el.off("mouseleave",".block",this.onBlockMouseLeave),this.workspaceContainer.removeEventListener("mousemove",this.onMouseMove),this.workspaceContainer.removeEventListener("mouseleave",this.onMouseLeave),this.$window.off("resize",this.onResize),this.$container.off("click",this.onclick),this.commentsRoot.unmount(),this.unsubscribeCommentMode?.(),this.destroyAllBlocks(),this.$el.remove()});this.$container=t.$container,this.mag=t.mag,this.setElement((0,ht.default)(t.template()).hide().appendTo(this.$container)),this.syncManager=t.syncManager,this.eCommerceManager=t.eCommerceManager,this.$container.on("click",this.onclick),this.$window=(0,ht.default)(window),this.$window.on("resize",this.onResize),this.$origin=this.$(".origin"),this.$scroller=t.$container,this.$frame=this.$(".selectframe").hide(),this.$border=this.$(".workspace-border"),this.page=this.mag.getPage(t.page_id),this.page.workspace=this,this.page.on("widget:create",this.createBlock),this.page.on("widget:remove",this.removeBlock),this.page.on("toggleWidgets",this.toggleWidgets);let r=t.viewport?this.page.getViewportParam(t.viewport,"enabled"):!1,i=t.viewport&&r?t.viewport:"default";this.page.widgets.chain().reject(function(n){return n.isGlobal()}).map(n=>this.addBlock(n,{viewport:i})),this.onResize(),this.page.on("change",this.updateWorkspaceViewport),this.updateWorkspaceViewport(),this.page.on("change:viewport",this.onChangeViewport),this.listenTo(this.page,"widgets:remove",this.onWidgetsRemove),this.on("widget:context:change",this.onWidgetsContextChange),this.on("redraw",W.default.debounce((n={})=>{window.RM.constructorRouter.trigger("redrawPage",n.is_global?this.page.id:t.page_id)},500)),this.on("select",this.onSelect),this.on("deselect",this.onDeselect),this.saveGroupDebounced=W.default.debounce(this.save_group,500),this.cloneBlocksDebounced=W.default.debounce(this.cloneBlocks,500),this.restoreFocusForCopyPasteDebounced=W.default.debounce(this.restoreFocusForCopyPaste,0),this.triggerSelectOnSelectedBlockDebounced=W.default.debounce(this.triggerSelectOnSelectedBlock,50),this.viewportScrolls={},this.bindUploader(),this.loader=(0,ht.default)(".rm-loader").eq(0),this.locked=!1,this.on("specialKeydown specialKeyup",this.onSpecialKey),this.on("selectAll",this.selectAllBlocks),Re.on("global_appear:widget",this.onGlobalAppear),Re.on("global_disappear:widget",this.onGlobalDisappear),Re.on("zoom",(n,s)=>{this.$border.toggleClass("fullscreen",s&&this.page.get("height")*n>=window.innerHeight),Ge("constructor.borderAlwaysVisible")&&this.updateBorder()}),this.listenTo(this.page,"change:height",(n,s)=>{this.$border.toggleClass("fullscreen",window.RM.constructorRouter.zoom.isFullScreenOrMore()&&s*window.RM.constructorRouter.zoom.getZoom()>=window.innerHeight)}),this.$el.on("mouseenter",".block",this.onBlockMouseEnter),this.$el.on("mouseleave",".block",this.onBlockMouseLeave),this.toggleBlocksEditParams(),this.mag.edit_params.on("change:blocks",this.toggleBlocksEditParams),this.mag.edit_params.on("change:guides",this.onGuidesChange),this.mag.on("change:desktopWidth",this.updateWorkspaceViewport),this.mag.on("change:phoneWidth",this.updateWorkspaceViewport),this.distance=new ia(this),this.workspaceContainer=this.$el.get(0),this.unsubscribeCommentMode=kf(this.onChangeCommentMode.bind(this)),this.commentsRoot=e_(this.$el.get(0).querySelector("#comments"),{workspace:this,router:window.RM.constructorRouter})}get viewport(){return this.page.getCurrentViewport()}onChangeCommentMode(t){this.visible&&(t?this._enableCommentMode():this._disableCommentMode()),this.isActiveCommentMode=t}getClientSize(){return{width:this.$container[0].clientWidth,height:this.$container[0].clientHeight}}getWorkspaceSize(){let t=this.mag.getViewportWidth(this.viewport),r=this.page.getViewportParam(this.viewport,"height");return{width:t,height:r}}setTempPicture(t,r){let i=t&&t.length&&t[0];i&&Su(i).then(({content:n,width:s,height:l,ext:c})=>{t[0].uploading&&r.setTempPicture({content:n,width:s,height:l,ext:c},{withoutResize:!0})}).catch(()=>{})}createNestedBlocks(t,r,i){if(i=i||W.default.noop,!t.child_workspace)return i();let n=function(s){let l=r[s];if(!l)return i();t.child_workspace?.add_widget(l,{copy:!0,success:function(){n(s+1)},error:function(){n(s+1)}})};n(0)}deleteCommentsFromBlock(t){E1(t)}updateBorder(){this.toggleBorder({guidesOn:this.mag.edit_params.get("guides"),columnCount:window.RM.constructorRouter.gg?.guides?.model?.get("columns"),margin:window.RM.constructorRouter.gg?.guides?.model?.get("margin")})}filterAutolayoutBlocks(t,r={includeHidden:!1,includeFixed:!1,includeGlobal:!1,includeAboveAll:!1,includeAtomic:!1}){let i=this.mag.get("packs").reduce((n,s)=>(n[s.pack_id]=s,n),{});if(r.includeAboveAll&&(!r.includeFixed||!r.includeGlobal))throw"If you include above page widgets in the autolayout, please include fixed and global widgets as well.";return t.filter(n=>{let s=n.model,l=s.get("pack_id");return!(n instanceof Eo.background)&&(r.includeHidden||!s.get("hidden"))&&(r.includeAtomic||!i[l]?.atomic)&&(r.includeGlobal||!s.get("is_global"))&&(r.includeFixed||!s.get("fixed_position"))&&(r.includeAboveAll||!s.get("is_above"))})}collectBlocks(t=[],r={fitText:!1,preserveGroups:!1}){let i=t.map(function(n){return r.fitText&&n instanceof Eo.text&&n.fitContentToBox(),{block:n,model:n.model,box:n.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0})}});if(r.preserveGroups){let n={};i=i.reduce((s,l)=>{let c=l.model.get("pack_id");return c?(n[c]||(n[c]={pack_id:c,y:l.box.bb_y,x:l.box.bb_x,w:[],fixed:!!l.model.get("fixed_position")},s.push(n[c])),n[c].y=Math.min(n[c].y,l.box.bb_y),n[c].x=Math.min(n[c].x,l.box.bb_x),n[c].w.push(l)):s.push(l),s},[]),i=W.default.sortBy(i,s=>s.model&&s.model.get("fixed_position")?s.box.bb_y*1e6+s.box.bb_x:s.pack_id&&s.fixed?s.y*1e6+s.x:(s.pack_id?s.y:s.box.bb_y)*1e12+(s.pack_id?s.x:s.box.bb_x)),i=i.reduce((s,l)=>!r.preserveGroups&&l.pack_id?[...s,...W.default.sortBy(l.w,c=>c.box.bb_y*1e6+c.box.bb_x)]:(s.push(l),s),[])}else i=W.default.sortBy(i,({box:n,model:s})=>s.get("fixed_position")?n.bb_y*1e6+n.bb_x:n.bb_y*1e12+n.bb_x);return i}scaleBlocksGroup(t,r,{downsizeOnly:i=!1,widgetPackId:n=Un()}={}){let s=new tc({id:n,workspace:this});t.forEach(p=>{s.addBlock(p)}),s.render();let l=s.getModelBox(),c,d=l.width===r.width?1:i?Math.min(r.width/l.width,1):r.width/l.width;if(l.width!==r.width||l.top!==r.top||l.left!==r.left){let p={...l,left:r.left,top:r.top,width:Math.round(l.width*d),height:Math.round(l.height*d)};c=s.frame.doResize(p,!1,"se",!1),s.destroy()}return c}findBlockByFunction(t){return this.blocks.find(t)}getCachedSizes(){return this.cachedSizes||(this.cachedSizes={width:this.$container.width()||0,height:this.$container.height()||0,clientWidth:this.$container[0].clientWidth,elHeight:this.$el.height()||0,elWidth:this.$el.width()||0,windowClientWidth:document.documentElement.clientWidth,windowClientHeight:document.documentElement.clientHeight}),this.cachedSizes}};(0,ht.default)(function(){let e;(0,ht.default)("#main").drag("start",function(...o){return e=window.RM.constructorRouter.workspace,!e||e.locked?!1:e.onDragStart(...o)}).drag(function(...o){return e.onDrag(...o)}).drag("end",function(...o){return e.onDragEnd(o[0])}),(0,ht.default)(window).on("contextmenu",function(o){(0,ht.default)(o.target).hasClass("dot")&&(o.stopPropagation(),o.preventDefault())})});var r_=Wf;var hn=B($t()),l_=B(Mo()),pa=B(pt());tn();var i_={"template-constructor-helpers-code-editor-container":Lt`
	<div class="code-editor-container">
		
		<% if (modal) { %>
		<div class="code-editor-modal-overlay"></div>
		<% } %>

		<div class="code-editor-block"  style="height:<%= height %>px;">
			<div class="code-editor-wrapper">

			</div>
			<div class="resize-handle"></div>			
		</div>
	</div>
`};ui();var Rl=B($t()),s_=B(Mo()),xi=B(pt());je();tn();var n_={"template-constructor-helpers-code-editor":Lt`
	<div class="rm-code-editor">
		<div class="code-editor-upgrade-alert">
			<% if (is_subscription_paused) { %>
			<div class="alert-message">Please <a class="link upgrade-link" target="_blank" rel="noopener noreferrer" href="/settings#change-plan">unpause</a> your subscription to make custom code work after publishing. <a class="link" rel="noopener noreferrer" href="https://help.readymag.com/hc/en-us/articles/360020844171-Adding-custom-code" target="_blank">Learn more</a>.</div>
			<% } else if (!is_contributor) { %>
			<div class="alert-message">Please <a class="link upgrade-link" target="_blank" rel="noopener noreferrer" href="/settings#change-plan">upgrade</a> your account to make custom code work after publishing. <a class="link" rel="noopener noreferrer" href="https://help.readymag.com/hc/en-us/articles/360020844171-Adding-custom-code" target="_blank">Learn more</a>.</div>
			<% } else { %>
			<div class="alert-message">Please upgrade owners account to make custom code work after you publish the project. <a class="link" href="http://help.readymag.com/hc/en-us/articles/360020527012-Embed-Code" rel="noopener noreferrer" target="_blank">See exceptions</a>. <a href="mailto:<%= owner_email %>">Contact owner</a>.</div>
			<% } %>
			<div class="alert-close">Close</div>
		</div>

		<div class="rm-code-editor-toolbar">
			<table class="toolbar-table">
				<tr>
					<td class="item widget-code">
 						<div class="tb-button pane-button" data-type="widget"><span class="tb-bullet"></span><span class="tb-title">Widget Code</span></div>
 					</td>
 					<td class="item project-code">
 						<div class="tb-caption">Project Code:</div>
 						<div class="tb-button pane-button" data-type="head"><span class="tb-bullet"></span><span class="tb-title">&lt;HEAD&gt;</span></div>
 						<div class="tb-button pane-button" data-type="body_top"><span class="tb-bullet"></span><span class="tb-title">After &lt;BODY&gt;</span></div>
 						<div class="tb-button pane-button" data-type="body_bottom"><span class="tb-bullet"></span><span class="tb-title">Before &lt;/BODY&gt;</span></div>
 						<div class="tb-button pane-button" data-type="css"><span class="tb-bullet"></span><span class="tb-title">CSS</span></div>
					</td>
					<% if (showUpdateButton) { %>
						<td class="item update"><div class="tb-button update"><span class="tb-title">Apply (<%= Modernizr.mac ? '\u2318' : 'Ctrl' %>+U)</span></div></td>
					<% } %>
					<td class="item save"><div class="tb-button save"><span class="tb-close">Save & Close</span></div></td>
				</tr>
			</table>
		</div>
		<div class="rm-code-editor-panes">
			<div class="code-pane" data-type="widget">
				<div class="code-editor-area"></div>
				<div class="options-area">
					<table class="options-table">
						<tr>
							<td class="option links">
								<a class="code-editor-learn-link" href="https://help.readymag.com/hc/en-us/articles/360020844171-Adding-custom-code" rel="noopener noreferrer" target="_blank">Learn about custom code</a>
								<a class="code-editor-integrations-link" href="https://readymag.com/integrations" rel="noopener noreferrer" target="_blank">Find out integrations</a>
							</td>
							<td class="option clear"><div class="option-title">Clear widget contents when switching to another page</div><div class="switcher clear rmswitcher"></div>
							</td>
							<td class="option use-iframe"><div class="option-title">Use iFrame</div><div class="switcher use-iframe rmswitcher"></div>
							</td>
						</tr>
					</table>
				</div>
			</div>
			<div class="code-pane" data-type="head"><div class="code-editor-area"></div></div>
			<div class="code-pane" data-type="body_top"><div class="code-editor-area"></div></div>
			<div class="code-pane" data-type="body_bottom"><div class="code-editor-area"></div></div>
			<div class="code-pane" data-type="css"><div class="code-editor-area"></div></div>

			<div class="editor-preloader rmpreloader">
				<div class="arc"></div>
			</div>
		</div>
	</div>
`};pr();var v7=s_.default.View.extend({template:n_["template-constructor-helpers-code-editor"],EDITOR_CONFIG:{lineNumbers:!0,lineWrapping:!0,mode:"htmlmixed",theme:"readymag",keyMap:"sublime",scrollbarStyle:"overlay",viewportMargin:50},events:{"click .tb-button.pane-selector .tb-title":"onPaneSelectorButtonClick","click .tb-button.update:not(.disabled)":"onUpdateButtonClick","click .tb-button.save":"onSaveButtonClick","click .pane-button:not(.selected)":"onPaneButtonClick","click .alert-close":"onCloseAlertClick","click .code-editor-learn-link":"onClickLearnLink","click .code-editor-integrations-link":"onClickIntegrationsLink"},initialize:function(e){xi.default.bindAll(this),this.codes=e.codes||[],this.defaultCode=e.defaultCode||"head",this.updateDelegate=e.updateDelegate,this.is_contributor=e.is_contributor,this.owner_email=e.owner_email,this.is_subscription_paused=e.is_subscription_paused,this.$container=e.$container,this.parent=e.parent,this.editors={},this.showUpgradeAlert=e.showUpgradeAlert,this.tabsNames={widget:"widget",head:"head",body_top:"body_top",body_bottom:"body_bottom",css:"css"},this.activePane=this.tabsNames.widget,this.refreshEditors_debounced=xi.default.debounce(this.refreshEditors,100),this.onCodeChange_throttled=xi.default.throttle(this.onCodeChange,400)},render:function(){this.setElement((0,Rl.default)(this.template({is_contributor:this.is_contributor,owner_email:this.owner_email,showUpdateButton:this.activePane===this.tabsNames.widget,is_subscription_paused:this.is_subscription_paused}))),this.showUpgradeAlert||(this.$(".code-editor-upgrade-alert").remove(),RM.constructorRouter.trigger("notice:triggerMetrics","codePanelOpened")),this.$container.html(this.$el),this.setElement(this.$el),!!xi.default.findWhere(this.codes,{type:"widget"})||(this.$(".rm-code-editor-toolbar .item.widget-code").remove(),this.$(".rm-code-editor-toolbar .item.update").remove(),this.$('.code-pane[data-type="widget"]').remove()),this.$paneSelectorPopup=this.$(".pane-selector-popup"),this.$codePanes=this.$(".code-pane"),this.initCodePanes(),this.parent&&this.listenTo(this.parent,"resize",this.refreshEditors_debounced)},initCodePanes:function(){import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-VOWJ3B5O.js").then(({default:e})=>{xi.default.each(this.$codePanes,function(o){let t=(0,Rl.default)(o),r=t.attr("data-type"),i=xi.default.findWhere(this.codes,{type:r}),n,s;r==="css"?(n=xi.default.clone(this.EDITOR_CONFIG),n.mode="css"):n=this.EDITOR_CONFIG,n.placeholder=y7[r],s=e(t.find(".code-editor-area")[0],n),this.editors[r]=s,s.rm_editor_type=r;let l=Modernizr.mac?"Cmd-U":"Ctrl-U",c=Modernizr.mac?"Cmd-S":"Ctrl-S",d={};d[l]=this.onUpdateButtonClick,d[c]=this.onUpdateButtonClick,d.Esc=this.onSaveButtonClick,s.setOption("extraKeys",d);let p=i&&i.code||"";s.setValue(p);let m=i.positions||{};m.cursor&&s.setCursor(m.cursor),m.scroll&&s.scrollTo(null,m.scroll),this.onCodeChange(s),s.on("change",this.onCodeChange_throttled),s.on("focus",this.onEditorFocusChange),s.on("blur",this.onEditorFocusChange),r===this.tabsNames.widget&&(this.iframeSwitcher=(0,Rl.default)(this.$(".switcher.use-iframe")).RMSwitcher({state:i.options.use_iframe,height:32,"color-0":"#0078ff","color-1":"#c9c8c9"},function(u){this.updateOption("use-iframe",u)}.bind(this)).data("switcher"),this.updateOption("use-iframe",i.options.use_iframe),this.clearSwitcher=(0,Rl.default)(this.$(".switcher.clear")).RMSwitcher({state:i.options.clear_content,height:32,"color-0":"#0078ff","color-1":"#c9c8c9"},function(u){this.updateOption("clear",u)}.bind(this)).data("switcher"),this.updateOption("clear",i.options.clear_content))}.bind(this)),this.switchToPane(this.defaultCode),this.hidePreloader()})},updateOption:function(e,o){this.$(".option."+e).toggleClass("active",!!o)},getCodePane:function(e){return this.$('.code-pane[data-type="'+e+'"]')},hidePreloader:function(){this.$(".editor-preloader").remove()},onPaneButtonClick:function(e){let o=(0,Rl.default)(e.currentTarget),t=o.attr("data-type");this.switchToPane(t),this.checkUpdateButtonVisibility(t)},switchToPane:function(e){let o=this.getCodePane(e);this.$(".code-pane").removeClass("active"),o.addClass("active"),this.$(".pane-button").removeClass("selected"),this.$('.section-item[data-type="'+e+'"]').addClass("selected"),this.$('.pane-button[data-type="'+e+'"]').addClass("selected"),this.activePane=e},checkUpdateButtonVisibility:function(e){let o=this.$(".item.update");e===this.tabsNames.widget?o.show():o.hide()},getAllCodes:function(){let e={};return xi.default.each(this.editors,function(o,t){let r={code:o.getValue().trim(),cursor:o.getCursor(),scroll:o.getScrollInfo().top};t==="widget"&&(r.options={clear_content:this.clearSwitcher.settings.state,use_iframe:this.iframeSwitcher.settings.state}),e[t]=r}.bind(this)),e},onUpdateButtonClick:function(){let e=this.$(".tb-button.update"),o=this.getAllCodes();e.hasClass("disabled")||(xi.default.isFunction(this.updateDelegate)?(e.addClass("disabled"),this.updateDelegate(o,function(){e.removeClass("disabled")})):this.trigger("update",o))},onSaveButtonClick:function(){this.trigger("save",this.getAllCodes())},refreshEditors:function(){xi.default.each(this.editors,function(e){e.refresh()})},onCloseAlertClick:function(){this.$(".code-editor-upgrade-alert").remove(),this.trigger("alert-close"),this.refreshEditors()},onCodeChange:function(e){let o=e.getValue().trim(),t=e.rm_editor_type,r=!!o;this.$('.pane-button[data-type="'+t+'"]').toggleClass("has-code",r)},onEditorFocusChange:function(e){let o=e.hasFocus(),t=e.state.placeholder;t&&(t.style.display=o?"none":"")},onClickLearnLink:function(){se(he.WidgetMisc,{action:"learn about adding custom code",widgetType:"code"})},onClickIntegrationsLink:function(){se(he.WidgetMisc,{action:"learn about intergrations",widgetType:"code"})}}),y7={widget:`<!-- 
Please note that custom code added to the
project is beyond of the scope of Readymag
support. Bend matter carefully.

 \\      oo
  \\____|\\mm
  //_//\\ \\_\\
 /K-9/  \\/_/
/___/_____\\
-----------
-->`,head:`<!-- 
Please note that custom code added to the
project is beyond of the scope of Readymag
support. Bend matter carefully.

 \\      oo
  \\____|\\mm
  //_//\\ \\_\\
 /K-9/  \\/_/
/___/_____\\
-----------
-->`,body_top:`<!-- 
Please note that custom code added to the
project is beyond of the scope of Readymag
support. Bend matter carefully.

 \\      oo
  \\____|\\mm
  //_//\\ \\_\\
 /K-9/  \\/_/
/___/_____\\
-----------
-->`,body_bottom:`<!-- 
Please note that custom code added to the
project is beyond of the scope of Readymag
support. Bend matter carefully.

 \\      oo
  \\____|\\mm
  //_//\\ \\_\\
 /K-9/  \\/_/
/___/_____\\
-----------
-->`,css:`/* 
Please note that custom code added to the
project is beyond of the scope of Readymag
support. Bend matter carefully.

 \\      oo
  \\____|\\mm
  //_//\\ \\_\\
 /K-9/  \\/_/
/___/_____\\
-----------
*/`},a_=v7;bh();var k7=l_.default.View.extend({template:i_["template-constructor-helpers-code-editor-container"],events:{"click .code-editor-modal-overlay":"onOverlayClick"},MIN_HEIGHT:47,INITIAL_HEIGHT_PERCENT:40,MAX_HEIGHT_PERCENT:80,initialize:function(e){pa.default.bindAll(this),this.widgetModel=e.model,this.router=e.router,this.mag=e.mag},render:function(){let e=this.getSavedHeight(),o=(0,hn.default)(window).height(),t,r=RM.common.codeEditorPositions||{};e?t=Math.min(e,Math.round(o*this.MAX_HEIGHT_PERCENT/100)):t=Math.max(Math.round((0,hn.default)(window).height()*this.INITIAL_HEIGHT_PERCENT/100),this.MIN_HEIGHT),this.setElement((0,hn.default)(this.template({height:t,modal:!this.widgetModel}))),this.$el.insertAfter("#constructor"),this.setElement(this.$el),this.$editorBlock=this.$(".code-editor-block"),this.$overlay=this.$(".code-editor-modal-overlay"),(0,hn.default)(this.$(".resize-handle")).RMDrag({start:this.startHandleDrag,move:this.moveHandleDrag,end:this.endHandleDrag,silent:!0,preventDefault:!0});let i=!this.router.codeInjectionAlertAlreadyShown&&!this.router.me.get("permissions").can_inject_code,n=[{type:"head",code:this.mag.get("ci_head")||"",positions:r.head},{type:"body_top",code:this.mag.get("ci_body_top")||"",positions:r.body_top},{type:"body_bottom",code:this.mag.get("ci_body_bottom")||"",positions:r.body_bottom},{type:"css",code:this.mag.get("ci_css")||"",positions:r.css}];this.widgetModel&&n.push({type:"widget",code:this.widgetModel.get("code")||"",options:{use_iframe:this.widgetModel.get("use_iframe"),clear_content:this.widgetModel.get("clear_content")},positions:r[this.widgetModel.get("_id")]}),this.codeEditor=new a_({$container:this.$(".code-editor-wrapper"),parent:this,codes:n,defaultCode:this.widgetModel?"widget":"head",updateDelegate:function(s,l){this.widgetModel.save({code:s.widget.code,options:s.widget.options},{success:l,error:function(){l()}}),pa.default.delay(function(){l()},5e3)}.bind(this),showUpgradeAlert:i,is_contributor:!this.router.isOwner,owner_email:this.router.mag.get("user").email,is_subscription_paused:et.isSubscriptionPaused()}),this.listenTo(this.codeEditor,"save",function(){this.router.closeCodeEditor()}),this.listenToOnce(this.codeEditor,"alert-close",function(){this.router.codeInjectionAlertAlreadyShown=!0}.bind(this)),this.codeEditor.render()},saveCodes:function(){let e=this.codeEditor.getAllCodes(),o=e.widget||{},t=this.widgetModel,r={},i;if(i=RM.common.codeEditorPositions||{},RM.common.codeEditorPositions=i,pa.default.each(e,function(n,s){s!=="widget"&&(r["ci_"+s]=n.code,i[s]={cursor:n.cursor,scroll:n.scroll})}.bind(this)),t){let n={code:o.code};pa.default.extend(n,o.options),t.set(n),t.hasChanged()&&this.widgetModel.save(n),i[t.get("_id")]={cursor:o.cursor,scroll:o.scroll}}this.mag.set(r),this.mag.hasChanged()&&this.mag.save(r,{patch:!0})},startHandleDrag:function(e){let o=(0,hn.default)(e.currentTarget);this.resizeParams={$handle:o,initial_h:this.$editorBlock.height()}},moveHandleDrag:function(e){let o=this.resizeParams.initial_h-e.deltaY;this.updateHeight(o)},endHandleDrag:function(){this.changedHeight=this.height},updateHeight:function(o){var o=o||this.$editorBlock.height(),t=Math.max(Math.round((0,hn.default)(window).height()*this.MAX_HEIGHT_PERCENT/100),this.MIN_HEIGHT);o>t&&(o=t),o<this.MIN_HEIGHT&&(o=this.MIN_HEIGHT),this.height=o,this.$editorBlock.height(o),this.trigger("resize")},show:function(){this.render(),pa.default.delay(function(){this.$el.addClass("visible")}.bind(this),20),(0,hn.default)(window).on("resize",this.onWindowResize),this.shown=!0},hide:function(){this.$el.removeClass("visible"),setTimeout(pa.default.bind(function(){this.remove()},this),200),(0,hn.default)(window).off("resize",this.onWindowResize),this.changedHeight&&this.saveHeight(),Ls(),this.shown=!1},saveHeight:function(){window.localStorage&&window.localStorage.setItem("RMCodeEditorHeight",this.height)},getSavedHeight:function(){return window.localStorage&&window.localStorage.getItem("RMCodeEditorHeight")},onWindowResize:function(){this.updateHeight()},toggle:function(){this.shown?this.hide():this.show(),this.trigger("toggle")},onOverlayClick:function(){this.router.closeCodeEditor()}}),p_=k7;var vi=B($t());Zd();su();Nh();Ho();rf();ui();var yi=B(pt()),zl=B(Mo());st();ec();ro();var _7=zl.default.Router.prototype;q0();var c_=Mr.extend({setupEcommerceSidebar:async function(){if(this.eCommerceManager.getConnectedProvider()==="ecwid"){let{default:e}=await import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-SF6DM2GV.js");this.cartSidebar=new e(this)}else{let{default:e}=await import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-YMEMOCNJ.js");this.cartSidebar=new e(this)}},getContainerSize(){if(["phone_portrait","tablet_portrait"].includes(this.viewport)){let{width:e,height:o}=Pr.fitToDevice(this.viewport==="tablet_portrait"?this.getViewportWidth(this.viewport)*.75:this.getViewportWidth(this.viewport),this.viewport,cl());return this.containerSize={width:e,height:Math.min(o,this.$el.height())},this.containerSize}else return Mr.prototype.getContainerSize.call(this)},switchToViewport(e,o){Mr.prototype.switchToViewport.call(this,e),Qp[cl()]!==e&&nu(o||Jp[e]),this.currentPage&&!this.aboveGlobalWidgetsRendered&&this.viewOpts.viewertype==="horizontal"&&this.renderAboveGlobalWidgets(this.currentPage),this.setViewerOptions(e),this.setViewerClasses(),this.onResize(),this.loadPages()}}),S7=zl.default.Router.extend({routes:{},prefix:"edit/",isPreview:!0,deviceSwitch:void 0,initialize:function(e){if(e.constructorViewport=window.sessionStorage.getItem("constructorViewport")||"default",yi.default.bindAll(this),this.environment=le.environment.viewer,this.started=!1,window.RM.data.usersLoader.me&&(this.me=window.RM.data.usersLoader.me),this.$mags_container=(0,vi.default)("#mags"),this.magsData=window.ServerData&&window.ServerData.mags,Xn.init(window.ServerData&&window.ServerData.userPermissions),this.internalHistory=[],this.magsData){if(this.cachedMag=yi.default.clone(this.magsData.mag),!this.cachedMag||!this.cachedMag.user||!this.cachedMag.user._id)return;this.cachedMag.user.isMe=this.me&&this.me.get("_id")==this.cachedMag.user._id}import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-T22CZGEP.js").then(({default:o})=>{RM.analytics=RM.analytics||new o({router:this}),this.analytics=RM.analytics;let t=window.RM?.common?.isDomainViewer===!0;le.isProd&&!t&&import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-C7DZA7HH.js").then(({getWebVitals:r})=>{r()})}),this.environment=le.environment.preview,e.title=e.title||"Project Title",this.$constructor=e.$constructor,this.mag=new c_(e,this),this.cachedMag=this.mag,this.listenTo(this.mag,"menuShown",this.onViewerMenuShow),this.listenTo(this.mag,"menuHidden",this.onViewerMenuHide),this.listenTo(this.mag,"change:viewport",this.onChangeViewport,this),(0,vi.default)("body").on("keydown",this.onKeyDown),this.mag.user&&(this.mag.user._id,RM.constructorRouter.me.get("_id")),Re.on("change:device",this.onChangeDevice,this)},navigate:function(e,o){let t=e.indexOf("/"+this.prefix)!==0?this.prefix+e:e;_7.navigate.call(this,t,o)},setTitle:function(){window.document.title=this.mag.title+" (Preview)"},onViewerMenuShow:function(){this.mag.viewOpts.viewertype==="vertical"&&this.$constructor&&this.$constructor.addClass("shift-toolbar-on-viewer-menu-open")},onViewerMenuHide:function(){this.mag.viewOpts.viewertype==="vertical"&&this.$constructor&&this.$constructor.removeClass("shift-toolbar-on-viewer-menu-open")},onKeyDown:function(e){if(e.ctrlKey||e.metaKey)return!0;e.target.tagName.toLowerCase()==="input"||e.target.tagName.toLowerCase()==="textarea"||e.keyCode===vi.default.keycodes.esc&&(RM.constructorRouter.togglePreview(),(0,vi.default)("body").off("keydown",this.onKeyDown))},destroy:function(){this.onViewerMenuHide(),(0,vi.default)("body").off("keydown",this.onKeyDown),this.deviceSwitch&&(kv(this.deviceSwitch),this.deviceSwitch?.parentNode?.removeChild(this.deviceSwitch)),Re.off("change:device",this.onChangeDevice,this),this.mag&&this.mag.destroy()},go:function(e,o){if(e=e||1,o.isPageNum)this.mag.showPage(e,o);else{let t=this.mag.getPageByPath(e)||{};this.mag.showPage(t.num||e,o)}if(this.scrollTop&&(this.mag.setScrollPosition({offset:this.scrollTop,animate:!1}),delete this.scrollTop),!this.deviceSwitch){this.deviceSwitch=document.createElement("div"),document.body.appendChild(this.deviceSwitch);let t=Jp[window.sessionStorage.getItem("constructorViewport")]||"Desktop";yv(this.deviceSwitch,{defaultDevice:t,router:this,project:RM.constructorRouter.previewMag})}},getMagUri:function(e){return"edit/"+e.num_id+"/preview/"},setScroll:function(e){this.scrollTop=e},getScroll:function(){return this.mag.getScrollPosition()},onChangeViewport:function(e){window.sessionStorage.setItem("constructorViewport",e.viewport||"default")},onChangeDevice(e){if(!this.mag.active)return;let o=Qp[e];o!==this.mag.viewport?this.mag.switchToViewport(o,e):this.mag.onResize()},startByPageNum:function(e,o,t){this.start(e,o,null,t)},getPageUrlFromCodeExportLink:function(e){if(!e)return e;if(window.RM.config?.root){let o=window.RM.config.root;return o[0]==="/"&&(o=o.substr(1)),e.replace(o,"")}return e},start:function(e,o,t,r){if(isNaN(parseInt(r))&&(r=void 0),!r){if(parseInt(e,10)==e||/^p\d+\/?$/i.test(e)){let n=o;o=e,t=n,e=null}if(!o)return this.notFound()}this.latestFragment=zl.default.history.getFragment(),t=t||1,r&&(t=r);let i=e+"_"+o;if(this.username=e,!(this.started==i&&this.loaded!=i)){if(this.started=i,this.loaded==this.started){this.go(t,{animation:!1,isPageNum:!!r});return}if(this.cachedMag&&!yi.default.isEmpty(this.cachedMag)){!(this.cachedMag instanceof Mr)&&!this.cachedMag.forbidden&&!this.cachedMag.is_suspended&&(this.cachedMag=new Mr(this.cachedMag,this)),this.mag=this.cachedMag,this.onPreloadMag(t,!!r);return}this._loadingMagDataXHR&&this._loadingMagDataXHR.abort(),this._loadingMagDataXHR=this.fetchData(this.username,o,{success:yi.default.bind(function(n){this.mag&&this.mag.num_id&&n&&n.num_id!=this.mag.num_id&&window.location.reload(),this.mag=new Mr(n,this),this.cachedMag=this.mag,this.onPreloadMag(t,!!r)},this),error:this.notFound})}},restartMag({currentPage:e,viewport:o}={}){let t=e||this.mag.currentPage.num,r=o||this.mag.viewport;this.stopListening(this.mag),this.mag.destroy();let i=this.mag.model.toJSON();this.mag=new c_({...i,user:this.mag.user,constructorViewport:r,hasSummary:!0,globalWidgets:this.mag.staticGlobalWidgetsData,aboveAllWidgets:this.mag.aboveGlobalWidgetsData},this),this.cachedMag=this.mag,this.mag.showPage(t),this.mag.toolbar.toggleToolbarVisibility(!0),this.listenTo(this.mag,"menuShown",this.onViewerMenuShow),this.listenTo(this.mag,"menuHidden",this.onViewerMenuHide),this.listenTo(this.mag,"change:viewport",this.onChangeViewport,this),window.sessionStorage.setItem("constructorViewport",r||"default"),Re.trigger("preview:mag:restart")},fetchMagPages:async function(e){let o=Array.isArray(e)&&e.length?e.join(","):void 0;return this._loadingPagesDataXHR&&this._loadingPagesDataXHR.abort(),this._loadingPagesDataXHR=vi.default.ajax({url:`/api/magpages/${this.mag.num_id}`,method:"GET",data:o?{pages:o}:void 0,success:function(t){return t},error:function(t){return null},context:this}),this._loadingPagesDataXHR},onPreloadMag:function(e,o){Ou(et.usedWidgets(this.mag.pages||[],this.mag.aboveGlobalWidgetsData)).finally(()=>{this.onLoadMag(e,o)})},onLoadMag:function(e,o){let t;if(this.loaded=this.started||!0,this.mag.forbidden){this.requestMagPassword(this.latestFragment,yi.default.clone(this.mag)),delete this.cachedMag,delete this.loaded,delete this.started;return}if(this.mag.is_suspended){this.showSuspended();return}this.mag._requested_page&&!o?(t=this.mag._requested_page,delete this.mag._requested_page):t=e,this.mag.render(),this.go(t,{animation:!1,isPageNum:o}),RM.common.mode="mag"},fetchData:function(e,o,r){var r=r||{};return e?r.url="/api/readymag/"+e+"/"+o:r.url="/api/readymag/"+o,vi.default.ajax(r)},sendReadyEvent:function(e){if(e=e||{},e=yi.default.defaults(e,{page:{}}),window.loadNotifier){if(e.error)return window.loadNotifier({error:e.error});window.loadNotifier({width:e.page.width,height:e.page.height})}},trackPage:function(){RM.screenshot||yi.default.defer(yi.default.bind(function(){this.analytics&&this.analytics.trackPage()},this))},goBack:function(){let e=this.internalHistory[this.internalHistory.length-2];e&&(e&&this.go(e,{skipInternalHistory:!0}),this.internalHistory.pop())},setUrlString:function(e){if(this.noUrlRewrite||e.isTemplateSubmission||(e=e||{},RM.screenshot))return;let o=this.mag.num_id+"/preview/",t=this.mag.currentPage;if(t&&t.num!="1"&&(o+=(t.pagePath||t.uri||t.num.toString())+"/"),e.skipInternalHistory||this.internalHistory.push(t.num.toString()),o===zl.default.history.getFragment())return;let i=(parseInt(yi.default.last(zl.default.history.getFragment(),"/"))||1)==t.num||e.replace;this.navigate(o,{replace:i})},getPreviousFragment:function(){return this.internalHistory[this.internalHistory.length-2]},getUserPermissions(){return this.userPermissions||[]},onError:function(){this.mag&&this.go(1,{animation:!1})},createMagFromTemplate:async function(e,o){let{default:t}=await import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-V6TUDP4N.js");new t({router:this,me:this.me,tp:e,templateID:o})},requestMagPassword:async function(e,o){if(!this.magPasswordView){let{default:t}=await import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-U2HSO23S.js");this.magPasswordView=new t({router:this,$parent:(0,vi.default)("#mags")})}this.magPasswordView.render({mag:o,mag_url:e})},showSuspended:async function(){let{default:e}=await import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-D57QBMWP.js");new e({type:"mag-suspended",$container:(0,vi.default)("#service-pages")}).render()},notFound:function(){yi.default.defer(async function(){let{default:e}=await import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-D57QBMWP.js");new e({type:"404",$container:(0,vi.default)("#service-pages")}).render()})}}),d_=S7;var fm=B(Mo()),Xe=B(pt());Ho();Bo();Zp();Qd();var zr=B(pt());eu();Ho();yr();var C7=ur.extend({id:"_groupSave",url:"/api/modelsGroup/",name:"GroupSave",skipResponse:!0,isNew:function(){return!1},toJSON:function(e){e=e||{};let o=e.attrs||ur.prototype.toJSON.apply(this,arguments),t=[];return zr.default.each(o.changeset,function(r){let i=r.model.name==="Widget",n;!e.patch&&(i||Ge("widget.putNotPatch"))?n=r.model.toJSON():n=zr.default.clone(r.attrs),n.modelType=r.model.name.toLowerCase(),t.push(n)}),t},set:function(e,o,t){if(e==null)return this;let r;return typeof e=="object"?(r=e,t=o):(r={})[e]=o,t||(t={}),t.noSet||(zr.default.each(r.changeset,function(i){let n=i.model,s=zr.default.clone(i.attrs);t.reset&&(s=n.getResetAttrs(n,s),s=n.parse(s)),t.groupsave=!0,i.model.set(s,t)}),r.changeset=zr.default.reject(r.changeset,function(i){return i.model.fakeSave})),ur.prototype.set.apply(this,arguments)},save:function(e,o,t){let r=this,i;zr.default.isObject(e)||e==null?(i=e,t=o):(i={},i[e]=o),!this.skipMagChanging&&!t?.skipMagChanging&&RM.constructorRouter.mag&&RM.constructorRouter.mag.set("changed",!0);let n=ur.prototype.save.apply(this,arguments);n&&(n.error(function(s,l){if(l!=="abort"){if(Ge("constructor.limitGroupSaves")){if(s.status&&s.status<500&&s.status!==429)return}else if(s.status&&s.status<500)return;r.wasNotSaved=!0,RM.constructorRouter.raiseConnectionError()}}),n.success(function(){r.wasNotSaved&&r.trigger("re-saved"),r.wasNotSaved=!1})),e&&e.changeset&&Re.trigger("save:group",{changeset:e.changeset,options:zr.default.isObject(o)?o:t})},sync:function(e,o,t){if(t.attrs&&t.attrs.changeset&&e=="patch"&&(t.attrs=this.toJSON(t)),!zr.default.isEmpty(t.attrs)||!zr.default.isEmpty(this.get("changeset")))return ur.prototype.sync.apply(this,arguments)},triggerSocketUpdate:function(e,o){let t=this.getViewport&&this.getViewport()||o?.viewport,r=zr.default.uniq(zr.default.map(e,function(i){return this.modelsList[i._id].model.getPageId()},this));if(e={changes:o.patch&&o.attrs?[...o.attrs]:e,pids:r},Array.isArray(e.changes)&&e.changes.length){let i={},n=[];if(e.changes.forEach(s=>{if(s?.modelType!=="widget"){n.push(s);return}(t&&t==="default"||s?._id&&this.modelsList[s._id]?.model?.get("is_global"))&&n.push(s),s.is_global&&s._id&&this.modelsList&&this.modelsList[s._id]&&this.modelsList[s._id].attrs&&(i[s._id]=this.modelsList[s._id].attrs)}),!n.length){RM.constructorRouter.trigger("update_from_server","UpdateInMobileViewport");return}n.length&&(e.changes=n),zr.default.isEmpty(i)||(e.widgetsAttrs=i)}RM.constructorRouter.trigger("update_from_server",this.name,e,t),this.clear({silent:!0})}}),u_=C7;Zp();yr();var m_=function(e,o){return this.router=e,this.mag=o,Re.on("set:model",this.onModelSet,this),Re.on("save:model",this.onModelSave,this),Re.on("ready:model",this.onModelReady,this),this.addHistoryStep.__debounced=Xe.default.debounce(this.addHistoryStep,300),this.historyModelsList={},this.groupSave=new u_,this.groupSave.modelsList=this.historyModelsList,this.lastSave=0,this.prevChangedList={},this.lastChangedList={},this};Xe.default.extend(m_.prototype,fm.default.Events,{MERGE_UNDO_DIFF:500,onModelReady:function(e){!e.tracked||this.historyModelsList[e.id]||(this.historyModelsList[e.id]={model:e,attrs:e.cloneJSON()})},whenModelReady(e){return new Promise(o=>{let t=e.id,r=i=>{i.id===t&&(Re.off("ready:model",r),o())};this.historyModelsList[t]?o():Re.on("ready:model",r)})},onModelSet:function(e){let o=e.model,t=e.options||{};if(this.historyModelsList[o.id]){if(Nn.isIncomingUpdate(t))return this.historyModelsList[o.id]={model:o,attrs:o.cloneJSON()},this.historyModelsList[o.id];this.lastChangedList[o.id]=Xe.default.keys(o.changed)}},onModelSave:function(e){let o=e.model,t=e.setAttrs;this.historyModelsList[o.id]&&this.addHistoryStep({model:o,attrs:this.historyModelsList[o.id].attrs,setAttrs:t},e.options)},setGroup:function(e,o){o=o||{};let t=[];Xe.default.each(e,function(r){let i=this.historyModelsList[r._id]&&this.historyModelsList[r._id].model;if(!i&&r instanceof Nn&&(i=r,r=Xe.default.extend({_id:r.get("_id")},r.changed)),o.socketUpdate&&i&&r.modelType==="widget"){let n=!1;if(Oe.viewport_listall.forEach(s=>{r[s]&&(n=!0,i[s]={...i[s]||{},...r[s]})}),n)return}if(!(!i&&o.socketUpdate)){if(!i)return console.error("SyncManager: model not found",r);t.push({model:i,attrs:r})}},this),this.groupSave.set({changeset:t},o),o.socketUpdate&&Xe.default.each(t,function(r){typeof r.attrs.is_global=="boolean"&&!r.attrs.is_global?this.historyModelsList[r.model.id]&&delete this.historyModelsList[r.model.id]:this.historyModelsList[r.model.id]={model:r.model,attrs:r.model.cloneJSON()}},this)},saveGroup:function(e=[],o){let t=e.reduce((n,s)=>n===s.name?n:"mixed",e?.[0]?.name);o=Xe.default.defaults(o||{},{patch:!(t==="Widget"&&Ge("widget.putNotPatch"))}),(o.undo||o.redo)&&(o.reset=!0,o.patch=!1);let r=o.changeset||this.getChangeset(e,o);o=Xe.default.omit(o,"changeset"),this.groupSaveXHR=this.groupSave.save({changeset:r},o);let i=this.getHistoryDict(r);o.applySnapshot&&o.applySnapshot(),this.addHistoryStep(i,o)},getChangeset:function(e,o){return e instanceof fm.default.Collection&&(e=e.models),Xe.default.isEmpty(e)&&(e=Xe.default.map(this.historyModelsList,function(t){return t.model})),e[0]instanceof fm.default.Model&&!Xe.default.isEmpty(e)?(o&&(o.noSet=!0),this.getChangedModelsData(e,o)):Xe.default.map(e,function(t){return{model:this.historyModelsList[t._id].model,attrs:t}},this)},getHistoryDict:function(e){return Xe.default.map(e,function(o){return Xe.default.extend({},this.historyModelsList[o.model.id],{setAttrs:o.attrs})},this)},getChangedModelsData:function(e,o={}){let t=[];return Xe.default.each(e,function(r){let i=r.toJSON(o),n=Xe.default.objectDifference(this.historyModelsList[r.id].attrs,i);o.byStoreAutolayoutBlocks&&Xe.default.isObject(r?.attributes)&&r.attributes.type==="text"&&r.attributes.version===3&&(Xe.default.isArray(i?.blocksMeta)&&(n.blocksMeta=[...i.blocksMeta]),Xe.default.isArray(i?.styles)&&(n.styles=[...i.styles])),Xe.default.isEmpty(n)||t.push({model:r,attrs:Xe.default.extend(n,{_id:r.get("_id")})})},this),t},addHistoryStep:function(e,o){if(Xe.default.isArray(e)||(e=[e]),o=o||{},Xe.default.each(e,function(i){i.model.undoKeys&&(i.attrs=Xe.default.pick(i.attrs,Xe.default.union(i.model.undoKeys,["_id"])))}),e=Xe.default.reject(e,function(i){let n=i.model.toJSON();return i.model.undoKeys&&(n=Xe.default.pick(n,Xe.default.keys(i.attrs))),Xe.default.isEqual(n,i.attrs)},this),Xe.default.isEmpty(e))return;let t=Xe.default.map(e,function(i){return i.model.id});Date.now()-this.lastSave<=this.MERGE_UNDO_DIFF&&!o.undo&&!o.redo&&Xe.default.all(Xe.default.pluck(e,"model"),function(n){return n.mergeUndoSteps!==!1})&&Xe.default.isEqual(Xe.default.pick(this.lastChangedList,t),this.prevChangedList)&&(o.replace=!0),o.undo||o.redo||o.skipHistory?this.prevChangedList={}:this.prevChangedList=Xe.default.clone(Xe.default.pick(this.lastChangedList,t)),this.lastChangedList=Xe.default.omit(this.lastChangedList,t),o.skipHistory||(this.lastSave=Date.now());let r=Xe.default.map(e,function(i){return{model:i.model,attrs:i.attrs}});o.skipHistory||Ot.add(r,o),Xe.default.each(e,function(i){let n=i.model.cloneJSON();if(o.patch){let s=i.setAttrs;n=Xe.default.deepExtend({},this.historyModelsList[i.model.id].attrs,s)}this.historyModelsList[i.model.id]={model:i.model,attrs:n}},this)}});var Vf=m_;tn();var g_={"template-constructor-workspace":Lt`


	<div class="workspace" aria-label="Workspace">
		<div class="origin" >
		</div>
        <div class="selectframe">
            <div class="frameborder"></div>
        </div>
		<div class="workspace-border"></div>
		<div class="page-size-control"></div>
		<div id="comments"></div>
	</div>
`};dx();yr();$h();Ho();ef();jI();sv();pr();Kx();var Zf=B(jp()),I_=B(H());zp();qa();var Yr=B(H());var h_=(e,o)=>{let t=e.getFullYear().toString(),r=(e.getMonth()+1).toString(),i=e.getDate().toString();switch(r=r.length===1?"0"+r:r,i=i.length===1?"0"+i:i,o){case"YYYYMMDD":return t+r+i;case"MMDDYYYY":return r+i+t;case"DDMMYYYY":return i+r+t;default:throw new Error("Invalid date format pattern")}};var C_=B(FI());var f_=B($6()),bm=f_.default;oe();Ve();N();$e();var b_=B(H());var w_=e=>{let[o,t]=(0,b_.useState)(e);return{isOpen:o,onToggle:()=>t(!o),onOpen:()=>t(!0),onClose:()=>t(!1)}};ln();jh();oe();N();W6();fe();var wm=B(H()),x_=e=>{(0,wm.useEffect)(()=>{if(!e)return;let o=document.createElement("script");return o.type="text/javascript",o.innerHTML=`(function(){${e}})()`,document.body.appendChild(o),()=>{window.onClearWhatsNewPopup&&window.onClearWhatsNewPopup(),document.body.removeChild(o)}},[e])},v_=e=>{(0,wm.useLayoutEffect)(()=>{if(!e)return;let o=document.createElement("style");return o.innerHTML=e,document.head.appendChild(o),()=>{document.head.removeChild(o)}},[e])};k();var P7=e=>e.hover?{":hover":e.hover}:{},y_=F(f)`
  z-index: 0;
  width: 336px;
  height: 496px;
  display: flex;
  color: #fff;
  border-radius: 8px;
  position: relative;
  user-select: none;
  background-size: cover;
  flex-direction: column;
  -webkit-font-smoothing: initial;
  ${en("backgroundColor")}
  ${en("backgroundImage",{transform:e=>()=>`url(${e})`})})}
`;y_.defaultProps={id:"popup-wrapper"};var Uf=F(ve)`
  font-size: 16px;
  margin-top: 25px;
  text-align: center;
`;Uf.defaultProps={id:"popup-caption"};var Gf=F(ve)`
  font-size: 24px;
  font-weight: 400;
  text-align: center;
  padding-bottom: 3px;
`;Gf.defaultProps={id:"popup-date-caption"};var jf=F(ve)`
  text-align: center;
  ${en("lineHeight",{transform:e=>()=>`${e}px`})};
  ${en("marginTop")};
`;jf.defaultProps={id:"popup-title"};var qf=Vx;qf.defaultProps={id:"popup-image"};var Yf=F(ve)`
  text-align: center;
  ${en("lineHeight",{transform:e=>()=>`${e}px`})};
  ${en("marginTop")};
`;Yf.defaultProps={id:"popup-description"};var Xf=F(Ce)`
  display: block;
  cursor: pointer;
  font-size: 16px;
  text-decoration: none;
  user-select: none;
  text-align: center;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  transition: 0.1s color, 0.1s background-color, 0.1s border-radius, 0.1s width, 0.1s height, 0.1s line-height;
  ${en("lineHeight",{transform:e=>()=>`${e}px`})};
  ${en("backgroundColor")};
  ${P7}
`;Xf.defaultProps={id:"popup-button"};function k_({customJsCode:e,customCssCode:o,...t}){return v_(o),x_(e),a(y_,{...t})}NI();k();var[T7]=Ga,__=5,ns=(e=>(e.prev="prev",e.next="next",e.show="show",e.close="close",e.outsideClose="outsideClose",e.buttonClick="buttonClick",e))(ns||{});function I7({defaultIsOpen:e=!1,getWhatsNew:o,onSeen:t,formatDate:r,lastUserSeen:i,userRegistrationDate:n,onClose:s,onAction:l}){let c=(0,Yr.useRef)(!0),[d,p]=(0,Yr.useState)({limit:10,skip:0}),[m,u]=(0,Yr.useState)(0),[g,h]=(0,Yr.useState)([]),{isOpen:b,onClose:x,onOpen:S}=w_(e),y=(0,Yr.useRef)("");(0,Yr.useEffect)(()=>{function A($){o(d).then(j=>{$(j),j.length<d.limit&&(c.current=!1),h(pe=>[...pe,...j])})}A($=>{if(!b&&i!==void 0&&n!==void 0&&$.length){let[j]=$,pe=new Date(j.date);new Date(i)<pe&&new Date(n)<pe&&S()}})},[d]),(0,Yr.useEffect)(()=>{b?(t&&t(),l&&l("show",y.current)):u(0)},[b]);let C=()=>{let A=Math.min(g.length,m+1);A%__===0&&g[A+__]===void 0&&c.current&&p({limit:10,skip:d.skip+10}),u(A),l?.("next",I(g[A]))},P=()=>{let A=Math.max(0,m-1);u(A),l?.("prev",I(g[A]))},v=A=>{T(A,!0)},T=(A,$=!1)=>{if(x(),s&&s(A),l){let{close:j,outsideClose:pe}=ns;l?.($?pe:j,y.current)}},R=()=>{l?.("buttonClick",y.current)},I=A=>{if(!A)return"";let $=A.name?.value||`_${A._id}`;return`${A.date&&h_(new Date(A.date),"YYYYMMDD")}${$}`},M=(0,Yr.useMemo)(()=>{let A=g[m];return y.current=I(A),A},[m,g]),D=b&&M!==void 0,[E]=Iy(D);return D?a(C_.default,{onExit:v,verticallyCenter:!0,titleId:"#popup-caption",initialFocus:"#close-popup-button",dialogStyle:E,underlayStyle:{...E,zIndex:1e4},children:w(f,{position:"relative",children:[w(k_,{customJsCode:M.js,customCssCode:M.css,...M.wrapper.cssProperties,children:[a(Uf,{...M.caption.cssProperties,children:"What's New"}),a(Gf,{...M.caption.cssProperties,children:r(M.date)}),M.title.text?a(jf,{dangerouslySetInnerHTML:{__html:bm.sanitize(M.title.text)},...M.title.cssProperties}):null,M.picture.url?a(qf,{marginLeft:"auto",marginRight:"auto",display:"block",srcSet:`${M.picture.url}, ${M.picture.url2x} 2x`,...M.picture.cssProperties}):null,M.description.text?a(Yf,{dangerouslySetInnerHTML:{__html:bm.sanitize(M.description.text)},...M.description.cssProperties}):null,a(Xf,{href:M.button.href,target:"blank",onClick:R,hover:M.button.hover,...M.button.cssProperties,children:M.button.text})]},M._id),a(M7,{id:"close-popup-button",variant:"unstyled",onClick:T,children:a(Nt,{height:14,width:14,color:"white"})}),w(f,{position:"absolute",display:"flex",flexDirection:"column",bottom:2,right:-64,children:[a(S_,{disabled:m===0,onClick:P,dir:"up",variant:"unstyled",children:a(Ys,{height:14,width:14,color:"#424242"})}),a(S_,{dir:"down",variant:"unstyled",onClick:C,disabled:m===g.length-1,children:a(Ys,{height:14,width:14,color:"#424242"})})]})]})}):null}var M7=F(ge)`
  top: 0;
  right: -56px;
  position: absolute;
  border-radius: 50%;
  opacity: 0.6;

  &:focus-within {
    outline-offset: 1px;
    outline: 1px auto rgb(153, 200, 255);
  }

  &:hover {
    opacity: 1;
  }

  @media (max-width: ${T7}) {
    top: -56px;
    right: 0;
  }
`,S_=F(ge)`
  width: 32px;
  height: 32px;
  display: flex;
  border-radius: 50%;
  margin-top: 8px;
  align-items: center;
  justify-content: center;
  background-color: ${({theme:e})=>e.colors.gray};

  &:focus-within {
    outline-offset: 1px;
    outline: 1px auto rgb(153, 200, 255);
  }

  &:hover {
    background-color: #fff;
  }

  ${e=>`transform: rotate(${e.dir==="up"?"90deg":"270deg"});`}
`,Kf=I7;je();Ws();var P_=async e=>{let{data:o}=await Zt.get("/api/whats-new",e);return o||[]},T_=async e=>{await Zt.post("/api/whats-new/seen",{date:e,type:"popup"})};k();function B7(e){let o=new Date().getFullYear(),t=new Date(e).getFullYear(),r=o===t?"MMMM d":"MMMM d, yyyy";return kr(new Date(e),r)}function xm(e){let o=(0,I_.useCallback)((t,r)=>{let i=n=>{se(he.WhatsNewPopup,{action:n,content:r})};switch(t){case ns.show:i("impression");break;case ns.next:case ns.prev:i(t===ns.next?"up":"down"),i("impression");break;case ns.buttonClick:i("click");break;default:i("close")}},[]);return a(Kf,{formatDate:B7,onSeen:()=>T_(new Date().toISOString()),getWhatsNew:P_,onAction:o,...e})}var Jf=(e,{lastUserSeen:o,userRegistrationDate:t})=>{let r=Zf.default.createRoot(e);function i(){r.unmount(),r=Zf.default.createRoot(e)}function n(){r.render(a(Fr,{withGlobalStyles:!1,children:a(xm,{lastUserSeen:o,userRegistrationDate:t})}))}return n(),{unmount:i}};je();Nh();rf();Wn();mi();Uo();vt();var J8=B(Qo());qa();N();Be();Jt();jt();Sr();oe();N();Co();_I();var Al=B(H());fI();bI();N();Ve();Uo();zt();oe();k();function R7({id:e,targetSteps:o,hidden:t,width:r,height:i,borderRadius:n,onClick:s,onMouseEnter:l,onMouseLeave:c,className:d,children:p,backgroundColor:m,disableHover:u=!1,color:g,disabled:h,tooltip:b,tooltipPosition:x,tooltipDisabled:S,tooltipPadding:y,forceTooltip:C,"data-testid":P,tooltipPreventOverflow:v,cursor:T}){let R=a(f,{onMouseEnter:l,onMouseLeave:c,className:d,width:r||56,height:i||56,alignItems:"center",justifyContent:"center",borderRadius:n||30,color:g||h?"gray":"white",backgroundColor:m||Me(C?"black":"darkGray",.88),cursor:T||"pointer",backdropFilter:"blur(3px)",display:t?"none":"flex",css:ae`
        ${u?"":`
          &:hover {
            background: ${Le(.12,h?V.darkGray:V.black)};
          }
        `}
      `,children:p}),I={key:b,placement:x||"top",indent:4,open:S?!1:C,preventOverflow:v,componentProps:{tooltip:{padding:y}}};return a(f,{display:"flex",id:e,"data-testid":P,onClick:s,children:b?a(gt,{...I,targetSteps:o,defaultText:b,children:R}):R})}var El=f.withComponent(R7);Be();vt();sn();gl();k();function z7({previewOnly:e,hidden:o}){let t=(0,Al.useContext)(Ee),{switchToPreview:r}=(0,Al.useContext)(ce),{switchToConstructor:i}=(0,Al.useContext)(mr),[n,s]=(0,Al.useState)(!1),l=e||t.inPreview;return gr("p",()=>{l?i():r()},[l,i,r],{ignoreSelector:window.RM.constructorRouter.workspaceTextInputSelectors}),a(El,{id:"preview-toggle-button",targetSteps:["PreviewAndPublish","BackToConstructor","CheckPreview","GoBackToEditor"],tooltip:l?"Edit (P)":"Preview (P)",tooltipDisabled:n,hidden:o,onMouseEnter:()=>n&&s(!1),tooltipPreventOverflow:16,onClick:()=>{l?i():r(),s(!0),l?He(["BackToConstructor","GoBackToEditor"]):(window.RM.constructorRouter.trigger("notice:triggerEduTipClose"),He(["PreviewAndPublish","CheckPreview"]))},children:l?a(Wv,{preserveAspectRatio:"none",width:38,height:38}):a(Vv,{height:"26px",width:"38px"})})}var vm=z7;var fn=B(H());Be();sn();N();fe();Fo();Ve();st();on();ro();zt();Od();oe();pr();vt();Ir();Od();k();function A7({textStyle:e,...o}){let t=(0,fn.useContext)(ce),r=(0,fn.useContext)(Ee),{switchToConstructor:i}=(0,fn.useContext)(mr),{showNotice:n}=Fd(),s=Cr(t.project),l=(0,fn.useCallback)(()=>{let g="Injected Code, Forms, Lottie and Shots will not work in Published project.",h=!t.hasPermission("can_inject_code")&&t.hasCustomCode(),b=!t.hasPermission("can_use_shots")&&t.hasShots(),x=!t.hasPermission("can_use_forms")&&t.hasForms();(h||b||x)&&n(g,{canBeClosed:!0,closeByTimer:!0})},[]),d=`${le.readymag_viewer_host}/${t.project.user.uri}/${t.project.uri}/`,p=(0,fn.useMemo)(()=>{let g=t.pages.find(h=>h._id===t.currentPageId);return g&&g.num!==1?`${d}num/${g.num_id}`:d},[d,t.currentPageId]),m=!t.isPublishError&&!t.publishInProgress&&s==="sameAsPublished",u=(0,fn.useCallback)(async()=>{if(s!=="sameAsPublished"&&!t.publishInProgress)try{await t.publishWithNotice({fromPreview:r.inPreview,isSharedAsTemplate:r.isCopyableSwitcherEnabled});let g=r.inPreview?i:t.switchToPreview;He("BackToConstructor",{cb:g})}catch(g){if(g instanceof Ja&&g.type==="warning"){await t.publishWithNotice({skipWarnings:!0,alsoExport:r.exportAsTemlate,dontRenewScreenshots:r.dontRenewScreenshots,isSharedAsTemplate:r.isCopyableSwitcherEnabled});let h=["type-widget-shots","type-code-injection","type-widget-shots","type-widget-lottie"];g.tag&&h.includes(g.tag)?rt("widgets"):rt("default")}else if(g instanceof Ja){let h={canBeClosed:!0,closeByTimer:!0};g.tag==="type-publish-noemail"?n(g.message,h):g.tag==="type-publish-limit"?rt("publish-limit"):g.tag==="type-publish-paused-subcription"?n(g.message,h):rt("default")}else throw g}},[s,t.publishInProgress,r.isCopyableSwitcherEnabled,t.project.isCopyableTemplate,i,t.switchToPreview]);return a(f,{id:"publish-button",width:128,height:56,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:30,backgroundColor:Le(.12,V.darkGray),color:"white",position:"relative",cursor:"pointer",backdropFilter:"blur(3px)",css:ae`
        &:hover {
          background: ${Le(.12,V.black)};
        }
      `,onMouseEnter:m?void 0:l,onClick:u,...o,children:a(L,{textStyle:e,textAlign:"center",as:m?"a":"span",href:m?p:void 0,target:"_blank",display:"block",lineHeight:"52px",height:"56px",textDecoration:"none",color:"inherit",...m?{position:"absolute",top:2,right:0,bottom:0,left:0}:{},children:t.isPublishError?"Error":t.publishInProgress?a(mt,{bgColor:"transparent"}):s==="unpublishedChanges"?"Republish":s==="sameAsPublished"?"Open":"Publish"})})}var B_=A7;var ss=B(H());N();fe();fl();oe();ro();Ve();zt();je();Jt();var to=B(H());Eh();oe();N();$0();oe();Jt();UI();dx();Be();k();var _c=(0,to.createContext)({});_c.displayName="ToolbarPopoverContext";var L7=(0,to.forwardRef)(({stroke:e},o)=>a("svg",{ref:o,width:"16",height:e?"10":"8",xmlns:"http://www.w3.org/2000/svg",viewBox:e?"0 0 16 10":"0 0 16 8",children:e?w(q,{children:[a("path",{fill:"currentColor",d:"M16 0H0V2C2.20914 2 4 3.79086 4 6C4 8.20914 5.79086 10 8 10C10.2091 10 12 8.20914 12 6C12 3.79086 13.7909 2 16 2V0Z",fillRule:"evenodd"}),a(f,{as:"path",fillRule:"evenodd",fill:e,d:"M0 0.0059433V2.00594C2.20914 2.00594 4 3.79681 4 6.00594C4 8.21508 5.79086 10.0059 8 10.0059C10.2091 10.0059 12 8.21508 12 6.00594C12 3.79681 13.7909 2.00594 16 2.00594V0.0059433C16 0.0059433 14.8115 0.00594401 14 0.347355C12 1.18877 10 3.39351 10 6.00594C10 7.11051 9.10457 8.00594 8 8.00594C6.89543 8.00594 6 7.11051 6 6.00594C6 3.39351 4.33039 1.17103 2 0.347355C1.36768 0.129361 0.930277 0.0625123 0 0.0059433Z"})]}):a("path",{fill:"currentColor",d:"M0 0C2.20914 0 4 1.79086 4 4C4 6.20914 5.79086 8 8 8C10.2091 8 12 6.20914 12 4C12 1.79086 13.7909 0 16 0H0Z",fillRule:"evenodd"})})),Xt=(0,to.forwardRef)(({id:e,name:o,closeOnOutsideClick:t=!0,onWindowBlur:r,children:i,skidding:n,button:s,onToggle:l,isAutoHeight:c,panelPosition:d={},ArrowProps:p={},withArrow:m=!0,watchingClick:u=T=>T,disabled:g=!1,disableInteractions:h=!1,disablePortal:b=!1,"data-testid":x,transform:S,onButtonClick:y,alwaysOpen:C,...P},v)=>{let{currentPanel:T,openPanel:R,closePanels:I}=(0,to.useContext)(Ct),M=(0,to.useContext)(Ee),[D,E]=(0,to.useState)(null),[A,$]=(0,to.useState)(null),[j,pe]=(0,to.useState)(null),ee=(0,to.useRef)(null),G=(0,to.useRef)(null),K=T?T===o:!1,[we,xe]=(0,to.useState)({tooltipContainer:ee.current||void 0,dropdownContainer:G.current||void 0});(0,to.useEffect)(()=>{(we.tooltipContainer!==ee.current||we.dropdownContainer!==G.current)&&xe(te=>({...te,tooltipContainer:ee.current||void 0,dropdownContainer:G.current||void 0}))},[ee.current,G.current]),(0,to.useEffect)(()=>{function te(){r?.(document.activeElement,I)}return K&&r&&window.addEventListener("blur",te),()=>{window.removeEventListener("blur",te)}},[K,r,I]);let _e=Ly({watchingClick:u(K&&!M.isUserTemplatesModalShown&&!M.isRmTemplatesModalShown),callback:te=>{let ye=!document.body.contains(te.target),de=Se=>Array.from(document.querySelectorAll("#settings-container, #react-aria-modal-dialog, .template-center, #my-templates-modal, .constructor-navigation-arrows, body > .popups, .code-editor-modal-overlay, .help-shortcuts, .code-editor-block")).find(Ae=>Ae&&Ae.contains(Se));t&&D&&!D.contains(te.target)&&!ye&&!de(te.target)&&I()}},[t]),{styles:ie,attributes:ze,update:ne}=nl(D,A,{placement:"top",modifiers:[{name:"offset",options:{offset:[n||0,16]}},{name:"arrow",options:{element:j,padding:p.popperPadding}}]}),J=(0,to.useRef)(M.inPreview),X=window.location.pathname.includes("/template-submission");(0,to.useEffect)(()=>{X&&setTimeout(()=>{R(J.current?"preview-share":"project-settings")},100)},[]),(0,to.useEffect)(()=>{ne&&ne(),l&&l(K)},[K]);function Q(te){y?y(te):g||(K?I():R(o))}return w(q,{children:[(K||C)&&a(Gd,{disablePortal:b,ref:te=>{if(b){let ye=te;$(ye),_e.current=ye}},children:a(f,{ref:te=>{b||($(te),_e.current=te,v&&(v.current=te))},id:e,display:"flex",flexDirection:"column",justifyContent:"flex-end",width:"224px",height:c?"auto":Va.isTablet()?`${window.innerHeight-108}px`:"calc(100vh - 108px)",maxHeight:Va.isTablet()?`${window.innerHeight-108}px`:"calc(100vh - 108px)",zIndex:"7100",style:{...ie.popper,...S?{transform:S}:{}},"data-testid":x,css:ae`
                ${h?`
                  pointer-events: none;
                  user-select: none;

                  * {
                    pointer-events: none !important;
                    user-select: none !important;
                  }
                `:""}
              `,...d,...ze.popper,children:w(_c.Provider,{value:we,children:[typeof i=="function"?i({popoverShown:K}):i,m&&a(f,{zIndex:"1",bottom:-10,ref:pe,style:ie.arrow,position:"absolute",color:p.backgroundColor||Me("lightGray",.96),...p.position,children:a(L7,{stroke:p.stroke})}),a(f,{ref:ee}),a(f,{ref:G})]})})}),a(f,{ref:E,...P,onClick:Q,opacity:g?.4:1,pointerEvents:g?"none":"all",children:s({isPanelShown:K})})]})});k();k();Be();sn();su();N();k();function Tt({padding:e,margin:o,"data-testid":t,textAlign:r="left",children:i}){return a(f,{width:"100%",padding:e||"12px 14px",margin:o||"0",borderRadius:"8px",backgroundColor:"white",textAlign:r,"data-testid":t||"common-error-message",display:"flex",flexDirection:"column",children:i})}aM();Uo();vt();k();var D7=({isActive:e,name:o,divider:t=!0,disabled:r})=>a(f,{width:"100%",height:48,display:"flex",cursor:"pointer",userSelect:"none",alignItems:"center",position:"relative",justifyContent:"left","data-testid":"project-settings-viewer","aria-label":`${o} viewer settings tab`,borderTop:"2px solid",borderTopColor:t?"gray":"transparent",css:ae`
        &:hover {
          & span {
            color: ${e&&r?V.gray:e?V.black:V.red};
          }
        }
      `,children:a(f,{position:"relative",bottom:"2px",children:a(L,{color:r?"gray":"black",textStyle:"subheading",children:o})})});function Qf({children:e,button:o,...t}){let{desktopOptions:r,phoneOptions:i,tabletOptions:n,setProjectOptions:s,viewport:l,setViewport:c,currentPageId:d,iframeElement:p}=(0,ss.useContext)(mr),{getProjectPermissionsOverrides:m,pages:u}=il(),[g]=iu(),h=u.find(v=>v._id===d),b=h?.viewport_phone_portrait?.enabled,x=h?.viewport_tablet_portrait?.enabled,S=Ht(),y=(0,ss.useMemo)(()=>({default:{options:r,...m(r),name:"Desktop"},tablet_portrait:{options:n,...m(n),name:"Tablet"},phone_portrait:{options:i,...m(i),name:"Mobile"}}),[i,n,r,m]),C=g==="iPhone SE horizontal"&&!x?"default":g==="iPhone SE horizontal"&&x?"tablet_portrait":l,P=(0,ss.useCallback)((v,T)=>{v===p&&T()},[p]);return a(Xt,{disablePortal:!0,name:"viewer-settings",skidding:-28,button:o,onWindowBlur:P,ArrowProps:{stroke:Le(.84,V.gray)},onToggle:v=>{v?se(he.SettingsPreviewViewer,{action:"viewer settings open"}):S.started&&S.tourType==="pro"&&S?.step?.name==="PointerCursorUpload"&&He("PointerCursorUpload")},...t,children:a(f,{width:224,height:"100%",color:"black",display:"flex",borderRadius:"2rm",flexDirection:"column",backgroundColor:"lightGray",border:"2px solid rgba(184, 184, 184, 0.16)",children:a(f,{height:"calc(100% - 100px)",flexGrow:1,children:a(Gr,{transition:{mass:1,stiffness:210,damping:20},value:C,onChange:v=>{l&&c(v),v==="phone_portrait"&&se(he.SettingsPreviewViewer,{action:"mobile tab open"})},children:Object.keys(y).map((v,T)=>{let{options:R,disabled:I,name:M}=y[v],D=v==="phone_portrait",E=v==="tablet_portrait",A=E?x:D?b:!0,$=(0,ss.useMemo)(()=>E||D?["scalableviewer","slidein","projectinfo","useCustomCursor","controlsontop","viewerNext"]:[],[E,D]),j=(0,ss.useCallback)(pe=>{s(pe,v)},[v,s]);return a(mo,{value:v,renderButton:({isActive:pe})=>w(f,{padding:"0 16px",children:[M==="Desktop"&&a(f,{position:"relative",top:24,children:a(gt,{targetSteps:["SwitchToDesktop"],position:"left",indent:24,children:a("div",{})})}),a(D7,{isActive:pe,name:M,divider:T>0,disabled:!A})]}),children:pe=>a(f,{ref:pe,paddingLeft:16,paddingRight:16,paddingBottom:16,"aria-label":`${M} viewer`,children:A?a(sk,{selectedViewport:C,options:R,exclude:$,disabled:I,setProjectOptions:j}):a(Tt,{margin:"0 0 14px",children:a(L,{textStyle:"small",color:"black",children:"Desktop layout is used"})})})},v)})})})})})}var Ll=B(H());oe();Wo();$e();zt();Uo();k();var R_=(0,Ll.createContext)({isSomeHovered:!1,getButtonProps:()=>({})});function z_({children:e}){let{isHovered:o,...t}=Ke(),r=(0,Ll.useCallback)(()=>t,[t]);return a(R_.Provider,{value:{isSomeHovered:o,getButtonProps:r},children:e})}var O7=F(Ue)`
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background-color: ${({isActive:e,theme:o})=>e?Le(.25,o.colors.black):"initial"};

  &:hover {
    background-color: ${({theme:e})=>Le(.25,e.colors.black)};
  }
`;function eb({TooltipProps:e,tooltipTargetSteps:o,icon:t,isActive:r,...i}){let{isSomeHovered:n,getButtonProps:s}=(0,Ll.useContext)(R_);return a(gt,{indent:8,leaveDelay:100,enterDelay:1400,open:e.disabled?!1:void 0,...e,defaultText:e.text,targetSteps:o,children:a("span",{children:a(O7,{variant:"unstyled",isActive:!n&&r,"aria-label":e.text,...i,...s(),children:t})})})}k();var E_=()=>w("svg",{width:"56",height:"56",viewBox:"0 0 56 56",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[a("path",{d:"M36.0343 20.5346C36.4265 20.9248 36.4273 21.5593 36.0361 21.9505C35.6463 22.3404 35.0145 22.3412 34.6237 21.9523L28.9741 16.3309L29.0009 34.0111C29.0017 34.5569 28.5595 34.9998 28.0137 34.9998C27.4691 34.9998 27.0274 34.5587 27.0265 34.0141L26.9998 16.3903L21.4028 21.9817C21.0123 22.3719 20.3794 22.3718 19.989 21.9814C19.5983 21.5907 19.5985 20.9573 19.9893 20.5668L27.2331 13.3302C27.3191 13.2443 27.4169 13.1773 27.5213 13.1292C27.9048 12.8986 28.4098 12.948 28.7414 13.2779L36.0343 20.5346Z",fill:"currentColor"}),a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 25.9999C16.5523 25.9999 17 26.4476 17 26.9999V36.9999C17 39.7613 19.2386 41.9999 22 41.9999H34C36.7614 41.9999 39 39.7613 39 36.9999V26.9999C39 26.4476 39.4477 25.9999 40 25.9999C40.5523 25.9999 41 26.4476 41 26.9999V36.9999C41 40.8659 37.866 43.9999 34 43.9999H22C18.134 43.9999 15 40.8659 15 36.9999V26.9999C15 26.4476 15.4477 25.9999 16 25.9999Z",fill:"currentColor"})]});var Om=B(H());N();sn();Jt();var mS=B(H());N();fl();var ca=B(H());N();$e();fe();je();Be();st();var Po=B(H()),L_=B(Qo());$e();N();fe();ro();Ve();Fo();var Dl=B(H());je();Co();fe();fe();oe();N();$e();Ws();var km=e=>Zt.post("/api/featured/submit",{url:e}),_m=e=>Zt.delete("/api/featured/submit",{url:e});Be();on();st();Ir();k();var $7=w(L,{textStyle:"small",marginTop:8,marginBottom:8,children:["The R/m design team will review ",a("br",{}),"your website and email you ",a("br",{}),"if it is selected into"," ",a(Ce,{isUnderlined:!0,color:"white",target:"_blank",rel:"noopener noreferrer",href:"https://readymag.com/examples",css:ae`
        &:hover {
          color: white;
          text-decoration: none;
        }
      `,children:"Examples"})]}),H7=w(L,{textStyle:"small",marginTop:8,marginBottom:8,children:["Revoke your submission",a("br",{}),"to Examples if you changed your mind"]}),A_=()=>{let{project:e}=(0,Dl.useContext)(ce),o=Cr(e),[t,r]=(0,Dl.useState)(!!e?.submitted_for_featured),i=(0,Dl.useMemo)(()=>{let l=window.RM.constructorRouter.me.get("stripe")||{};return l.subscription_status==="active"||l.subscription_status==="trialing"},[]),n=async(l,c)=>{try{await l(`${le.readymag_host}/${e.num_id}/`),r(c),se(he.SettingsProject,{settingsType:`submit to examples ${c?"on":"off"}`})}catch{console.warn("sendToExamples error")}},s=()=>{if(!i){rt("submit-to-examples");return}t?n(_m,!1):n(km,!0)};return a(q,{children:a(St,{interactive:!0,text:t?H7:$7,indent:4,componentsProps:{tooltip:{width:186},arrow:{marginLeft:68}},children:a(f,{children:a(ge,{display:"block",disabled:o==="unpublished",width:"100%",height:40,variant:"bordered",textStyle:"small",onClick:s,"data-testid":"submit-examples-button",children:t?"Revoke submission":"Examples"})})})})};Be();tI();st();pr();je();k();var Sm=({children:e,...o})=>a(ge,{display:"block",width:"100%",height:40,variant:"bordered",textStyle:"small",...o,children:e}),F7=({isPreview:e=!1})=>{let o=(0,Po.useContext)(ce),[t,r]=(0,Po.useState)(!1),[i,n]=(0,Po.useState)(!1),[s,l]=(0,Po.useState)(!1),[c,d]=(0,Po.useState)(o.project.templateSubmissionStatus),[p,m]=(0,Po.useState)(!1),[u,g]=(0,Po.useState)(!0),[h,b]=(0,Po.useState)(!1),[x,S]=(0,Po.useState)(!1),y=document.querySelector("body > .popups"),C=(0,Po.useMemo)(()=>[Hr.approved,Hr.pending,Hr.needs_revision,Hr.unsubmission_requested,Hr.resubmitted],[]);(0,Po.useEffect)(()=>{let D=()=>{let E=window.location.pathname.includes("/template-submission");!E&&p?m(!1):!C.includes(c)&&E?m(!0):E&&T()};return D(),window.addEventListener("popstate",D),()=>{window.removeEventListener("popstate",D)}},[c,C,p]),(0,Po.useEffect)(()=>{p&&se("submitTemplateFormOpened",{action:"opened"})},[p]),(0,Po.useEffect)(()=>{i&&setTimeout(()=>{n(!1)},5e3)},[i]),(0,Po.useEffect)(()=>{s&&setTimeout(()=>{l(!1)},5e3)},[s]);let P=()=>{if(!o.checkIsEmailVerified()){Yp("Please verify your email address.",{canBeClosed:!0,closeByTimer:!0});return}o.renewLastScreenshot(),m(!0);let E=window.location.pathname.replace("/contents","");window.history.pushState({},"",`${window.location.origin}${E}template-submission/${window.location.search}`)},v=()=>{m(!1),T()},T=()=>{let D=window.location.pathname.replaceAll("/template-submission","");window.history.pushState({},"",`${window.location.origin}${D}${window.location.search}`)},R=D=>{d(D),T()},I=async()=>{r(!1),b(!0);let D=await o.sendUnsubmitTemplate();b(!1),D===Hr.unsubmitted&&(n(!0),se("settingsProject",{settingsType:"unsubmit from templates"})),d(D)},M=async()=>{S(!0);try{let D=await o.sendResubmitTemplate();d(D),D===Hr.resubmitted&&l(!0)}finally{S(!1)}};return w(f,{display:"flex",flexDirection:"column",gap:8,...e?{paddingTop:8}:{borderTop:"1px solid",borderTopColor:Ua.transparentGrey,paddingTop:16},children:[a(A_,{}),(c===Hr.needs_revision||c===Hr.resubmitted)&&a(Sm,{disabled:x||h||i||s,onClick:M,"data-testid":"resubmit-templates-button",children:x?a(f,{display:"flex",justifyContent:"center",marginTop:-8,children:a(mt,{bgColor:"transparent",color:"lightGray"})}):a(q,{children:s?"Resubmitted":"Resubmit to Templates"})}),t?w(f,{display:"flex",flexDirection:"row",gap:8,children:[a(Sm,{background:"white",onClick:()=>r(!1),"data-testid":"cancel-unsubmit-templates-button",children:"Cancel"}),a(Sm,{background:"white",color:V.red,onClick:I,"data-testid":"unsubmit-templates-button",children:"Unsubmit"})]}):a(Sm,{disabled:i||c===Hr.unsubmission_requested||h||x||s,onClick:C.includes(c)?()=>r(!0):P,"data-testid":"submit-templates-button",children:h?a(f,{display:"flex",justifyContent:"center",marginTop:-8,children:a(mt,{bgColor:"transparent",color:"lightGray"})}):a(q,{children:i?"Unsubmitted":c===Hr.unsubmission_requested?"Unsubmission requested":C.includes(c)?"Unsubmit from Templates":"Templates"})}),p&&y?L_.default.createPortal(a(V0,{onExit:v,onSubmit:R,showHint:u,setShowHint:g}),y):null,a(Tt,{children:C.includes(c)?w(L,{textStyle:"small",lineHeight:"14px",children:["To make changes in your Template"," ",a(Ce,{color:V.blue,href:`mailto:${le.SUPPORT_MAIL}`,onClick:()=>{se("settingsProject",{settingsType:"email us to change template"})},children:"email us"})]}):w(L,{textStyle:"small",lineHeight:"14px",children:["Make sure your project fits\u2014check ",a(Ce,{color:V.blue,target:"_blank",rel:"noopener noreferrer",href:"https://help.readymag.com/hc/en-us/articles/37197706249627-Templates-Requirements",children:"requirements for Community templates"})]})})]})},Cm=F7;k();function D_({shareMode:e}){let[o,t]=(0,ca.useState)(!1),{project:r,currentPageId:i,pages:n}=(0,ca.useContext)(ce),s=(0,ca.useMemo)(()=>n.find(d=>d._id===i),[i]),l=(0,ca.useMemo)(()=>{let d=le.readymag_viewer_host;return r.domain||new URL(d).hostname},[r.domain]),c=()=>{let d=e==="page"?`${s?.num}`:r.num_id,p=RM.common.embedDomainName||window.location.protocol+"//"+l;navigator.clipboard.writeText(`${p}/${d}`),t(!0),se(he.SettingsProject,{settingsType:"copy link"}),r.isPublishedAsTemplate&&se("settingsProject",{settingsType:"copy link of user template"}),setTimeout(()=>t(!1),2500)};return w(f,{display:"flex",flexDirection:"column",gap:16,paddingBottom:16,children:[r.is_published?null:a(N7,{}),w(f,{children:[a(Ue,{display:"block",disabled:!r.is_published,width:"100%",height:40,variant:"bordered",textStyle:"small",onClick:c,"data-testid":"copy-link-button",children:o?"Copied":"Copy Link"}),a(Cm,{isPreview:!0})]})]})}var N7=()=>a(f,{children:a(Tt,{children:a(ve,{textStyle:"small",color:"black",children:"To share your project or submit to Examples, it has to be published."})})});var Xr=B(H()),Pm=B(Qo());$e();fe();N();var as=B(H());N();$e();fe();dr();je();N();Dp();var O_=B(Js());gl();_r();k();function W7({children:e,onExit:o}){return gr(O_.Key.Escape,o,[o]),w(q,{children:[a($i,{zIndex:uo.popupZindex-1,backgroundColor:"#000","data-testid":"export-modal-overlay",onClick:o}),a(f,{display:"flex",position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:uo.popupZindex-1,margin:"auto",padding:"16px 24px 28px 24px",borderRadius:"8px",flexDirection:"column",backgroundColor:"lightGray",width:336,height:584,role:"dialog","aria-modal":"true",children:e})]})}var Ol=W7;Qa();oe();k();function V7({numId:e,onExit:o,totalPages:t,email:r="your email"}){let[i,n]=(0,as.useState)(!1),[s,l]=(0,as.useState)(!1),[c,d]=(0,as.useState)(""),[p,m]=(0,as.useState)(!1),[u,g]=(0,as.useState)(),[h,b]=(0,as.useState)(!1),[x,S]=(0,as.useState)(""),y=R=>{let I=[],M=R.split(",").map(D=>D.trim());for(let D of M){if(!/^\d+$/.test(D)&&!/^\d+-\d+$/.test(D))return S("Please enter valid numeric values and valid ranges (e.g., 1-5)"),[];if(/^\d+$/.test(D)){let E=parseInt(D,10);if(E===0)return S("Pages amount can not be 0"),[];I.push(E)}else if(/^\d+-\d+$/.test(D)){let[E,A]=D.split("-").map($=>parseInt($,10));for(let $=E;$<=A;$++)I.push($)}}return Math.max(...I)>t?(S("It\u2019s impossible to export more pages than the project includes"),[]):Array.from(new Set(I))};return w(Ol,{onExit:o,children:[a(L,{as:"div",textStyle:"subheading",marginBottom:24,lineHeight:"30px",children:"Export to PDF"}),i?w(q,{children:[w(L,{as:"div",children:["Your project is being converted.",a("br",{}),"We will send you the download link to ",r," when it\u2019s ready."]}),a(ge,{width:"100%",height:56,marginTop:"auto",variant:"bordered",onClick:o,children:"Done"})]}):w(q,{children:[w("form",{onSubmit:async R=>{if(s)return;R.preventDefault();let I;try{I=p?y(c):void 0}catch(M){g(M);return}try{l(!0),await c0(e,I),l(!1),n(!0),se(he.SettingsProject,{settingsType:"export to pdf"})}catch(M){l(!1),b(!0),typeof M=="string"?S(M):M&&typeof M=="object"&&"message"in M&&typeof M.message=="string"&&S(M.message),setTimeout(()=>{b(!1),S("")},5e3)}},children:[w(f,{display:"flex",children:[a(f,{width:"50%",children:a(Ce,{color:p?"gray":"black",onClick:R=>{R.preventDefault(),m(!1),S("")},children:"All pages"})}),a(f,{width:"50%",children:a(yt,{name:"page-range",value:c,placeholder:"or select e.g. 2-8",onChange:R=>{g(void 0),S("");let{value:I}=R.target;m(!!I),d(I),y(I)},onFocus:()=>{m(!!c),g(void 0),y(c)},padding:0,color:p?"black":"gray",css:ae`
                    &:focus {
                      border: none;
                    }
                  `})})]}),a(ge,{disabled:h||!!x||s,width:"100%",height:56,marginTop:20,variant:"bordered",children:h||x?"Error":"Create PDF"})]}),!!x&&a(L,{as:"div",textStyle:"small",color:"tomato",marginTop:14,children:x}),u&&a(L,{as:"div",textStyle:"small",color:"tomato",marginTop:14,children:u}),a(L,{as:"div",marginTop:"auto",textStyle:"small",color:"darkGray",children:"Please note: due to license restrictions, all Adobe Fonts or type.today fonts will be replaced with alternatives."})]})]})}var $_=V7;var $l=B(H());je();oe();Qa();fe();$e();dr();N();fi();k();var Sc=F(f)`
  & + & {
    margin-top: 1.3em;
  }
`;function U7({numId:e,defaultSearchEngineIndexing:o,email:t="your email",onExit:r}){let[i,n]=(0,$l.useState)(!1),[s,l]=(0,$l.useState)(""),[c,d]=(0,$l.useState)(!1),[p,m]=(0,$l.useState)(!1),[u,g]=(0,$l.useState)(o);return w(Ol,{onExit:r,children:[a(L,{as:"div",textStyle:"subheading",marginBottom:24,lineHeight:"30px",children:"Export to HTML"}),i?w(q,{children:[w(L,{as:"div",children:["Your project is being converted. We will send you the download link to ",t," when it\u2019s ready."]}),a(ge,{width:"100%",height:56,marginTop:"auto",variant:"bordered",onClick:r,children:"Done"})]}):w(q,{children:[w("form",{onSubmit:async b=>{if(!(p||!s)){b.preventDefault();try{m(!0),se(he.SettingsProject,{settingsType:"export to html"}),await d0(e,{origin:s,searchEngineIndexing:u}),n(!0),m(!1)}catch{m(!1),d(!0),setTimeout(()=>d(!1),5e3)}}},children:[a(L,{as:"div",children:"Please provide the full path for your destination webpage. Typekit fonts will only work on the URL specified."}),a(yt,{name:"base-url",placeholder:"domain.com or domain.com/page",value:s,onChange:b=>l(b.target.value),padding:0,marginTop:12,css:ae`
                &:focus {
                  border: none;
                }
              `}),a(ge,{disabled:!s||c||p,width:"100%",height:56,marginTop:20,variant:"bordered",children:c?"Error":"Create export"}),w(f,{as:"label",display:"flex",alignItems:"center",marginTop:20,justifyContent:"space-between",children:[a(L,{children:"Search engine indexing"}),a(Wt,{backgroundChecked:"green",checked:u,onChange:g})]})]}),w(L,{as:"div",marginTop:"auto",textStyle:"small",color:"darkGray",children:[a(Sc,{children:"Please note:"}),a(Sc,{children:"Exported forms will not work with Google Docs or Mailchimp. The URL option will still be available."}),a(Sc,{children:"Page-specific sharing settings will not be exported. Sharing settings from the first page will be applied to the whole project."}),a(Sc,{children:"Exported projects cannot be password-protected."}),a(Sc,{children:a(Ce,{textStyle:"small",href:"https://help.readymag.com/hc/en-us/articles/360020647452-Code-export",target:"_blank",rel:"noopener noreferrer",children:"Learn more"})})]})]})]})}var H_=U7;var bn=B(H());je();N();fe();Kp();$e();wu();Ay();fi();k();function G7({magUrl:e,projectNumId:o,onIframeEmbedAllowedChange:t,isIframeEmbedAllowed:r=!1,onExit:i}){let[n,s]=(0,bn.useState)("Copy code"),[l,c]=(0,bn.useState)(0),[d,p]=(0,bn.useState)(0),[m,u]=(0,bn.useState)(!1),g=[{title:"Pixels"},{title:"Percentage"}],h=l===0,b=d===0,[x,S]=(0,bn.useState)(640),[y,C]=(0,bn.useState)(480),[P,v]=(0,bn.useState)(100),[T,R]=(0,bn.useState)(100),I=h?`width: ${x}px`:`width: ${P}%`,M=b?`height: ${y}px`:`height: ${T}%`,E=`<iframe src="${m?e:`${e}?link_target=parent`}" style="border: 0; ${I}; ${M};"></iframe>`,A=()=>{navigator.clipboard.writeText(E),s("Copied"),se(he.SettingsProject,{settingsType:"export to iframe"}),setTimeout(()=>{s("Copy code")},2500)},$=()=>{t(r?"disallow":"allow",o)},j=h?x:P,pe=String(j).length,ee=pe===4?42:pe===5?33.6:56,G=pe===4?1.5:pe===5?1.835:1,K=b?y:T,we=String(K).length;return w(Ol,{onExit:i,children:[a(L,{as:"div",textStyle:"subheading",marginBottom:26,lineHeight:"30px",children:"Embed as iframe"}),w(f,{display:"flex",marginBottom:"4px",children:[w(f,{width:144,children:[a(L,{display:"block",children:"Width"}),a(f,{marginLeft:-16,marginTop:"-3px",marginBottom:"1px",width:140,children:a(ac,{items:g,onChange:c,activeIndex:l})}),a(cn,{fontSize:ee,value:j,lineHeight:G,height:66,min:0,max:h?99999:100,maxLength:5,onChange:({value:ie})=>h?S(ie):v(ie)})]}),w(f,{children:[a(L,{display:"block",children:"Height"}),a(f,{marginLeft:-16,marginTop:"-3px",marginBottom:"1px",width:140,children:a(ac,{items:g,onChange:p,activeIndex:d})}),a(cn,{fontSize:we===4?42:we===5?33.6:56,value:K,lineHeight:we===4?1.5:we===5?1.835:1,height:66,min:0,max:b?99999:100,maxLength:5,onChange:({value:ie})=>b?C(ie):R(ie)})]})]}),w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rm",children:[a(L,{fontSize:12,textStyle:"small",color:"black",children:"Open links within the same iframe"}),a(Wt,{checked:m,backgroundChecked:"black",onChange:()=>{u(!m)}})]}),a(er,{height:"104px",padding:"12px 15px",fontSize:"12px",fontWeight:"500",lineHeight:"16px",color:"darkGray",backgroundColor:"white",border:"1px solid rgba(64, 64, 64, 0.08)",borderRadius:"8px",rows:5,readOnly:!0,value:E}),a(ge,{variant:"bordered",width:"100%",height:56,marginTop:"2rm",marginBottom:32,onClick:A,children:n}),w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:15,borderBottom:"2px solid rgba(230, 230, 230)",marginBottom:20,children:[a(L,{fontSize:12,textStyle:"small",color:"black",children:"Allow third-party embeds"}),a(Wt,{checked:r,backgroundChecked:"black",onChange:$})]}),a(L,{fontSize:12,marginBottom:16,textStyle:"small",color:"darkGray",children:"With an iframe, a Readymag project can be inserted into any other web page in a few minutes."}),a(Ce,{textStyle:"small",href:"https://help.readymag.com/hc/en-us/articles/4417292690587",target:"_blank",rel:"noopener noreferrer",children:"Learn more"})]})}var F_=G7;Be();Ir();ro();st();X6();Ve();k();var Tm=({isViewer:e})=>{let o=(0,Xr.useContext)(ce),t=o.hasPermission("can_export_pdf"),r=o.hasPermission("can_export_code"),i=o.hasPermission("can_use_iframe"),[n,s]=(0,Xr.useState)(!1),[l,c]=(0,Xr.useState)(!1),[d,p]=(0,Xr.useState)(!1),[m,u]=(0,Xr.useState)(!1),[g,h]=(0,Xr.useState)(!1),[b,x]=(0,Xr.useState)(!1),[S,y]=(0,Xr.useState)(""),C=document.querySelector("body > .popups"),P=o.project,v=o.isSubscriptionPaused(),T=E=>{let A=le.readymag_viewer_host;return E||`${A}/${P.user.uri}/${P.uri}/`},R=async(E,A,$)=>{let j=T(P.domain);if($){let pe=await u0("user",$);pe.userdomain_data&&pe.userdomain_data.status==="on"&&pe.userdomain_data.type&&pe.userdomain_data.type.toLowerCase()==="user"&&pe.userdomain_data.user&&pe.userdomain_data.user._id===E&&pe.userdomain_data.mag&&pe.userdomain_data.mag.num_id&&pe.userdomain_data.mag.num_id===A?y(T($)):y(j)}else y(j)};(0,Xr.useEffect)(()=>{R(P.user._id,P.num_id,P.user.domain)},[]);let I=()=>{t?c(!0):rt("export-pdf")},M=()=>{r?s(!0):rt("export-html")},D=()=>{i?p(!0):rt("export-iframe")};return w(f,{display:"flex",flexDirection:"column",gap:16,paddingBottom:8,children:[w(f,{display:"flex",flexDirection:"column",gap:8,children:[v&&P.is_published&&a(Tt,{margin:"4px 0 0",children:a(L,{textStyle:"small",color:V.black,lineHeight:"14px",children:`To activate export${e?"":" and submit to Examples"}, the subscription has to be active.`})}),!P.is_published&&a(Tt,{margin:"4px 0 0",children:a(L,{textStyle:"small",color:V.black,lineHeight:"14px",children:`To activate export${e?"":" and submit to Examples"}, the project has to be published.`})}),a(ge,{display:"block",disabled:!P.is_published,width:"100%",height:40,variant:"bordered",textStyle:"small",onClick:v?void 0:I,"data-testid":"export-pdf-button",children:v?a(Ce,{textStyle:"small",display:"block",color:"inherit",href:"/settings#change-plan",lineHeight:"inherit",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:m?"Unpause":"PDF"}):"PDF"}),a(ge,{display:"block",disabled:!P.is_published,width:"100%",height:40,variant:"bordered",textStyle:"small",onClick:v?void 0:M,"data-testid":"export-html-button",children:v?a(Ce,{textStyle:"small",display:"block",color:"inherit",href:"/settings#change-plan",lineHeight:"inherit",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:g?"Unpause":"HTML"}):"HTML"}),a(ge,{display:"block",disabled:!P.is_published,width:"100%",height:40,variant:"bordered",textStyle:"small",onClick:v?void 0:D,"data-testid":"export-iframe-button",children:v?a(Ce,{textStyle:"small",display:"block",color:"inherit",href:"/settings#change-plan",lineHeight:"inherit",onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:b?"Unpause":"iframe"}):"iframe"}),n&&C?Pm.default.createPortal(a(H_,{numId:o.project.num_id,email:o.me.email,onExit:()=>s(!1),defaultSearchEngineIndexing:o.project.opts.allowindex}),C):null,l&&C?Pm.default.createPortal(a($_,{numId:o.project.num_id,onExit:()=>c(!1),totalPages:o.pages.length,email:o.me.email}),C):null,d&&C?Pm.default.createPortal(a(F_,{magUrl:S,projectNumId:P.num_id,isIframeEmbedAllowed:P.allow_iframe_embed,onIframeEmbedAllowedChange:(E,A)=>{o.toggleAllowIframeEmbed(E,A)},onExit:()=>p(!1)}),C):null]}),!e&&a(Cm,{})]})};var _i=B(H());N();fl();fe();Ve();oe();var Vt=B(H());Vr();Kp();N();fe();fi();var Er=B(H());on();var Hl=B(H());zt();$e();Ve();N();Be();je();k();var ls=(0,Hl.memo)(({link:e,margin:o,color:t,borderColor:r,openButton:i=!0,width:n,linkTitle:s,analytics:l})=>{let[c,d]=(0,Hl.useState)(s||"Copy link"),{project:p}=(0,Hl.useContext)(ce),m=()=>{d("Copied"),p.isPublishedAsTemplate&&se("settingsProject",{settingsType:l}),setTimeout(()=>{d(s||"Copy link")},2500)},u=async g=>{g.preventDefault(),await navigator.clipboard.writeText(e),m()};return w(f,{display:"flex",width:"100%",height:40,margin:o||0,justifyContent:"space-between",children:[a(ge,{width:n??92,height:40,variant:"bordered",borderColor:r||Le(.92,V.black),textStyle:"small",color:t||"black",onClick:u,onMouseLeave:g=>g.currentTarget.blur(),children:c}),i&&a(ge,{boxSizing:"border-box",width:92,height:40,variant:"bordered",borderColor:r||Le(.92,V.black),as:"a",href:e,target:"_blank",textStyle:"small",color:t||"black",lineHeight:"38px","data-testid":"open-project-by-link",children:"Open"})]})});ls.displayName="OpenAndCopyLink";var vo=B(H()),N_=B(Qo());sf();dr();N();fe();Ve();oe();k();var j7=(e,o,t,r="left")=>({top:Math.abs(e.top-o.top)-t.height/2+o.height/2,left:r==="right"?Math.abs(e.left-o.left)+o.width:Math.abs(e.left-o.left)-t.width}),W_=e=>{if(e)return e.scrollHeight>e.clientHeight?e:e.parentNode?W_(e.parentNode):void 0};function q7({link:e,disabled:o,id:t,name:r,placeholder:i,color:n,inactiveColor:s,textStyle:l="regular",withSlash:c,validationMessageContainer:d=document.body,validationMessageAnchor:p,validationMessageZIndex:m,validationMessagePlacement:u="left",validate:g,filter:h,onDone:b,setInputRef:x,...S}){let[y,C]=(0,vo.useState)(e||""),[P,v]=(0,vo.useState)(y),[T,R]=(0,vo.useState)(!1),[I,M]=(0,vo.useState)(),[D,E]=(0,vo.useState)(),[A,$]=(0,vo.useState)(!1),[j,pe]=(0,vo.useState)(!1),ee=(0,vo.useCallback)(ze=>{ze.keyCode===13&&(ze.preventDefault(),ze.currentTarget.blur())},[]),G=ze=>{let ne=h?h(ze.currentTarget.value):ze.currentTarget.value,J=g(ne);$(!1),C(ne),M(J)},K=(0,vo.useCallback)(()=>{R(!1),I?(C(P),M(void 0)):(v(y),b(y))},[y,P,I]),we=(0,vo.useCallback)(()=>{v(y),R(!0),$(!1)},[y]),xe=(0,vo.useCallback)(ze=>{if(p&&d&&ze){let ne=ze.getBoundingClientRect();E(j7(d.getBoundingClientRect(),p.getBoundingClientRect(),ne,u))}},[p,d]);(0,vo.useEffect)(()=>{C(e||""),v(e||"")},[e]);let _e=(0,vo.useRef)(null),ie=(0,vo.useCallback)(()=>$(!0),[]);return(0,vo.useEffect)(()=>{let ze=j&&_e.current?W_(_e.current):void 0;return ze&&(I?ze.addEventListener("scroll",ie):ze.removeEventListener("scroll",ie)),()=>{ze&&ze.removeEventListener("scroll",ie)}},[_e,j,I]),w(f,{display:"flex",...S,ref:ze=>{_e.current=ze,pe(!0)},children:[c&&a(L,{textStyle:l,color:(T||y)&&!o?n||V.black:s||V.gray,children:"/"}),a(yt,{ref:ze=>{x&&x(ze)},type:"text",id:t,name:r,textStyle:l,color:I?V.red:n||V.black,placeholder:i,spellCheck:!1,autoComplete:"off",autoCorrect:"off",value:y,disabled:o,onKeyDown:ee,onChange:G,onFocus:we,onBlur:K,height:"auto",padding:0,textOverflow:"ellipsis",css:ae`
          &::placeholder {
            color: ${s||V.gray};
          }
          &:disabled {
            color: ${s||V.gray};
          }
          &:focus {
            border: none;
          }
        `}),T&&I&&d&&!A&&N_.default.createPortal(a(bl,{marginLeft:"-4px",visibility:D?"visible":"hidden",ref:xe,text:I||"",position:"absolute",arrowPosition:u==="right"?{right:"100%",transform:"translateX(4px) rotate(90deg)"}:void 0,top:D&&D.top,left:D&&D.left,zIndex:10},I),d)]})}var Fl=q7;N();fe();k();var Y7=e=>{let o=[{regex:/(_)/gi,replacer:"-"},{regex:/([^a-zA-Z0-9-])/gi,replacer:""},{regex:/(-{2,})/gi,replacer:"-"}],t=e;return o.forEach(r=>{t.match(r.regex)&&(t=t.replace(r.regex,r.replacer))}),t};var X7=(e,o,t)=>{let r=e.toLowerCase();if(/(^-)|(-$)/.test(r))return new Error("The link should not start or end with a hyphen");if(r==="info")return new Error("Sorry, info is not acceptable");if(r&&r.length>128)return new Error("The link should be less than 128 characters long");if(/^[0-9]+$/.test(r)&&r!==o.toString())return new Error("The link should not consist of digits only");if(!t.reduce((i,n)=>i&&r!==n.uri,!0))return new Error("You already have a project with this link")},tb=(0,Er.memo)(({projectNumId:e,publishState:o,projectUri:t,fullProjectLink:r,urlDomainString:i,hideInput:n,loadUserProjectsLinks:s,saveProjectUri:l})=>{let[c,d]=(0,Er.useState)([]),[p,m]=(0,Er.useState)(!1);(0,Er.useEffect)(()=>{p||(m(!0),s().then(x=>{d(x),m(!1)}).finally(()=>{m(!1)}))},[]);let u=(0,Er.useCallback)(x=>{let S=X7(x,e,c);return S?S.message:void 0},[e,c]),g=(0,Er.useCallback)(x=>{l(x||e.toString())},[e]),h=(0,Er.useCallback)(x=>Y7(x),[]),b=(0,Er.useRef)(null);return w(q,{children:[w(f,{width:"100%",marginTop:22,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:[a(L,{as:"label",textStyle:"small",htmlFor:"project-link",color:"black",children:"URL"}),a(f,{marginTop:"2px",children:a(L,{as:"label",textStyle:"small",htmlFor:"project-link",title:i,color:"black",children:`${i}/`})}),a(f,{ref:b,marginBottom:"10px",children:!n&&a(Fl,{validationMessageAnchor:b.current,validationMessageContainer:document.getElementById("settings-popup-container"),textStyle:"regular",name:"project-link",id:"project-link",placeholder:e.toString(),link:t,disabled:p,marginTop:"4px",validate:u,filter:h,onDone:g})})]}),o!=="unpublished"&&a(ls,{link:r,margin:"2px 0 0 0"})]})});tb.displayName="LinkSettings";var yo=B(H());N();fe();fi();Ve();Lp();zt();je();Be();Ir();on();Hn();Qa();ui();fe();N();oe();var da=B(H());fe();N();Ap();Ve();ln();Ur();Xv();oe();st();Xp();var V_="https://st-p.rmcdn1.net/1ce0501a/dist/bg-JAKY5MEK.jpg";k();var Z7=({passwordBackground:e,saveBgImage:o})=>{let[t,r]=(0,da.useState)(!1),[i,n]=(0,da.useState)(!1),[s,l]=(0,da.useState)(!1),[c,d]=(0,da.useState)(()=>e),p=(0,da.useCallback)(async u=>{if(n(!1),u.size>le.UPLOAD_IMAGE_SIZE_LIMIT){window.alert(le.MSG_UPLOAD_IMAGE_SIZE_ERROR);return}if(!s){l(!0);try{let g=await $n("password-bg",u);g&&g.picture&&g.picture.url&&(d(g.picture.url),o(g.picture.url).fail(()=>{d(e)}).always(()=>{l(!1)}))}catch{l(!1)}}},[s]),m=u=>{u.preventDefault(),u.stopPropagation(),!s&&(l(!0),d(void 0),o("").fail(()=>{d(e)}).always(()=>{l(!1)}))};return w(q,{children:[a(L,{textStyle:"small",children:"Password page background"}),a(f,{width:192,height:125,marginTop:"4px",marginBottom:"8px",position:"relative",opacity:i?.8:1,onDragEnter:()=>{i||n(!0)},onDragLeave:()=>{i&&n(!1)},onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:a(Di,{id:"privacy-bg-upload",accept:"image/*",dropFile:!0,readFileData:!1,onChange:p,children:w(q,{children:[a(f,{width:192,height:125,backgroundColor:"darkGrey",borderRadius:"4px",position:"relative",cursor:"pointer",boxShadow:"0 1px 1px rgba(64, 64, 64, 0.32)",children:a(f,{display:"flex",width:"100%",height:"100%",borderRadius:"4px",backgroundImage:c?`url(${c})`:`url(${V_})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})}),(t||s)&&!i&&w(f,{display:"flex",width:96,height:32,position:"absolute",left:0,right:0,bottom:9,margin:"auto",justifyContent:"space-around",children:[a(f,{display:"flex",width:32,height:32,justifyContent:"center",alignItems:"center",border:"1px solid rgba(128, 128, 128, 0.16)",borderRadius:"50%",backgroundColor:"white",cursor:s?"default":"pointer",css:ae`
                    &:hover {
                      & svg {
                        color: ${V.red};
                      }
                    }
                    &:active {
                      background-color: ${V.red};
                      & svg {
                        color: ${V.white};
                      }
                    }
                    animation: ${s?"loadingindicatoranimation":"none"} 2s infinite linear;
                    @keyframes loadingindicatoranimation {
                      from {
                        transform: rotateZ(0deg);
                      }
                      to {
                        transform: rotateZ(360deg);
                      }
                    }
                  `,children:a(du,{color:"black"})}),c&&!s&&a(Pt,{height:32,width:32,color:"white",hoverColor:"white",activeColor:"tomato",outline:!0,onClick:m,css:ae`
                      &:hover {
                        & svg {
                          color: ${V.red};
                        }
                      }
                      &:active {
                        background-color: ${V.red};
                        & svg {
                          color: ${V.white};
                        }
                      }
                    `,children:a(Nt,{color:"black"})})]})]})})})]})},Im=Z7;k();var J7=({passwordBackground:e,saveBgImage:o,isEmailWhiteListErrShown:t,combinedWhiteList:r})=>a(q,{children:w(f,{width:"100%",children:[a(f,{margin:"5px 0 14px",children:t?a(f,{display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",padding:"14px 19px",backgroundColor:"white",borderRadius:8,children:w(L,{color:"black",textStyle:"small",children:["First, add trusted emails",a("br",{}),"in"," ",a(Ce,{as:"a",color:"tomato",href:"/settings",target:"_blank",css:ae`
                    &:hover {
                      opacity: 0.8;
                    }
                  `,children:"Settings"})]})}):w(f,{display:"flex",flexDirection:"column",children:[a(L,{lineHeight:"16px",color:"darkGray",textStyle:"small",children:"Trusted emails"}),r.map((i,n)=>a(L,{lineHeight:"20px",color:"black",children:i},n))]})}),a(Im,{passwordBackground:e,saveBgImage:o})]})}),U_=J7;N();fe();dr();oe();Ve();L0();k();var Q7=({editPasswordMode:e,projectPassword:o,onPasswordChange:t,savePassword:r,setEditPasswordMode:i,privacyType:n,hasPrivatePages:s,onPrivacyTypeChange:l,passwordBackground:c,saveBgImage:d})=>{let p=u=>{u.key==="Enter"&&(u.preventDefault(),u.currentTarget.blur())},m=()=>[s?a(L,{textStyle:"small",color:"white",display:"block",userSelect:"none",paddingTop:"1px",children:"Pages"},"pages"):a(L,{textStyle:"small",color:"white",display:"block",userSelect:"none",children:"Selected"},"pages"),a(L,{textStyle:"small",color:"white",userSelect:"none",children:"All pages"},"project")];return w(f,{width:"100%",marginTop:"16px",children:[a(f,{display:"flex",justifyContent:"space-between",children:e?w(q,{children:[a(yt,{name:"project-password",id:"project-password",type:"text",marginBottom:"4px",color:V.black,fontSize:"16px",spellCheck:!1,autoComplete:"off",autoCorrect:"off",placeholder:"Set password",value:o,onKeyDown:p,onChange:t,css:ae`
                &:focus {
                  border: none;
                }
                &::placeholder {
                  color: ${V.gray};
                }
                &:disabled {
                  color: ${V.gray};
                }
              `}),a(f,{display:"flex",height:20,justifyContent:"flex-start",alignItems:"center",children:a(Ce,{as:"a",color:"tomato",onClick:r,css:ae`
                  &:hover {
                    opacity: 0.8;
                  }
                `,children:"Save"})})]}):w(q,{children:[a(L,{textStyle:"regular",marginBottom:"14px",children:"Password"}),a(f,{display:"flex",height:20,justifyContent:"flex-start",alignItems:"center",children:a(Ce,{as:"a",color:"grey",onClick:()=>i(!0),css:ae`
                  &:hover {
                    opacity: 0.8;
                  }
                `,children:"Change"})})]})}),a(f,{marginBottom:"16px",children:a(Ud,{width:192,selected:n,values:["pages","project"],captions:m(),onChange:l,margin:"8px 0"})}),a(Im,{passwordBackground:c,saveBgImage:d})]})},G_=Q7;L0();k();var j_=(0,yo.memo)(({projectNumId:e,isPublished:o,disabled:t,canUseEmailProtection:r,isClosed:i,privacySwitchState:n,privateProjectSwitchState:s,privatePagesSwitchState:l,privateEmailProjectSwitchState:c,setPrivacySwitchState:d,setPrivateProjectSwitchState:p,setPrivatePagesSwitchState:m,setPrivateEmailProjectSwitchState:u,setPrivacy:g,saveBgImage:h,isProtected:b,passwordBackground:x})=>{let S=(0,yo.useContext)(Ee),y=(0,yo.useContext)(ce),[C,P]=(0,yo.useState)(!1),[v,T]=(0,yo.useState)(!1),[R,I]=(0,yo.useState)(""),[M,D]=(0,yo.useState)(()=>b),[E,A]=(0,yo.useState)(()=>!b),[$,j]=(0,yo.useState)(r&&c?"email":"password"),[pe,ee]=(0,yo.useState)(l?"pages":"project"),G=(0,yo.useMemo)(()=>window.RM.constructorRouter.me?.get("magEmailWhitelist")||{allowedEmails:[],allowedDomains:[]},[window.RM.constructorRouter.me]),K=(0,yo.useMemo)(()=>[...G.allowedEmails,...G.allowedDomains],[G.allowedEmails,G.allowedDomains]),we=t&&y.isSubscriptionPaused();(0,yo.useEffect)(()=>{if(i)return;let Q=y.pages.some(te=>te.isPrivate);($==="email"&&K.length===0||$==="password"&&!M&&!r||$==="password"&&r&&pe==="pages"&&!Q)&&(d(!1),p(!1),m(!1),u(!1)),S.isPrivatePagesOpened&&S.dispatch({type:"togglePrivatePages"})},[i]),(0,yo.useEffect)(()=>{if(S.isPrivatePagesOpened||!n)return;let Q=y.pages.some(te=>te.isPrivate);$==="password"&&!Q&&!r&&ie("project")},[S.isPrivatePagesOpened]);let xe=()=>$d(e).then(Q=>et.facebookGraphRefresh(Q)).catch(Q=>console.error(Q)),_e=()=>{if(t&&!n){rt("project-privacy");return}if(C)return;let Q=!n;d(Q),A(!M),S.isPrivatePagesOpened?S.dispatch({type:"togglePrivatePages"}):r&&pe==="pages"&&S.dispatch({type:"togglePrivatePages"});let te={};if(Q){if(p(!0),m(!1),j(r?"email":"password"),ee("project"),r&&(te.isProjectEmailPrivate={isEnabled:!0,...G},K.length===0)){T(!0);return}}else te.isPrivate=!1,te.isPrivatePages=!1,r&&(te.isProjectEmailPrivate={isEnabled:!1,...G});Object.keys(te).length&&(P(!0),g(te).catch(()=>{d(!Q)}).finally(()=>{P(!1),D(Q),I("")})),o&&xe()},ie=Q=>{let te=Q==="password"?"project":Q;if(C)return;(te==="pages"||te==="project"&&S.isPrivatePagesOpened||te==="email"&&S.isPrivatePagesOpened)&&S.dispatch({type:"togglePrivatePages"});let ye=te==="project",de=te==="pages",Se=te==="email";if(p(ye),m(de),u(Se),te==="email"?(j("email"),ee("project")):(j("password"),ee(te)),te==="email"&&K.length===0){T(!0);return}let be={};M&&(be.isPrivate=ye,be.isPrivatePages=de),r&&(be.isProjectEmailPrivate={isEnabled:te==="email",...G}),Object.keys(be).length&&(P(!0),g(be).catch(()=>{p(!ye),m(!de),u(!Se)}).finally(()=>{P(!1)}),o&&xe()),v&&T(!1)},ze=()=>{R&&(P(!0),g({isPrivate:!!R&&s,isPrivatePages:!!R&&l,password:R}).finally(()=>{P(!1),xe(),D(!0),A(!1),I("")}),R&&se(he.SettingsProject,{settingsType:"protect with a password"}))},{callback:ne}=Oi(ze,500),J=Q=>{I(W0(N0(Q.currentTarget.value)))},X=y.pages.some(Q=>Q.isPrivate);return w(q,{children:[w(f,{display:"flex",width:"100%",height:24,marginBottom:n?void 0:"4px",justifyContent:"space-between","data-testid":"password-protected-switcher",children:[a(L,{textStyle:"small",lineHeight:"24px",color:we?Le(.6,V.black):V.black,children:r?"Protect project":"Protect with a password"}),we?a(Ro,{width:194,text:"Unpause your subscription to use password protection",boxPosition:{marginLeft:"-169px"},arrowPosition:{left:"auto",right:4},href:"https://help.readymag.com/hc/en-us/articles/360049959532-Protect-project-with-a-password"}):a(Wt,{backgroundChecked:"green",checked:n,onChange:_e})]}),t&&n&&a(Tt,{margin:"0 0 16px",children:a(L,{textStyle:"small",color:V.black,children:"Please note that if you remove the password, you won\u2019t be able to set it back again as your current subscription plan doesn\u2019t support password protection."})}),n&&w(q,{children:[r&&a(f,{children:a(Ud,{width:192,selected:$,values:["password","email"],captions:[a(L,{textStyle:"small",color:"white",userSelect:"none",children:"Password"},"password"),a(L,{textStyle:"small",color:"white",display:"block",userSelect:"none",children:"Email"},"email")],activeHoverColor:V.black,onChange:ie,margin:"8px 0"})}),$==="email"?a(U_,{passwordBackground:x,saveBgImage:h,isEmailWhiteListErrShown:v,combinedWhiteList:K}):a(G_,{editPasswordMode:E,projectPassword:R,onPasswordChange:J,savePassword:ne,setEditPasswordMode:A,hasPrivatePages:X,privacyType:pe,onPrivacyTypeChange:ie,saveBgImage:h,passwordBackground:x})]})]})});var Mm=B(H());N();fe();fi();k();var ob=(0,Mm.memo)(({projectHidden:e,profileUrl:o,saveProjectOptions:t})=>{let[r,i]=(0,Mm.useState)(()=>e);return w(q,{children:[w(f,{display:"flex",width:"100%",minHeight:24,marginBottom:"4px",justifyContent:"space-between",alignItems:"center",children:[w(L,{textStyle:"small",color:"black",children:["Add to my"," ",a(Ce,{href:o,target:"_blank",textStyle:"small",children:"Public Profile"})]}),a(Wt,{backgroundChecked:"green",checked:!r,onChange:()=>{let s=!r;i(s),t({hidden:s})}})]}),!r&&w(L,{marginBottom:4,textStyle:"small",lineHeight:"16px",color:"darkGray",letterSpacing:"-0.13px",children:["Public Profile combines all your projects in one place."," ",a(Ce,{isUnderlined:!0,target:"_blank",href:"https://help.readymag.com/hc/en-us/articles/360026692531-Public-profile",color:"darkGray",children:"Learn more"})]})]})});ob.displayName="VisibilitySettings";var Bm=B(H());N();$e();Ks();je();Be();k();var rb=(0,Bm.memo)(()=>{let e=(0,Bm.useContext)(Ee);return a(f,{display:"flex",width:"100%",minHeight:24,marginBottom:"4px",justifyContent:"space-between",alignItems:"center",children:a(Ue,{textStyle:"small",width:"100%",onClick:()=>{e.dispatch({type:"ToggleTemplateShareSettings"}),se("settingsProject",{settingsType:"convert to template"})},children:w(f,{display:"flex",alignItems:"center",justifyContent:"space-between",children:["\u0421onvert to template",a(zo,{transform:"rotate(-90deg)"})]})})})});rb.displayName="TemplateShareButton";on();Be();st();k();function q_({isActive:e}){let o=(0,Vt.useContext)(Ee),t=(0,Vt.useContext)(ce),r=(ee,G)=>`${le.readymag_viewer_host}/${ee}/${G}/`,[i,n]=(0,Vt.useState)(()=>t.project.title||""),[s,l]=(0,Vt.useState)(!1),[c,d]=(0,Vt.useState)(()=>t.project.description||""),[p,m]=(0,Vt.useState)(!1),[u,g]=(0,Vt.useState)(r(t.project.user.uri,t.project.uri));(0,Vt.useEffect)(()=>{s||n(t.project.title||"")},[t.project.title]);let h=()=>{l(!1);let ee=Lh(i," ").trim();n(ee),t.projectSave({title:ee},{patch:!0})};(0,Vt.useEffect)(()=>{p||d(t.project.description||"")},[t.project.description]);let b=()=>{m(!1);let ee=c.trim();d(ee),t.projectSave({description:ee},{patch:!0})},x=()=>t.loadUserProjectsLinks(t.project.user._id),S=(0,Vt.useMemo)(()=>jd(t.project),[t.project.domain,t.project.user.domain,t.project.user.uri]),y=(0,Vt.useMemo)(()=>F0(t.project.user),[t.project.user]);(0,Vt.useEffect)(()=>{g(r(t.project.user.uri,t.project.uri))},[t.project.num_id,t.project.user.uri]);let C=(0,Vt.useCallback)(ee=>{ee!==t.project.uri&&t.projectSave({uri:ee},{patch:!0}).then(()=>{g(r(t.project.user.uri,ee))})},[]),[P,v]=(0,Vt.useState)(()=>t.project.is_private||t.project.isPrivatePages||!!t.project.isProjectEmailPrivate?.isEnabled),[T,R]=(0,Vt.useState)(()=>t.project.is_private),[I,M]=(0,Vt.useState)(()=>t.project.isPrivatePages),[D,E]=(0,Vt.useState)(()=>!!t.project.isProjectEmailPrivate?.isEnabled),A=(0,Vt.useCallback)(ee=>t.projectSave({pass_bg:ee},{patch:!0}),[]),$=(0,Vt.useMemo)(()=>Cr(t.project),[t.project.is_published,t.project.changed]),j=()=>{o.dispatch({type:"toggleExportAsTemlate"})},pe=["free","personal"].includes(t.me.plan?.level||"free");return w(f,{marginTop:"10px",paddingBottom:16,children:[a(L,{as:"label",textStyle:"small",htmlFor:"project-title-in-settings",children:"Title"}),a(Ft,{children:({ref:ee})=>a(f,{width:"100%",maxHeight:160,marginTop:"4px",ref:ee,children:a(er,{name:"project-title-in-settings",placeholder:"Give your project name",translate:"no",spellCheck:!1,maxLength:128,rows:1,autoSize:!0,textStyle:"regular",color:"black",value:i,onChange:G=>{n(Lh(String(G.currentTarget.value)))},onFocus:()=>{l(!0)},onBlur:h})})}),a(f,{marginTop:22,children:a(L,{as:"label",textStyle:"small",htmlFor:"project-description",children:"Description"})}),a(Ft,{children:({ref:ee})=>a(f,{width:"100%",marginTop:"4px",ref:ee,children:a(er,{name:"project-description",placeholder:"What's it about...",translate:"no",spellCheck:!1,maxLength:6e3,rows:1,autoSize:!0,textStyle:"regular",color:"black",value:c,onChange:G=>{d(G.currentTarget.value)},onFocus:()=>{m(!0)},onBlur:b})})}),a(tb,{projectNumId:t.project.num_id,publishState:$,projectUri:t.project.uri,fullProjectLink:u,urlDomainString:S,hideInput:!!t.project.domain,loadUserProjectsLinks:x,saveProjectUri:C}),w(f,{display:"flex",width:"100%",marginTop:t.project.is_published?24:"4px",flexDirection:"column",children:[a(j_,{projectNumId:t.project.num_id,isPublished:t.project.is_published,privacySwitchState:P,privateProjectSwitchState:T,privatePagesSwitchState:I,privateEmailProjectSwitchState:D,setPrivacySwitchState:v,setPrivateProjectSwitchState:R,setPrivatePagesSwitchState:M,setPrivateEmailProjectSwitchState:E,disabled:!t.project.user?.permissions.can_make_mag_private,canUseEmailProtection:!!t.project.user?.permissions.can_make_mag_private_by_email,isClosed:!e,setPrivacy:t.setPrivacy,saveBgImage:A,isProtected:t.project.isProtected,passwordBackground:t.project.pass_bg,ownerEmail:t.project.user.email}),!P&&!pe&&a(ob,{projectHidden:t.project.opts.hidden,profileUrl:y,saveProjectOptions:t.setProjectOptions})]}),a(rb,{}),t.project.user.permissions.can_export_template&&w(q,{children:[w(f,{display:"flex",width:"100%",height:24,justifyContent:"space-between",children:[a(L,{textStyle:"small",lineHeight:"24px",children:"Export as template"}),a(Wt,{backgroundChecked:"green",checked:o.exportAsTemlate,onChange:j})]}),o.exportAsTemlate&&w(f,{display:"flex",width:"100%",height:24,marginTop:4,justifyContent:"space-between",children:[a(L,{textStyle:"small",lineHeight:"24px",children:"Don't Renew Screenshots"}),a(Wt,{backgroundChecked:"green",checked:o.dontRenewScreenshots,onChange:()=>{o.dispatch({type:"toggleDontRenewScreenshots"})}})]})]})]})}var Y_=B(H());$e();fe();N();Be();k();function X_({showUpgradeAlert:e,onOpenCodeEditorClick:o}){let r=(0,Y_.useContext)(ce).isSubscriptionPaused();return w(f,{paddingBottom:16,children:[a(ge,{width:"100%",height:40,marginTop:"5px",marginBottom:16,variant:"bordered",textStyle:"small",onClick:o,children:"Open Code Editor"}),e&&w(Tt,{children:[w(L,{textStyle:"small",color:"tomato",children:["Injected code works",a("br",{}),"for Preview only!"]}),a("br",{}),a("br",{}),r?w(L,{textStyle:"small",color:"black",children:[a(Ce,{href:"/settings#change-plan",target:"_blank",textStyle:"small",isActive:!0,children:"Unpause"})," ","your subscription to have it work in Published project."]}):w(L,{textStyle:"small",color:"black",children:[a(Ce,{href:"/settings#change-plan",target:"_blank",textStyle:"small",isActive:!0,children:"Upgrade"})," ","to have it work",a("br",{}),"in Published project."]})]})]})}var jo=B(H());fe();N();var Lm=B(H());dr();$e();Ve();fe();oe();je();var ps=B(H());on();Be();Ws();var Rm=({domainForChecking:e,isMapedDomain:o=!1,domainSource:t="other"})=>{let r=(0,ps.useContext)(ce),[i,n]=(0,ps.useState)(e),[s,l]=(0,ps.useState)(t),[c,d]=(0,ps.useState)(),[p,m]=(0,ps.useState)(!1),[u,g]=(0,ps.useState)(!1),h=(S,y,C)=>{p&&m(!1),d({errorType:S,dnsError:y,domainData:C})};return{testingDomain:i,domainError:c,domainCheckSuccess:p,isProcessingTest:u,setTestingDomain:n,setTestingDomainSource:l,checkDomain:(S,y)=>{let C=S||i,P=y||s;if(!(!C||u)){if(/:|@|\\|\//.test(C)){h("invalid");return}g(!0),r.checkDomain(C,P).then(v=>{if(!v){h("server-error"),g(!1);return}if(v.errors.notPublished){h("unpublished"),g(!1);return}if(v.errors.noValidSubscription){h("subscription-expired"),g(!1);return}if(v.errors.subscriptionPaused){h("subscription-paused"),g(!1);return}if(!o&&v.errors.badDomainName){h("invalid"),g(!1);return}if(v.errors.setupButNeedMoreTime){h("setup-but-need-more-time"),g(!1);return}if(o){if(v.errors.badDNSSettings){let T=Ah(v.dnsSettings);h("domain-set-dns-error",{domainName:C,recordType:T.recordType,currentValue:T.currentValue,neededValue:T.neededValue,domain:T.domain,subdomain:T.subdomain}),g(!1);return}}else{if(v.errors.badDNSSettings||v.errors.ipv6Present||v.errors.invalidOwner){let j=Ah(v.dnsSettings),pe=()=>{h("test-dns-error",{domainName:C,recordType:j.recordType,currentValue:j.currentValue,neededValue:j.neededValue,badDNSSettings:!!v.errors.badDNSSettings,ipv6Present:!!v.errors.ipv6Present,invalidOwner:!!v.errors.invalidOwner,ownerKey:v.dnsSettings.ownerKey,domain:j.domain,subdomain:j.subdomain,unsetedCaaRecords:v.dnsSettings.caaRecords?v.dnsSettings.unsetedCaaRecords:[]})};Zt.get(`https://${C}/api/domainmaptest`).then(ee=>{ee&&ee.domainOk?pe():h("wait-our-dns-server")}).catch(()=>pe()).finally(()=>{g(!1)});return}let T=v.domain_data||{},R=T.mag||{},I=T.user||R.user||{},M=I.name||"UNKNOWN",D="/"+(I.uri||"UNKNOWN")+"/",E=D+(R.uri||"UNKNOWN")+"/",A=R.title||E,$=(v.domain_data||{}).type;if(v.errors.domainUsed){v.errors.usedByOtherUser?h("test-other-user",void 0,{userName:M,userUrl:D}):h("test-same-user",void 0,{magName:A,magUrl:E,entityType:T.type,userName:M,userUrl:D,domainType:$}),g(!1);return}}if(v.errors.domainNotFound){h("notfound"),g(!1);return}g(!1),d(void 0),m(!0)}).catch(()=>{h("server-error"),g(!1)})}},showDomainError:h,hideDomainError:()=>{d(void 0)},setDomainCheckSuccess:m}};on();Be();Qa();ui();var ib=B(H());oe();fe();N();Nv();Co();st();var zm=B(H());fe();k();function K_({children:e,...o}){let t=(0,zm.useRef)(null),r=(0,zm.useCallback)(i=>{i.preventDefault();let n=t.current?.innerText??"";i.clipboardData?.setData("text/plain",n)},[]);return a(ve,{ref:t,onCopy:r,...o,children:e})}k();var e9="https://www.youtube.com/watch?v=rOisaXwqbyk",t9="https://help.readymag.com/hc/en-us/articles/4403970232091-Mapping-a-domain-to-a-project",o9=F("ol")`
  margin: 6px 0 -8px 17px;
  list-style: decimal;
  font-size: 12px;
`,Em=F("li")`
  padding: 4px 0;
  list-style: decimal;
`,r9=f.withComponent(F("div")`
  position: absolute;
  right: 45px;
  opacity: 1;
  &:hover {
    svg {
      color: ${e=>e.theme.colors.darkGray};
    }
  }
  &:active {
    svg {
      color: ${e=>e.theme.colors.black};
    }
  }
`);function Am({domainError:e,m:o,showUnmap:t,mapDomain:r,unmapDomain:i}){let n=e?e.dnsError:void 0,s=e?e.domainData:void 0,[l,c]=(0,ib.useState)(!1),[d,p]=(0,ib.useState)(!1),m=n?.neededValue?.replace(/\.$/,"")??"",u=S=>{if(S)try{navigator.clipboard.writeText(S)}catch{console.error("Could not copy to clipboard.")}},g=(S,y)=>{let C=()=>{S==="domain"?(u(m),c(!0),p(!1)):(u(n?.ownerKey),p(!0),c(!1))},P=()=>{setTimeout(()=>{c(!1),p(!1)},200)};return a(St,{enterDelay:150,text:l||d?"Copied":"Copy",indent:10,placement:"top-end",componentsProps:{tooltip:{left:5,width:40},arrow:{left:"-4px !important"}},children:a(r9,{title:"Copy","data-testid":`domain-copy-button-${S}`,children:a(pu,{width:14,height:14,color:y?"darkGray":"gray",cursor:"pointer",onMouseLeave:P,onMouseDown:C})})})},h=()=>n?a(q,{children:w(L,{textStyle:"small",color:"black",children:["This domain\u2019s ",n.recordType?n.recordType:""," ",n.currentValue==="UNKNOWN"?"is not currently set":"is currently set to"," ",n.currentValue!=="UNKNOWN"?n.currentValue:"",". Please change your"," ",n.recordType?n.recordType:""," to"," ",a(L,{textStyle:"small",color:"darkGray",fontFamily:"monospace",children:n.neededValue?n.neededValue:""})," ","at your registrar settings."," "]})}):null,b=()=>n?w(q,{children:[a(L,{textStyle:"small",color:"black",children:"Go to your domain registrar\u2019s website. Open\xA0DNS settings and:"}),w(o9,{children:[n.badDNSSettings&&n.recordType&&w(Em,{children:[a(L,{textStyle:"small",color:"black",children:"Add an A-record:"}),a("br",{}),w(L,{textStyle:"small",color:"black",children:["Hostname = ",n.subdomain??"@"]}),a("br",{}),w(f,{display:"flex",children:[a(f,{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"125px",children:w(L,{textStyle:"small",color:"black",children:["Value ="," ",a(L,{textStyle:"small",color:"tomato","data-testid":"domain-value",children:m})]})}),g("domain",l)]})]},"dnsError"),w(q,{children:[n.invalidOwner&&w(Em,{children:[w(L,{textStyle:"small",color:"black",children:["Confirm domain ownership by adding a\xA0TXT-record:",a("br",{})]}),a(L,{textStyle:"small",color:"black",children:"Hostname = @"}),a("br",{}),w(f,{display:"flex",children:[a(f,{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"125px",children:w(L,{textStyle:"small",color:"black",children:["Value ="," ",a(K_,{textStyle:"small",color:"tomato","data-testid":"domain-ownerkey",children:n.ownerKey})]})}),g("key",d)]}),a("br",{}),n.subdomain&&a(L,{textStyle:"small",color:"black",children:"This record should be added to your root domain."})]},"invalidOwner"),n.badDNSSettings&&n.unsetedCaaRecords?.length?a(Em,{children:w(L,{textStyle:"small",color:"black",children:["Looks like your DNS settings are missing some"," ",a(Ce,{href:"https://help.readymag.com/hc/en-us/articles/4403970242331-SSL",target:"_blank",textStyle:"small",color:"tomato",children:"CAA records"}),". Add these or leave it up to your techies:",a("br",{}),w(L,{textStyle:"small",color:"darkGray",fontFamily:"monospace",children:[n.unsetedCaaRecords.join(", "),"."]})]})},"dnsCaaError"):null]}),n.ipv6Present&&a(Em,{children:a(L,{textStyle:"small",color:"black",children:"Remove the AAAA-record from your DNS settings to disable iPv6."})},"ipv6Present")]}),a(L,{textStyle:"small",color:"black",children:"Changes may take a few minutes to 72 hours to work. We\u2019ll notify you by email when you can map your domain."})]}):null;return e?w(Tt,{margin:o||"0 0 14px",padding:"16px 23px 16px 14px","data-testid":"domain-error-message",textAlign:"left",children:[(()=>{if(!e)return null;switch(e.errorType){case"server-error":return w(L,{textStyle:"small",color:"black",children:["Oops! It\u2019s not you, it\u2019s an internal server error.",a("br",{}),"Please click the \u2018Test\u2019 button again."]});case"unpublished":return w(L,{textStyle:"small",color:"black",children:["You can","'","t use custom domain mapping on unpublished project. Please, publish it first."]});case"subscription-expired":return w(q,{children:[w(L,{textStyle:"small",color:"black",children:["Please"," ",a(Ce,{href:"/settings#change-plan",target:"_blank",textStyle:"small",color:"tomato",children:"upgrade"})," ","to access custom domain mapping."]}),a(Ce,{href:`${le.readymag_host}/pricing/`,target:"_blank",textStyle:"small",color:"tomato",children:"See the pricing"})]});case"subscription-paused":return a(q,{children:w(L,{textStyle:"small",color:"black",children:["Please"," ",a(Ce,{href:"/settings#change-plan",target:"_blank",textStyle:"small",color:"tomato",children:"unpause"})," ","your subscription to access custom domain mapping."]})});case"invalid":return w(q,{children:[w(L,{textStyle:"small",color:"black",children:["Domain name should not contain non-alphanumeric characters. No directories are allowed.",a("br",{}),a("br",{}),"Examples:"]}),a("br",{}),w(L,{textStyle:"small",color:"gray",children:["mydomain.com",a("br",{}),"www.mydomain.com",a("br",{}),"readymag.mydomain.com"]})]});case"notfound":return a(L,{textStyle:"small",color:"black",children:"We can\u2019t find the info for this domain. Please check the name again. Note that it may take up to a few hours for a subdomain to get created."});case"setup-but-need-more-time":return a(f,{textAlign:"center",children:a(L,{textStyle:"small",color:"black",children:w(q,{children:["Your domain is being registered. It might take up to 48 hours. You","'","ll receive an email when",a("br",{}),"it","'","s ready to be connected to your Readymag project"]})})});case"wait-our-dns-server":return w(L,{textStyle:"small",color:"black",children:["Your domain settings are correct; It seems that our DNS servers haven","'","t updated yet, though.",a("br",{}),"It may take up to 72 hrs.",a("br",{}),"Please try again later."]});case"test-dns-error":return a(q,{children:b()});case"test-other-user":return w(L,{textStyle:"small",color:"black",children:["This domain is already used by"," ",a(Ce,{href:s&&s.userUrl?s.userUrl:"#",target:"_blank",textStyle:"small",color:"tomato",children:s&&s.userName?s.userName:"other user"}),"."]});case"test-same-user":return w(L,{textStyle:"small",color:"black",children:["This domain is already mapped to"," ",a(Ce,{href:s?s.domainType==="User"?s.userUrl:s.magUrl:"#",target:"_blank",textStyle:"small",color:"tomato",children:s?s.domainType==="User"?s.userName:s.magName:"unknown"}),".",a("br",{}),a(Ce,{textStyle:"small",color:"tomato",onClick:()=>r&&r(),children:"Switch it to current project"})]});case"domain-set-dns-error":return w(q,{children:[a(L,{textStyle:"small",color:"black",children:"Seems like your DNS settings have been changed."})," ",h()]});case"domain-set-try-later":return w(L,{textStyle:"small",color:"black",children:["Seems that some of the DNS servers haven","'","t updated yet.",a("br",{}),"It may take 72 hrs.",a("br",{}),"Please try again later."]});default:return null}})(),t&&i&&w(q,{children:[a(L,{textStyle:"small",color:"black",children:"or"})," ",a(Ce,{textStyle:"small",color:"tomato",onClick:()=>i(),children:"Unmap"})]}),(e.errorType==="test-dns-error"||e.errorType==="domain-set-dns-error"||e.errorType==="domain-set-try-later")&&w(f,{marginTop:"12px",display:"flex",flexDirection:"column",gap:"12px",children:[a(Ce,{href:e9,target:"_blank",textStyle:"small",color:"darkGrey",children:"Short video guide"}),a(Ce,{href:t9,target:"_blank",textStyle:"small",color:"darkGrey",children:"Step-by-step guide"})]})]}):null}oe();$e();N();fe();Ks();je();var Cc=B(H());w0();var i9=()=>!!window?.entri;async function n9(){return new Promise((e,o)=>{if(i9())return e();let t=document.getElementsByTagName("script")[0],r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src="https://cdn.goentri.com/entri.js",r.onload=()=>e(),r.onerror=()=>o(),t?.parentNode?.insertBefore(r,t)})}function J_({userNumId:e,onClose:o}){let[t,r]=(0,Cc.useState)(!1),[i,n]=(0,Cc.useState)(null);(0,Cc.useEffect)(()=>{if(!o)return;let l=({detail:c})=>o(c);return window.addEventListener("onEntriClose",l,!1),()=>{window.removeEventListener("onEntriClose",l,!1)}},[]);async function s(){try{r(!0);let[l]=await Promise.all([b0(e),n9()]);window?.entri?.purchaseDomain(l)}catch(l){n(l)}finally{r(!1)}}return{loading:t,error:i,onShow:s}}Sr();k();function Q_({onResellerDomainPurchase:e,ownerNumId:o}){let{user:t,setUserMetrics:r}=On();function i(d){if(!d.success||d.setupType!=="purchase")return;e(d.domain);let p=t?.behavior_metrics?.entri_purchase_amount;r({entri_purchase_amount:p?p+1:1})}let{loading:n,onShow:s}=J_({userNumId:o,onClose:i});function l(){se("settingsProject",{settingsType:"domain ionos integration click"}),s()}function c(){se("settingsProject",{settingsType:"domain xyz integration click"})}return w(f,{display:"flex",flexDirection:"column",borderBottom:"2px solid",borderColor:Me("#B8B8B8",.24),justifyContent:"space-between",gap:"4rm",paddingBottom:"4rm",alignItems:"flex-start",children:[a(Ue,{textStyle:"small",width:"100%",onClick:l,disabled:n,children:a(f,{display:"flex",alignItems:"center",justifyContent:"space-between",children:n?a(ve,{textStyle:"small",color:"inherit",marginTop:"1rm",marginBottom:"1rm",children:"Loading..."}):w(q,{children:[t?.domainDiscountIsAvailable?"Buy a domain with $12 off":"Buy a domain",a(zo,{color:"gray",transform:"rotate(-90deg)"})]})})}),w(Ce,{href:"https://help.readymag.com/hc/en-us/articles/4405321039259",onClick:c,target:"_blank",textStyle:"small",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",children:["Get a free .XYZ domain",a(zo,{color:"gray",transform:"rotate(-90deg)"})]})]})}k();function eS(){let e=(0,Lm.useContext)(ce),o=e.project.last_checked_domain||"",t=e.project.last_checked_domain_source,{testingDomain:r,domainError:i,domainCheckSuccess:n,isProcessingTest:s,setTestingDomain:l,setTestingDomainSource:c,checkDomain:d,showDomainError:p,hideDomainError:m,setDomainCheckSuccess:u}=Rm({domainForChecking:o,domainSource:t}),[g,h]=(0,Lm.useState)(!1),b=C=>{i&&m(),n&&u(!1);let P=qd(C.currentTarget.value),T=P===o&&t?t:"other";l(P),c(T)},x=C=>{C.keyCode===13&&(C.preventDefault(),C.currentTarget.blur(),d())},S=()=>{!r||g||(h(!0),i&&m(),e.mapDomain(r).then(async()=>{$d(e.project.num_id).then(C=>et.facebookGraphRefresh(C)).catch(C=>console.error(C)),se(he.SettingsProject,{settingsType:"map domain"})}).catch(C=>{C&&C.badDomainName?p("domain-set-try-later"):p("server-error")}).finally(()=>{h(!1)}))},y=C=>{let P=qd(C);l(qd(P)),c("reseller"),m(),u(!1),d(P,"reseller"),se("settingsProject",{settingsType:"domain name purchased",domainProvider:"ionos"})};return w(q,{children:[a(L,{as:"label",textStyle:"small",htmlFor:"project-domain",children:"Enter registered domain name"}),a(yt,{name:"project-domain",id:"project-domain",type:"text",marginTop:"4px",spellCheck:!1,autoComplete:"off",autoCorrect:"off",placeholder:"yourdomainname.com","data-testid":"test-domain-input",value:r,onKeyDown:x,onChange:b,css:ae`
          &:focus {
            border: none;
          }
          &::placeholder {
            color: ${V.gray};
          }
          &:disabled {
            color: ${V.gray};
          }
        `}),a(ge,{width:"100%",height:40,marginTop:"2px",marginBottom:14,variant:"bordered",textStyle:"small",disabled:!r||s||g,onClick:n?S:()=>d(),"data-testid":n?"map-domain-button":"test-domain-button",children:n?g?"Connecting":"Connect":s?"Testing...":"Test"}),a(Am,{domainError:i,onHideError:m,mapDomain:S}),n&&a(Tt,{margin:"0 0 14px",children:w(L,{textStyle:"small",color:"green",children:["Your domain is pointing to Readymag",a("br",{}),"and can be connected with this project \u2014 click ",a("br",{})," Connect button."]})}),a(Q_,{onResellerDomainPurchase:y,ownerNumId:e.owner.num_id})]})}var Vi=B(H());N();Fo();dr();$e();fe();oe();Be();Hn();k();function tS({isVisitingDomain:e,visitError:o,showVisitError:t}){let r=(0,Vi.useContext)(ce),{domainError:i,domainCheckSuccess:n,isProcessingTest:s,checkDomain:l,hideDomainError:c}=Rm({domainForChecking:r.project.domain||"",isMapedDomain:!0});(0,Vi.useEffect)(()=>{l()},[]);let d=(0,Vi.useMemo)(()=>!!r.project.domain&&i&&(i.errorType==="domain-set-dns-error"||i.errorType==="notfound"||i.errorType==="subscription-expired"),[r.project.domain,i]),[p,m]=(0,Vi.useState)(!1),[u,g]=(0,Vi.useState)(!1),[h,b]=(0,Vi.useState)(!1),x=()=>{m(!0),h&&b(!1)},S=()=>{m(!1)},y=()=>{g(!0),o&&t(!1),r.unmapDomain().catch(()=>{b(!0)}).finally(()=>{g(!1)})};return a(q,{children:s?a(f,{display:"flex",justifyContent:"center",children:a(mt,{bgColor:"transparent",color:"black"})}):i&&!n?a(Am,{domainError:i,onHideError:c,showUnmap:d,unmapDomain:y}):w(q,{children:[a(L,{as:"label",textStyle:"small",htmlFor:"project-mapped-domain",color:"black",children:"Name"}),a(yt,{id:"project-mapped-domain",type:"text",spellCheck:!1,autoCorrect:"off",defaultValue:r.project.domain,marginTop:"4px","data-testid":"mapped-domain",readOnly:!0,css:ae`
              padding: 0;
              &:focus {
                border: none;
              }
            `}),p?w(f,{display:"flex",width:"100%",height:40,marginTop:12,marginBottom:16,justifyContent:"space-between",alignItems:"center",children:[a(ge,{width:90,height:38,variant:"bordered",textStyle:"small",lineHeight:"38px",background:"white",onClick:y,"data-testid":"unmap-domain",children:"Unmap"}),a(ge,{width:90,height:38,variant:"bordered",textStyle:"small",lineHeight:"38px",background:"white",onClick:S,children:"Cancel"})]}):a(ge,{width:"100%",height:40,marginTop:12,marginBottom:16,variant:"bordered",textStyle:"small",disabled:!r.project.domain||u,onClick:x,"data-testid":"open-unmap-dialog",children:u?"Unmaping":"Unmap"}),h&&a(Tt,{margin:"0 0 14px",children:w(L,{textStyle:"small",color:"black",children:["Something went wrong.",a("br",{}),"Please try again later."]})}),e&&a(Tt,{margin:"0 0 14px",children:w(L,{textStyle:"small",color:"black",children:[a(Ce,{href:"https://help.readymag.com/hc/en-us/articles/4403970242331-SSL",target:"_blank",textStyle:"small",isActive:!0,children:"Your SSL certificate"})," ","is being issued. It may take a few minutes, but feel free ",a("br",{}),"to keep working\u2014it","'","s a background process!"]})}),o&&a(Tt,{margin:"0 0 14px",children:w(L,{textStyle:"small",color:"black",children:["Your SSL certificate hasn\u2019t been installed, but the problem is on our end.",a("br",{}),a(Ce,{href:`//${r.project.domain}`,target:"_blank",textStyle:"small",isActive:!0,children:"Just open your website"})," ","so that we can try to enable the certificate again."]})}),w(f,{display:"flex",width:"100%",height:24,marginBottom:16,justifyContent:"space-between",children:[a(L,{textStyle:"small",lineHeight:"24px",color:"black",children:"SSL is enabled"}),a(Ro,{href:"https://help.readymag.com/hc/en-us/articles/4403970242331-SSL"})]})]})})}N();fe();oe();Ve();Hn();dr();Ve();var Kr=B(H()),oS=B(Qo());Ai();_r();sf();k();var s9=(e,o,t)=>({top:Math.abs(e.top-o.top)-t.height/2+o.height/2,left:Math.abs(e.left-o.left)-t.width}),rS=e=>{if(e)return e.scrollHeight>e.clientHeight?e:e.parentNode?rS(e.parentNode):void 0};function a9({initialValue:e="",validate:o,onDone:t,onValueChange:r,...i}){let[n,s]=(0,Kr.useState)(e),[l,c]=(0,Kr.useState)(e),[d,p]=(0,Kr.useState)(!1),[m,u]=(0,Kr.useState)(o(e)),[g,h]=(0,Kr.useState)(),[b,x]=(0,Kr.useState)(!1),[S,y]=(0,Kr.useState)(!1),C=E=>{E.key==="Enter"&&(E.preventDefault(),E.currentTarget.blur())},P=E=>{let A=o(E.currentTarget.value);x(!1),s(E.currentTarget.value),u(A),r&&r(E.currentTarget.value)},v=()=>{p(!1),m?(s(l),u(null),t(l)):(c(n),t(n))},T=()=>{c(n),p(!0),x(!1)},R=(0,Kr.useRef)(null),I=document.body,M=E=>{if(E&&!g){let{getClientBox:A}=ct;if(R.current&&I){let $=A(E);h(s9(A(I),A(R.current),$))}}else!E&&g&&h(null)};(0,Kr.useEffect)(()=>{let E=S&&R.current?rS(R.current):void 0,A=()=>x(!0);return E&&(m?E.addEventListener("scroll",A):E.removeEventListener("scroll",A)),()=>{E&&E.removeEventListener("scroll",A)}},[S,m]);let D=d&&m&&I&&!b;return w(q,{children:[a(yt,{value:n,onKeyDown:C,onChange:P,onFocus:T,onBlur:v,color:m?V.red:V.black,ref:E=>{R.current=E,S||y(!0)},...i}),D&&oS.default.createPortal(a(bl,{text:m||"",ref:M,marginLeft:"-4px",visibility:g?"visible":"hidden",position:"absolute",top:g&&g.top,left:g&&g.left,zIndex:uo.popupZindex},m),I)]})}var nb=a9;k();function iS({ga:e,gtm:o,canUseGtm:t,saveProjectOptions:r}){let i=d=>{d!==e&&r({ga_id:d.trim()})},n=d=>{d!==o&&t&&r({gtm_id:d.trim()})},s=d=>d.includes("<script>"),l=d=>s(d)?"Enter GA ID, not a script":null,c=d=>s(d)?"Enter GTM ID, not a script":null;return w(q,{children:[w(f,{width:"100%",marginTop:"4px",children:[a(L,{as:"label",textStyle:"small",htmlFor:"google-analytics",children:"Google Analytics"}),w(f,{display:"flex",width:"100%",justifyContent:"space-between",css:ae`
            &:hover {
              & .help-link {
                opacity: 1;
              }
            }
          `,children:[a(nb,{name:"google-analytics",id:"google-analytics",type:"text",marginTop:"4px",spellCheck:!1,autoComplete:"off",autoCorrect:"off",placeholder:"GA-XXXXXX",initialValue:e,validate:l,onDone:i,css:ae`
              &:focus {
                border: none;
              }
              &::placeholder {
                color: ${V.gray};
              }
              &:disabled {
                color: ${V.gray};
              }
            `}),a(Ro,{text:"Set a Google Analytics ID to send data to your GA account",href:"https://help.readymag.com/hc/en-us/articles/360020844511-Google-Analytics",width:194,boxPosition:{marginLeft:"-169px"},arrowPosition:{left:"auto",right:4}})]})]}),w(f,{width:"100%",marginTop:"4px",children:[a(L,{as:"label",textStyle:"small",htmlFor:"google-tag-manager",children:"Google Tag Manager"}),w(f,{display:"flex",width:"100%",justifyContent:"space-between",css:ae`
            &:hover {
              & .help-link {
                opacity: 1;
              }
            }
          `,children:[a(nb,{name:"google-tag-manager",id:"google-tag-manager",type:"text",marginTop:"4px",spellCheck:!1,autoComplete:"off",autoCorrect:"off",placeholder:"GTM-XXXXXX",initialValue:o,validate:c,onDone:n,disabled:!t,css:ae`
              &:focus {
                border: none;
              }
              &::placeholder {
                color: ${V.gray};
              }
              &:disabled {
                color: ${V.gray};
              }
            `}),a(Ro,{text:"Set a Google Tag\xA0Manager\xA0ID",href:"https://help.readymag.com/hc/en-us/articles/360025544812-Google-Tag-Manager",width:194,boxPosition:{marginLeft:"-169px"},arrowPosition:{left:"auto",right:4},whiteSpace:"nowrap"})]})]})]})}Be();w0();st();var Dm=B(H());fe();Ve();fi();N();je();zt();Hn();k();function nS({defaultValue:e,permissions:o,projectDomain:t,userDomain:r,setProjectOptions:i}){let[n,s]=(0,Dm.useState)(()=>e),l=(0,Dm.useMemo)(()=>!!(t||r)||o.allow_index,[o.allow_index,t,r]),c=()=>{if(!l)return;let p=!n;s(p),i({allowindex:p}),p&&se(he.SettingsProject,{settingsType:"make searchable"})},d=!l;return w(f,{display:"flex",width:"100%",justifyContent:"space-between",children:[a(L,{textStyle:"small",lineHeight:"24px",color:d?Le(.6,V.black):"black",children:"Search engine indexing"}),d?a(Ro,{width:194,text:"\u041Cap domain to make your project visible for search engines",boxPosition:{marginLeft:"-169px"},arrowPosition:{left:"auto",right:4},href:"https://help.readymag.com/hc/en-us/articles/4403970232091-Mapping-a-domain","data-testid":"map-domain-helptip"}):a(Wt,{backgroundChecked:"green",checked:n,onChange:c,disabled:d,"data-testid":"make-searchable-checkbox"})]})}var cs=B(H());N();fe();ln();Ap();qv();Ve();oe();zt();Be();Xp();st();Hn();Dh();k();function l9({domain:e}){let o=(0,cs.useContext)(ce),[t,r]=(0,cs.useState)(!1),i=(0,cs.useMemo)(()=>o.project.opts.favicon,[o.project.opts.favicon]),n=(0,cs.useCallback)(async l=>{if(l.size>le.UPLOAD_IMAGE_SIZE_LIMIT){window.alert(le.MSG_UPLOAD_IMAGE_SIZE_ERROR);return}if(!t){r(!0);try{let c=await $n("favicon",l);c&&c.baseUrl&&(await o.setProjectOptions({favicon:c.baseUrl}),r(!1))}catch{r(!1)}}},[t]),s=async()=>{i&&await o.setProjectOptions({favicon:""})};return w(f,{display:"flex",width:"100%",height:24,marginBottom:16,marginTop:10,justifyContent:"space-between",children:[a(L,{textStyle:"small",lineHeight:"24px",color:e?"black":Le(.6,V.black),children:"Favicon"}),!e&&a(Ro,{width:194,boxPosition:{marginLeft:"-169px"},arrowPosition:{left:"auto",right:4},text:"Map domain to add favicon to your project",href:"https://help.readymag.com/hc/en-us/articles/360038720292-Adding-a-favicon"}),e&&w(q,{children:[i&&a(f,{display:"flex",width:24,height:24,borderRadius:"50%",justifyContent:"center",alignItems:"center",border:"1px solid rgba(64, 64, 64, 0.08)",cursor:"pointer",backgroundImage:`${o.project.opts.favicon?`url(${al(o.project.opts.favicon,57)})`:"none"}`,backgroundSize:"contain",backgroundPosition:"center",css:ae`
                & svg {
                  opacity: 0;
                }
                &:hover {
                  background-image: none;
                  & > div {
                    opacity: 1;
                  }
                  & svg {
                    color: ${V.red};
                    opacity: 1;
                  }
                }
              `,onClick:s,children:a(Nt,{color:"black"})}),!i&&a(Di,{id:"favicon-upload",accept:"image/*",dropFile:!1,readFileData:!1,onChange:n,children:a(f,{display:"flex",width:24,height:24,borderRadius:"50%",justifyContent:"center",alignItems:"center",border:"1px solid rgba(64, 64, 64, 0.08)",cursor:"pointer",css:ae`
                  &:hover {
                    & svg {
                      color: ${V.red};
                    }
                  }
                `,children:a(oc,{color:"black"})})})]})]})}var sS=l9;Ks();k();function aS(){let e=(0,jo.useContext)(ce),o=(0,jo.useMemo)(()=>!!e.project.domain,[e.project.domain]),t=(0,jo.useMemo)(()=>!!e.project.user.permissions.can_map_domain,[e.project.user.permissions.can_map_domain]),r=(0,jo.useMemo)(()=>e.project.is_published,[e.project.is_published]),i=(0,jo.useMemo)(()=>e.project.user.permissions.domain_limit,[e.project.user.permissions.domain_limit]),n=(0,jo.useMemo)(()=>e.me.plan?.level,[e.me.plan?.level])||"free",s=e.isSubscriptionPaused(),[l,c]=(0,jo.useState)(!1),[d,p]=(0,jo.useState)(!1),[m,u]=(0,jo.useState)(!1),g=e.project.user.projectDomains,h=!1;i&&g&&g>=i&&(h=!0);let[b,x]=(0,jo.useState)(!1),[S,y]=(0,jo.useState)(!1),C=async R=>{if(!b){x(!0);try{await f0(R)}catch(I){I&&I.statusCode!==504&&y(!0)}finally{x(!1)}}};(0,jo.useEffect)(()=>{e.project.domain&&C(e.project.domain)},[e.project.domain]);let P=()=>{d||(p(!0),e.unmapDomain().catch(()=>{u(!0)}).finally(()=>{p(!1),l&&c(!1)}))},v=()=>n==="free"?"Please upgrade your plan to access domain mapping.":n==="extra"?"Please change your subscription conditions to map another domain.":"Please upgrade your plan to map another domain.",T=()=>n==="extra"?a(Ce,{href:`mailto:${le.SUPPORT_MAIL}`,textStyle:"small",color:"tomato",children:"Contact our support team to learn more."}):a(Ce,{href:`${le.readymag_host}/pricing/}`,target:"_blank",textStyle:"small",color:"tomato",children:"Check out the pricing to learn more."});return w(f,{paddingBottom:16,children:[r?t?o?w(q,{children:[a(f,{"data-testid":"mapping-status","data-status":"mapped",display:"none"}),a(tS,{isVisitingDomain:b,visitError:S,showVisitError:y})]}):h?w(Tt,{margin:"4px 0 14px",children:[e.isOwner&&w(L,{textStyle:"small",color:"black",children:[v(),a("br",{}),T()]}),!e.isOwner&&w(L,{textStyle:"small",color:"black",children:["To access custom domain mapping project owner should upgrade.",a("br",{}),a(Ce,{href:`mailto:${e.project.user.email}`,textStyle:"small",isActive:!0,children:"Contact the owner"})]})]}):w(q,{children:[a(f,{"data-testid":"mapping-status","data-status":"not-mapped",display:"none"}),a(f,{paddingBottom:"3rm",children:w(Ce,{href:"https://help.readymag.com/hc/en-us/articles/4403970232091-Mapping-a-domain-to-a-project",target:"_blank",textStyle:"small",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",color:"gray",children:["Help on connecting a domain",a(zo,{marginLeft:"-1rm",transform:"rotate(-90deg)"})]})}),a(eS,{})]}):a(Tt,{margin:"0 0 14px",children:s?w(L,{textStyle:"small",color:"black",children:["You can","'","t map a custom domain.",a("br",{}),"Please"," ",a(Ce,{href:"/settings#change-plan",target:"_blank",textStyle:"small",isActive:!0,children:"unpause"})," ","your subscription first."]}):e.isOwner?w(L,{textStyle:"small",color:"black",children:["Please"," ",a(Ce,{href:"/settings#change-plan",target:"_blank",textStyle:"small",isActive:!0,children:"upgrade"})," ","to access custom domain mapping.",a("br",{}),a(Ce,{href:`${le.readymag_host}/pricing/`,target:"_blank",textStyle:"small",isActive:!0,children:"See the pricing"})]}):w(L,{textStyle:"small",color:"black",children:["To access custom domain mapping project owner should upgrade.",a("br",{}),a(Ce,{href:`mailto:${e.project.user.email}`,textStyle:"small",isActive:!0,children:"Contact the owner"})]})}):a(Tt,{margin:"0 0 14px",children:w(L,{textStyle:"small",color:"black",children:["You can","'","t map a domain to an unpublished project.",a("br",{}),"Please, publish your project first."]})}),a(sS,{domain:e.project.domain}),a(f,{marginBottom:16,marginTop:10,children:a(nS,{projectDomain:e.project.domain,userDomain:e.project.user.domain,setProjectOptions:e.setProjectOptions,permissions:e.project.user.permissions,defaultValue:e.project.opts.allowindex})}),t&&a(iS,{ga:e.project.opts.ga_id,gtm:e.project.opts.gtm_id,canUseGtm:!!e.project.user.permissions.can_use_gtm,saveProjectOptions:e.setProjectOptions}),e.project.domain&&t&&r&&a(Tt,{margin:"4px 0 14px",children:w(L,{textStyle:"small",color:"black",children:["If you don\u2019t see your project or Readymag page when you visit"," ",a(Ce,{href:`//${e.project.domain}`,target:"_blank",textStyle:"small",isActive:!0,children:"your website"}),", the DNS record might need more time to update. This can take up to 72 hours."]})}),e.project.domain&&(!t||!r)&&w(q,{children:[a(Tt,{margin:"4px 0 14px",children:w(L,{textStyle:"small",color:"black",children:["The name ",e.project.domain," is already being used in this project.",a("br",{}),a(Ce,{textStyle:"small",isActive:!0,onClick:P,children:d?"Unmaping...":"Unmap"})]})}),m&&a(Tt,{margin:"0 0 14px",children:w(L,{textStyle:"small",color:"black",children:["Something went wrong.",a("br",{}),"Please try again later."]})})]})]})}var Wl=B(H());N();Be();var Pc=B(H());N();fi();fe();ro();Lp();sM();wu();N();A0();fe();k();var lS=16;function p9({checked:e,maxWidth:o,onChange:t,onMaxWidthChange:r,height:i,margin:n}){return w(f,{display:"flex",margin:n,maxWidth:216,cursor:"pointer",borderRadius:52,position:"relative",height:i||104,backgroundColor:e?"green":"gray",children:[a(f,{display:"flex",padding:lS,width:"100%",height:"100%",alignItems:"center",onClick:()=>t(!e),children:a(Vd,{as:"input",type:"checkbox",checked:e,onChange:()=>t(e)})}),a(f,{left:lS,top:"calc(50% - 1px)",position:"absolute",transform:"translateY(-50%)",children:w(L,{color:"white",whiteSpace:"nowrap",textStyle:"small",userSelect:"none",children:[a(f,{as:"span",onClick:()=>t(!e),children:e?"Scale layout up to ":"Scale layout"}),e?a(f,{display:"inline-block",onClick:l=>l.stopPropagation(),children:a(cn,{min:1024,max:9999,autoWidth:!0,color:"orange",textStyle:"small",padding:0,value:o,onChange:({value:l})=>r(l)})}):null,e?a(f,{as:"span",onClick:()=>t(!e),children:"px"}):null]})})]})}var pS=p9;nM();iM();Hn();k();var c9={width:194,boxPosition:{marginLeft:"-125px"},arrowPosition:{left:"auto",right:49}},Nl=({checked:e,disabled:o,children:t,onChange:r,showSwitch:i=!0,HelptipProps:n,...s})=>{let[l,c]=(0,Pc.useState)(!1);return a(f,{...s,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[a(f,{flex:"1",children:a(L,{textStyle:"small",color:e?"green":o?void 0:"black",opacity:o||!e?.4:1,children:t})}),n&&a(Ro,{...c9,marginRight:"4px",...n,opacity:l?1:0}),i?a(Wt,{backgroundChecked:"green",checked:e,disabled:o,onChange:r}):null]})})},cS=(0,Pc.memo)(({options:e,disabled:o,exclude:t=[],setProjectOptions:r,permissionOverrides:i})=>{let[n,s]=(0,Pc.useState)(e.scalewidth),{callback:l}=Oi(d=>r({scalewidth:d}),500),c=Object.keys(i).includes("arrows");return w(q,{children:[!t.includes("scalableviewer")&&a(pS,{checked:e.scalableviewer,maxWidth:n,onChange:d=>r({scalableviewer:d}),onMaxWidthChange:d=>{s(d),l(d)},height:"52px"}),a(ik,{checked:e.viewertype==="vertical",onChange:d=>r(d?{viewertype:"vertical"}:{viewertype:"horizontal"}),margin:"12px 0 4px 0"}),a(nk,{direction:e.viewertype,arrowsOn:e.arrows,slideIn:e.slidein,slideInRequiresArrows:e.viewertype==="horizontal",excludeSlideIn:t.includes("slidein"),arrowsDisabled:o.includes("arrows"),onArrowsChange:d=>r({arrows:d}),onSlideInChange:d=>r({slidein:d}),margin:"12px 0"}),w(f,{paddingLeft:"4rm",paddingRight:"2rm",marginTop:"12px",children:[c&&a(Tt,{margin:"16px 0",padding:"12px 16px",children:w(L,{textStyle:"small",children:["Please"," ",a(Ce,{href:"/settings#change-plan",target:"_blank",textStyle:"small",isActive:!0,children:"upgrade"})," ","your account to\xA0manage the\xA0white\xA0label settings."]})}),w(f,{backgroundColor:"white",padding:"12px 8px 12px 16px",marginLeft:"-16px",borderRadius:"16px",children:[a(Nl,{marginBottom:"1rm",checked:e.menubutton,onChange:d=>{r(d?{menubutton:d}:{menubutton:d,projectinfo:!1})},HelptipProps:{href:"https://help.readymag.com/hc/en-us/articles/360020588752-Viewer-navigation",text:e.controlsontop?"Show the menu button in the top right corner of a page":"Show the menu button in the bottom right corner of a page"},children:"Project menu"}),a(Nl,{marginTop:"1rm",marginBottom:"1rm",checked:e.sharebutton,disabled:o.includes("sharebutton"),onChange:d=>r({sharebutton:d}),HelptipProps:{text:"Show the share button to the user"},children:"Share button"}),a(Nl,{marginTop:"1rm",marginBottom:"1rm",checked:e.pagecounter,disabled:o.includes("pagecounter"),onChange:d=>r({pagecounter:d}),HelptipProps:{text:"Show a number of a current page to the user"},children:"Page counter"}),!t.includes("controlsontop")&&a(Nl,{marginTop:"1rm",checked:e.controlsontop,disabled:o.includes("controlsontop"),onChange:d=>r({controlsontop:d}),HelptipProps:{text:"Keep Project menu, Share button, and Page counter at the top of the screen"},children:"Buttons on top"}),a(Nl,{marginTop:"1rm",checked:e.branding,disabled:o.includes("branding"),onChange:d=>r({branding:d}),showSwitch:!o.includes("branding"),HelptipProps:o.includes("branding")?{text:"Upgrade to disable branding",href:"/settings#change-plan"}:void 0,children:"Readymag branding"})]}),a(Nl,{margin:"12px 0 8px",width:192,checked:e.lqip,disabled:o.includes("lqip"),onChange:d=>r({lqip:d}),HelptipProps:{text:"Use blurred image previews while loading",href:"https://help.readymag.com/hc/en-us/articles/360019989052-Picture"},children:"Progressive images"}),!t.includes("useCustomCursor")&&a(f,{margin:"8px 0",width:192,children:a(rk,{useCustomCursor:!!e.useCustomCursor,customCursorImage:e.customCursorImage,customHoverCursorImage:e.customHoverCursorImage,saveProjectOptions:r})}),a(f,{display:"flex",marginTop:16,marginBottom:16,children:a(Ce,{href:"https://help.readymag.com/hc/en-us/articles/360020588752-Viewer-navigation",target:"_blank",textStyle:"small",color:"darkGray",children:"Need help?"})})]})]})});jt();k();function d9({margin:e,width:o}){let t=il(),{viewport:r}=(0,Wl.useContext)(qe),i=t.getProjectOptions(r),n=(0,Wl.useCallback)(d=>{t.setProjectOptions(d,void 0,r)},[r]),{disabled:s,permissionOverrides:l}=t.getProjectPermissionsOverrides(i),c=(0,Wl.useMemo)(()=>r==="tablet_portrait"||r==="phone_portrait"?["scalableviewer","slidein","projectinfo","useCustomCursor","controlsontop"]:[],[r]);return a(f,{margin:e,width:o,children:a(cS,{options:i,disabled:s,exclude:c,permissionOverrides:l,setProjectOptions:n})})}var dS=d9;Be();jt();ro();Ir();je();k();function uS({exclude:e=[],ButtonTextPosition:o,defaultAccordionValue:t=0,renderButtonContainer:r=n=>n,renderCollapseContainer:i=n=>n}){let n=(0,_i.useContext)(ce),{viewport:s}=(0,_i.useContext)(qe),l=n.project.user.projectDomains,c=(0,_i.useMemo)(()=>n.me.plan?.level,[n.me.plan?.level])||"free",d=n.project.user.permissions.domain_limit,p=n.project.domain,m=!1;d&&l&&l>=d&&!p&&(m=!0);let u=n.hasPermission("can_map_domain"),g=n.isSubscriptionPaused(),[h,b]=(0,_i.useState)(t),x=()=>n.openCodeEditor(),S=(0,_i.useMemo)(()=>n.hasProjectCode(),[n.project.ci_head,n.project.ci_css,n.project.ci_body_top,n.project.ci_body_bottom]),y=(0,_i.useMemo)(()=>({default:"Desktop",tablet_portrait:"Tablet",phone_portrait:"Mobile"})[s]??"",[s]);return w(Gr,{transition:{mass:1,stiffness:210,damping:20},value:h,onChange:P=>{P===3&&!g?u?m?c==="business"?rt("map-domain-limit-business"):rt("map-domain-limit"):b(P):rt("map-domain"):b(P)},children:[a(mo,{value:0,renderButton:({isActive:P})=>r(a(ds,{isActive:P,label:"Project settings","data-testid":"project-settings-general",TextPosition:o}),"project-settings"),children:(P,v)=>a(f,{ref:P,children:i(a(q_,{isActive:v}),"project-settings")})}),e.includes("viewer")?null:a(mo,{value:1,renderButton:({isActive:P})=>r(a(ds,{divider:!0,label:`${y} Viewer`,isActive:P,TextPosition:o}),"viewer"),children:P=>a(f,{ref:P,children:i(a(dS,{}),"viewer")})}),a(mo,{value:2,renderButton:({isActive:P})=>r(a(ds,{divider:!0,label:"Code",isActive:P,withDot:S,TextPosition:o}),"code"),children:P=>a(f,{ref:P,children:i(a(X_,{hasProjectCode:S,showUpgradeAlert:!n.me.permissions.can_inject_code,onOpenCodeEditorClick:x}),"code")})}),a(mo,{value:3,renderButton:({isActive:P})=>r(a(ds,{divider:!0,label:"Domain",isActive:P,withDot:!!n.project.domain,TextPosition:o}),"domain"),children:P=>a(f,{ref:P,children:i(a(aS,{}),"domain")})}),e.includes("export")?null:a(mo,{value:4,renderButton:({isActive:P})=>((0,_i.useEffect)(()=>{P&&se("settingsProject",{settingsType:"export and submit"})},[P]),r(a(ds,{label:"Export & Submit",isActive:P,divider:!0,TextPosition:o}),"export")),children:P=>a(f,{ref:P,children:i(a(Tm,{}),"export")})})]})}function ds({label:e,divider:o,isActive:t,withDot:r,"data-testid":i,TextPosition:n={}}){return w(f,{width:"100%",height:48,display:"flex",justifyContent:"left",alignItems:"center",cursor:"pointer","data-testid":i,userSelect:"none",position:"relative",borderTop:"2px solid",borderTopColor:o?Ua.transparentGrey:"transparent",css:ae`
        &:hover {
          & span {
            color: ${t?V.black:V.red};
          }
        }
      `,children:[a(f,{position:"relative",bottom:r?"2px":void 0,children:a(L,{color:V.black,textStyle:"subheading",...n,children:e})}),r?a(f,{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:V.black,position:"absolute",right:24,top:21}):null]})}k();var gS=()=>{let[e,o]=(0,mS.useState)(0);return w(Gr,{dynamicHeight:!0,transition:{mass:1,stiffness:210,damping:20},value:e,onChange:t=>{o(t)},children:[a(mo,{value:0,renderButton:({isActive:t})=>a(f,{padding:"0 16px",children:a(u9,{label:"Share & Submit",isActive:t})}),children:t=>a(f,{ref:t,padding:"0 16px",children:a(D_,{shareMode:"full"})})}),a(mo,{value:1,renderButton:({isActive:t})=>a(f,{padding:"0 16px",children:a(ds,{isActive:t,label:"Export",divider:!0})}),children:t=>a(f,{ref:t,padding:"0 16px 16px 16px",children:a(Tm,{isViewer:!0})})})]})};function u9(e){return a(f,{display:"flex",justifyContent:"space-between",alignItems:"baseline",children:a(f,{children:a(ds,{...e})})})}oe();zt();Ve();k();function sb({children:e,button:o,...t}){let{iframeElement:r}=(0,Om.useContext)(mr),i=(0,Om.useCallback)((n,s)=>{n===r&&s()},[r]);return a(Xt,{disablePortal:!0,name:"preview-share",skidding:-84,button:o,ArrowProps:{stroke:Le(.84,V.gray)},panelPosition:{height:"auto"},onWindowBlur:i,...t,children:a(f,{width:224,color:"black",height:"100%",borderRadius:"2rm",backdropFilter:"blur(4px)",backgroundColor:Me("lightGray",.96),border:"2px solid rgba(184, 184, 184, 0.16)",children:a(gS,{})})})}fy();Bh();var ua=B(H());pn();sn();Be();dI();k();function hS(){let{pages:e}=il(),{currentPageId:o,setViewport:t,viewport:r}=(0,ua.useContext)(mr),[i]=(0,ua.useState)(_v),n=e.find(b=>b._id===o),s=n?.viewport_tablet_portrait?.enabled,l=n?.viewport_phone_portrait?.enabled,c=i.find(b=>b.pageId===o),d=!!(s&&c?.tablet_portrait),p=!!(l&&c?.phone_portrait),m=(0,ua.useMemo)(()=>{let b=["default"];return s&&b.push("tablet_portrait"),l&&b.push("phone_portrait"),b},[s,l]),u=(0,ua.useMemo)(()=>{let b=(m.indexOf(r)+1)%m.length;return m[b]},[m,r]);function g(){t(u)}let h;return u==="tablet_portrait"?h=a(Wi,{show:d,offset:[0,"calc(100% + 3px)"],children:a(iy,{})}):u==="phone_portrait"?h=a(Wi,{show:p,offset:[0,"calc(100% + 3px)"],children:a(oy,{})}):h=a(ty,{}),m.length>1?a(El,{onClick:g,children:h}):null}yr();k();function m9(e){return w(f,{"aria-label":"Preview toolbar",position:"fixed",right:16,bottom:16,gap:"2rm",display:"flex",...e,children:[a(f,{position:"absolute",right:"102%",top:"0",children:a(hu,{})}),a(B_,{width:104,textStyle:"small"}),a(z_,{children:a(sl,{children:w(f,{display:"flex",width:112,height:56,backgroundColor:Me("darkGray",.96),borderRadius:40,children:[a(Qf,{width:"50%",height:"100%",button:({isPanelShown:o})=>a(eb,{width:56,icon:a(Zv,{}),isActive:o,tooltipTargetSteps:["ViewerSettings"],"aria-label":"Viewer settings toggle",TooltipProps:{text:"Viewer settings",disabled:o,instance:!0,closeOnTargetClick:!0}})}),a(sb,{width:"50%",height:"100%",button:({isPanelShown:o})=>a(eb,{width:56,icon:a(E_,{}),isActive:o,TooltipProps:{text:"Share & Submit",disabled:o,instance:!0,closeOnTargetClick:!0}})})]})})}),a(vm,{previewOnly:!0})]})}function g9(e){return a(f,{position:"fixed",left:16,bottom:16,gap:"2rm",display:"flex",...e,children:a(hS,{})})}function $m(e){return w(q,{children:[Ge("constructor.mobileBrokenChange")?a(g9,{...e}):null,a(m9,{...e})]})}var rh=B(H());var T5=B(H());je();N();oe();Co();$e();jn();k();var fS=({id:e="stackIcon",width:o,height:t,hoverBox:r})=>{let i=Vo(o,t,r);return w("svg",{viewBox:"0 -3 26 31",xmlns:"http://www.w3.org/2000/svg",id:e,width:o,height:t,style:{padding:i},children:[w("path",{d:"M13.4 2.23764L22.5768 7.68364C23.8575 8.44363 23.8643 10.295 22.5893 11.0644L13.4085 16.6048C12.7836 16.9819 12.0014 16.9826 11.3758 16.6066L2.18583 11.0828C0.908554 10.3151 0.913273 8.46198 2.19444 7.70077L11.3884 2.23816C12.0083 1.86983 12.7799 1.86963 13.4 2.23764Z",stroke:"currentColor",strokeWidth:"2",fill:"none",children:[a("animateTransform",{attributeName:"transform",type:"translate",to:"0 -2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animateTransform",{attributeName:"transform",type:"translate",from:"0 -2",to:"0 0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0.170953 12.017C-0.275589 13.2786 0.154473 14.7905 1.43996 15.5631L10.8527 21.2208C11.7958 21.7877 12.9751 21.7866 13.9173 21.2181L23.3205 15.5434C24.6028 14.7696 25.0309 13.2599 24.585 12C24.3683 12.6133 23.946 13.1659 23.3205 13.5434L13.9173 19.2181C12.9751 19.7866 11.7958 19.7877 10.8527 19.2208L1.43996 13.5631C0.81201 13.1857 0.388184 12.6319 0.170953 12.017Z",fill:"currentColor"}),w("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0.329156 15.932C-0.117386 17.1936 0.312676 18.7055 1.59817 19.4782L11.0109 25.1358C11.954 25.7027 13.1333 25.7017 14.0755 25.1331L23.4787 19.4585C24.761 18.6847 25.1891 17.175 24.7432 15.915C24.5265 16.5284 24.1042 17.081 23.4787 17.4585L14.0755 23.1331C13.1333 23.7017 11.954 23.7027 11.0109 23.1358L1.59817 17.4782C0.970213 17.1007 0.546387 16.5469 0.329156 15.932Z",fill:"currentColor",children:[a("animateTransform",{attributeName:"transform",type:"translate",to:"0 2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animateTransform",{attributeName:"transform",type:"translate",from:"0 2",to:"0 0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};Uo();vt();k();var bS=({disableTooltip:e,onClick:o,...t})=>a(gt,{targetSteps:["OpenLayersPanel","FindVisibleMobileMenu"],defaultText:"Layers (Q)",indent:8,disabled:e,leaveDelay:100,instance:!0,closeOnTargetClick:!0,children:a(ge,{"data-widgetbar-action":"stack-panel",display:"flex",alignItems:"center",justifyContent:"center",onClick:o,variant:"unstyled",height:"100%",width:"100%",color:"white","aria-label":"Widgets","data-testid":"layer-button",...t,children:a(fS,{width:"26px",height:"34px",hoverBox:{width:56,height:56}})})});$e();jn();k();var wS=({id:e="plusIcon",width:o,height:t,hoverBox:r})=>{let i=Vo(o,t,r);return w("svg",{id:e,viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:o,height:t,style:{padding:i},children:[w("line",{x1:"5",y1:"16",x2:"27",y2:"16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[a("animate",{attributeName:"x1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x1",to:"5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"31",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"27",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"16",y1:"5",x2:"16",y2:"27",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[a("animate",{attributeName:"y1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"y1",to:"5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"y2",to:"31",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"y2",to:"27",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};mi();pr();Uo();vt();k();var xS=({onClick:e,tooltipPosition:o,disableTooltip:t,...r})=>{let[{message:i}]=ol(),n=()=>{e&&e(),window.RM.constructorRouter.trigger("notice:triggerMetrics","countWidgetPanelOpened")};return a(gt,{targetSteps:["PictureWidget","ButtonWidget"],eduTips:["eduTipUsePlusIcon"],defaultText:"Add widget (W)",indent:8,position:i==="eduTipUsePlusIcon"?"right":o,disabled:t,leaveDelay:100,instance:!0,closeOnTargetClick:!0,children:a(ge,{"data-widgetbar-action":"add-widget",display:"flex",alignItems:"center",justifyContent:"center",color:"white",onClick:n,variant:"unstyled",height:"100%",width:"100%","aria-label":"Add widget","data-testid":"widget-button",...r,children:a(wS,{width:"32px",height:"32px",hoverBox:{width:56,height:56}})})})};jt();Ur();var vS=B(H());oe();Sr();zt();Ve();N();k();var yS=({children:e,onMouseEnter:o,onMouseLeave:t,onClick:r,...i})=>{let{user:n}=(0,vS.useContext)(cr);return a(Pt,{position:"relative","data-testid":"open-profile",height:56,width:56,as:"a",margin:"0",textDecoration:"none",border:"none",backgroundColor:"transparent",css:ae`
        & > * {
          width: 56px !important;
          height: 56px !important;
          flex: none;
          background-color: transparent !important;
        }
        ${n?.pic?`& > *, & > * > * {
                  background-color: transparent !important;
                }`:""}
      `,onMouseEnter:o,onMouseLeave:t,onClick:r,...i,children:n&&w(q,{children:[a(Gt,{url:n.pic,name:n.name}),a(f,{boxShadow:`0 0 0 2px inset ${Le(.8,V.gray)}`,position:"absolute",top:"0",borderRadius:"50%",width:"100%",height:"100%"})]})})};var ga=B(H());N();Be();var bb=B(H());je();var Ui=B(H());Ty();pn();Ve();N();$e();var kS=B(H());vI();N();fe();Ur();Ve();oe();k();var ab=[`inset 0 0 0 8px ${V.red}, inset 0 0 0 12px ${V.white}`,`inset 0 0 0 4px ${V.red}, inset 0 0 0 12px ${V.white}`],_S=4,h9=16*1.25,Vl=h9*2+_S,f9=f,b9=F(f)`
  display: flex;
  overflow: hidden;
  @media (pointer: fine) {
    &:hover {
      overflow: visible;
    }
  }
`,w9=F(Gt)`
  display: block;
  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    border-radius: 50%;
    transition: box-shadow 100ms ease-out;
    ${e=>e.selected?`box-shadow: ${ab[0]}`:"box-shadow: none"};
  }
`,x9=F(Gv)`
  display: block;
  g {
    fill: ${V.red};
    transition: fill 100ms ease-out;
  }
`;function v9({name:e,url:o,isMultiple:t,isSelected:r,isCaptionVisible:i,isPending:n=!1,fullBox:s,projectsCount:l,showInitials:c=!0,showCaption:d=!0,className:p,email:m,overflowName:u=!0,onUnshare:g,showUnshareButton:h=!1,...b}){let x=u&&!n,[S,y]=(0,kS.useState)(!1),C=()=>{g&&g()};return w(b9,{onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),position:"relative",flexDirection:"column",alignItems:"center",paddingBottom:s?Vl:void 0,className:p,cursor:r?"auto":"pointer",children:[t?a(x9,{"data-testid":"multiple-icon",selected:r,opacity:S||r?1:.5}):w(f,{children:[h&&S&&a(Pt,{position:"absolute",zIndex:1,color:"gray",hoverTextColor:"white",width:At.regular,height:At.regular,onClick:C,marginRight:0,children:"Delete"}),a(w9,{name:typeof e=="string"?e:"",url:o,showInitials:c,...b,boxShadow:S?r?ab[0]:ab[1]:void 0,selected:S||r})]}),d?w(f9,{position:"absolute",top:At.regular+_S,width:"100%",color:i?"black":"tomato",opacity:S||r||i?1:0,transition:"opacity 100ms ease-out;",children:[a(ve,{as:"div",textAlign:"center",textStyle:"regular",paddingLeft:"2rm",paddingRight:"2rm",overflow:x?"hidden":void 0,whiteSpace:x?"nowrap":void 0,maskImage:x?"linear-gradient(to right, rgba(0, 0, 0, 1), rgba(0, 0, 0, 1) 65%, rgba(0, 0, 0, 0))":void 0,children:n?"Pending":typeof e=="string"?e.split(" ")[0]:e}),a(ve,{as:"div",textAlign:"center",textStyle:"regular",children:l}),m?a(ve,{as:"div",textAlign:"center",textStyle:"regular",color:"tomato",marginLeft:"50%",transform:"translateX(-50%)",display:"inline-block",whiteSpace:"nowrap",children:m}):null]}):null]})}var us=v9;yM();fe();var Ul=B(H());Ik();var RS=B(TS());var tr={CASE_SENSITIVE_EQUAL:7,EQUAL:6,STARTS_WITH:5,WORD_STARTS_WITH:4,CONTAINS:3,ACRONYM:2,MATCHES:1,NO_MATCH:0},C9=(e,o)=>String(e.rankedValue).localeCompare(String(o.rankedValue));function lb(e,o,t){t===void 0&&(t={});let{keys:r,threshold:i=tr.MATCHES,baseSort:n=C9,sorter:s=d=>d.sort((p,m)=>M9(p,m,n))}=t,l=e.reduce(c,[]);return s(l).map(d=>{let{item:p}=d;return p});function c(d,p,m){let u=P9(p,r,o,t),{rank:g,keyThreshold:h=i}=u;return g>=h&&d.push({...u,item:p,index:m}),d}}lb.rankings=tr;function P9(e,o,t,r){if(!o){let n=e;return{rankedValue:n,rank:IS(n,t,r),keyIndex:-1,keyThreshold:r.threshold}}return z9(e,o).reduce((n,s,l)=>{let{rank:c,rankedValue:d,keyIndex:p,keyThreshold:m}=n,{itemValue:u,attributes:g}=s,h=IS(u,t,r),b=d,{minRanking:x,maxRanking:S,threshold:y}=g;return h<x&&h>=tr.MATCHES?h=x:h>S&&(h=S),h>c&&(c=h,p=l,m=y,b=u),{rankedValue:b,rank:c,keyIndex:p,keyThreshold:m}},{rankedValue:e,rank:tr.NO_MATCH,keyIndex:-1,keyThreshold:r.threshold})}function IS(e,o,t){return e=MS(e,t),o=MS(o,t),o.length>e.length?tr.NO_MATCH:e===o?tr.CASE_SENSITIVE_EQUAL:(e=e.toLowerCase(),o=o.toLowerCase(),e===o?tr.EQUAL:e.startsWith(o)?tr.STARTS_WITH:e.includes(` ${o}`)?tr.WORD_STARTS_WITH:e.includes(o)?tr.CONTAINS:o.length===1?tr.NO_MATCH:T9(e).includes(o)?tr.ACRONYM:I9(e,o))}function T9(e){let o="";return e.split(" ").forEach(r=>{r.split("-").forEach(n=>{o+=n.substr(0,1)})}),o}function I9(e,o){let t=0,r=0;function i(c,d,p){for(let m=p,u=d.length;m<u;m++)if(d[m]===c)return t+=1,m+1;return-1}function n(c){let d=1/c,p=t/o.length;return tr.MATCHES+p*d}let s=i(o[0],e,0);if(s<0)return tr.NO_MATCH;r=s;for(let c=1,d=o.length;c<d;c++){let p=o[c];if(r=i(p,e,r),!(r>-1))return tr.NO_MATCH}let l=r-s;return n(l)}function M9(e,o,t){let{rank:n,keyIndex:s}=e,{rank:l,keyIndex:c}=o;return n===l?s===c?t(e,o):s<c?-1:1:n>l?-1:1}function MS(e,o){let{keepDiacritics:t}=o;return e=`${e}`,t||(e=(0,RS.default)(e)),e}function B9(e,o){typeof o=="object"&&(o=o.key);let t;if(typeof o=="function")t=o(e);else if(e==null)t=null;else if(Object.hasOwnProperty.call(e,o))t=e[o];else{if(o.includes("."))return R9(o,e);t=null}return t==null?[]:Array.isArray(t)?t:[String(t)]}function R9(e,o){let t=e.split("."),r=[o];for(let i=0,n=t.length;i<n;i++){let s=t[i],l=[];for(let c=0,d=r.length;c<d;c++){let p=r[c];if(p!=null)if(Object.hasOwnProperty.call(p,s)){let m=p[s];m!=null&&l.push(m)}else s==="*"&&(l=l.concat(p))}r=l}return Array.isArray(r[0])?[].concat(...r):r}function z9(e,o){let t=[];for(let r=0,i=o.length;r<i;r++){let n=o[r],s=E9(n),l=B9(e,n);for(let c=0,d=l.length;c<d;c++)t.push({itemValue:l[c],attributes:s})}return t}var BS={maxRanking:1/0,minRanking:-1/0};function E9(e){return typeof e=="string"?BS:{...BS,...e}}Ty();fe();N();Ur();$e();A0();Ve();ln();tk();dr();oe();k();var pb=e=>e&&/^\S+@\S+$/.test(e);function Ic(e,o){return e||pb(o)}var[A9]=Ga,L9=(e,{inputValue:o,...t})=>{switch(t.type){case ta.stateChangeTypes.blurInput:case ta.stateChangeTypes.itemMouseEnter:case ta.stateChangeTypes.mouseUp:return t;default:return{inputValue:o,...t}}};function D9({placeholder:e,submitText:o="Submit",suggestions:t=[],suggestionsBoxStyle:r,renderWhenSelected:i,disabled:n=!1,focusOnMount:s,onChange:l,onFocus:c,onBlur:d,selectedUser:p,showInput:m=!0,preSubmitSlot:u}){let[g,h]=(0,Ul.useState)(!1),b=(0,Ul.useRef)(null);return(0,Ul.useEffect)(()=>{s&&b.current&&b.current.focus()},[s]),a(ta,{stateReducer:L9,itemToString:x=>x?x.name:null,id:"rm-user-search",initialInputValue:typeof p=="string"?p:void 0,initialSelectedItem:typeof p=="object"?p:void 0,isOpen:!0,onStateChange:x=>{l&&(x.selectedItem!==void 0?l(x.selectedItem):x.inputValue!==void 0&&l(x.inputValue))},children:({getInputProps:x,getItemProps:S,getMenuProps:y,selectedItem:C,inputValue:P,clearSelection:v})=>a("div",{children:a(xu,{query:`(min-width: ${A9})`,children:T=>{let R=lb(t,P||"",{keys:["name"]}),I=P?null:!!t.length&&a(f,{display:"flex",marginRight:[0,16],marginBottom:[16,0],height:72,alignItems:"center",children:a(ve,{textStyle:T?"subheading":"regular",color:"gray",children:"Suggestions"})});return w(f,{children:[w(f,{display:"flex",paddingLeft:C||!T?0:88,flexDirection:["row-reverse","row"],children:[C?T?a(Gt,{name:C.name,url:C.pic,marginRight:16}):w(f,{position:"relative",children:[a(f,{position:"absolute",top:0,left:0,zIndex:1,width:72,height:72,display:"flex",alignItems:"center",justifyContent:"center",children:a(Mu,{zIndex:1,inverted:!0,color:"tomato","aria-label":"Clear selection",onClick:()=>v(),icon:a(Nt,{})})}),a(Gt,{name:C.name,url:C.pic,display:"block"})]}):null,w(f,{flex:1,display:["flex","block"],children:[w(f,{gap:"20px",display:"flex",justifyContent:"space-between",borderBottom:"2px solid",borderColor:g?"black":"lightGray",width:"100%",css:ae`
                          ${Ue}.clear {
                            visibility: hidden;
                          }

                          &:hover ${Ue}.clear {
                            visibility: visible;
                          }
                        `,children:[C?a(f,{display:"flex",height:At.regular-2,alignItems:"center",children:a(f,{whiteSpace:T?void 0:"nowrap",width:T?void 0:"calc(100vw - 200px)",overflow:T?void 0:"hidden",textOverflow:T?void 0:"ellipsis",children:w(ve,{textStyle:T?"subheading":"regular",children:[C.name,T&&!n&&a(Ue,{className:"clear","aria-label":"Clear selection",onClick:()=>v(),marginLeft:"2rm",children:a(Nt,{"aria-hidden":!0})})]})})}):m?w(f,{as:"label",width:"100%",children:[a(Vd,{as:"span",children:e}),a(yt,{ref:b,textStyle:T?"subheading":"regular",padding:"0 !important",margin:"none !important",boxSizing:"border-box",height:`${At.regular}px`,border:"none !important",...x({placeholder:e,id:"rm-user-search-input",height:At.regular,disabled:n,onFocus:()=>{c&&(h(!0),c())},onBlur:()=>{d&&(h(!1),d())}})})]}):"",Ic(C,P)&&T?w(f,{display:"flex",gap:"20px",children:[u,a(Ue,{variant:"primary",textStyle:"subheading",type:"submit",disabled:n,lineHeight:"72px",minWidth:60,whiteSpace:"nowrap",children:o})]}):null]}),!T&&P&&!Ic(C,P)&&R.length?R.slice(0,1).map((M,D)=>a(us,{name:M.name||M.email,email:M.name?M.email:"",url:M.pic,projectsCount:M.projectsCount,isCaptionVisible:!1,showInitials:!1,fullBox:!1,"data-testid":M._id,...S({item:M,key:D}),opacity:.4},D)):null,Ic(C,P)&&!T?a(Pt,{type:"submit",width:At.regular,height:At.regular,color:"tomato",disabled:n,flexShrink:0,marginRight:0,whiteSpace:"nowrap",children:o}):null,Ic(C,P)?i:null]})]}),t.length?a(f,{marginTop:[22,66],marginLeft:[0,At.regular+16],minHeight:At.regular+(T?Vl:0),...r,children:Ic(C,P)?null:w(f,{display:["block","flex"],children:[T?null:I,w(f,{display:"flex",...y(),flexWrap:["nowrap","wrap"],marginLeft:[-24,0],paddingLeft:[24,0],width:["100vw",null],overflowX:"auto",css:ae`
                              -webkit-overflow-scrolling: touch;
                            `,children:[T?I:null,T||!P?R.map((M,D)=>a(f,{height:146,children:a(us,{name:M.name||M.email,email:M.name?M.email:"",url:M.pic,projectsCount:M.projectsCount,isCaptionVisible:!T,fullBox:!T,"data-testid":M._id,...S({item:M,key:D})})},M._id)):null]})]})}):null]})}})})})}var cb=D9;var Fm=B(H());vM();Dp();N();$e();fe();k();function O9({showUnshare:e,onUnshare:o,onChangeRole:t,roles:r,selectedRoleName:i,disabled:n=!1}){let[s,l]=(0,Fm.useState)(!1),c=(0,Fm.useMemo)(()=>{let d=r.find(p=>p.name===i);return w(ge,{variant:"tertiary",textStyle:"subheading",disabled:n,children:[d?.description||i||"Select role"," ",a(L,{textStyle:"subheading",color:"gray",children:"v"})]})},[r,i,n]);return w(q,{children:[s&&a($i,{position:"absolute",borderRadius:["8px 8px 0 0","8px"]}),a(f,{display:"flex",alignItems:"center",whiteSpace:"nowrap",children:w(Mk,{target:c,placement:"bottom-end",onStateChange:d=>{typeof d.isOpen=="boolean"&&l(d.isOpen)},menuWrapper:d=>a(f,{textAlign:"right",children:d}),children:[r.map((d,p)=>a(pf,{description:{content:d.secondaryDescription,marginTop:"9px"},onClick:()=>t(d.name),children:d.description},p)),e&&o&&a(pf,{onClick:()=>o(),children:"Unshare"})]})})]})}var db=O9;fe();oe();var ub=ve.withComponent(F("input")`
  outline: none;
  height: 72px;
  width: 100%;
  padding-left: 0;
  padding-right: 0;
  border: none;

  transition: border-color 100ms ease-out;
  /* NOTE:           ,
           ,      */
  border-top: 2px solid transparent;
  border-bottom: 2px solid ${({theme:e})=>e.colors.lightGray};
  border-radius: 0;

  &::placeholder {
    color: ${({theme:e})=>e.colors.gray};
  }

  &:focus {
    border-bottom-color: ${({theme:e})=>e.colors.black};
  }
`);ub.defaultProps={textStyle:"subheading"};var Gl=B(H());N();Wr();oe();rc();N();k();var mb=24,ma=mb+2,zS=2,$9=8,H9=Cd`
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
`,F9=F("div")`
  display: flex;
  justify-content: center;
  align-items: center;
  width: ${mb}px;
  height: ${mb}px;
  border: 1px solid transparent;
  border-radius: 50%;
  background: ${({theme:e})=>e.colors.tomato};
  background-clip: content-box;
`,N9=f.withComponent(F("svg")`
  position: absolute;
  left: -1px;
  top: -1px;
`),W9=F("circle")`
  stroke: ${({theme:e})=>e.colors.white};
  stroke-width: ${zS}px;
  stroke-dasharray: 37;
  fill: none;
  transform-origin: center;
  animation: ${H9} ${$9}s linear infinite;
`;function ES({className:e,spinning:o}){return w(F9,{className:e,children:[a(N9,{width:`${ma}px`,height:`${ma}px`,viewBox:`0 0 ${ma} ${ma}`,xmlns:"http://www.w3.org/2000/svg",children:o&&a(W9,{cx:ma/2,cy:ma/2,r:(ma-zS)/2})}),a(Tr,{})]})}ES.defaultProps={spinning:!0};var AS=ES;Dp();Ur();tk();ln();rc();oe();k();var gb=1e3,V9=F(Tr)`
  & > g {
    fill: ${({theme:e})=>e.colors.tomato}!important;
  }
`,U9=F(AS)`
  position: absolute;
  left: 0;
  bottom: ${Vl}px;
  top: 0;
  right: 0;
  z-index: 1;
  margin: auto;
`;function G9({teammate:e,projectCount:o,isSelected:t,showOverlay:r,showActionOnHover:i,showEllipsisIcon:n,showContextMenu:s=!0,onResend:l,onUnshare:c,onToggle:d,onAppear:p,onDisappear:m}){let[u,g]=(0,Gl.useState)(!1),[h,b]=(0,Gl.useState)(!1),[x,S]=(0,Gl.useState)(!1),y=(0,Gl.useRef)(null),C=M=>{g(M),d&&d(M),p&&p()},P=()=>{!u&&m&&setTimeout(()=>m(),100)},v=()=>{C(!1),l&&l()},T=()=>{C(!1),c&&c()},R=y.current&&y.current.getBoundingClientRect(),I=()=>!u&&(e.isPending||n?a(U9,{spinning:!n}):a(f,{position:"absolute",left:0,bottom:`${Vl}px`,top:0,right:0,zIndex:1,margin:"auto",children:a(Mu,{icon:a(Nt,{}),color:"tomato",inverted:!0,solid:!0})}));return w(f,{position:"relative",onMouseOver:()=>b(!0),onMouseLeave:()=>b(!1),children:[u&&a($i,{zIndex:gb,opacity:r?void 0:0,onClick:()=>C(!1)}),w(f,{position:"relative",onClick:()=>C(!u),zIndex:u?gb:void 0,ref:y,children:[e.isPending&&(i?h&&I():I()),a(us,{name:e.name||"",email:e.email,isPending:e.isPending,url:e.pic,fullBox:!0,isCaptionVisible:!t&&!u,projectsCount:o,isSelected:t,showInitials:!!(i||u),showCaption:!u}),s&&u&&a(f,{position:"absolute",left:12,top:12,width:48,height:48,borderRadius:"50%",children:a(Pt,{width:48,height:48,color:"lightGray",hoverColor:"lightGray",children:a(V9,{})})}),x&&a(f,{position:"absolute",left:12,top:12,backgroundColor:"black",width:48,height:48,opacity:.3,borderRadius:"50%"})]}),!e.isPending&&h&&a(f,{position:"absolute",top:-13,right:-13,onMouseOver:()=>S(!0),onMouseLeave:()=>S(!1),children:a(Pt,{color:"tomato",hoverColor:"black",width:24,height:24,onClick:()=>T(),children:a(Nt,{color:"white"})})}),e.isPending&&u?w(Dt.div,{initial:{opacity:0},animate:{opacity:u?1:0},onAnimationComplete:M=>{typeof M=="object"&&"opacity"in M&&M.opacity===0&&P()},style:{position:"fixed",zIndex:gb,top:`${R&&R.top+At.regular}px`,left:`${R&&R.left}px`},children:[a(Pt,{as:"div",color:"black",width:At.regular,height:At.regular,onClick:()=>v(),marginRight:0,css:M=>ae`
              color: ${M.colors.white};
              &:hover {
                background-color: ${M.colors.tomato};
              }
            `,children:"Resend"}),a(Pt,{as:"div",color:"tomato",width:At.regular,height:At.regular,onClick:()=>T(),marginRight:0,css:M=>ae`
              color: ${M.colors.white};
              &:hover {
                background-color: ${M.colors.black};
              }
            `,children:"Remove"})]}):null]})}var hb=G9;var LS=B(H());oe();$e();fe();k();var j9=F("div")`
  white-space: nowrap;
`;function Nm({isTeammatePending:e,isSupportTeammate:o,isSharedViaFolder:t,isResend:r,onResend:i,onUnshare:n,onMouseOut:s}){let[l,c]=(0,LS.useState)(!1);return a(q,{children:t?a(ge,{variant:"tertiary",textStyle:"subheading",disabled:!0,children:"Shared within collection"}):e?w(j9,{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[a(L,{as:"div",display:l?"none":void 0,textStyle:"subheading",lineHeight:`${At.regular}px`,children:"Pending"}),!o&&a(ge,{display:l?"inline-block":"none",variant:"tertiary",textStyle:"subheading",lineHeight:`${At.regular}px`,onClick:i,onMouseOut:s,children:r?"Sent":"Resend"}),a(ge,{display:l?"inline-block":"none",variant:"tertiary",textStyle:"subheading",lineHeight:`${At.regular}px`,marginLeft:10,onClick:n,children:"Unshare"})]}):a(ge,{variant:"tertiary",textStyle:"subheading",onClick:n,children:"Unshare"})})}oe();ov();k();var[q9]=Ga,DS=568;function Y9({projects:e,allProjects:o,myTeam:t,sharedTeam:r,user:i,onExit:n,show:s,zIndex:l,userRoles:c,initialRole:d,authHost:p,onTeammateAdd:m,onTeammateRemove:u,onTeammateUpdate:g,onResendInvitation:h,onUserSelect:b,onCollaboratorsLimit:x}){let S=t.filter(J=>J.isSupport===!1),y=(0,Ui.useMemo)(()=>i&&i.plan&&i.plan.level,[i]),C=(0,Ui.useMemo)(()=>!!(i&&i.stripe&&i.stripe.subscription_pause_ends_at),[i]),P=(0,Ui.useMemo)(()=>{let J=Q0(i)-ev(S).length;return!C&&J>0},[i,S,C]),[v,T]=(0,Ui.useState)({projects:e?.length?e:[],selectedUser:null,copy:!1,isSubmitting:!1,didError:!1,userSearchKey:1,lastInvinationTo:null,unsharedProjects:[],filteredProjects:[],selectedUserRole:d||(c?.length?c[0].name:""),sentAnalyticsOnUserPlanErrorMessage:!1}),R=(0,Ui.createRef)(),I=pl(v.projects),M=tu(v.projects),D=Fh({myTeam:t,sharedTeam:r,projectNumIds:I,folderIds:M}),E=(0,Ui.useMemo)(()=>J0({projects:v.projects,allTeammates:D,me:i}),[v.projects,D,i,I,M]),A=!E.length,$=e?Z0({all:t,allProjects:o,excluded:E,selectedUser:v.selectedUser,me:i}):[];function j(){if(x&&!v.sentAnalyticsOnUserPlanErrorMessage)return T(J=>({...J,sentAnalyticsOnUserPlanErrorMessage:!0})),x()}let pe=(0,Ui.useMemo)(()=>(j(),C?"You can't add collaborators. Your subscription has been paused.":y==="free"?"Please upgrade your plan to add collaborators.":["personal","freelancer","studio","business"].includes(y)||y==="extra"?"Please change your subscription conditions to add new collaborators.":`You can\u2019t ${$.length?"invite":"add"} more collaborators on your plan.`),[y,C]);function ee(J){let{projects:X}=v;return X.every(Q=>Gs(Q)&&!!Q.folder&&J.folderIds.includes(Q.folder))}async function G(J,X=!1){let{selectedUser:Q}=J?{selectedUser:J}:v,te=i;if(Q){let ye=typeof Q=="string"?Q:Q.email,de=pl(o),Se=pl(v.projects),be=tu(v.projects);if(T(Ae=>({...Ae,isSubmitting:!0,didError:!1,error:"",isCollaboratorLimitReached:!1})),te?.email===ye)return T(Ae=>({...Ae,isSubmitting:!1,didError:!0,error:"You can\u2019t collaborate with yourself."}));try{let Ae=Fh({myTeam:t,sharedTeam:r},{excludeSupport:!0}).find(U=>U.email===ye),Qe=Ae&&t.some(U=>U.email===ye),O={};if(Ae&&Qe){let U=Ae.sharesAll?de:new Set([...Ae.projectNumIds,...Se]),Y=new Set([...Ae.folderIds,...be]),re=Array.prototype.concat(...[...Y].map(ke=>o.filter(Te=>Gs(Te)&&Te.folder===ke))).map(ke=>ke.num_id),Ne=new Set([...U].filter(ke=>!re.includes(ke)));if(v.selectedUserRole){let ke=rn({items:[...Ne],roles:Ae.projectRoles||{},newItems:Se,newRole:v.selectedUserRole}),Te=rn({items:[...Y],roles:Ae.folderRoles||{},newItems:be,newRole:v.selectedUserRole});O=await g({email:ye,sharesAll:!1,projectNumIds:ke.items,projectRoles:ke.roles,folderIds:Te.items,folderRoles:Te.roles})}}else if(v.selectedUserRole){let U=rn({newItems:Se,newRole:v.selectedUserRole}),Y=rn({newItems:be,newRole:v.selectedUserRole});O=await m({email:ye,sharesAll:!1,projectNumIds:U.items,projectRoles:U.roles,folderIds:Y.items,folderRoles:Y.roles})}T(U=>({...U,isSubmitting:!1,didError:!1,userSearchKey:v.userSearchKey+1,updatedTeammate:O,...X?{}:{selectedUser:""}}))}catch(Ae){let Qe=(Ae.code||Ae.errorOptions?.code)==="COLLABORATOR_LIMIT_REACHED";T(O=>({...O,isSubmitting:!1,didError:!0,collaboratorInvited:!1,isCollaboratorLimitReached:Qe,error:Qe?void 0:Ae.message?Ae.message:Ae.error?Ae.error.message||Ae.error.toString():"Error adding collaborator. Please try again."}))}}}async function K(J){if(J){T(X=>({...X,didError:!1,error:""}));try{await h(J.email),T(X=>({...X,lastInvinationTo:J._id}))}catch{T(X=>({...X,didError:!0,error:"Error sending invitation. Please try again."}))}}}async function we(J){if(!J)return;let X=pl(v.projects),Q=tu(v.projects),te=pl(o),ye=(J.sharesAll?te:J.projectNumIds).filter(Se=>!X.includes(Se)),de=J.folderIds.filter(Se=>!Q.includes(Se));T(Se=>({...Se,didError:!1,error:""}));try{if(J.isSupport||J.isPending&&!ye.length&&!de.length)await u(J);else{let Se=rn({items:ye,roles:J.projectRoles}),be=rn({items:de,roles:J.folderRoles});await g({email:J.email,sharesAll:!1,projectNumIds:Se.items,projectRoles:Se.roles,folderIds:be.items,folderRoles:be.roles})}T(Se=>({...Se,updatedTeammate:void 0}))}catch{T(Se=>({...Se,didError:!0,error:"Error when unsharing. Please try again."}))}}function xe(J){return J.preventDefault(),v.selectedUser&&pb(typeof v.selectedUser=="string"?v.selectedUser:v.selectedUser.email)}function _e(){T(J=>({...J,isInputInFocus:!1}))}function ie(J){T(X=>({...X,isInputInFocus:!0})),R.current&&!J&&window.scroll({top:R.current.offsetTop,behavior:"smooth"})}function ze(J){T(X=>({...X,selectedUser:J,selectedProject:void 0})),b&&b()}async function ne(){if(v.projects.length)await G();else{let J=t.find(Q=>typeof v.selectedUser=="object"?Q.email===v.selectedUser?.email:Q.email===v.selectedUser),X=J?o.filter(Q=>Gs(Q)&&!J.projectNumIds.includes(Q.num_id)):o;T(Q=>({...Q,isSelectUserProjectVisible:!0,unsharedProjects:X,filteredProjects:X.slice(0,2)}))}}return a(xu,{query:`(min-width: ${q9})`,children:J=>a(Bk,{closeTitle:"Close",initialFocus:J&&A&&P?"#rm-user-search-input":"",show:s,onExit:n,error:v.isCollaboratorLimitReached?w(q,{children:["You work with maximum collaborators."," ",a(Ce,{as:"a",textDecoration:"underline",color:"white",href:"https://help.readymag.com/hc/en-us/articles/360029207812-Collaborating-on-projects",target:"_blank",css:ae`
                    &:hover {
                      text-decoration: none;
                      color: white;
                    }
                  `,children:"Remove some"})," ","or upgrade to invite more"]}):v.error,zIndex:l,dialogPosition:"relative",title:a(f,{as:"span",paddingLeft:J?At.regular+16:0,children:e?v.projects.length?E.length?"Collaborators":"Collaborate with":"Add collaborator":w(q,{children:[v.isSelectUserProjectVisible?a(ge,{as:"a",textStyle:J?"subheading":"regular",onClick:()=>{T(X=>({...X,isSelectUserProjectVisible:!1,projects:[]}))},color:"gray",children:"Add collaborator"}):a(L,{textStyle:J?"subheading":"regular",children:"Add collaborator"}),v.isSelectUserProjectVisible||v.selectedProject?w(q,{children:[a(L,{paddingLeft:"2rm",paddingRight:"2rm",textStyle:J?"subheading":"regular",color:"gray",children:">"}),v.selectedProject&&!v.isSelectUserProjectVisible?a(ge,{as:"a",textStyle:J?"subheading":"regular",onClick:()=>{T(X=>({...X,isSelectUserProjectVisible:!0,projects:[]}))},color:"gray",children:"Select project"}):a(L,{textStyle:J?"subheading":"regular",children:"Select project"})]}):null]})}),children:a(f,{height:["auto",e?"auto":"326px"],children:v.isSelectUserProjectVisible?w(f,{display:"flex",marginBottom:[0,v.selectedProject?28:v.filteredProjects.length?"15px":40],flex:["1",void 0],paddingTop:72,paddingLeft:[0,88],flexDirection:"column",justifyContent:"flex-start",children:[a(f,{children:v.selectedProject?w(f,{display:"flex",height:At.regular,alignItems:"center",position:"relative",borderBottom:"2px solid",borderBottomColor:v.collaboratorInvited?"transparent":"black",justifyContent:"space-between",children:[w(f,{display:"flex",whiteSpace:J?void 0:"nowrap",width:J?void 0:"calc(100vw - 200px)",overflow:J?void 0:"hidden",textOverflow:J?void 0:"ellipsis",children:[a(L,{textStyle:J?"subheading":"regular",display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",maxWidth:330,verticalAlign:"bottom",lineHeight:1.25,whiteSpace:"nowrap",children:js(v.selectedProject)?v.selectedProject.name:v.selectedProject.title}),v.collaboratorInvited?null:a(ge,{className:"clear","aria-label":"Clear selection",onClick:()=>T(X=>({...X,selectedProject:void 0,filterProjects:"",filteredProjects:v.unsharedProjects.slice(0,2)})),marginTop:"1rm",children:a(Nt,{"aria-hidden":!0})})]}),v.collaboratorInvited?v.updatedTeammate&&a(Nm,{isTeammatePending:v.updatedTeammate.isPending,isSupportTeammate:v.updatedTeammate.isSupport,isResend:v.lastInvinationTo===v.updatedTeammate._id,isSharedViaFolder:!1,onResend:()=>K(v.updatedTeammate),onMouseOut:()=>T(X=>({...X,lastInvinationTo:null})),onUnshare:()=>we(v.updatedTeammate)}):a(ge,{variant:"primary",textStyle:"subheading",type:"submit",position:"absolute",right:0,lineHeight:"72px",minWidth:60,onClick:async()=>{T(X=>({...X,projects:[v.selectedProject],collaboratorInvited:!0})),await G(void 0,!0)},children:"Invite collaborator"})]}):a(ub,{textStyle:J?"subheading":"regular",paddingRight:80,placeholder:"Project name",boxSizing:"border-box",height:At.regular,onChange:X=>{let Q=X.target.value,te=v.unsharedProjects.filter((ye,de)=>Q?((js(ye)?ye.name:ye.title)||"").toLowerCase().includes(Q.toLowerCase()):de<2);Q&&te.length===1?T(ye=>({...ye,filteredProjects:te,selectedProject:te[0],filterProjects:Q})):T(ye=>({...ye,filteredProjects:te,filterProjects:Q}))}})}),v.selectedProject?a(f,{width:152,paddingTop:61,children:a(f,{display:"flex","data-testid":`project-card-${v.selectedProject._id}`,paddingLeft:"2rm",paddingRight:"2rm",position:"relative",flexDirection:"column",borderRadius:"4px",aspectRatio:1.66,borderColor:"lightGray",border:"1px solid",backgroundColor:"white",backgroundPosition:"center",backgroundSize:"cover",backgroundImage:js(v.selectedProject)?"":v.selectedProject.cover})}):w(f,{display:"flex",paddingTop:65,flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",marginRight:-20,marginBottom:-11,children:[v.filterProjects?null:a(f,{display:"flex",marginBottom:[3,0],height:72,alignItems:"center",paddingRight:[0,18],children:a(L,{textStyle:J?"subheading":"regular",color:"gray",children:"Suggestions"})}),v.filteredProjects.map(X=>a(f,{cursor:"pointer",width:152,flex:"0 0 152px",paddingBottom:20,overflow:"hidden",marginRight:20,children:a(f,{display:"flex","data-testid":`project-card-${X._id}`,paddingLeft:"2rm",paddingRight:"2rm",position:"relative",flexDirection:"column",borderRadius:"4px",aspectRatio:1.66,borderColor:"lightGray",border:"1px solid",backgroundColor:"white",backgroundPosition:"center",backgroundSize:"cover",backgroundImage:js(X)?"":X.cover,onClick:async()=>{T(Q=>({...Q,selectedProject:X}))}})},X._id))]})]}):w(f,{display:"flex",marginBottom:[0,$.length?0:40],flex:["1",void 0],flexDirection:"column",justifyContent:["space-between",void 0],children:[w(f,{marginTop:[0,72],marginBottom:[80,0],children:[e&&(J?a(f,{display:"flex",flexDirection:"column",children:E.map(X=>{let Q=e.map(be=>tv({teammate:X,projectNumId:Gs(be)?be.num_id:void 0,projectFolderId:Gs(be)&&be.folder||void 0,folderId:js(be)?be._id:void 0})).filter(Boolean),te=[...new Set(Q)],ye=te.length?te.length===1?te[0]:"Multiple roles":null,de=e.filter(Gs).map(be=>be.num_id),Se=e.filter(js).map(be=>be._id);return w(f,{display:"flex",justifyContent:"space-between",children:[a(f,{minWidth:0,children:w(f,{display:"flex",alignItems:"center",children:[a(f,{minWidth:72,children:a("a",{href:`${p||"https://my.readymag.com"}/team/${X.uri}`,target:"_blank",rel:"noreferrer",children:a(Gt,{name:X.name||"",url:X.pic})})}),a(f,{marginLeft:16,overflow:"hidden",children:a(L,{as:"div",textStyle:"subheading",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",lineHeight:2,paddingRight:2,children:X.name||X.email})})]})}),w(f,{display:"flex",gap:"20px",minWidth:0,flexShrink:0,children:[c?.length?a(db,{roles:c,selectedRoleName:ye,onChangeRole:async be=>{let Ae=rn({items:X.projectNumIds,roles:X.projectRoles||{},newItems:de,newRole:be}),Qe=rn({items:X.folderIds,roles:X.folderRoles||{},newItems:Se,newRole:be}),O={email:X.email,sharesAll:X.sharesAll||!1,projectNumIds:Ae.items,projectRoles:Ae.roles,folderIds:Qe.items,folderRoles:Qe.roles};await g(O)}}):void 0,X.email!==i.email?a(Nm,{isTeammatePending:X.isPending,isSupportTeammate:X.isSupport,isResend:v.lastInvinationTo===X._id,isSharedViaFolder:ee(X),onResend:()=>K(X),onMouseOut:()=>T(be=>({...be,lastInvinationTo:null})),onUnshare:()=>we(X)}):void 0]})]},X._id||X.email)})}):a(f,{display:"flex",marginTop:40,marginLeft:-24,paddingLeft:24,width:"100vw",overflowX:"auto",css:ae`
                          -webkit-overflow-scrolling: ${v.isTeammateDropdownVisible?"auto":"touch"};
                          @media (max-height: ${DS}px) {
                            margin-top: 20px;
                          }
                        `,children:E.map(X=>a(hb,{teammate:X,projectCount:Hh(X,o),onToggle:Q=>T(te=>({...te,isTeammateDropdownOpen:Q})),onAppear:()=>T(Q=>({...Q,isTeammateDropdownVisible:!0})),onDisappear:()=>T(Q=>({...Q,isTeammateDropdownVisible:!1})),onUnshare:()=>we(X),onResend:()=>K(X)},X._id||X.email))})),!e&&v.selectedUser&&v.updatedTeammate&&(J?a(f,{display:"flex",flexDirection:"column",marginBottom:P?143:0,marginTop:"-1px",children:w(f,{display:"flex",justifyContent:"space-between",children:[w(f,{display:"flex",alignItems:"center",children:[a(Gt,{name:v.updatedTeammate.name||"",url:v.updatedTeammate.pic}),a(f,{marginLeft:16,children:a(L,{as:"div",textStyle:"subheading",children:v.updatedTeammate.name||v.updatedTeammate.email})})]}),a(Nm,{isTeammatePending:v.updatedTeammate.isPending,isSupportTeammate:v.updatedTeammate.isSupport,isResend:v.lastInvinationTo===v.updatedTeammate._id,isSharedViaFolder:!1,onResend:()=>K(v.updatedTeammate),onMouseOut:()=>T(X=>({...X,lastInvinationTo:null})),onUnshare:()=>we(v.updatedTeammate)})]})}):a(f,{display:"flex",marginTop:40,marginLeft:-24,paddingLeft:24,width:"100vw",overflowX:"auto",css:ae`
                          -webkit-overflow-scrolling: ${v.isTeammateDropdownVisible?"auto":"touch"};
                          @media (max-height: ${DS}px) {
                            margin-top: 20px;
                          }
                        `,children:a(hb,{teammate:v.updatedTeammate,projectCount:Hh(v.updatedTeammate,o),onToggle:X=>T(Q=>({...Q,isTeammateDropdownOpen:X})),onAppear:()=>T(X=>({...X,isTeammateDropdownVisible:!0})),onDisappear:()=>T(X=>({...X,isTeammateDropdownVisible:!1})),onUnshare:()=>we(v.updatedTeammate),onResend:()=>K(v.updatedTeammate)},v.updatedTeammate._id||v.updatedTeammate.email)})),!v.isTeammateDropdownOpen&&P&&!v.collaboratorInvited?a(f,{position:"relative",children:a(f,{as:"form",onSubmit:X=>xe(X)&&ne(),marginTop:[26,0],marginBottom:[0,$.length||!P?0:80],ref:R,children:a(cb,{placeholder:"Maria or maria@example",submitText:v.projects.length?P?"Invite":"Add":"Select project",disabled:v.collaboratorInvited||v.isSubmitting,suggestions:e?!v.error&&P?$:[]:[],onChange:ze,onFocus:()=>ie(J),onBlur:()=>_e(),"data-testid":"user-search",showInput:P,selectedUser:v.selectedUser,preSubmitSlot:c?.length?a(db,{roles:c,selectedRoleName:v.selectedUserRole,onChangeRole:X=>{T(Q=>({...Q,selectedUserRole:X}))}}):void 0},v.userSearchKey)})}):null,!P&&!v.selectedUser&&$.length?w(f,{paddingLeft:[0,88],marginTop:[0,24],minHeight:[60,0],textAlign:J?"left":"center",paddingBottom:10,children:[v.projects.length?a(L,{textStyle:J?"subheading":"regular",color:"gray",children:"Add collaborator"}):null,a(f,{display:"flex",marginTop:[0,12],flexWrap:"wrap",children:$.map(X=>a(f,{height:146,children:a(us,{name:X.name||X.email,email:X.email,url:X.pic,projectsCount:X.projectsCount,isCaptionVisible:!J,fullBox:!J,"data-testid":X._id,onClick:async()=>{v.projects.length?await G(X):T(Q=>({...Q,selectedUser:X}))}})},X._id||X.email))})]}):null]}),P?null:a(q,{children:w(f,{paddingLeft:[0,88],marginTop:[0,v.updatedTeammate?67:v.selectedUser?106:$.length?12:24],marginBottom:[18,56],minHeight:[60,0],textAlign:J?"left":"center",children:[a(L,{as:"p",children:pe}),!C&&a(L,{as:"p",children:y==="extra"?a(Ce,{as:"a",color:"gray",href:"mailto:support@readymag.com",children:"Contact our support team to learn more."}):a(Ce,{as:"a",color:"gray",href:"https://my.readymag.com/settings/#change-plan",target:"_blank",children:"Upgrade your plan to add collaborators."})})]})})]})})})})}var fb=Y9;ov();Wn();Be();K6();st();k();var OS=({children:e,...o})=>{let t=(0,bb.useContext)(Ee),r=(0,bb.useContext)(ce);function i(n){let l=[...Object.values(n.projectRoles||{}),...Object.values(n.folderRoles||{})].filter(c=>c)[0]||"member";se(he.SettingsProject,{settingsType:"collaborate",collaborateType:l==="member"?"design and content":"content only"})}return a(fb,{projects:r.teamworkProjects,allProjects:r.allProjects,myTeam:r.team,sharedTeam:[],user:r.me,show:!0,userRoles:Ze.rolesList,initialRole:"member",authHost:le.readymag_auth_host,...o,onExit:()=>{t.dispatch({type:"toggleTeamworkModal",payload:!1})},onResendInvitation:async n=>{await k0(n)},onTeammateAdd:async n=>{let s=await x0(n);return i(n),r.updateTeam([...r.team,s],r.project.num_id),s},onTeammateRemove:async n=>{await y0(n.recordId),r.updateTeam([...r.team.filter(s=>s.recordId!==n.recordId)],r.project.num_id),se(he.SettingsProject,{settingsType:"collaborate unshare"})},onTeammateUpdate:async n=>{let s=await v0(n);return i(n),r.updateTeam([...r.team.map(l=>l._id===s._id?s:l)],r.project.num_id),s}})};jh();Ur();qh();oe();zt();Ve();Wo();Co();je();k();var X9=10,wb=.3,$S=({children:e,...o})=>{let{isHovered:t,...r}=Ke(!1),{isHovered:i,...n}=Ke(!1),[s,l]=(0,ga.useState)(void 0),c=(0,ga.useContext)(Ee),d=(0,ga.useContext)(ce),p=()=>{let x="";return d.isOwner?x=`/${d.project.user.uri}`+(d.project.folder?`/f/${d.project.folder.uri}`:""):x=`/shared/${d.project.user.uri}`,x},m=d.ownedProjectTeam.filter(x=>x.email!==d.me.email),u=()=>{c.dispatch({type:"toggleTeamworkModal",payload:!0})},g=()=>{se(he.EditorActions,{action:"back to profile"}),window.location.href=p()},h=(0,ga.useMemo)(()=>m.slice(0,X9).reverse(),[m]),b=m.length-h.length;return w(f,{position:"relative",width:"56px",height:"56px",...o,children:[c.isTeamworkModalOpened&&a(OS,{zIndex:10500}),w(f,{width:"100%",height:"100%",...r,children:[w(f,{...n,children:[a(yS,{}),i&&a(Pt,{position:"absolute",top:"0px",left:"0px",width:"56px",height:"56px",color:"darkGray",hoverColor:"darkGray",activeColor:"darkGray",borderRadius:"50%",onClick:g,children:a(Ys,{color:"white"})})]}),w(f,{width:"56px",height:"72px",position:"absolute",bottom:"100%",visibility:t?"visible":"hidden",opacity:t?"1":"0",transform:t?"translateY(0px)":"translateY(4px)",transition:`opacity ${wb}s ease, transform ${wb}s ease, visibility 0s ${t?"0s":wb+"s"} ease`,children:[b>0&&a(f,{bottom:48*(h.length+1)+16,position:"absolute",width:"58px",height:"58px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",color:"white",backgroundColor:"darkGray",cursor:"pointer",onClick:u,children:`+${b}`}),h.map(({email:x,pic:S,name:y},C)=>w(f,{position:"absolute",width:"56px",height:"56px",bottom:48*(h.length-C)+16,zIndex:s===x?h.length+2:void 0,cursor:"pointer",onMouseEnter:()=>l(x),onMouseLeave:()=>l(void 0),onClick:u,css:ae`
                & > * {
                  width: 100% !important;
                  height: 100% !important;
                }
              `,children:[a(Gt,{url:S,name:y||x,type:"settingsUser"}),a(f,{boxShadow:`0 0 0 2px inset ${Le(.6,V.gray)}`,position:"absolute",top:"0",borderRadius:"50%",width:"100%",height:"100%"})]},x)),d.isOwner?a(St,{text:"Add collaborator",indent:8,preventOverflow:16,open:m.length>0?!1:void 0,children:a(Pt,{position:"absolute",top:"0",zIndex:m.length+1,width:"56px",height:"56px",color:"darkGray",hoverColor:"black",activeColor:"black",onClick:u,children:a(Xs,{width:"24px",height:"24px",color:"white"})})}):null]})]})]})};fe();var ha=B(H());$e();Uo();Be();N();jn();k();var HS=({id:e="pageIcon",width:o,height:t,hoverBox:r})=>{let i=Vo(o,t,r);return w("svg",{id:e,width:o,height:t,viewBox:"0 0 27 28",xmlns:"http://www.w3.org/2000/svg",style:{padding:i},children:[w("line",{x1:"1",y1:"25.5",x2:"26",y2:"25.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[a("animateTransform",{attributeName:"transform",type:"translate",to:"0 2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animateTransform",{attributeName:"transform",type:"translate",from:"0 2",to:"0 0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"1",y1:"3.5",x2:"26",y2:"3.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[a("animateTransform",{attributeName:"transform",type:"translate",to:"0 -2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animateTransform",{attributeName:"transform",type:"translate",from:"0 -2",to:"0 0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};mi();k();var FS=({onClick:e,disableTooltip:o})=>{let t=(0,ha.useContext)(ce),[r,i]=(0,ha.useState)(""),[n,s]=(0,ha.useState)("");return(0,ha.useEffect)(()=>{let{currentPageId:l,pagesParams:c}=t;c[l]&&(c[l].parentId?(i(`${c[c[l].parentId].viewNum}`),s(`${c[l].viewNum}`)):(i(`${c[l].viewNum}`),n&&s("")))},[t.currentPageNum,t.currentPageId,t.pagesParams]),a(gt,{instance:!0,closeOnTargetClick:!0,eduTips:"eduTipNewTemplate",defaultText:"Pages (M)",indent:8,disabled:o,leaveDelay:100,children:w(ge,{display:"flex",alignItems:"center",justifyContent:"center",onClick:e,variant:"unstyled",height:"100%",width:"100%",position:"relative",color:"white","aria-label":"Pages","data-testid":"pages-button",children:[a(HS,{width:"26px",height:"28px",hoverBox:{width:56,height:56}}),w(f,{width:"100%",height:"100%",position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",children:[a(L,{textStyle:"subheading",fontSize:"20px",color:"white",children:r}),n?w(L,{textStyle:"small",position:"relative",top:5,fontWeight:"700",color:"white",marginBottom:"4px",children:[".",n]}):null]})]})})};$e();jn();k();var NS=({id:e="desktopIcon",width:o,height:t,hoverBox:r})=>{let i=Vo(o,t,r);return w("svg",{id:e,viewBox:"0 0 34 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:o,height:t,style:{padding:i},children:[w("rect",{x:"4",y:"5.5",width:"26",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2",children:[a("animate",{attributeName:"x",to:"10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x",to:"4",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"y",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"y",to:"5.5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"width",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"width",to:"26",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"height",to:"30",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"height",to:"18",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"rx",to:"3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"rx",to:"2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"1",y1:"27.5",x2:"33",y2:"27.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[a("animate",{attributeName:"x1",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"20",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"33",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};jn();k();var WS=({id:e="phoneIcon",width:o,height:t,hoverBox:r})=>{let i=Vo(o,t,r);return w("svg",{id:e,viewBox:"0 0 34 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:o,height:t,style:{padding:i},children:[w("rect",{x:"10",y:"1",width:"14",height:"30",rx:"3",stroke:"currentColor",strokeWidth:"2",children:[a("animate",{attributeName:"x",to:"4",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x",to:"10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"y",to:"5.5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"y",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"width",to:"26",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"width",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"height",to:"18",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"height",to:"30",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"rx",to:"2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"rx",to:"3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"14",y1:"27.5",x2:"20",y2:"27.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[a("animate",{attributeName:"x1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x1",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"33",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"20",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};jn();k();var VS=({id:e="tabletIcon",width:o,height:t,hoverBox:r})=>{let i=Vo(o,t,r);return w("svg",{id:e,viewBox:"0 0 34 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:o,height:t,style:{padding:i},children:[w("rect",{x:"7",y:"1",width:"20",height:"30",rx:"3",stroke:"currentColor",strokeWidth:"2",children:[a("animate",{attributeName:"x",to:"4",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x",to:"7",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"y",to:"5.5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"y",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"width",to:"26",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"width",to:"20",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"height",to:"18",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"height",to:"30",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"rx",to:"2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"rx",to:"3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"17",y1:"27.5",x2:"17",y2:"27.5",stroke:"currentColor",strokeWidth:"2",strokeOpacity:"0",strokeLinecap:"round",children:[a("animate",{attributeName:"x1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x1",to:"17",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"33",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"17",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"stroke-opacity",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"discrete"}),a("animate",{attributeName:"stroke-opacity",to:"0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"discrete"})]})]})};Uo();vt();k();function US({currentViewport:e,disableTooltip:o,onClick:t,...r}){return a(gt,{targetSteps:["CreateLayout","OpenMobileLayout"],defaultText:"Devices (D)",indent:8,disabled:o,leaveDelay:100,instance:!0,closeOnTargetClick:!0,children:a(ge,{display:"flex",alignItems:"center",justifyContent:"center",onClick:t,variant:"unstyled",height:"100%",width:"100%",color:"white","aria-label":"Viewports","data-testid":"viewport-button",...r,children:e==="tablet_portrait"?a(VS,{width:"34px",height:"32px",hoverBox:{width:56,height:56}}):e==="phone_portrait"?a(WS,{width:"34px",height:"32px",hoverBox:{width:56,height:56}}):a(NS,{width:"34px",height:"32px",hoverBox:{width:56,height:56}})})})}var Mb=B(H());var hs=B(H());var or=B(H());N();var qo=B(H());N();Be();Qh();var ko=B(H());N();Ks();xI();fe();dr();Fo();Xd();var Um=B(H());ek();N();rc();N();$e();_r();k();function jS({isPageSettingsOpened:e,hideDelete:o,actionCallback:t}){return w(f,{"aria-label":"Page action menu",paddingLeft:"4rm",paddingTop:12,children:[a(f,{children:a(Ue,{"aria-label":"Duplicate page","data-testid":"duplicate-page",textStyle:"subheading",color:"white",onClick:r=>{r.preventDefault(),r.stopPropagation(),t("duplicate")},children:"Duplicate"})}),a(f,{marginTop:12,children:a(Ue,{"aria-label":"Toggle page settings","data-testid":"toggle-page-settings",textStyle:"subheading",color:e?"tomato":"white",onClick:r=>{r.preventDefault(),r.stopPropagation(),t("settings")},children:"Settings"})}),!o&&a(f,{marginTop:12,children:a(Ue,{"aria-label":"Delete page","data-testid":"delete-page",textStyle:"subheading",color:"white",onClick:r=>{r.preventDefault(),r.stopPropagation(),t("detele")},children:"Delete"})})]})}var Wm=B(H()),qS=B(Qo());N();zt();Co();Ve();oe();k();var YS=(0,Wm.forwardRef)(({isShown:e,position:o="absolute",zIndex:t=8e3,transform:r,placement:i,placementStyles:n,rootElement:s,children:l,...c},d)=>{if(!e)return null;let p=(0,Wm.useMemo)(()=>{let m="";switch(i){case"bottom":m="bottom: -8px; left: 20px;";break;case"right":m="bottom: calc(50% - 4px); right: -12px; transform: rotate(-90deg);";break;case"left":m="bottom: calc(50% - 4px); left: -12px; transform: rotate(90deg);";break;default:break}return m},[i]);return qS.default.createPortal(w(f,{ref:d,position:o,zIndex:t,borderRadius:"4px",backgroundColor:Le(.08,V.black),transform:r||"none",transition:"0.3s transform ease",...c,children:[l,i&&a(f,{display:"flex",height:8,width:16,position:"absolute",color:Le(.08,V.black),css:ae`
              ${n||p}
            `,children:a(O0,{})})]}),s||document.body)});YS.displayName="Popup";var Vm=YS;oe();k();var XS=f.withComponent(F("button")`
  width: 32px;
  height: 32px;
  color: ${e=>e.theme.colors.black};
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 50%;
  transition: opacity 0.2s ease;
  padding: 0;
  margin: 0;
  border: none;
  box-shadow: rgb(128 128 128 / 16%) 0px 0px 0px 1px;
  cursor: pointer;
  &:hover {
    color: ${e=>e.theme.colors.tomato};
  }

  ${e=>Td({light:{backgroundColor:"white"},dark:{backgroundColor:e.theme.colors.lightGray}})}

  ${e=>e.isActive&&ae`
      background-color: ${e.theme.colors.tomato};
      color: white;
      &:hover {
        color: white;
      }
    `}
`);XS.defaultProps={variant:"light"};var xb=(0,Um.memo)(({isPopupOpened:e,isCurrentPage:o,popupContainer:t,hideDelete:r,onPageActionsButtonClick:i,isPageSettingsOpened:n,pageActionsHandler:s,collaboratorName:l,collaboratorAvatar:c,keepActionButtons:d,isHovered:p,buttonVariant:m="light"})=>{let[u,g]=(0,Um.useState)({left:0,top:0}),h=Iu({watchingClick:e,callback:()=>{i(!0)}});return w(f,{display:"flex",children:[a(XS,{marginRight:0,"data-testid":"toggle-page-actions-popup",variant:m,isActive:e||n&&o,opacity:p||d?1:0,onClick:b=>{if(b.preventDefault(),b.stopPropagation(),t){let x=b.currentTarget.getBoundingClientRect(),S=t.getBoundingClientRect();g({left:x.left-S.left+x.width+12,top:x.top-S.top-(r?28:46)}),i()}},children:a(Tr,{color:"currentColor"})}),t&&a(Vm,{ref:h,rootElement:t,isShown:e,width:148,height:r?88:124,top:`${u.top}px`,left:`${u.left}px`,placement:"left",children:a(jS,{isPageSettingsOpened:n&&o,hideDelete:r,actionCallback:s})}),l&&a(Gt,{size:"small",marginLeft:"8px",url:c,name:l})]})});xb.displayName="PageActionsSmallPanel";N();Ve();Ur();Nv();SI();ln();oe();_r();var KS=B(H());k();var Z9=F(f)`
  display: flex;
  width: 128px;
  height: 32px;
  justify-content: center;
  transition: opacity 0.2s ease;
  & > * {
    margin-left: 16px;
    &:first-of-type {
      margin-left: 0;
    }
  }
`,J9=F(f)`
  display: flex;
  width: 32px;
  height: 128px;
  flex-direction: column;
  justify-content: center;
  transition: opacity 0.2s ease;
  & > * {
    margin: 3px 0;
  }
`,Q9=(0,KS.memo)(({isCurrentPage:e,isPageSettingsOpened:o,hideDelete:t,collaboratorName:r,collaboratorAvatar:i,vertical:n,pageActionsHandler:s,keepActionButtons:l,isHovered:c,...d})=>w(n?J9:Z9,{"aria-label":"Page action buttons",...d,children:[a(Pt,{"aria-label":"Duplicate page","data-testid":"duplicate-page",height:32,width:32,color:"white",outline:!0,marginRight:0,unstyledHover:!0,opacity:c?1:o?0:l?1:0,transition:"opacity 0.2s ease",css:ae`
            &:hover {
              background-color: ${V.white};

              & svg {
                color: ${V.red};
              }
            }

            &:active {
              background-color: ${V.red};

              & svg {
                color: ${V.white};
              }
            }
          `,onClick:m=>{m.preventDefault(),m.stopPropagation(),s("duplicate")},children:a(pu,{color:"black"})}),a(Pt,{"aria-label":"Toggle page settings","data-testid":"toggle-page-settings",height:32,width:32,color:"white",outline:!0,"data-active":e&&o,marginRight:0,opacity:c||l?1:0,transition:"opacity 0.2s ease",css:ae`
            &:hover {
              background-color: ${V.white};

              & svg {
                color: ${V.red};
              }
            }

            &:active {
              background-color: ${V.red};

              & svg {
                color: ${V.white};
              }
            }
          `,onClick:m=>{m.preventDefault(),e&&m.stopPropagation(),(!o||o&&!e||o&&e)&&s("settings")},children:a(Jv,{color:e&&o?"white":"black"})}),t||r?null:a(Pt,{"aria-label":"Delete page","data-testid":"delete-page",height:32,width:32,color:"white",outline:!0,marginRight:0,opacity:c?1:o?0:l?1:0,transition:"opacity 0.2s ease",css:ae`
              &:hover {
                background-color: ${V.white};

                & svg {
                  color: ${V.red};
                }
              }

              &:active {
                background-color: ${V.red};

                & svg {
                  color: ${V.white};
                }
              }
            `,onClick:m=>{m.preventDefault(),m.stopPropagation(),s("detele")},children:a(Nt,{color:"black"})}),r&&a(Gt,{size:"small",url:i,name:r,transform:c?"translateX(0)":`${n?"translateY":"translateX"} (${l?0:"-48px"})`,transition:"opacity 0.2s ease, transform 0.2s ease-in-out"})]})),vb=f.withComponent(Q9);vb.displayName="PageActionsStandartPanel";var ms=B(H());N();_r();Be();k();var jm=(0,ms.memo)(({isCurrentPage:e,pageId:o,gridSize:t,hidden:r=!1,vertical:i,viewport:n,isHovered:s,actionButtonVariant:l,...c})=>{let d=(0,ms.useContext)(Ee),p=(0,ms.useContext)(ce),m=(0,ms.useContext)(yb),u=()=>{d.masterSharePidIsChanging||p.deletePage(o)},g=()=>{let P=`pending-${Date.now()}`,v=p.pages.find(R=>R._id===o),T=p.pagesParams[o];if(v){let R=T.children.length&&T.collapsed;m.addPendingPage({_id:P,uri:"",screenshot:v.screenshot,title:v.title,num:T.children.length?v.num:v.num+1,parentPage:R?v._id:v.parentPage,hidden:!1,isPrivate:!1,pending:!0})}p.duplicatePage(o).then(()=>{}).catch(R=>{console.warn("page dublicate",R)}).finally(()=>{m.removePendingPage(P)})},h=()=>{d.isPageSettingsOpened&&!e?window.RM.constructorRouter.showWorkspace({id:o}):!d.isPageSettingsOpened&&!e?(window.RM.constructorRouter.showWorkspace({id:o}),d.dispatch({type:"togglePageSettings"})):d.dispatch({type:"togglePageSettings"})},b=P=>{let v=!1;if(P){d.dispatch({type:"setPageActionsPopup",payload:v});return}d.isPageActionsPopupOpenedFor!==o&&(v=o),d.dispatch({type:"setPageActionsPopup",payload:v})},x=P=>{switch(P){case"duplicate":g();break;case"detele":u();break;case"settings":d.isPageActionsPopupOpenedFor&&b(!0),h();break;case"gotopage":p.changeWorkspace({id:o});break;default:break}},S=(0,ms.useMemo)(()=>d.isPageActionsPopupOpenedFor===o,[d.isPageActionsPopupOpenedFor]),y=p.lockedPages[o],C=y&&y!==window.RM.constructorRouter.me?.get("uri")?p.collaborators.find(P=>P.uri===y):void 0;return r?null:t===0?a(f,{children:a(vb,{isCurrentPage:e,keepActionButtons:e&&!d.addingPage,isPageSettingsOpened:d.isPageSettingsOpened,hideDelete:p.pages.length===1,collaboratorName:C&&C.name,collaboratorAvatar:C&&C.pic,vertical:i,position:"absolute",top:i?0:"auto",right:i?"auto":0,bottom:i?"auto":8,left:i?"100%":0,margin:i?"0 0 0 8px":"auto",pageActionsHandler:x,isHovered:s})}):a(f,{display:"flex",alignItems:"center",position:"absolute",top:0,bottom:0,margin:"auto",left:7,...c,children:a(xb,{isPopupOpened:S,popupContainer:document.getElementById("settings-popup-container"),hideDelete:p.pages.length===1,onPageActionsButtonClick:b,isPageSettingsOpened:d.isPageSettingsOpened,collaboratorName:C&&C.name,collaboratorAvatar:C&&C.pic,isCurrentPage:e,keepActionButtons:e&&!d.addingPage,pageActionsHandler:x,isHovered:s,buttonVariant:l})})});jm.displayName="ActionsPanelWraper";_r();Be();jt();oe();Wo();var gs=B(H());k();var ZS=(0,gs.createContext)({addElementPageToMap:()=>{}}),{Provider:eR}=ZS;function JS(e){let{current:o}=(0,gs.useRef)(new Map);(0,gs.useEffect)(()=>{if(e.currentPageID){let r=o.get(e.currentPageID);r&&r.scrollIntoView({block:"nearest"})}},[e.currentPageID]);function t(r,i){o.has(r)||i&&o.set(r,i)}return a(eR,{value:{addElementPageToMap:t},children:e.children})}var QS=()=>(0,gs.useContext)(ZS);k();var kb=(0,ko.memo)(({page:e,gridSize:o,dragableRef:t,level:r=0,head:i,childIndex:n,onCollapsed:s,isPageCollapsed:l=!0,viewNum:c,selectedPageIds:d=[],isCurrent:p,isPrivatePages:m,isSortableActive:u,sortableId:g,onSortableItemId:h,selectPage:b,selectPagesRange:x,deselectPages:S,changeWorkspace:y,pageSave:C,updateBrokenScreenshot:P,validatePageUri:v})=>{let{isHovered:T,...R}=Ke(!1),{addElementPageToMap:I}=QS(),M=r&&r*16,D=Y=>{Y.defaultPrevented||(Y.metaKey||Y.ctrlKey?b(e._id):Y.shiftKey?x(e._id):d.length?S():u||y({id:e._id}))},E=()=>s&&s(),[A,$]=(0,ko.useState)(()=>e.title?e.title:""),[j,pe]=(0,ko.useState)(!1),{viewport:ee}=(0,ko.useContext)(qe);(0,ko.useEffect)(()=>{!j&&e.title!==A&&$(e.title?e.title:"")},[e.title,A,j]);let G=()=>{pe(!1);let Y=C(e._id,{title:A},{patch:!0});Y&&!(Y instanceof Error)&&Y.done(re=>{}).fail(()=>{})},[K,we]=(0,ko.useState)(null);(0,ko.useEffect)(()=>{we(e._id===h?"gray":d.includes(e._id)?"tomato":null)},[h,e._id,d]);let xe=e.pending,_e=(0,ko.useRef)(null),ie=(0,ko.useCallback)(Y=>{Y!==e.uri&&C(e._id,{uri:Y},{patch:!0})},[e._id,e.uri,C]),ze=(0,ko.useCallback)(Y=>v(e._id,Y),[e._id,v]),ne=(0,ko.useCallback)(Y=>Y.replace(/[^A-Za-z0-9_.+-]/g,""),[]),J=(0,ko.useCallback)(()=>{P(e._id)},[]),X=e.viewport_phone_portrait?.enabled,Q=e.viewport_tablet_portrait?.enabled,te=e.viewport_phone_portrait?.screenshot,ye=e.viewport_tablet_portrait?.screenshot,de=!!(ee==="phone_portrait"&&te)&&X,Se=!!(ee==="tablet_portrait"&&ye)&&Q,be=o===0?"standard":"small",{width:Ae,height:Qe}=de?Yd.phone_portrait[be]:Se?Yd.tablet_portrait[be]:Yd[be],O=ee==="phone_portrait",U=ee==="tablet_portrait";return w(f,{width:"192px",paddingTop:"2px",paddingBottom:"2px",marginLeft:`${M}px`,position:"relative",display:o===0?"block":"flex",className:"page-list-item",ref:Y=>I(e._id,Y),...R,children:[m&&e.isPrivate?a(rR,{color:p?"tomato":"black",level:r,gridSize:o,page:e,position:"absolute",zIndex:1,top:o===0?64:"25px",left:o===0?r?-6:-4:"-8px",transformOrigin:"left",transform:"scale(0.75)"}):p?a(oR,{position:"absolute",top:o===0?70:"31px",left:o===0?-3:"-7px"}):void 0,i&&a(f,{width:12,height:12,position:"absolute",top:o===0?143:20,left:o===0?5:O?41:U?56:97,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",zIndex:Ns.pageItem,transform:`rotate(${l?"0deg":"-90deg"})
              translateX(${l?"2px":"0px"})`,transition:"transform 200ms ease",onClick:E,children:a(zo,{color:"black"})}),a(f,{"aria-label":"Page thumbnail",width:Ae+(o===0?16:8),height:Qe+(o===0?16:8),className:"page-list-item-picture",marginBottom:r?1:"0px",borderRadius:o===0?"8px":"6px",position:"relative",zIndex:Ns.pageItem,padding:o===0?"4px":"2px",cursor:"pointer",transformOrigin:"left",overflow:!de&&!Se?"hidden":"",flex:"0 0 auto",transform:`scale(${r&&o===0?"0.92":"1"})`,css:Y=>ae`
            border: ${o===0?"4px":"2px"} solid
              ${K?Y.colors[K]:"transparent"};
          `,onClick:D,children:w(f,{className:"sortable-item-handle",height:o===0?124:"56px",position:"relative",boxShadow:"0 1px 1px rgba(64, 64, 64, 0.32)",borderRadius:de||Se||o===1?"4px":"8px",backgroundColor:"white",ref:t,children:[xe&&a(f,{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",zIndex:Ns.pageItem,children:a(mt,{bgColor:"transparent"})}),a(Fn,{desktopUrl:e.screenshot,phonePortraitUrl:te,tabletPortraitUrl:ye,phoneViewportEnabled:X,tabletViewportEnabled:Q,opacity:e.hidden?.4:1,imageSize:be,viewport:ee,onLoadError:J}),!xe&&(o!==1||!de)&&a(jm,{isCurrentPage:p,pageId:e._id,gridSize:o,hidden:!!u,vertical:de||Se,viewport:ee,isHovered:T})]})}),w(f,{opacity:o===0&&e._id===g&&u?0:1,children:[w(f,{width:"100%",marginLeft:`${o===0?i?24:8:i?20:4}px`,marginTop:`${o===0?i?-1:0:16}px`,children:[w(L,{textStyle:"small",float:"left",children:[c,n?`.${n}`:"",".\xA0"]}),a(yt,{type:"text",textStyle:"small",color:"black",placeholder:"Page Title",spellCheck:!1,autoComplete:"off",autoCorrect:"off",maxLength:128,value:A,disabled:xe,onChange:Y=>{$(Y.target.value)},onBlur:G,onFocus:()=>{pe(!0)},width:`${o===0?i||r?156:170:i||r?62:82}px`,height:"auto",padding:"0",textOverflow:"ellipsis",css:ae`
                &:focus {
                  border: none;
                }
              `})]}),a(f,{width:"100%",marginLeft:`${o===0?i&&l?24:8:4}px`,marginTop:"-2px",display:"flex",justifyContent:"start",ref:_e,children:a(Fl,{validationMessageAnchor:_e.current,validationMessageContainer:document.getElementById("settings-popup-container"),name:"link",placeholder:"custom url",textStyle:"small",link:e.uri,disabled:xe,width:o===0?i||r?172:192:i||r?80:96,withSlash:!0,validationMessageZIndex:3,validationMessagePlacement:"right",validate:ze,filter:ne,onDone:ie})})]}),!xe&&de&&o===1&&a(jm,{isCurrentPage:p,pageId:e._id,gridSize:o,hidden:!!u,vertical:de||Se,viewport:ee,isHovered:T,position:"static",actionButtonVariant:"dark"})]})});kb.displayName="PageListItem";var oR=e=>a(f,{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"tomato",zIndex:Ns.pageItem,...e});function rR({color:e,level:o,gridSize:t,page:r,...i}){let n=(0,ko.useContext)(Ee);return a(f,{onClick:()=>{n.dispatch({type:"togglePrivatePages",payload:r._id})},cursor:"pointer",...i,children:a(cu,{color:e})})}var qm=B(H());N();Xd();Be();oe();k();var _b=(0,qm.memo)(({topPageId:e,stackedPages:o,gridSize:t,level:r=0})=>{let i=(0,qm.useContext)(ce),n=r&&r*16,s=i.pagesTree.reduce((l,c)=>c.children instanceof Array?[...l,c,...c.children]:[...l,c],[]).filter(l=>o.includes(l._id));if(e){let l=s.findIndex(d=>d._id===e),[c]=s.splice(l,1);s.unshift(c)}return s=s.slice(0,4).reverse(),w(f,{width:"192px",height:t===0?"176px":"68px",paddingTop:"2px",paddingBottom:"2px",marginLeft:`${n}px`,position:"relative",display:t===0?"block":"flex",userSelect:"none",children:[s.map((l,c)=>a(f,{top:t===0?(s.length-1-c)*4:0,left:(s.length-1-c)*4,width:t===0?208:"96px",height:t===0?140:"64px",className:"page-list-item-picture",marginBottom:r?1:"0px",borderRadius:t===0?"8px":"4px",position:"absolute",zIndex:1,padding:t===0?"4px":"2px",border:`${t===0?"4px":"2px"} solid transparent`,cursor:"pointer",transformOrigin:"left",overflow:"hidden",flex:"0 0 auto",transform:`scale(${r&&t===0?"0.92":"1"})`,css:ae`
            :hover {
              .page-actions-standart-panel > * {
                opacity: 1;
                display: block;
              }
              .page-actions-button {
                opacity: 1;
                display: block;
              }
            }
          `,children:a(f,{borderRadius:"4px",height:t===0?124:"56px",backgroundColor:"#FFF",boxShadow:"0 1px 1px rgba(64, 64, 64, 0.32)",children:a(Fn,{desktopUrl:l.screenshot,imageSize:t===0?"standard":"small"})})},l._id)),a(f,{height:32})]})});_b.displayName="StackedPages";k();var oue=typeof window<"u"&&(window.requestAnimationFrame||window.setImmediate)||(e=>setTimeout(e,0)),iR=(e,o,t)=>e[o]?e[o].parentId?e[e[o].parentId].viewNum:e[o].viewNum:t,Ym=(0,qo.memo)(({page:e,gridSize:o,level:t=0,dropableId:r,childIndex:i})=>{let n=(0,qo.useContext)(ce),s=(0,qo.useContext)(yu),l=(0,qo.useRef)(null),c=!!(e.children&&e.children.length),d=n.pagesParams[e._id]?n.pagesParams[e._id].collapsed:!0,[p,m]=(0,qo.useState)(!1),[u,g]=(0,qo.useState)(0),h=n.setPageCollapse,b=(0,qo.useCallback)(()=>{h(e._id,!d),m(!1),d?g(setTimeout(()=>{m(!0)},800)):u&&(clearTimeout(u),g(0))},[h,e._id,d,u]),[x,S]=(0,qo.useState)(!1),[y,C]=(0,qo.useState)(!1);return(0,qo.useEffect)(()=>{if(s.isActive&&s.id){if(n.selectedPages.includes(s.id))if(s.id===e._id){S(!0),C(!1);return}else{S(!1),C(n.selectedPages.includes(e._id));return}else if(s.id===e._id&&e.children){S(!0);return}}S(!1),C(!1)},[e._id,e.children,n.selectedPages,s.id,s.isActive]),y?null:a(Ey,{draggableId:e._id,dropableId:r,children:({ref:P,mouseDownRef:v})=>a(f,{position:"relative",ref:P,children:x?a(_b,{topPageId:e._id,stackedPages:n.selectedPages.includes(e._id)?n.selectedPages:[e._id,...e.children.map(T=>T._id)],gridSize:o,level:s.id===e._id?s.parentId?1:0:t}):w(q,{children:[a(kb,{page:e,gridSize:o,dragableRef:v,level:s.id===e._id?s.parentId?1:0:t,head:c,onCollapsed:b,isPageCollapsed:d,childIndex:i,viewNum:iR(n.pagesParams,e._id,e.num),selectedPageIds:n.selectedPages,isCurrent:e._id===n.currentPageId,isPrivatePages:n.project.isPrivatePages,sortableId:s.id,onSortableItemId:s.onItemId,isSortableActive:s.isActive,selectPage:n.selectPage,selectPagesRange:n.selectPagesRange,deselectPages:n.deselectPages,changeWorkspace:n.changeWorkspace,pageSave:n.pageSave,updateBrokenScreenshot:n.updateBrokenScreenshot,validatePageUri:n.validatePageUri}),d&&!p&&e.children&&c?a(ku,{parentId:e._id,dropableId:e._id,children:({dropElementRef:T,dropableId:R})=>a(f,{className:"page-children-container",ref:l,"data-parent-id":e._id,style:{height:d?"auto":"0px",overflow:d?"visible":"hidden",transition:"height 200ms ease"},children:a(f,{ref:T,children:e.children.map((I,M)=>a(Ym,{page:I,gridSize:o,level:t+1,dropableId:R,childIndex:M+1},I._id))})})}):null]})})})});Ym.displayName="Branch";Be();Qh();k();var yb=(0,or.createContext)({removePendingPage:()=>{},addPendingPage:()=>{}}),nR=({children:e,...o})=>{let t=(0,or.useContext)(Ee),r=(0,or.useContext)(ce),i=(0,or.useContext)(yu),[n,s]=(0,or.useState)(0),[l,c]=(0,or.useState)([]),d=(0,or.useCallback)(g=>{c([...l,g])},[l]),p=(0,or.useCallback)(g=>{c(l.filter(h=>h._id!==g))},[l]);(0,or.useEffect)(()=>{if(i.isActive&&i.id&&r.selectedPages.includes(i.id)){let g=r.pagesTree.reduce((h,b)=>(Array.isArray(b.children)?h.push(b,...b.children):h.push(b),h),[]).filter(h=>r.selectedPages.includes(h._id)).findIndex(h=>h._id===i.id);s(Math.max(0,g*(t.gridSize===0?176:68)));return}s(0)},[i.isActive]);let m=(0,or.useCallback)(g=>g.sort((h,b)=>(h.pending?h.num-1:h.num)-(b.pending?b.num-1:b.num)),[]),u=l.length?m([...r.pagesTree.map(g=>{let h=l.filter(b=>b.parentPage===g._id);return h.length?{...g,children:m([...g.children?g.children:[],...h])}:g}),...l.filter(g=>!g.parentPage)]):r.pagesTree;return a(yb.Provider,{value:{addPendingPage:d,removePendingPage:p},children:w(f,{display:"flex",id:"page-list-container",flexDirection:"column",justifyContent:"left",flexWrap:"wrap",userSelect:"none",...o,children:[i.isActive?a(f,{height:n}):null,a(ku,{dropableId:"0",children:({dropElementRef:g,dropableId:h})=>a(f,{ref:g,children:u.map(b=>a(Ym,{page:b,gridSize:t.gridSize,dropableId:h},b._id))})})]})})},Sb=nR;Be();N();fe();PI();CI();var hr=B(H());V6();var Xm=B(mx());Be();Qh();k();var eC=({children:e})=>{let o=(0,hr.useContext)(Ee),t=(0,hr.useContext)(ce),r=(0,hr.useRef)(!0),i=(0,hr.useRef)(null),n=(0,hr.useRef)(!1),s=(0,hr.useRef)(null),l=(0,hr.useRef)(!1),c=(0,hr.useRef)(null),d=(0,hr.useRef)(null);(0,hr.useEffect)(()=>{d.current&&(o.isPageActionsPopupOpenedFor?d.current.style.overflowY="hidden":d.current.style.overflowY="scroll")},[o.isPageActionsPopupOpenedFor]);let p=m=>{d.current=m;let u=m.scrollHeight,g=m.clientHeight,h=m.scrollTop,b=!!h,x=g<u&&g+h<u;x!==l.current&&(l.current=x,s.current&&(x?s.current.style.display="block":s.current.style.display="none")),b!==n.current&&(n.current=b,i.current&&(b?i.current.style.display="block":i.current.style.display="none"))};return(0,hr.useEffect)(()=>{d.current&&p(d.current)},[o.gridSize,t.pagesParams]),a(zy,{unionOn:!0,idList:_h(t.pagesTree),isDragOff:o.isPageSettingsOpened,onAfterDragEnd:()=>{c.current&&c.current.style.removeProperty("height");let m=document.getElementsByTagName("body")[0],u=m.className;m.className=u.split(" ").filter(g=>g&&g!=="user-select-none").join(" "),r.current=!0},onBeforeDragStart:m=>{if(t.selectedPages.includes(m))return(0,Xm.without)(t.selectedPages,m);let u=t.pagesTree.find(g=>g._id===m);return u&&u.children&&(t.pagesParams[u._id]?t.pagesParams[u._id].collapsed:!0)?u.children.map(h=>h._id):[]},onDragStart:()=>{let m=document.getElementsByTagName("body")[0];m.className+=" user-select-none",c.current&&(c.current.style.height=c.current.clientHeight+"px"),r.current=!1},onDragEnd:(m,u,g,h)=>{let b=_h(t.pagesTree),x=t.pagesTree.reduce((v,T)=>(v.push(T),T.children?[...v,...T.children]:v),[]).find(v=>v._id===m),S=t.selectedPages.includes(m)?h.length?[...h,m]:[m]:u&&x&&x.children?[m,...x.children.map(v=>v._id)]:[m],y=(v,T)=>{let R=[];for(let I=0;I<v.length;I++)if(T.includes(v[I].id)&&R.push(v[I]),v[I].items){let M=y(v[I].items,T);R=[...R,...M]}for(let I=0;I<T.length;I++){let M=(0,Xm.findIndex)(v,D=>D.id===T[I]);M!==-1&&v.splice(M,1)}return R},C=(v,T,R,I)=>{if(!I){v.splice(R,0,...T);return}for(let M=0;M<v.length;M++){if(v[M].id===I){v[M].items||(v[M].items=[]),T.forEach(D=>D.parentId=v[M].id),C(v[M].items,T,R);return}v[M].items&&C(v[M].items,T,R,I)}},P=y(b,S);if(P.length){P.forEach(I=>I.parentId=void 0),C(b,P,g,u);let v=jx(b),T=1,R=v.map(I=>({id:I.id,num:T++,parentPage:I.parentId||null}));t.saveOrder(R),setTimeout(()=>{t.updateUrl()},100)}},children:()=>e})};N();F6();Be();Vr();var fr=B(H());k();function Cb({children:e,bottomLine:o,...t}){let r=(0,fr.useContext)(Ee),i=(0,fr.useContext)(ce),n=(0,fr.useRef)(!0),s=(0,fr.useRef)(null),l=(0,fr.useRef)(!1),c=(0,fr.useRef)(null),d=(0,fr.useRef)(null);(0,fr.useEffect)(()=>{d.current&&(r.isPageActionsPopupOpenedFor?d.current.style.overflowY="hidden":d.current.style.overflowY="scroll")},[r.isPageActionsPopupOpenedFor]);let p=g=>{d.current=g;let h=g.scrollHeight,b=g.clientHeight,x=g.scrollTop,S=b<h&&b+x<h;S!==l.current&&(l.current=S,s.current&&(S?s.current.style.display="block":s.current.style.display="none"))},m=(0,fr.useCallback)(g=>{if(!n.current)return;let h=g.target;h&&p(h)},[n]),u=g=>{p(g)};return(0,fr.useEffect)(()=>{d.current&&p(d.current)},[r.gridSize,i.pagesParams]),a(Ft,{onScroll:m,onFirstRender:u,children:({ref:g})=>w(f,{ref:Nx(g,c),overflow:"hidden",...t,children:[e,o&&o(s)]})})}var fa=B(H());je();Be();var br=B(H());N();$e();ek();oe();var Pb=B(H());N();Fo();fe();var tC="https://st-p.rmcdn1.net/1ce0501a/dist/rm-templates-XWWYJF2Q.png";k();function aR({onMyTemplatesClick:e,onRmTemplatesClick:o,isUserTemplatesLoading:t,userTemplatesScreenshot:r}){let[i,n]=(0,Pb.useState)(!1),[s,l]=(0,Pb.useState)(!1),c=p=>{p.preventDefault(),o()},d=p=>{p.preventDefault(),e()};return w(f,{display:"flex",flexDirection:"column",color:"white",paddingTop:"4rm",paddingLeft:"4rm",paddingBottom:"4rm",children:[w(f,{display:"flex","data-testid":"show-rm-templates-modal",alignItems:"center",cursor:"pointer",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),onClick:c,children:[a(f,{width:88,height:60,borderRadius:"4px",backgroundColor:"grey",backgroundImage:`url('${tC}')`,backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat"}),a(L,{textStyle:"small",marginLeft:"4rm",color:i?"tomato":"white",children:"R/m templates"})]}),w(f,{display:"flex","data-testid":"show-user-templates-modal",alignItems:"center",marginTop:"4rm",cursor:"pointer",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),onClick:p=>d(p),children:[a(f,{display:"flex",width:88,height:60,borderRadius:"4px",justifyContent:"center",alignItems:"center",backgroundColor:"grey",backgroundImage:r?`url(${r})`:"none",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover",children:!r&&t&&a(mt,{bgColor:"transparent"})}),a(L,{textStyle:"small",marginLeft:"4rm",color:s?"tomato":"white",children:"My templates"})]})]})}var oC=aR;var Km=B(H()),rC=B(Qo());N();Fo();Dp();k();var iC=(0,Km.memo)(({isShown:e,width:o,height:t,isLoading:r,children:i,onClose:n})=>{let s=(0,Km.useRef)(null);function l(c){c.stopPropagation(),n&&n()}return rC.default.createPortal(a(q,{children:e?w(q,{children:[a(f,{id:"my-templates-modal",ref:s,width:`${o}px`,height:`${t}px`,position:"absolute",top:`calc(50% - ${t/2}px)`,left:`calc(50% - ${o/2}px)`,zIndex:9999,borderRadius:"12px",backgroundColor:"black",overflowY:"auto",children:r?a(f,{display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center",children:a(mt,{bgColor:"transparent"})}):i}),a($i,{"data-testid":"my-template-modal-overlay",zIndex:7149,backgroundColor:"rgba(0, 0, 0, 0)",onClick:l})]}):null}),document.body)});iC.displayName="MyTemplatesModal";var nC=iC;var Si=B(H()),pC=B(Qo());Be();qx();var it=B($t()),aC=B(Mo()),Je=B(pt());tn();var jl={"template-constructor-helpers-template-center":Lt`
	<div class="template-center">
		<div class="template-center-wrapper">

			<div class="left-panel">
				<div class="search-icon"></div>
				<div class="back-icon"></div>
			</div>

			<div class="center-panel">

				<div class="search-wrapper">
					<div class="border"></div>
					<input class="search-string" type="text" placeholder="Search..."/>
					<div class="clear invisible"></div>
				</div>


				<div class="scroll-wrapper main">
					<div class="results-wrapper">
						<div class="results">
						</div>
					</div>
					<div class="scroll"></div>
				</div>

				<div class="scroll-wrapper info">
					<div class="results-wrapper">
						<div class="results">
						</div>
					</div>
					<div class="scroll"></div>
				</div>
			</div>


			<div class="right-panel">
				<div class="template-filter">
					<div class="categories">
						<div class="caption">Categories</div>
						<div class="category-switcher">
							<div class="category-item button active">All</div>
							<div class="category-item button" data-category="microsites">Portfolio</div>
							<div class="category-item button" data-category="presentations">Presentation</div>
							<div class="category-item button" data-category="longreads">Editorial</div>
							<div class="category-item button" data-category="photo_stories">Landing page</div>
							<div class="category-item button" data-category="e_commerce">E-commerce</div>
							<div class="category-item button" data-category="sandbox">Sandbox Tutorials</div>
						</div>
					</div>
					<div class="sort">
						<div class="caption">Sort</div>
						<div class="sort-switcher">
							<div class="sort-item button" data-criteria="popular">Popular</div>
							<div class="sort-item button active" data-criteria="newest">Newest</div>
						</div>

					</div>
					<div class="rm-logo"></div>
				</div>

				<div class="template-info">
				</div>
			</div>



			<div class="overlay">
				<div class="preloader rmpreloader"><div class="arc"></div></div>
			</div>

		</div>
	</div>
`,"template-constructor-helpers-template-center-templateset":Lt`
	<div class="templateset" data-id="<%=data._id%>">
		<div class="image-wrapper">
			<img src="<%-data.screenshot%>" alt="">
		</div>
		<div class="title"><%-data.title || 'Templateset'%></div>
		<div class="num-pages"><%=data.pages + ' page' + (data.pages == 1 ? '' : 's')%></div>
	</div>
`,"template-constructor-helpers-template-center-template":Lt`
<div class="template" data-id="<%=data.page_id%>" data-thumb="<%=data.thumb%>">
	<div class="title"><%-data.idx%>. <%-data.title || 'Page ' + data.num%></div>
	<div class="template-image-wrapper">
		<img src="">
	</div>
	<div class="add-page"><div class="plus"></div><div class="checkmark"></div></div>
</div>
`,"template-constructor-helpers-template-center-templateinfo":Lt`
<div class="title"><%-data.title || 'Templateset'%></div>
<div class="author">
	<span class="label">Designed by</span>
	<% if (data.author_url) { %>
		<a href="<%-data.author_url%>" target="_blank" class="name"><%-data.author_name%></a>
	<% } else { %>
		<span class="name"><%-data.author_name || 'Unknown'%></span>
	<% } %>
</div>
<div class="desc-scroll-wrapper">
	<div class="desc-wrapper">
		<div class="desc"><%-data.description || 'No description'%></div>
	</div>
	<div class="scroll"></div>
</div>
<div class="viewports">
	<div class="caption">Viewports</div>
	<div class="devices">
		<div class="device default" title="Desktop"></div>
		<% _.each(data.viewports, function(v) { %>
			<div class="device <%=v%>" title="<%=data.VIEWPORTS[v]%>"></div>
		<% }); %>
	</div>
</div>
<div class="categories">
	<div class="caption">Categories</div>
	<div class="list"><%-data.categories_string%></div>
</div>
<a href="<%=Constants.readymag_host%>/<%=data.mag_num_id%>" class="preview button" target="blank" data-id="<%=data._id%>">Preview</a>
<div class="add-pages button" data-id="<%=data._id%>">
	<div class="message">Add <%=data.templates.length%> page<%=data.templates.length == 1 ? '' : 's'%></div>
	<div class="plus"></div>
	<div class="checkmark"></div>
</div>
`,"template-constructor-helpers-template-center-animation":Lt`
<style id="template-center-page-animation">
	.animation-page-flyout-x {
	    -webkit-animation: flyout-x .8s linear forwards;
	    animation: flyout-x 1s linear forwards;
	}

	.animation-page-flyout-y {
	    -webkit-animation: flyout-y .8s linear forwards;
	    animation: flyout-y 1s linear forwards;
	}

	@-webkit-keyframes flyout-x {
	    0% {
	    	-webkit-animation-timing-function: ease-out;
	    }
	    30% {
	        -webkit-transform: translateX(-40px);
	        -webkit-animation-timing-function: ease-in;
	        // -webkit-animation-timing-function: linear;
	        opacity: 1;
	    }
	    80% {
	    	-webkit-transform: translateX(150px);
	    	// -webkit-animation-timing-function: ease-in-out;
	    	-webkit-animation-timing-function: linear;
	    	opacity: 0.5;
	    }
	    100% {
	        -webkit-transform: translateX(304px);
	        // -webkit-animation-timing-function: ease-in;
	        -webkit-animation-timing-function: linear;
	        opacity: 0;
	    }
	}

	@-webkit-keyframes flyout-y {
	    0% {
	    	// -webkit-animation-timing-function: linear;
	    	-webkit-animation-timing-function: ease-in;
	    }
	    30% {
	        -webkit-transform: translateY(<%=top1%>px) scale(0.8);
	        -webkit-animation-timing-function: linear;
	        // -webkit-animation-timing-function: ease-in-out;
	        -webkit-animation-timing-function: ease-out;
	    }
	    80% {
	    	-webkit-transform:translateY(<%=top2%>px) scale(0.5);
	    	-webkit-animation-timing-function: ease-in-out;
	    }
	    100% {
	        -webkit-transform:translateY(<%=top3%>px)  scale(0.37);
	        -webkit-animation-timing-function: ease-in;
	    }
	}

	@keyframes flyout-x {
	    0% {
	    	animation-timing-function: ease-out;
	    }
	    30% {
	        transform: translateX(-40px);
	        animation-timing-function: ease-in;
	        // -moz-animation-timing-function: linear;
	        opacity: 1;
	    }
	    80% {
	    	transform: translateX(150px);
	    	// -moz-animation-timing-function: ease-in-out;
	    	animation-timing-function: linear;
	    	opacity: 0.5;
	    }
	    100% {
	        transform: translateX(304px);
	        // -moz-animation-timing-function: ease-in;
	        animation-timing-function: linear;
	        opacity: 0;
	    }
	}

	@keyframes flyout-y {
	    0% {
	    	// -moz-animation-timing-function: linear;
	    	animation-timing-function: ease-in;
	    }
	    30% {
	        transform: translateY(<%=top1%>px) scale(0.8);
	        animation-timing-function: linear;
	        // -moz-animation-timing-function: ease-in-out;
	        animation-timing-function: ease-out;
	    }
	    80% {
	    	transform:translateY(<%=top2%>px) scale(0.5);
	    	animation-timing-function: ease-in-out;
	    }
	    100% {
	        transform:translateY(<%=top3%>px)  scale(0.37);
	        animation-timing-function: ease-in;
	    }
	}


</style>
`};ui();st();mi();je();Dh();bh();var lR={microsites:"portfolio",presentations:"presentation",longreads:"editorial",photo_stories:"landing page",e_commerce:"ecommerce"},sC=e=>lR[e]||e,pR=aC.default.View.extend({events:{"click .scroll-wrapper.main .results .templateset":"onTemplatesetClick","click .search-icon":"toggleSearch","click .back-icon":"closeInfo","input .search-wrapper .search-string":"onSearchStringChange","keypress .search-wrapper .search-string":"onSearchStringKey","keyup .search-wrapper .search-string":"onSearchStringKey","keydown .search-wrapper .search-string":"onSearchStringKey","click .search-wrapper .clear":"onClearSearchString","click .category-switcher .category-item":"filterItemClick","click .sort-switcher .sort-item":"filterItemClick","click .template:not(.added)":"onAddPageClick","click .right-panel .add-pages:not(.added)":"onAddMultipleClick","click .right-panel .preview.button":"onPreviewButtonClick"},CATEGORIES:{microsites:"Microsites",presentations:"Presentations",photo_stories:"Photo Stories",longreads:"Longreads",e_commerce:"E-commerce",sandbox:"Sandbox"},VIEWPORTS:{tablet_portrait:"Tablet Portrait",phone_portrait:"Phone Portrait"},initialize:function(e){Je.default.bindAll(this),this.template=jl["template-constructor-helpers-template-center"],this.templatesetTemplate=jl["template-constructor-helpers-template-center-templateset"],this.templateTemplate=jl["template-constructor-helpers-template-center-template"],this.templateTemplateInfo=jl["template-constructor-helpers-template-center-templateinfo"],this.templatePageAnimation=jl["template-constructor-helpers-template-center-animation"],this.router=e.router,this.showPagesAlert=e.pagesAlert,this.animateAppearance=e.animateAppearance,this.onClose=e.onClose,this.overlayDarker=e.overlayDarker?!!e.overlayDarker:!1,this.overlayTransparent=e.overlayTransparent?!!e.overlayTransparent:!1,this.showBlockLayer=typeof e.showBlockLayer<"u"?e.showBlockLayer:!0,this.analyticsZone=e.analyticsZone,this.applyFilter.__debounced=Je.default.debounce(this.applyFilter,150),RM.analytics=RM.analytics||new Jd,this.analytics=RM.analytics},render:function(){this.setElement((0,it.default)(this.template({})).insertAfter("#constructor")),this.setElement(this.$el),this.$mainList=this.$(".scroll-wrapper.main .results-wrapper .results"),this.$infoList=this.$(".scroll-wrapper.info .results-wrapper .results"),this.filterCategory&&this.$('.category-switcher .category-item[data-category="'+this.filterCategory+'"]').addClass("active").siblings().removeClass("active"),this.mainScroll=(0,it.default)(this.$mainList.closest(".scroll-wrapper")).RMScroll({$container:this.$mainList.closest(".results-wrapper"),$content:this.$mainList,$handle:this.$mainList.closest(".scroll-wrapper").find(".scroll"),gap_start:8,gap_end:8}).data("scroll"),this.infoScroll=(0,it.default)(this.$infoList.closest(".scroll-wrapper")).RMScroll({$container:this.$infoList.closest(".results-wrapper"),$content:this.$infoList,$handle:this.$infoList.closest(".scroll-wrapper").find(".scroll"),gap_start:8,gap_end:8}).data("scroll");let e=(0,it.default)(this.$(".size-wrapper .slider"));this.sizeSlider=e.slider({min:1,max:7,value:4,orientation:"vertical",start:function(){(0,it.default)("body").addClass("ns-resize-cursor"),e.addClass("dragging")},stop:function(){(0,it.default)("body").removeClass("ns-resize-cursor"),e.removeClass("dragging")},change:this.sizeChanged,slide:this.sizeChanged}),this.loadTemplateData(),import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-FK4O2EWF.js").then(({default:o})=>{o("templatecenter")}),this.rendered=!0},loadTemplateData:function(){let e=this;if(!Je.default.isEmpty(this.templatesets))return e.$(".overlay").remove(),e.renderTemplatesetList();it.default.ajax({type:"GET",url:"/api/rm_templatesets/",contentType:"application/json",success:o=>{e.$(".overlay").remove(),Je.default.each(o,function(t){t.templates=Je.default.sortBy(t.templates,"num")}),e.templatesets=e.filtered_templatesets=o,e.applyFilter(),e.filterCategories()},error:()=>{console.log(arguments)}})},filterCategories:function(){Object.keys(this.CATEGORIES).forEach(function(e){this.templatesets.some(function(o){return o.categories.includes(e)})||this.$('.category-switcher .category-item[data-category="'+e+'"]').remove()}.bind(this))},renderTemplatesetList:function(){let e=this.$(".scroll-wrapper.main .results");e.empty().scrollTop(0),Je.default.each(this.filtered_templatesets,function(o){e.append(this.renderTemplateset(o))},this),this.templatesetRendered=!0,Je.default.defer(function(){this.mainScroll.recalc()}.bind(this))},renderTemplateset:function(e){return e.pages=e.templates.length,e.screenshot=e.templates[0].thumb,this.templatesetTemplate({data:e})},renderTemplateList:function(e){let o=this.$(".scroll-wrapper.info .results"),t=e.templates;o.empty().scrollTop(0),Je.default.each(t,function(r,i){r.idx=i+1,r.mag_num_id=e.mag_num_id,o.append(this.renderTemplate(r))},this)},renderTemplate:function(e){let o=(0,it.default)(this.templateTemplate({data:e})),t=o.find("img"),r="256",i=e.thumb,n=e.fullScreenshotBaseUrl?al(e.fullScreenshotBaseUrl,r):i;return t.one("load",function(){Je.default.defer(function(){this.infoScroll.recalc()}.bind(this))}.bind(this)),t.attr("src",n),o},renderTemplateInfo:function(e){let o=[],t;Je.default.each(e.categories,function(r){o.push(this.CATEGORIES[r])},this),e.categories_string=o.join(", "),e.VIEWPORTS=this.VIEWPORTS,this.$(".right-panel .template-info").html(this.templateTemplateInfo({data:e,Constants:le,_:Je.default})),Je.default.defer(function(){t=(0,it.default)(this.$(".right-panel .desc-scroll-wrapper")),this.infoDescriptionScroll=t.RMScroll({$container:t.find(".desc-wrapper"),$content:t.find(".desc"),$handle:t.find(".scroll"),gap_start:4,gap_end:4}).data("scroll")}.bind(this))},applyFilter:function(){let e=it.default.trim(this.$(".search-string").val()),o=this.$(".category-switcher .category-item.active").attr("data-category"),t=this.$(".sort-switcher .sort-item.active").attr("data-criteria");Je.default.isEmpty(this.templatesets)||(e?this.filtered_templatesets=Je.default.filter(this.templatesets,function(r){return new RegExp(e,"i").test(r.title)}):this.filtered_templatesets=this.templatesets,o&&(this.filtered_templatesets=Je.default.filter(this.filtered_templatesets,function(r){return Je.default.contains(r.categories,o)})),this.filterCategory=o,Je.default.isEmpty(this.filtered_templatesets)||(this.filtered_templatesets=Je.default.sortBy(this.filtered_templatesets,function(r){return t=="popular"?-(r.usages||0):-new Date(r.created)})),this.renderTemplatesetList())},onSearchStringKey:function(e){if(e.stopPropagation(),e.keyCode==it.default.keycodes.esc&&e.preventDefault(),e.type=="keyup"){if(e.keyCode==it.default.keycodes.esc){this.$(".search-wrapper .search-string").val()!=""?this.clearSearchString():this.toggleSearch();return}e.keyCode==it.default.keycodes.enter&&(e.preventDefault(),this.applyFilter())}},onSearchStringChange:function(){let e=this.$(".search-wrapper .search-string").val();this.$(".search-wrapper .clear").toggleClass("invisible",e==""),this.applyFilter.__debounced()},clearSearchString:function(){this.$(".search-wrapper .search-string").blur().val("").focus(),this.onSearchStringChange()},onClearSearchString:function(){this.clearSearchString(),this.toggleSearch()},toggleSearch:function(){clearTimeout(this.searchFocusTimeout),this.$(".search-icon").toggleClass("active"),this.$(".search-wrapper").toggleClass("shift-down"),this.$(".scroll-wrapper.main").toggleClass("shift-down"),this.$(".search-icon").hasClass("active")?this.searchFocusTimeout=setTimeout(Je.default.bind(function(){this.$(".search-wrapper .search-string").focus()},this),700):(this.$(".search-wrapper .search-string").val(""),this.$(".search-wrapper .clear").addClass("invisible"),Ls()),this.applyFilter()},closeInfo:function(){this.$(".template-center-wrapper").removeClass("info-mode")},onTemplatesetClick:function(e){let o=(0,it.default)(e.currentTarget),t=o.attr("data-id");this.openInfo(t)},openInfo:function(e){let o=Je.default.findWhere(this.templatesets,{_id:e});this.renderTemplateList(o),this.renderTemplateInfo(o),this.$(".template-center-wrapper").addClass("info-mode"),this.$(".template-center-wrapper").one("transitionend webkitTransitionEnd",function(){this.infoScroll.recalc()}.bind(this))},onBodyKey:function(e){this.$(".search-input").is(":focus")||((e.keyCode==it.default.keycodes.esc||e.keyCode==it.default.keycodes.backspace)&&(e.preventDefault(),e.stopPropagation()),e.type=="keyup"&&(e.keyCode==it.default.keycodes.esc&&(this.$(".font-explorer-wrapper").hasClass("info-mode")?this.closeInfo():Je.default.isFunction(this.onClose)?this.onClose():this.hide()),e.keyCode==it.default.keycodes.backspace&&(this.$(".font-explorer-wrapper").hasClass("info-mode")?this.closeInfo():Je.default.isFunction(this.onClose)?this.onClose():this.hide()),e.keyCode==it.default.keycodes.f&&this.toggleSearch()))},filterItemClick:function(e){(0,it.default)(e.currentTarget).addClass("active").siblings().removeClass("active"),this.applyFilter()},canCreatePage:function(e){let t=this.router.me.get("permissions").pages_per_mag;return t&&e+this.router.mag.pages.length>t?(et.isSubscriptionPaused()?this.router.trigger("notice:show","unpauseSubscriptionToCreatePage",{canBeClosed:!0}):this.showPagesAlert(),!1):!0},onAddPageClick:function(e){let o=(0,it.default)(e.currentTarget),t=o.closest(".template"),r=t.attr("data-id"),i=t.attr("data-thumb");this.canCreatePage(1)&&(Je.default.delay(function(){this.trigger("add-page",{template:r,specialScreenshot:i})}.bind(this),800),t.flashClass("added",2e3),this.animateAdd(t))},onPreviewButtonClick:function(e){let o=(0,it.default)(e.currentTarget).attr("data-id"),t=Je.default.findWhere(this.templatesets,{_id:o});se(he.Template,{action:"preview",zone:this.analyticsZone,templateName:t.title,templateType:t.categories.map(sC).join(", ")})},onAddMultipleClick:function(e){let o=(0,it.default)(e.currentTarget),t=(0,it.default)(e.currentTarget).attr("data-id"),r=Je.default.findWhere(this.templatesets,{_id:t}),i=[];!r||!this.canCreatePage(r.templates.length)||(Je.default.each(r.templates,function(n){i.push({template:n.page_id,specialScreenshot:n.thumb})}),i.length===1?this.animateAdd(this.$(".center-panel .template")):this.animateAdd(),Je.default.delay(function(){this.trigger("add-multiple",{templates:i,templateName:r.title,templateType:r.categories.map(sC).join(", ")})}.bind(this),1500),o.flashClass("added",2e3))},onMouseWheel:function(e){e&&e.stopPropagation(),e&&e.preventDefault()},animateAdd:function(e){let o,t,r,i=(0,it.default)('<div class="animation-wrapper-v"></div>'),n=(0,it.default)('<div class="animation-wrapper-h"></div>').append(i),s=(0,it.default)('<div class="animation-wrapper-clip"></div>').append(n),l=this.$el.offset(),c=this.$el.height(),d=200;if(e)o=e.find(".template-image-wrapper"),t=o.clone().detach().addClass("clipped"),r=o.offset(),r.top<l.top&&(r.top=l.top+20),t.css({margin:0}),i.append(t),Je.default.defer(function(){n.css({position:"fixed"}),n.addClass("animation-page-flyout-x"),i.addClass("animation-page-flyout-y")});else{r={left:(0,it.default)(".center-panel .template").offset().left,top:l.top+c/2-87};let p=[];s.css({overflow:"hidden"}),Je.default.each((0,it.default)(".center-panel .template"),function(m){let u=(0,it.default)(m).find(".template-image-wrapper");t=u.clone().detach().addClass("clipped stacking"),t.css({margin:0}),i.prepend(t),et.applyTransform(t,"translateY("+(u.offset().top-r.top)+"px)"),p.push(t)}),Je.default.delay(function(){Je.default.each(p,function(m,u){et.applyTransform(m,"translateY("+u*5+"px)translateX(-"+u*5+"px)")})},100),Je.default.delay(function(){s.css({overflow:"visible"}),n.addClass("animation-page-flyout-x"),i.addClass("animation-page-flyout-y")},500+d)}(0,it.default)("head").append((0,it.default)(this.templatePageAnimation({top1:(l.top-r.top)/2,top2:l.top-r.top-130,top3:l.top-r.top-70}))),n.css({left:r.left,top:r.top}),s.css({top:l.top,height:c}),(0,it.default)("body").append(s),Je.default.delay(function(){s.remove(),(0,it.default)("#template-center-page-animation").remove()},1500)},disableMouseWheel:function(){window.document.addEventListener("mousewheel",this.onMouseWheel,{passive:!1})},enableMouseWheel:function(){window.document.removeEventListener("mousewheel",this.onMouseWheel)},show:function(){this.render(),this.disableMouseWheel(),this.showBlockLayer&&(this.$block_layer=RM.constructorRouter.showBlockLayer(Je.default.isFunction(this.onClose)?this.onClose:this.hide,{darker:this.overlayDarker,transparent:this.overlayTransparent})),this.animateAppearance?(this.$el.removeClass("show-out").addClass("show-in").css("display","block"),setTimeout(Je.default.bind(function(){this.$el.removeClass("show-in")},this),20),setTimeout(Je.default.bind(function(){this.$el.css("width","+=1")},this),300),setTimeout(Je.default.bind(function(){this.$el.css("width","-=1")},this),300)):this.$el.removeClass("show-out").css("display","block"),(0,it.default)("body").on("keypress keyup keydown",this.onBodyKey),this.shown=!0},hide:function(e){e&&e.stopPropagation(),this.enableMouseWheel(),this.showBlockLayer&&RM.constructorRouter.hideBlockLayer(this.$block_layer),(0,it.default)("body").off("keypress keyup keydown",this.onBodyKey),this.animateAppearance?(this.$el.addClass("show-out"),setTimeout(Je.default.bind(function(){this.remove()},this),200)):(this.$el.css("display","none"),this.remove()),Ls(),this.$(".language-wrapper").removeClass("active"),this.shown=!1},toggle:function(){this.shown?this.hide():this.show(),this.trigger("toggle")}}),lC=pR;Dp();je();k();function cR({isShown:e,addPageFromTemplate:o,onClose:t,analyticsZone:r}){let i=(0,Si.useContext)(ce),[n,s]=(0,Si.useState)(null),l=()=>{n&&n.remove();let h=new Op({$parent:document.querySelector("body > .popups"),router:window.RM.constructorRouter,opts:{type:"type-more-pages",is_contributor:!window.RM.constructorRouter.isOwner,owner_email:i.project.user?i.project.user.email:""},alert_source:"page from rm template"});h.render(),s(h)},[c,d]=(0,Si.useState)(null),p=(0,Si.useRef)(!1),m=h=>{h.stopPropagation(),t&&t()},u=h=>{o(h)},g=h=>{if(!h.templates||!h.templates.length||p.current)return;se(he.Template,{action:"add",zone:r,templateName:h.templateName,templateType:h.templateType});let b=0,x=()=>{o(h.templates[b],i.currentPageNum+b).then(()=>{if(++b===h.templates.length){p.current=!1;return}x()}).catch(()=>{p.current=!1})};p.current=!0,x()};return(0,Si.useEffect)(()=>{let h=new lC({router:window.RM.constructorRouter,pagesAlert:l,showBlockLayer:!1,analyticsZone:r});h.on("add-page",u),h.on("add-multiple",g),d(h)},[]),(0,Si.useEffect)(()=>{c&&(c.off("add-page"),c.off("add-multiple"),c.on("add-page",u),c.on("add-multiple",g))},[i.currentPageNum,i.pagesParams]),(0,Si.useEffect)(()=>{c&&(e?c.show():c.hide())},[e]),e?pC.default.createPortal(a($i,{"data-testid":"rm-template-modal-overlay",zIndex:7149,backgroundColor:"rgba(0, 0, 0, 0)",onClick:m}),document.body):null}var cC=cR;var Ci=B(H());N();dr();Fo();Ur();Vr();fe();ln();qh();Mh();$e();oe();je();k();var dR="Template title";function uR({templates:e,newTemplateTitle:o,createNewUserTemplate:t,addPageFromTemplate:r,deleteUserTemplate:i,hasGlobalWidgets:n,analyticsZone:s}){let[l,c]=(0,Ci.useState)(!1),[d,p]=(0,Ci.useState)([]),[m,u]=(0,Ci.useState)(!1),[g,h]=(0,Ci.useState)(!1),[b,x]=(0,Ci.useState)(!1),[S,y]=(0,Ci.useState)(!1),[C,P]=(0,Ci.useState)(!1),v=A=>{A.preventDefault(),A.stopPropagation(),R()},T=A=>{A.preventDefault(),A.stopPropagation(),R({withGlobalWidgets:!0})},R=(A={})=>{if(l)return;se(he.MyTemplates,{action:"create template",zone:s});let $=`pending-${Date.now()}`;c(!0),p([{id:$,pending:!0,thumb:""},...d]),t(A).then(()=>{c(!1)}).catch(()=>{c(!1)}).finally(()=>{p(d.filter(j=>j.id!==$))})},I=(0,Ci.useCallback)(A=>{A.keyCode===13&&(A.preventDefault(),A.currentTarget.blur())},[]),M=(0,Ci.useCallback)((A,$)=>$&&h0(A,$),[]),D=(A,$)=>{A.preventDefault(),A.stopPropagation(),i($)},E=(A,$,j)=>{A.preventDefault(),A.stopPropagation(),se(he.MyTemplates,{action:"add template",zone:s}),r({template:$,custom:!0,specialScreenshot:j})};return a(f,{display:"flex",width:"100%",height:"100%",borderRadius:"12px",overflowY:"auto",children:a(Ft,{children:({ref:A})=>w(f,{display:"flex",ref:A,width:"100%",height:"100%",paddingTop:"24px",paddingBottom:"24px",paddingLeft:"68px",paddingRight:"68px",flexWrap:"wrap",alignContent:"flexStart",children:[a(f,{display:"flex",flexDirection:"column","data-testid":"create-user-template",children:n()?w(q,{children:[a(f,{display:"flex",width:216,height:141,marginLeft:"12px",marginRight:"12px",position:"relative",justifyContent:"center",alignItems:"center",backgroundColor:"darkGray",borderRadius:"4px",cursor:"pointer",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:a(q,{children:m?w(f,{textAlign:"center",children:[a(ge,{"data-testid":"create-user-template-with-global-widgets",variant:"clean",width:184,borderRadius:8,paddingLeft:"2rm",paddingRight:"2rm",paddingTop:"16px",paddingBottom:"16px",marginTop:"6px",marginBottom:"6px",color:"white",backgroundColor:g?"blue":"black",textStyle:"small",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onClick:T,children:"Include 'On all pages'"}),a(ge,{"data-testid":"create-user-template-without-global-widgets",variant:"clean",width:184,borderRadius:8,paddingLeft:"2rm",paddingRight:"2rm",paddingTop:"16px",paddingBottom:"16px",marginTop:"6px",marginBottom:"6px",color:"white",backgroundColor:b?"blue":"black",textStyle:"small",onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),onClick:v,children:"Without 'On all pages'"})]}):a(Xs,{color:"black"})})}),a(f,{width:216,marginLeft:"12px",marginRight:"12px",marginBottom:"8px",marginTop:"6px",padding:"0 0 10px 0",textAlign:"center",color:m?"white":"darkGray",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:a(L,{textStyle:"small",color:m?"white":"darkGray",children:o})})]}):w(q,{children:[a(f,{display:"flex",width:216,height:141,marginLeft:"12px",marginRight:"12px",position:"relative",justifyContent:"center",alignItems:"center",backgroundColor:"darkGray",borderRadius:"4px",cursor:"pointer",onClick:v,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:a(Xs,{color:m?"white":"black"})}),a(f,{width:216,marginLeft:"12px",marginRight:"12px",marginBottom:"8px",marginTop:"6px",padding:"0 0 10px 0",textAlign:"center",color:m?"white":"darkGray",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:a(L,{textStyle:"small",color:m?"white":"darkGray",children:o})})]})}),[...d,...e].map($=>w(f,{display:"flex",flexDirection:"column",children:[w(f,{display:"flex","data-testid":"create-page-from-template",width:216,height:141,marginLeft:"12px",marginRight:"12px",position:"relative",backgroundColor:"darkGray",borderRadius:"4px",justifyContent:"center",alignItems:"center",cursor:"pointer",backgroundImage:$.thumb?`url(${$.thumb})`:"none",backgroundPosition:"center center",backgroundRepeat:"no-repeat",backgroundSize:"cover",css:ae`
                    &:hover {
                      .delete-template-button {
                        opacity: 1;
                      }
                    }
                  `,onClick:j=>!$.pending&&E(j,$.id,$.thumb),children:[$.pending&&a(mt,{bgColor:"transparent"}),!$.pending&&a(Pt,{height:32,width:32,className:"delete-template-button",color:"white",hoverColor:"white",activeColor:"tomato",outline:!0,position:"absolute",top:"8px",right:"8px",opacity:0,transition:"opacity 0.15s ease",onMouseEnter:()=>y($.id),onMouseLeave:()=>{C&&P(!1),y(!1)},onMouseDown:()=>P($.id),onMouseUp:()=>P(!1),onClick:j=>D(j,$.id),children:a(Nt,{color:C&&C===$.id?"white":S&&S===$.id?"tomato":"black"})})]},$.id),a(yt,{"data-testid":"custom-template-name",marginLeft:"12px",marginRight:"12px",marginBottom:"8px",marginTop:"6px",padding:"0 0 10px 0",width:"auto",type:"text",textStyle:"small",color:"white",spellCheck:!1,placeholder:dR,defaultValue:$.title,disabled:$.pending,onBlur:j=>M($.id,j.target.value),onKeyDown:I,textAlign:"center",css:ae`
                    &:focus {
                      border-bottom: none;
                    }
                  `})]},$.id))]})})})}var dC=uR;_r();Be();vt();Co();Jt();st();k();var mR=le.readymag_host,uC=(0,br.memo)(({isPopupShown:e,onChangePopupVisibility:o,placementStyles:t,margin:r,bottom:i,left:n,width:s,hoverColor:l,hasDeletedPages:c,children:d,analyticsZone:p})=>{let m=(0,br.useContext)(Ee),u=(0,br.useContext)(ce),{currentPanel:g}=(0,br.useContext)(Ct),[h,b]=(0,br.useState)(!1),x=(0,br.useRef)(null),S=Iu({watchingClick:e,preventDefault:!0,callback:()=>{o(!1)}}),y=Ht(),C=g==="page";(0,br.useEffect)(()=>{e&&(b(!0),u.getUserTemplates().then(()=>{b(!1)}).catch(I=>{b(!1),I&&console.warn(I.message)})),(!C||e)&&y.modalStatus==="unshowWithTooltip"&&gi("unshow")},[e,C]);let P=(0,br.useMemo)(()=>{let I=u.pages.find(M=>M._id===u.currentPageId);return I&&I.title?I.title:`page ${u.currentPageNum}`},[u.currentPageNum]),v=I=>{e||(I.preventDefault(),I.stopPropagation(),o(!e))},T=()=>{o(!1),m.dispatch({type:"toggleUserTemplatesModal"})},R=(I,M)=>u.addNewPage(M||u.currentPageNum,I);return w(q,{children:[a(St,{text:"Click here to choose a template",indent:8,open:y.modalStatus==="unshowWithTooltip"&&C&&!e,componentsProps:{tooltip:{backgroundColor:"blue",right:"auto"},arrow:{left:c?"auto":"0px !important",color:"blue"}},disabled:!C,closeOnTargetClick:!0,children:a(f,{position:"relative",boxSizing:"border-box",zIndex:Ns.footerButtons,ref:x,children:a(ge,{display:"block","data-testid":"toggle-templates-popup",color:e?"tomato":"black",textStyle:"small",onClick:v,boxSizing:"border-box",margin:r||0,css:ae`
                &:hover {
                  color: ${l||"tomato"};
                  path {
                    fill: ${l||"tomato"};
                  }
                  svg {
                    fill: ${l||"tomato"};
                  }
                }
              `,children:d})})}),a(Vm,{ref:S,width:s||224,height:168,bottom:i,left:n,isShown:e,placement:"bottom",placementStyles:t,rootElement:x.current,children:a(oC,{onRmTemplatesClick:()=>window.open(`${mR}/templates`,"_blank"),onMyTemplatesClick:T,isUserTemplatesLoading:h,userTemplatesScreenshot:u.userTemplates.length?u.userTemplates[0].thumb:void 0})}),a(nC,{width:880,height:580,isShown:m.isUserTemplatesModalShown,onClose:()=>m.dispatch({type:"toggleUserTemplatesModal"}),isLoading:h,children:a(dC,{templates:u.userTemplates,newTemplateTitle:`Create template from ${P}`,createNewUserTemplate:u.createTemplateFromCurrentPage,addPageFromTemplate:R,deleteUserTemplate:u.deleteUserTemplate,hasGlobalWidgets:u.hasGlobalWidgets,analyticsZone:p})}),a(cC,{onClose:()=>m.dispatch({type:"toggleRmTemplatesModal"}),isShown:m.isRmTemplatesModalShown,addPageFromTemplate:R,analyticsZone:p})]})});uC.displayName="AddFromTemplatesButton";var Jm=uC;Ir();N();qh();$e();oe();oe();N();k();var gR=e=>a("svg",{fill:"none",viewBox:"0 0 16 19",xmlns:"http://www.w3.org/2000/svg",...e,children:w("g",{fill:"currentColor",children:[a("path",{d:"M0 2.972a1 1 0 011-1h14a1 1 0 110 2H1a1 1 0 01-1-1z"}),a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.999.5a.5.5 0 01.5-.5H9.5a.5.5 0 010 1H6.499a.5.5 0 01-.5-.5z"}),a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.405 6.181a.8.8 0 01.912.67l1.58 10.321h6.206l1.58-10.32a.8.8 0 011.582.241l-1.58 10.321a1.6 1.6 0 01-1.582 1.358H4.897a1.6 1.6 0 01-1.581-1.358l-1.58-10.32a.8.8 0 01.67-.913z"})]})}),hR=f.withComponent(F(gR)`
      display: block;
    `),Qm=hR;Co();Gn();Wo();mi();k();var mC=({children:e,binIcon:o,...t})=>{let r=(0,fa.useContext)(Ee),i=(0,fa.useContext)(ce),{isHovered:n,...s}=Ke(!1),l=()=>{rt("more-pages")},c=y=>{y.preventDefault(),(i.project.has_deleted_pages||r.isTrashOpened)&&r.dispatch({type:"toggleTrash"})},[d,p]=(0,fa.useState)(!1),[m,u]=(0,fa.useState)(!1),g=y=>{se(he.EditorActions,{action:"add page"}),y.preventDefault(),p(!0),r.dispatch({type:"setAddingPage",inProgress:!0}),i.addNewPage(i.currentPageNum).finally(()=>{r.dispatch({type:"setAddingPage",inProgress:!1})}).catch(C=>{C&&C.err==="permission_denied"&&(i.isSubscriptionPaused()?window.RM.constructorRouter.trigger("notice:show","unpauseSubscriptionToCreatePage",{canBeClosed:!0}):l())})},h=()=>{p(!1),u(!0)},[b,x]=(0,fa.useState)(!1),S=!i.project.has_deleted_pages&&!r.isTrashOpened;return w(f,{width:"240px",height:95,padding:"0 24px",position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"lightGray",...t,children:[a(St,{indent:15,text:"Add page",open:d||b?!1:void 0,children:a(f,{zIndex:"1",children:a(an,{permission:"PageCanAddBlank",children:a(Xs,{"data-testid":"add-blank-page",color:m?"tomato":"black",cursor:"pointer",onClick:g,onMouseEnter:h,onMouseLeave:()=>u(!1)})})})},"add-page"),w(f,{display:"flex",alignItems:"center",children:[a(an,{permission:"PageCanAddFromTemplate",children:a(Jm,{isPopupShown:b,onChangePopupVisibility:x,bottom:"32px",left:"-109px",hasDeletedPages:i.project.has_deleted_pages,placementStyles:"bottom: -8px; left: 129px;",analyticsZone:kd.EditorPages,children:"Templates"})}),w(ge,{display:"flex",alignItems:"center",justifyContent:"flex-end",marginTop:"2px",marginLeft:"20px","data-testid":"toggle-pages-bin",textStyle:"small",position:"relative",onClick:S?void 0:c,variant:"unstyled",cursor:S?"auto":"pointer",color:S?"gray":n?"tomato":"black",...s,children:[a(Qm,{width:"16px",height:"19px",marginBottom:"4px"}),a(fR,{blink:i.pageRecentlyDeleted,position:"absolute",top:"12px",left:"6px",width:"4px",height:"4px",backgroundColor:S?"gray":n?"tomato":"black"})]})]})]})},fR=({blink:e,backgroundColor:o,...t})=>{let r=e?ae`
        animation: 1.5s blinkAnimation infinite linear;
        @keyframes blinkAnimation {
          from {
            opacity: 1;
          }
          33% {
            opacity: 1;
          }
          34% {
            opacity: 0.8;
          }
          40% {
            opacity: 0;
          }
          60% {
            opacity: 0;
          }
          66% {
            opacity: 0.8;
          }
          67% {
            opacity: 1;
          }
          to {
            opacity: 1;
          }
        }
      `:void 0;return a(f,{as:"span",width:"6px",height:"6px",borderRadius:"50%",backgroundColor:e?"tomato":o||"black",css:r,...t})};zt();oe();Ve();N();fe();k();var bR=({pages:e,maxPages:o})=>{if(!o)return null;let t=o-e===1?"page":"pages",r=o-e>0?`${o-e} ${t} left on Free plan`:"No more pages left on Free plan";return a(f,{marginTop:"3rm",marginBottom:"10rm",children:a(L,{color:"gray",textStyle:"small",children:r})})},gC=bR;N();oe();Ve();Fp();k();var wR=f.withComponent(F("div")`
  display: flex;
  box-sizing: border-box;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  width: 16px;
  height: 16px;
  border-radius: 2.62px;
  border: 1px solid;
  border-color: rgba(162, 162, 162, 0.32);
`),xR=({direction:e})=>{let o=()=>{switch(e){case"top":return"rotate(-90deg)";case"right":return"rotate(0deg)";case"bottom":return"rotate(90deg)";case"left":return"rotate(180deg)";default:return"rotate(-90deg)"}},t=Hi(()=>({transform:o(),paddingLeft:e==="left"?"0":e==="right"?"1px":0,paddingBottom:e==="left"||e==="right"?"1px":0,paddingTop:e==="left"?"2px":0}),[e]);return a(wR,{marginRight:"1rm",children:a("svg",{style:t,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a("path",{d:"M12.4165 7.99738C12.4165 8.16595 12.3399 8.32686 12.202 8.45712L9.24826 11.4032C9.11034 11.5334 8.9571 11.5947 8.79619 11.5947C8.45905 11.5947 8.19853 11.3419 8.19853 10.9971C8.19853 10.8362 8.25217 10.6753 8.3671 10.568L8.4245 10.4723L10.6082 8.51075L9.1141 8.61802H3.88093C3.5208 8.61802 3.26794 8.35751 3.26794 7.99738C3.26794 7.63725 3.5208 7.37674 3.88093 7.37674H9.1141L10.6006 7.48401L8.4245 5.52247L8.3671 5.42677C8.25217 5.3195 8.19853 5.15859 8.19853 4.99768C8.19853 4.65288 8.45905 4.40002 8.79619 4.40002C8.9571 4.40002 9.11034 4.46132 9.24826 4.59158L12.202 7.53764C12.3399 7.6679 12.4165 7.82881 12.4165 7.99738Z",fill:V.gray})})})},Mc=xR;k();var vR=(0,hs.forwardRef)((e,o)=>a(f,{ref:o,width:"auto",height:"2px",position:"fixed",left:"8px",right:"8px",zIndex:"1",borderRadius:"2px",backgroundColor:"gray",display:"none",...e})),hC=({children:e,...o})=>{let t=(0,hs.useContext)(Ee),r=(0,hs.useContext)(ce),i=()=>{t.dispatch({type:"toggleGridSize"})},{project:{opts:{viewertype:n}}}=r;return(0,hs.useEffect)(()=>{r.renewLastScreenshot()},[]),(0,hs.useEffect)(()=>function(){t.gridSize===1&&t.isPageActionsPopupOpenedFor&&t.dispatch({type:"setPageActionsPopup",payload:!1})},[t.gridSize,t.isPageActionsPopupOpenedFor]),w(f,{"aria-label":"Pages menu",width:"100%",height:"100%",borderRadius:"2rm",backdropFilter:"blur(4px)",backgroundColor:Me("lightGray",.96),boxShadow:`0 0 0 2px inset ${Le(.84,V.gray)}`,...o,children:[a(JS,{currentPageID:r.currentPageId,children:a(eC,{children:a(f,{id:"project-settings-body",position:"relative",width:"100%",backgroundColor:"transparent",height:"calc(100% - 56px)",zIndex:"auto",children:w(Cb,{padding:"16px 16px 0 16px",bottomLine:s=>a(vR,{ref:s,bottom:"55px",backgroundColor:Me("gray",.4)}),children:[w(f,{display:"flex",height:"16px",justifyContent:"space-between",alignItems:"center",children:[w(f,{display:"flex",alignItems:"end",marginTop:-3,marginLeft:-1,children:[a(L,{color:"black",textStyle:"subheading",children:"Pages"}),a(f,{marginLeft:"2rm",children:n==="horizontal"?w(f,{display:"flex",flexDirection:"row",children:[a(Mc,{direction:"left"}),a(Mc,{direction:"right"})]}):w(f,{display:"flex",flexDirection:"row",children:[a(Mc,{direction:"top"}),a(Mc,{direction:"bottom"})]})})]}),a(f,{position:"relative",marginTop:3,children:w(f,{display:"flex",width:28,onClick:i,cursor:"pointer",children:[a(f,{children:a(ey,{color:t.gridSize===0?"black":"gray"})}),a(f,{marginLeft:"1rm",children:a(Qv,{color:t.gridSize===1?"black":"gray"})})]})})]}),a(Sb,{margin:t.gridSize===0?"9px 0 6px -8px":"10px 0 6px -4px"}),r.isOwner&&a(gC,{pages:r.pages.length,maxPages:r.me.plan_limits.pages_per_mag})]})})})}),a(mC,{backgroundColor:"transparent",position:"relative",width:"100%",height:"56px",padding:"0 20px 0 16px",zIndex:"1",borderTop:"1px solid transparent",backgroundClip:"padding-box",binIcon:a(Qm,{width:"16px",height:"19px",color:"darkGray",marginBottom:"4px"})})]})};var Rc=B(H());fe();N();Vr();Be();var wn=B(H());N();_r();Be();oe();k();var fC=(0,wn.memo)(({children:e,footerHeight:o,footer:t,...r})=>{let i=(0,wn.useContext)(Ee),n=(0,wn.useContext)(ce),[s,l]=(0,wn.useState)(!1);return(0,wn.useEffect)(()=>{i.isTrashOpened?((i.isPageSettingsOpened||i.isPrivatePagesOpened)&&(l(!0),setTimeout(()=>{i.dispatch({type:i.isPageSettingsOpened?"togglePageSettings":"togglePrivatePages"}),l(!1)},0)),n.updateTrash()):s&&l(!1),i.isTrashOpened?document.body.classList.add("trash-is-opened"):document.body.classList.remove("trash-is-opened")},[i.isTrashOpened]),w(f,{id:"constructor-pages-bin",width:"240px",height:"100%",paddingTop:0,backdropFilter:"blur(4px)",backgroundColor:Me("black",.96),zIndex:s?uo.sidebarZindex+1:uo.sidebarZindex,overflowX:"hidden",overflowY:"auto",...r,children:[a(f,{height:`calc(100% - ${o+(typeof o=="number"?"px":"")})`,overflow:"auto",children:e}),t({height:o})]})});fC.displayName="TrashPanel";var eg=fC;var xn=B(H());N();Vr();fe();Ve();$e();oe();k();function yR({children:e,"data-testid":o,width:t,onClick:r,background:i,color:n,danger:s,dangerOnHover:l,...c}){let d=s?V.red:i||V.white,p=s?V.white:n||V.black;return a(ge,{"data-testid":o,width:t||80,height:32,lineHeight:"30px",textStyle:"small",backgroundColor:d,color:p,borderRadius:"16px",cursor:"pointer",border:"1px solid rgba(128, 128, 128, 0.16)",...c,transition:"opacity 0.2s ease",css:ae`
        &:hover {
          opacity: 0.96;
          background: ${l?V.red:d};
          color: ${l?V.white:p};
        }
      `,onClick:r,children:e})}var Bc=yR;Xd();Be();jt();Wo();var fs=B(H());N();oe();fe();Ve();$e();Be();k();var bC=(0,fs.memo)(({isTrashOpen:e,emptyTrash:o,isOwner:t,isEmpty:r,dividerColor:i,...n})=>{let s=(0,fs.useContext)(Ee),[l,c]=(0,fs.useState)(!1),d=()=>{t&&!r&&c(!0)},p=u=>{u===0&&t&&!r&&o(),c(!1)},m=()=>{s.isTrashOpened&&s.dispatch({type:"toggleTrash"})};return(0,fs.useEffect)(()=>{e||c(!1)},[e]),!r||e?w(f,{height:88,paddingLeft:24,paddingRight:24,display:"flex",justifyContent:"center",alignItems:"center",position:"relative",...n,children:[a(f,{left:"2rm",right:"2rm",height:2,position:"absolute",top:-1,borderRadius:"2px",backgroundColor:i||"gray"}),l?w(f,{width:"100%",display:"flex",justifyContent:"space-between",children:[a(f,{"data-testid":"empty-bin-cancel",width:80,height:32,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",borderRadius:"16px",cursor:"pointer",border:"1px solid rgba(128, 128, 128, 0.16)",css:ae`
                &:hover {
                  opacity: 0.96;
                }
              `,onClick:()=>p(1),children:a(L,{textStyle:"small",color:"black",children:"Cancel"})}),a(f,{"data-testid":"empty-bin-confirm",width:80,height:32,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",borderRadius:"16px",cursor:"pointer",border:"1px solid rgba(128, 128, 128, 0.16)",css:ae`
                &:hover {
                  background-color: ${V.red};
                  opacity: 0.96;
                  & > span {
                    color: ${V.white};
                  }
                }
              `,onClick:()=>p(0),children:a(L,{textStyle:"small",color:"black",children:"Empty"})})]}):a(kR,{isEmpty:r,isOwner:t,onClick:()=>r?m():d()})]}):null});function kR({isEmpty:e,onClick:o,isOwner:t}){return t?a(ge,{"data-testid":"empty-bin",textStyle:"small",color:"white",onClick:o,cursor:"pointer",children:e?"Close":"Empty bin"}):null}bC.displayName="TrashFooter";var tg=bC;k();var _R=(0,xn.memo)(({children:e,...o})=>{let t=(0,xn.useContext)(Ee),r=(0,xn.useContext)(ce),i=s=>r.restorePage(s),n=s=>r.deletePagesFromTrash([s]);return a(eg,{footerHeight:"88px",...o,footer:({height:s})=>a(tg,{isTrashOpen:t.isTrashOpened,isOwner:r.isOwner,isEmpty:!r.trashPages.length,emptyTrash:r.emptyTrash,height:s}),children:a(Ft,{children:({ref:s})=>w(f,{ref:s,paddingLeft:22,paddingRight:22,paddingTop:28,children:[a(f,{height:48,display:"flex",alignItems:"center",marginBottom:16,children:a(L,{color:"white",textStyle:"subheading",textAlign:"left",children:"Deleted pages"})}),r.trashPages.map(l=>a(og,{page:l,margin:"0 0 12px 2px",isOwner:r.isOwner,onRestorePage:i,onDeletePage:n},l._id))]})})})});_R.displayName="Trash";var og=(0,xn.memo)(({page:e,isOwner:o,onRestorePage:t,onDeletePage:r,...i})=>{let{isHovered:n,...s}=Ke(!1),[l,c]=(0,xn.useState)(!1),{viewport:d}=(0,xn.useContext)(qe),p=h=>{h.preventDefault(),t(e._id)},m=h=>{h.preventDefault(),o&&r(e._id)},u=h=>{h.preventDefault(),c(!0)},g=h=>{h.preventDefault(),c(!1)};return w(f,{"data-pageid":e._id,...i,children:[w(f,{width:192,height:124,backgroundColor:"darkGray",borderRadius:"4px",position:"relative",...s,children:[a(Fn,{desktopUrl:e.screenshot,phonePortraitUrl:e.viewport_phone_portrait?.screenshot,tabletPortraitUrl:e.viewport_tablet_portrait?.screenshot,phoneViewportEnabled:e.viewport_phone_portrait?.enabled,tabletViewportEnabled:e.viewport_tablet_portrait?.enabled,viewport:d}),w(f,{width:176,height:32,display:"flex",justifyContent:o?"space-between":"center",position:"absolute",left:8,bottom:8,opacity:n?1:0,transition:"opacity 200ms ease",children:[l?a(Bc,{"data-testid":"confirm-bin-action",danger:!0,onClick:m,children:"Yes"}):a(Bc,{"data-testid":"restore-page",onClick:p,children:"Restore"}),l?a(Bc,{"data-testid":"deny-bin-action",onClick:g,children:"Cancel"}):a(q,{children:o&&a(Bc,{"data-testid":"delete-page-from-bin",dangerOnHover:!0,onClick:u,children:"Delete"})})]})]}),a(f,{marginTop:"7px",children:a(L,{textStyle:"small",color:"white",children:e.title?e.title:"Page Title"})})]})});og.displayName="TrashPage";k();var wC=(0,Rc.memo)(({children:e,...o})=>{let t=(0,Rc.useContext)(ce),r=(0,Rc.useContext)(Ee),i=s=>t.restorePage(s),n=s=>t.deletePagesFromTrash([s]);return a(eg,{footerHeight:"56px",borderRadius:"2rm",...o,footer:({height:s})=>a(tg,{isTrashOpen:r.isTrashOpened,isOwner:t.isOwner,isEmpty:!t.trashPages.length,emptyTrash:t.emptyTrash,dividerColor:"rgba(128, 128, 128, 0.4)",height:s}),children:a(Ft,{children:({ref:s})=>w(f,{ref:s,padding:"16px 16px 0 16px",children:[a(f,{display:"flex",alignItems:"center",height:"16px",marginBottom:"16px",children:a(L,{display:"block",color:"white",textStyle:"subheading",textAlign:"left",children:"Deleted pages"})}),t.trashPages.map(l=>a(og,{page:l,margin:"0 0 12px 0",isOwner:t.isOwner,onRestorePage:i,onDeletePage:n},l._id))]})})})});wC.displayName="Trash";var xC=wC;var bs=B(H());N();_r();Be();oe();k();var vC=(0,bs.memo)(({children:e,footerHeight:o,footer:t,backgroundColor:r,...i})=>{let n=(0,bs.useContext)(Ee),[s,l]=(0,bs.useState)(!1);return(0,bs.useEffect)(()=>{n.isPageSettingsOpened?(n.isTrashOpened||n.isPrivatePagesOpened)&&(l(!0),setTimeout(()=>{n.dispatch({type:n.isTrashOpened?"toggleTrash":"togglePrivatePages"}),l(!1)},0)):s&&l(!1),n.isPageSettingsOpened?document.body.classList.add("page-settings-is-opened"):document.body.classList.remove("page-settings-is-opened")},[n.isPageSettingsOpened]),w(f,{id:"constructor-page-settings",height:"100%",width:240,padding:0,backdropFilter:"blur(4px)",backgroundColor:Me("black",.96),overflow:"hidden",zIndex:s?uo.sidebarZindex+1:uo.sidebarZindex,...i,children:[a(f,{width:"100%",height:`calc(100% - ${o+(typeof o=="number"?"px":"")})`,children:e}),t({height:o})]})});vC.displayName="PageSettingsPanel";var yC=vC;var vn=B(H());fl();Ch();var oo=B(H());N();fe();Ve();N();k();var ql=({children:e,divider:o,dividerColor:t,"data-testid":r,onMouseEnter:i,onMouseLeave:n,onClick:s,...l})=>w(f,{position:"relative",width:"100%",display:"flex",alignItems:"center",height:48,padding:"0 16px",borderBottom:"2px solid transparent",cursor:"pointer","data-testid":r,userSelect:"none",onMouseEnter:i,onMouseLeave:n,onClick:s,...l,children:[o&&a(f,{height:"2px",position:"absolute",top:"-1px",left:"8px",right:"8px",borderRadius:"2px",backgroundColor:t||"gray"}),e]});_r();on();Be();st();k();var kC=({isActive:e,onClick:o,children:t,...r})=>{let[i,n]=(0,oo.useState)(!1);return a(ql,{"data-testid":"page-main-settings",padding:"0 24px",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),onClick:o,...r,children:a(L,{textStyle:"subheading",color:!e&&i?"tomato":"white",children:"Page Settings"})})},_C=(0,oo.forwardRef)(({currentPage:e,...o},t)=>{let r=(0,oo.useContext)(ce),i=(0,oo.useMemo)(()=>r.pagesParams[e._id]?r.pagesParams[e._id].viewNum.toString():"",[e._id,r.pagesParams[e._id]]),n=(0,oo.useRef)(null),s=(0,oo.useRef)(null),l=(0,oo.useCallback)(b=>{b!==e.uri&&e._id&&r.pageSave(e._id,{uri:b},{patch:!0})},[e._id]),c=(0,oo.useCallback)(b=>e._id&&r.validatePageUri(e._id,b),[e._id]),d=(0,oo.useCallback)(b=>{b&&(n.current=b)},[e._id]),p=(0,oo.useCallback)(b=>b.replace(/[^A-Za-z0-9_.+-]/g,""),[]),m=(0,oo.useMemo)(()=>`${le.readymag_viewer_host}/${r.project.user.uri}/${r.project.uri}/`,[r.project.uri,r.project.user.uri]),u=(0,oo.useMemo)(()=>`${m}num/${e.num_id}/`,[m,e.num_id]),g=(0,oo.useMemo)(()=>Cr(r.project),[r.project.is_published,r.project.changed]),h=(0,oo.useMemo)(()=>jd(r.project),[r.project.domain,r.project.user.domain,r.project.user.uri]);return w(f,{ref:t,...o,children:[w(f,{marginTop:"10px",children:[w(f,{width:"100%",color:"white",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:[a(L,{as:"label",htmlFor:"page-seo-description",textStyle:"small",children:"URL"}),a(f,{marginTop:"2px",children:a(L,{as:"label",htmlFor:"page-link",title:h,textStyle:"small",children:h})})]}),w(f,{display:"flex",flexWrap:"nowrap",marginTop:"4px",ref:s,children:[a(f,{maxWidth:"50%",color:"white",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:w(L,{fontSize:"16px",children:[r.project.domain?"":r.project.uri,e.parentPage&&r.pagesParams[e.parentPage]?`/${r.pagesParams[e.parentPage].uri}`:null]})}),a(Fl,{setInputRef:d,validationMessageAnchor:s.current,validationMessageContainer:document.body,name:"page-link",color:"white",textStyle:"regular",placeholder:i,inactiveColor:V.darkGray,link:e&&e.uri?e.uri:"",validationMessageZIndex:uo.popupZindex,validate:c,filter:p,onDone:l,maxWidth:"50%",withSlash:!0},e._id)]})]}),g!=="unpublished"&&a(ls,{link:u,margin:"12px 0 0 0",color:"white",borderColor:"darkGray"})]})});_C.displayName="MainSettings";var SC=(0,oo.memo)(_C);var so=B(H());N();fe();Kp();Ve();lv();oe();$e();var Yl=F(Ue)`
  width: 100%;
  height: 40px;
  border: solid 1px ${({theme:e})=>e.colors.darkGray};
  border-radius: 8px;
`;Be();Ir();oe();mi();$e();ro();sv();Fo();yr();uM();mM();kI();k();var CC=70,PC=({isActive:e,dividerColor:o,onClick:t,children:r,...i})=>{let[n,s]=(0,so.useState)(!1);return a(ql,{divider:!0,dividerColor:o||"darkGray","data-testid":"page-seo-settings",padding:"0 24px",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),onClick:t,...i,children:a(L,{textStyle:"subheading",color:!e&&n?"tomato":"white",children:"SEO"})})},TC=(0,so.forwardRef)(({currentPage:e,...o},t)=>{let r=(0,so.useContext)(ce),[i,n]=(0,so.useState)(e&&e._id?e._id:null),s=(0,so.useRef)({}),l=(0,so.useRef)(null),[c,d]=(0,so.useState)(!1),p=()=>{rt("custom-seo")},m=(0,so.useMemo)(()=>!!window.RM.constructorRouter.me&&!!(window.RM.constructorRouter.me.get("permissions")||{}).custom_seo,[window.RM.constructorRouter.me]),u=()=>{let $=r.project.domain||r.project.user&&r.project.user.domain;return ru.getDefaultSEO(e,r.project,{customDomain:!!$})},g=$=>{$.preventDefault(),r.isSubscriptionPaused()?window?.RM?.constructorRouter?.trigger("notice:show","unpauseSubscriptionToCustomizeSeo",{canBeClosed:!0}):p()},h=()=>{let $={title:"",description:"",keywords:""};return e.seo&&($={...$,...e.seo}),$},b=()=>{let $=u();return{title:r.project.title||$.title||"",description:r.project.description||"What\u2019s it about\u2026",keywords:"e.g. fashion, photo"}},[x,S]=(0,so.useState)(()=>h()),[y,C]=(0,so.useState)(()=>b()),[P,v]=(0,so.useState)();(0,so.useEffect)(()=>{l.current&&l.current===document.activeElement&&l.current.blur(),Object.keys(s.current).forEach($=>{let j=s.current[$];j&&j===document.activeElement&&j.blur&&j.blur()}),C(b()),S(h()),n(e&&e._id?e._id:null)},[e._id]),(0,so.useEffect)(()=>{C(b())},[r.project.title,r.project.description]);let T=$=>{let j=$.target,pe=j.dataset.name;pe&&x[pe]!==void 0&&S(ee=>({...ee,[pe]:j.value}))},R=()=>{let $=i&&r.pageSave(i,{seo:x},{patch:!0});$&&!($ instanceof Error)&&$.done(()=>{}).fail(()=>{})};function I(){return r.projectMag.getPage(e._id).widgets.filter(G=>G.attributes.type==="text").map(G=>iv(G)).map(G=>`<p>${G}</p>`).reduce((G,K)=>G+K,"")}async function M(){let $=I();if(!($.length<CC)){d(!0);try{let j=await uk($),{title:pe,description:ee,keywords:G}=j;pe&&ee&&G&&(P||v(x),S({title:pe,description:ee,keywords:G}),i&&r.pageSave(i,{seo:{title:pe,description:ee,keywords:G}},{patch:!0}))}catch(j){console.error("Error generating SEO tags:",j)}finally{d(!1)}}}function D(){P&&(S(P),i&&r.pageSave(i,{seo:P},{patch:!0}),v(void 0))}let E=c,A=Ge("constructor.ai")&&I()?.length>=CC;return w(f,{ref:t,...o,children:[A&&w(f,{display:"flex",flexDirection:"row",gap:4,children:[P&&a(ge,{variant:"clean",as:"div",minWidth:34,display:"flex",alignItems:"center",justifyContent:"center",border:"1px white solid",borderRadius:8,onClick:D,children:a(Kv,{color:"white",width:24,height:24})}),a(ge,{variant:"clean",as:"div",minHeight:34,width:"100%",display:"flex",alignItems:"center",justifyContent:"center",border:"1px white solid",borderRadius:8,disabled:E,opacity:E?.7:1,onClick:M,children:c?a(mt,{bgColor:"transparent",size:24}):w(q,{children:[a(L,{color:"white",children:"Fill with AI"}),a(dk,{color:"white"})]})})]}),w(f,{marginTop:"12px",children:[a(L,{as:"label",htmlFor:"page-seo-title",color:m?V.white:V.darkGray,textStyle:"small",children:"Title"}),a(er,{ref:$=>s.current["page-seo-title"]=$,name:"page-seo-title","data-name":"title",color:"white",placeholder:y.title,translate:"no",autoComplete:"off",autoCorrect:"off",maxLength:128,rows:1,autoSize:!0,marginTop:"4px",disabled:!m,value:x.title,onChange:T,onBlur:R,css:ae`
              &::placeholder {
                color: ${V.darkGray};
              }
              &:disabled {
                color: ${V.darkGray};
              }
            `})]}),w(f,{marginTop:"22px",children:[a(L,{as:"label",htmlFor:"page-seo-description",color:m?V.white:V.darkGray,textStyle:"small",children:"Description"}),a(er,{ref:$=>s.current["page-seo-description"]=$,name:"page-seo-description","data-name":"description",color:"white",placeholder:y.description,translate:"no",autoComplete:"off",autoCorrect:"off",maxLength:2048,rows:1,autoSize:!0,marginTop:"4px",disabled:!m,value:x.description,onChange:T,onBlur:R,css:ae`
              &::placeholder {
                color: ${V.darkGray};
              }
              &:disabled {
                color: ${V.darkGray};
              }
            `})]}),w(f,{marginTop:"22px",children:[a(L,{as:"label",htmlFor:"page-seo-keywords",textStyle:"small",color:m?V.white:V.darkGray,children:"Keywords"}),a(er,{ref:$=>s.current["page-seo-keywords"]=$,name:"page-seo-keywords","data-name":"keywords",color:"white",placeholder:y.keywords,translate:"no",spellCheck:!1,autoComplete:"off",autoCorrect:"off",rows:1,autoSize:!0,marginTop:"4px",disabled:!m,value:x.keywords,onChange:T,onBlur:R,css:ae`
              &::placeholder {
                color: ${V.darkGray};
              }
              &:disabled {
                color: ${V.darkGray};
              }
            `})]}),a(Yl,{textStyle:"small",color:"white",marginTop:24,display:m?"none":"block",onClick:g,children:"Customize"})]})});TC.displayName="SeoSettings";var IC=(0,so.memo)(TC);var Et=B(H());N();fe();Ap();Kp();eI();Ve();Xv();Ur();ln();fi();lv();Be();Ir();Xp();st();oe();mi();Dh();k();var MC=({isActive:e,dividerColor:o,onClick:t,children:r,...i})=>{let[n,s]=(0,Et.useState)(!1);return a(ql,{divider:!0,"data-testid":"page-social-settings",dividerColor:o||"darkGray",padding:"0 24px",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),onClick:t,...i,children:a(L,{textStyle:"subheading",color:!e&&n?"tomato":"white",children:"Social sharing"})})},Ib=e=>{if(e.custom_shares){let o={...e.custom_shares};if(!o.image){let t=G0(512),r=e.screenshot?al(e.screenshot,t):"";o.image=r}return o}return{description:"",title:"",tweet:"",image:""}},BC=(0,Et.forwardRef)(({currentPage:e,...o},t)=>{let r=(0,Et.useContext)(ce),i=(0,Et.useContext)(Ee),n=()=>{rt("custom-sharing")},s=(0,Et.useMemo)(()=>!!window.RM.constructorRouter.me&&!!(window.RM.constructorRouter.me.get("permissions")||{}).custom_sharing,[window.RM.constructorRouter.me]),[l,c]=(0,Et.useState)(()=>r.project.master_share_pid||null),d=()=>l?l===e._id?"custom":"inherited":e.custom_shares?"custom":"default",[p,m]=(0,Et.useState)(d()),u=(0,Et.useMemo)(()=>!s||p==="inherited",[p,s]),g=()=>{let te=r.project.domain||r.project.user&&r.project.user.domain;return ru.getDefaultShare(e,r.project,{customDomain:!!te})},h=()=>{if(l){if(l===e._id)return Ib(e);{let te=r.pages.find(ye=>ye._id===l);if(te)return Ib(te)}}else if(e.custom_shares)return Ib(e);return g()},[b,x]=(0,Et.useState)(()=>h());(0,Et.useEffect)(()=>(x(h()),m(d()),()=>{x(null),m("default")}),[e._id]);let S=te=>r.pageSave(e._id,{custom_shares:te||b},{patch:!0}),[y,C]=(0,Et.useState)(!1),[P,v]=(0,Et.useState)(!1),[T,R]=(0,Et.useState)(!1),I=(0,Et.useMemo)(()=>{if(b?.image){let te=U0(b.image);return e.screenshot!==te}else return!1},[b,e.screenshot]),[M,D]=(0,Et.useState)(!1),[E,A]=(0,Et.useState)(!1),[$,j]=(0,Et.useState)(!1),[pe,ee]=(0,Et.useState)(!1),G=async te=>{if(R(!1),te.size>le.UPLOAD_IMAGE_SIZE_LIMIT){window.alert(le.MSG_UPLOAD_IMAGE_SIZE_ERROR);return}if(!P){v(!0);try{let ye=await $n("share-upload",te);if(ye&&ye.picture&&ye.picture.url&&b){let de={...b,image:ye.picture.url},Se=S(de);Se&&!(Se instanceof Error)&&Se.then(()=>{x(be=>({...be,...de})),p==="default"&&m("custom")}).always(()=>{v(!1)})}}catch{v(!1)}}},K=async te=>{te.preventDefault();let ye=g(),de={...b,image:ye.image},Se=S(de);Se&&!(Se instanceof Error)&&Se.done(()=>x(be=>({...be,...de})))},we=te=>{let ye=te.target,de=ye.getAttribute("name");de&&b&&b[de]!==void 0&&x(Se=>({...Se,[de]:ye.value}))},xe=()=>{if(b&&!u){let te=S();te&&!(te instanceof Error)&&te.done(()=>{p==="default"&&m("custom")}).fail(()=>{})}},_e=(0,Et.useMemo)(()=>!!(e&&l&&e._id===l),[e._id,l]),ie=()=>(0,Et.useMemo)(()=>!l||_e,[_e,l]),ze=te=>{if(!i.masterSharePidIsChanging)if(i.dispatch({type:"toggleMasterSharePidChanging"}),te){c(e._id);let ye=r.projectSave({master_share_pid:e._id},{patch:!0});if(ye&&ye.always(()=>{i.dispatch({type:"toggleMasterSharePidChanging"})}),!e.custom_shares){let de=g(),Se=r.pageSave(e._id,{custom_shares:de},{patch:!0});Se&&!(Se instanceof Error)&&Se.done(()=>{x(de),m("custom")})}}else{c(null),r.projectUnset("master_share_pid");let ye=r.projectSave({});ye&&ye.always(()=>{i.dispatch({type:"toggleMasterSharePidChanging"})})}},ne=()=>{r.pageSet(e._id,{custom_shares:null});let te=r.pageSave(e._id,{custom_shares:null},{patch:!0});te&&!(te instanceof Error)&&te.done(()=>{x(g()),m("default")}).fail(()=>{})},J=te=>{if(te.preventDefault(),!i.masterSharePidIsChanging)if(l){i.dispatch({type:"toggleMasterSharePidChanging"}),r.projectUnset("master_share_pid");let ye=r.projectSave({});ye&&!(ye instanceof Error)&&ye.done(()=>{c(null),ne()}).always(()=>{i.dispatch({type:"toggleMasterSharePidChanging"})})}else ne()},X=te=>{te.preventDefault();let ye=l?r.pages.find(de=>de._id===l):null;l&&ye&&window.RM.constructorRouter.showWorkspace({id:l})},Q=te=>{te.preventDefault(),r.isSubscriptionPaused()?window?.RM?.constructorRouter?.trigger("notice:show","unpauseSubscriptionToCustomizeSharing",{canBeClosed:!0}):n()};return w(f,{ref:t,...o,paddingBottom:24,children:[w(f,{marginTop:"10px",position:"relative",children:[a(L,{color:"white",textStyle:"small",children:"OpenGraph"}),a(f,{position:"absolute",right:0,top:5,css:ae`
              &:hover {
                & svg {
                  color: ${V.red};
                }
              }
            `,children:a("a",{href:"https://help.readymag.com/hc/en-us/articles/360020844431-Sharing",target:"_blank",rel:"noopener noreferrer",children:a(H0,{color:"darkGray"})})})]}),a(f,{width:192,height:104,marginTop:"12px",position:"relative",opacity:T?.8:1,onDragEnter:()=>{T||R(!0)},onDragLeave:()=>{T&&R(!1)},onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),children:a(Di,{accept:"image/*",dropFile:!0,readFileData:!1,onChange:G,disabled:u,children:w(q,{children:[a(f,{width:192,height:104,backgroundColor:"darkGrey",borderRadius:"4px",position:"relative",cursor:s&&!u?"pointer":"default",boxShadow:"0 1px 1px rgba(64, 64, 64, 0.32)",children:a(f,{display:"flex",width:"100%",height:"100%",borderRadius:"4px",backgroundImage:b&&b.image?`url(${b.image})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})}),(y||P)&&!T&&a(f,{display:"flex",width:96,height:32,position:"absolute",left:0,right:0,bottom:8,margin:"auto",justifyContent:"space-around",cursor:"default",children:!u&&w(q,{children:[a(f,{display:"flex",width:32,height:32,justifyContent:"center",alignItems:"center",onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1),onMouseDown:()=>A(!0),onMouseUp:()=>A(!1),backgroundColor:E?"tomato":"white",borderRadius:"50%",cursor:P?"default":"pointer",boxShadow:"0 0 0 1px rgba(128, 128, 128, 0.16)",css:ae`
                          animation: ${P?"loadingindicatoranimation":"none"} 2s infinite linear;
                          @keyframes loadingindicatoranimation {
                            from {
                              transform: rotateZ(0deg);
                            }
                            to {
                              transform: rotateZ(360deg);
                            }
                          }
                        `,children:a(du,{color:E?"white":M&&!P?"tomato":"black"})}),I&&!P&&a(Pt,{height:32,width:32,color:"white",hoverColor:"white",activeColor:"tomato",outline:!0,onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),onMouseDown:()=>ee(!0),onMouseUp:()=>ee(!1),onClick:K,disabled:P,children:a(Nt,{color:pe?"white":$?"tomato":"black"})})]})})]})})}),a(f,{marginTop:"4px",children:a(er,{name:"title",placeholder:"Title",translate:"no",autoComplete:"off",autoCorrect:"off",maxLength:128,rows:1,autoSize:!0,color:"white",textStyle:"regular",disabled:u,value:b?.title,onChange:we,onBlur:xe,css:ae`
              &::placeholder {
                color: ${V.darkGray};
              }
              &:disabled {
                color: ${V.darkGray};
              }
            `})}),a(f,{children:a(er,{name:"description",placeholder:"Description",translate:"no",autoComplete:"off",autoCorrect:"off",maxLength:2048,autoSize:!0,rows:1,color:"white",textStyle:"small",disabled:u,value:b?.description,onChange:we,onBlur:xe,css:ae`
              &::placeholder {
                color: ${V.darkGray};
              }
              &:disabled {
                color: ${V.darkGray};
              }
            `})}),w(f,{marginTop:"22px",children:[a(L,{as:"label",textStyle:"small",htmlFor:"share-tweet",color:"white",children:"Tweet message"}),a(er,{name:"tweet",translate:"no",autoComplete:"off",autoCorrect:"off",maxLength:116,rows:1,autoSize:!0,marginTop:"4px",color:"white",textStyle:"regular",disabled:u,value:b?.tweet,onChange:we,onBlur:xe,css:ae`
              &::placeholder {
                color: ${V.darkGray};
              }
              &:disabled {
                color: ${V.darkGray};
              }
            `})]}),w(f,{display:"flex",marginTop:"22px",alignItems:"center",justifyContent:"space-between",children:[a(f,{width:"128px",children:a(L,{as:"label",textStyle:"small",htmlFor:"all-pages",color:"white",children:"Use these sharing settings for all pages"})}),a(Wt,{name:"all-pages",disabled:u||!ie,checked:_e,onChange:ze})]}),w(f,{display:"flex",marginTop:"2px",children:[a(Yl,{textStyle:"small",color:"white",marginTop:"24px",display:s?"none":"block",onClick:Q,children:"Customize"}),a(Yl,{textStyle:"small",color:"white",marginTop:"24px",display:s&&p==="custom"?"block":"none",onClick:J,children:"Restore to defaults"}),a(Yl,{textStyle:"small",color:"white",marginTop:"24px",display:s&&p==="inherited"?"block":"none",onClick:X,children:"Go to master page"})]})]})});BC.displayName="SocialSettings";var RC=(0,Et.memo)(BC);Be();k();var SR=({padding:e,dividerColor:o})=>{let t=(0,vn.useContext)(Ee),r=(0,vn.useContext)(ce),[i,n]=(0,vn.useState)(0),[s,l]=(0,vn.useState)(null);return(0,vn.useEffect)(()=>{let c=t.isPageSettingsOpened&&r.pages.find(d=>d._id===r.currentPageId)||null;return l(c),()=>{l(null)}},[t.isPageSettingsOpened,r.currentPageNum,r.currentPageId]),(0,vn.useEffect)(()=>{if(!t.isPageSettingsOpened)return;let c=r.pages.find(d=>d._id===r.currentPageId)||null;return l(c),()=>{l(null)}},[r.pages]),s?w(Gr,{transition:{ease:Hp.easeInCubic},value:i,onChange:c=>n(c),children:[a(mo,{value:0,renderButton:({isActive:c})=>a(kC,{isActive:c,padding:e}),children:c=>a(SC,{ref:c,currentPage:s,padding:e})}),a(mo,{value:1,renderButton:({isActive:c})=>a(PC,{isActive:c,dividerColor:o,padding:e}),children:c=>a(IC,{ref:c,currentPage:s,padding:e})}),a(mo,{value:2,renderButton:({isActive:c})=>a(MC,{isActive:c,dividerColor:o,padding:e}),children:c=>a(RC,{ref:c,currentPage:s,padding:e})})]}):null},zC=SR;var EC=B(H());Be();N();$e();k();var AC=({children:e,dividerColor:o,...t})=>{let r=(0,EC.useContext)(Ee);return w(f,{display:"flex",position:"relative",width:"100%",height:88,justifyContent:"center",alignItems:"center",...t,children:[a(f,{height:2,position:"absolute",top:-1,left:"2rm",right:"2rm",borderRadius:"2px",backgroundColor:o||"darkGray"}),a(ge,{textStyle:"small","data-testid":"close-page-settings",onClick:()=>{r.dispatch({type:"togglePageSettings"})},color:"white",children:"Close page settings"})]})};oe();k();var CR=({children:e,...o})=>a(yC,{footerHeight:"56px",backgroundColor:Me("black",.96),backdropFilter:"blur(4px)",...o,footer:({height:t})=>a(AC,{height:t,dividerColor:"rgba(128, 128, 128, 0.4)"}),children:a(zC,{padding:"0 16px",dividerColor:"rgba(128, 128, 128, 0.4)"})}),LC=CR;Be();Jt();var DC=B(H());Wr();Ve();zt();_r();k();var PR=(e,o)=>({position:"absolute",boxSizing:"content-box",width:"100%",height:"100%",marginLeft:e?o==="right"?"16px":"-32px":0,transform:`translateX(${e?o==="right"?"-100%":"100%":"0px"})`,transition:`transform ${uo.moveSpeed} ease, padding 0.1s 0s ease, border-radius 0.1s 0s ease, margin 0.1s 0s ease`,zIndex:"auto",[o==="right"?"paddingRight":"paddingLeft"]:e?"16px":0,borderRadius:e?o==="right"?"8px 0 0 8px":"0 8px 8px 0":"10px",boxShadow:`0 0 0 2px inset ${Le(.96,V.gray)}`});function ws({isOpen:e,direction:o="left",children:t,...r}){return a(No,{children:e?a(Dt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:e?.1:.5},children:(0,DC.cloneElement)(t,{...r,...PR(e,o)})}):null})}var ba=B(H()),Gi=(e,o,t=[])=>{let r=(0,ba.useRef)(o),i=(0,ba.useRef)(t);(0,ba.useEffect)(()=>{r.current=o},[o]),(0,ba.useEffect)(()=>{i.current=t},[t]),(0,ba.useEffect)(()=>{let{activeOnLock:n,optionKeys:s}=r.current,l=()=>{i.current.includes(!0)||r.current.handler()};return window.RM.constructorRouter.bindGlobalKeyPress({key:e,handler:l,activeOnLock:n,optionKeys:s}),()=>{window.RM.constructorRouter.unbindGlobalKeyPress(e,l)}},[e])};zt();Ve();k();var OC=({children:e,button:o,...t})=>{let r=(0,Mb.useContext)(Ee),{togglePanel:i}=(0,Mb.useContext)(Ct);return Gi("m",{handler:()=>{i("page",!1)}}),w(Xt,{name:"page",button:o,skidding:84,ArrowProps:{stroke:Le(.84,V.gray),popperPadding:21},...t,children:[a(ws,{isOpen:r.isTrashOpened,children:a(xC,{})}),a(ws,{isOpen:r.isPageSettingsOpened,children:a(LC,{})}),a(hC,{position:"relative",width:"100%",height:"100%",zIndex:"1"})]})};var bt=B(H());fl();N();$e();oe();je();vt();Vs();Jt();var Zr=B(H());N();Co();st();Eu();Vs();var Xl=B(H());kh();st();fe();N();Sr();k();var Bb=(0,Xl.memo)(({widget:e,onSelect:o,showBorder:t,highlightedWidget:r,onMouseEnter:i,onMouseLeave:n,forceHovered:s})=>{let[l,c]=(0,Xl.useState)(!!s),{isFreePlan:d}=On(),p=()=>{c(!r||e.blockName===r),i&&i(e.blockName)},m=()=>{c(!1),n&&n(e.blockName)};(0,Xl.useEffect)(()=>{c(s?!r||e.blockName===r:!1)},[s,r,e.blockName]);let u=d&&l&&le.paidWidgetsToShow.includes(e.blockName);return w(f,{"data-widget-type":e.blockName,"aria-label":e.blockName,width:64,height:92,cursor:!r||e.blockName===r?"pointer":"default",onMouseEnter:p,onMouseLeave:m,onClick:()=>{(!r||e.blockName===r)&&o(e.blockName)},position:"relative",opacity:!r||e.blockName===r?1:.2,userSelect:!r||e.blockName===r?"auto":"none",children:[a(f,{border:"1px solid rgba(255, 255, 255, 0.8)",width:64,height:64,borderRadius:"8px",position:"absolute",left:0,top:0,opacity:t?1:0,transition:"all 0.1s"}),a(f,{width:64,height:64,backgroundRepeat:"no-repeat",backgroundPosition:"50% 50%",opacity:l&&!t?.8:1,transition:"all .05s",style:{backgroundImage:`url('${Hs(`./constructor/widgetbar/widget-selector/${e.thumb}.svg`)}')`}}),a(f,{opacity:l?1:.6,textAlign:"center",marginTop:"6px",children:a(L,{color:u?"tomato":"white",textStyle:"small",fontWeight:600,whiteSpace:"nowrap",children:u?"Upgrade":`${e.title}${e.titleShortcut?` (${e.titleShortcut})`:""}`})})]})});vt();ro();Sr();Jt();k();function TR({children:e,backgroundColor:o,boxShadow:t,highlightedWidget:r,disableKeyboardNavigation:i=!1,...n}){let{model:{workspace:s,onClose:l}}=(0,Zr.useContext)(Ya),{panelPayload:c}=(0,Zr.useContext)(Ct),[d,p]=(0,Zr.useState)(-1),[m,u]=(0,Zr.useState)(null),{isFreePlan:g}=On();function h(v){if(g&&le.paidWidgetsToShow.includes(v.toLowerCase())){window.open(`${le.readymag_host}/pricing`,"_blank");return}v==="ecommercecart"&&s.eCommerceManager&&s.eCommerceManager.isCartWidgetExist||(He(["TextWidget","PictureWidgetSelect","ButtonWidgetSelect"]),setTimeout(()=>{l(v)},50))}let b=(0,Zr.useMemo)(()=>{let v=Object.keys(Eo),T=[];for(let R of v){let I=Eo[R]?.prototype;if(I&&!I.excludedFromLib&&(!I.restrictions||I.restrictions(s))){let M={blockName:R,thumb:I.thumb,title:I.name,titleShortcut:I.titleShortcut,iconColor:I.icon_color,sortIndex:I.sort_index||0};typeof I.getBlockCreateParams=="function"&&(M={...M,...I.getBlockCreateParams(s)}),T.push(M)}}return T.sort((R,I)=>{if(R.sortIndex!==I.sortIndex){if(R.sortIndex>I.sortIndex||R.sortIndex===0)return 1;if(R.sortIndex<I.sortIndex||I.sortIndex===0)return-1}return R.sortIndex-I.sortIndex})},[s]),x=(0,Zr.useCallback)(v=>{if(i)return;S(v);let T=d;switch(v.key){case"ArrowLeft":T=T-1,T=Math.max(T,0);break;case"ArrowUp":T=T-3,T=Math.max(T,0);break;case"ArrowRight":T=T+1,T=Math.min(T,b.length-1);break;case"ArrowDown":T=T+3,T=Math.min(T,b.length-1);break;case"Enter":if(T>-1&&b[T])return h(b[T].blockName);break;case"Escape":return l();default:break}T>-1&&T!==d&&p(T)},[b,d,i]);function S(v){i||["ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Enter","Esc"].includes(v.key)&&(v.preventDefault(),v.stopPropagation())}(0,Zr.useEffect)(()=>(document.body.addEventListener("keyup",x),document.body.addEventListener("keydown",S),()=>{document.body.removeEventListener("keyup",x),document.body.removeEventListener("keydown",S)}),[x]);function y(v){u(v)}function C(){u(null)}let P=m&&le.paidWidgetsToShow.includes(m);return d>=0&&(P=le.paidWidgetsToShow.includes(b[d].blockName)),a(St,{indent:16,arrow:!1,open:!!(g&&P),componentsProps:{tooltip:{backgroundColor:"blue"}},text:"Upgrade your plan to publish a project with this widget",listenReferenceResize:!0,popperOptions:{modifiers:[{name:"offset",enabled:!0,options:{offset:[0,48]}}]},children:a(f,{width:208,opacity:b.length?1:0,transition:"opacity .1s",...n,children:a(f,{paddingBottom:12,id:"widget-selector",backgroundColor:o,boxShadow:t,transition:"all 0.1s",children:a(f,{display:"flex",gap:"0px 8px",flexWrap:"wrap",children:b.map((v,T)=>v.blockName==="presets"?a(St,{text:"Add your first one",open:c?.showPresetDemoTooltip??!1,componentsProps:{tooltip:{backgroundColor:"blue"},arrow:{color:"blue",left:"-1px !important"}},children:a(f,{as:"span",children:a(Bb,{widget:v,onSelect:h,showBorder:d===T,forceHovered:d===T,highlightedWidget:r,onMouseEnter:y,onMouseLeave:C},v.blockName)})},T):a(Bb,{widget:v,onSelect:h,showBorder:d===T,forceHovered:d===T,highlightedWidget:r,onMouseEnter:y,onMouseLeave:C},v.blockName))})})})})}var $C=TR;jt();var ft=B(H());je();ro();N();$e();dr();Jh();Vr();fe();Wo();pn();oe();lu();jt();var wr=B(H());Wr();var FC=B(pt()),Rb=B($t());Wh();pn();YI();jt();Bo();Tk();Eu();N();Ai();oe();Du();df();ec();bu();fk();dM();Zp();$h();Fs();k();var IR=F(f,{label:"workspace-scroller"})`
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  // Overflow hidden prevents scroll bar from showing when we scroll the scroller on hover to demo the scroll animation.
  overflow: hidden;
`,MR=F(f,{label:"workspace-container"})`
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 7px;
  cursor: pointer;
  transition: transform 0.1s ease;
  &:active {
    transform: scale(0.99);
  }
  * {
    // It's important to disable pointer events on widgets. For example, to avoid triggering mouseleave on preset popover
    // when hovering over the blocks which are rendered with react, such as text or shots.
    pointer-events: none !important;
  }
  & > * {
    position: relative;
    width: 100%;
    height: 100%;
    flex: none;
  }
  & .block {
    position: absolute;
    flex: none;
    &.lottie .content > *:first-child {
      background: transparent;
    }
  }
  &.has-cover > * > .block,
  & .steps-lines-wrapper {
    display: none;
  }
  & .animation-steps-container {
    // It's display and not visibility or opacity, because the animation does not play when not it's not displayed and starts anew when it is.
    // Visibility or opacity would show animation from the whatever frame it is currently in.
    display: none;
    z-index: 2510;
  }
  &:hover {
    .block.animation-mode {
      display: none;
    }
    .animation-steps-container {
      display: block;
    }
  }
`,BR=F(f,{label:"cover"})`
  position: absolute;
  width: 100%;
  height: 100%;
  background: center / contain no-repeat;
  pointer-events: none;
  ${e=>ae`
      background-image: url(${e.cover});
    `}
`,RR=F(f,{label:"preview"})`
  position: relative;
  border-radius: 8px;
  margin: 0 auto;
  overflow: hidden;
  cursor: pointer;
`,zb=Lu.extend({...Oh,tracked:!1}),zR=jr.extend({...Oh,tracked:!1});function ER(e,o,t,r){let i=Pr.getWorkspaceSize(t,r,o),n={width:t.opts.scalableviewer?i.width:window.innerWidth,height:window.innerHeight},s={workspaceSize:i,windowSize:n,viewport:o,zoom:1},l=e.map(p=>hi({target:new zb({...p,_id:`preset-${Un()}-${p._id}`}),viewport:o,pageId:p.pid,disposable:!0})).filter(p=>!p.attributes.hidden),c=l.length>0&&l.every(p=>p.attributes.is_full_width&&p.attributes.is_full_height),d={fixed_position:"",is_global:!1,is_above:!1};if(c){let p=$x[o].width;return l.forEach(m=>m.set({...d,x:0,y:0,w:p,h:p},{silent:!0})),{models:l,union:{width:p,height:p}}}else{let p=l.map(u=>{let{x:g,y:h,w:b,h:x,fixed_position:S,angle:y,is_full_width:C,is_full_height:P}=u.attributes;return{x:g,y:h,w:C?n.width:b,h:P?n.height:x,fixed_position:S,angle:y}}),m=Pr.coordinatesToClientBoundingBox(p,s);return l.forEach(u=>{let g=Pr.mapWidgetToWindow([u.attributes],s),h=ct.absoluteToRelative(g,m);u.set(Object.assign({},d,{x:h.left,y:h.top},u.attributes.is_full_width?{w:Math.max(m.width,n.width)}:{},u.attributes.is_full_height?{h:Math.max(m.height,n.height)}:{}),{silent:!0})}),{models:l,union:m}}}var AR=e=>{let o=e.map(s=>{let{x:l,y:c,w:d,h:p,angle:m=0}=s,u=Math.cos(m*Math.PI/180),g=Math.sin(m*Math.PI/180),h={left:l,top:c,width:d,height:p,cosAngle:u,sinAngle:g};return dt.calcBoundingBox(h,void 0,!0)}),{left:t,top:r,width:i,height:n}=dt.getBoundingBoxOfBoxes(o);return{left:t,top:r,width:i,height:n}};function LR({mag:e,union:o,backgroundColor:t,eCommerceManager:r,size:i,spacing:n=16,viewport:s,container:l,scroller:c}){let d=new zu({page:new zR,mag:e,$container:(0,Rb.default)(l),width:o.width,height:o.height,background:t,eCommerceManager:r,viewport:s});d.$scroller=(0,Rb.default)(c);let p=d.$el[0],m={width:i.width-n*2,height:i.height-n*2},g=ct.contain(o,m).width/o.width;return p.style.setProperty("transform",`scale(${g})`),p.style.setProperty("width",`${o.width}px`),p.style.setProperty("height",`${o.height}px`),d}function DR(e,o){return e.map(t=>{let r=new Eo[t.attributes.type](t,o);r.isStandalone=!0,r.autoRasterize=!1,r.$standaloneContainer=o.$el,FC.default.extend(r,{},hk),r.render(),r.redrawPosition(t,{forceRedraw:!0});let i=r.$el[0],n=rg(t),s=i.querySelector(".frameborder"),l=i.querySelector(".content");if(s.style.setProperty("display","none"),l.style.setProperty("z-index",t.attributes.z),n){let c=$R(n,t,o.viewport);c.opacity!==void 0&&i.style.setProperty("opacity",c.opacity),c.transform!==void 0&&i.style.setProperty("transform",c.transform)}return r})}var HC={hover:3,load:2,scroll:1,click:0,none:0},OR=({type:e},{type:o})=>HC[o]-HC[e],rg=(e,o=!1)=>{let t=[...e.get("animation")||[]].sort(OR),r=o?["hover","load","scroll","click"]:["hover","load","scroll"];return t.find(({type:i,steps:n})=>r.includes(i)&&n.length>0)};function $R(e,o,t){let{steps:r,type:i}=ll.getNormalizedAnimation(e,!!o.get("fixed_position"),o.get("is_full_width"),o.get("is_full_height"),1,t),n=r[0],{from_rotate:s=0,from_scale:l=100,from_opacity:c=100}=n,d={},p=K0.getTransformString({x:0,y:0,angle:s,scale:l/100,hasRotation:Y0(r),hasScale:X0(r),isKeyframe:i!=="scroll",force3d:!1,offsetPathEnabled:!1});return(s!==0||l!==100)&&(d.transform=p),c!==100&&(d.opacity=(c/100).toString()),d}function HR(e,o){let t=e.map(d=>d.id),i=(e[0]?.model.get("animation")?.filter(d=>d.type!=="none")||[])[0]?.UUID,n=!!i&&e.every(d=>{let p=d.model.get("animation")?.filter(m=>m.type!=="none")||[];return p.length===1&&p[0].UUID===i}),s=e.reduce((d,p)=>{let m=rg(p.model,n);if(!m)return d;let u=m.UUID;return d[u]?d[u].push(p):d[u]=[p],d},{});if(!n&&Object.keys(s).length>0&&e.filter(d=>rg(d.model)).length!==e.length){let d="animation-stub-"+Un(),p=[{UUID:d,type:"hover",steps:[{}]}],m=e.filter(u=>!rg(u.model));m.forEach(u=>u.model.set("animation",p)),s[d]=m}return Object.keys(s).sort((d,p)=>{let{z:m,_id:u}=s[d][0].model.attributes,{z:g,_id:h}=s[p][0].model.attributes;return m-g||t.indexOf(u)-t.indexOf(h)}).map(d=>{let p=s[d],m=p[0].model,u=AR(p.map(b=>b.model.attributes)),g=new ck({uuid:d,blocks:p,workspace:o,static:!0,isFixed:!!m.get("fixed_position"),isFullwidth:m.get("is_full_width"),isFullheight:m.get("is_full_height"),isSticked:!!m.get("sticked"),updateIndexes:!0,zoomView:{getZoom:()=>1}}),h=g.$el[0];return h.style.setProperty("left",`${u.left}px`),h.style.setProperty("top",`${u.top}px`),h.querySelectorAll(".block").forEach(b=>{b.style.removeProperty("opacity"),b.style.removeProperty("transform")}),g})}var FR=({widgets:e,backgroundColor:o="white",boxShadow:t,width:r,height:i,cover:n,viewport:s,onClick:l,hidden:c=!1,videoUrl:d})=>{let p=(0,wr.useRef)(null),m=(0,wr.useRef)(null),[u,g]=(0,wr.useState)(!0),{mag:h,page:b,eCommerceManager:x}=(0,wr.useContext)(qe),S=(0,wr.useRef)(),y=(0,wr.useRef)(),C=(0,wr.useRef)();(0,wr.useEffect)(function(){if(!(!h||!b||c||d)){try{let{models:R,union:I}=ER(e,s,h.toJSON(),b.toJSON()),M=LR({viewport:s,mag:h,union:I,size:{width:r,height:i},backgroundColor:o,eCommerceManager:x,container:p.current,scroller:m.current});C.current=M,y.current=DR(R,M)}catch(R){console.error("Error rendering preset preview",R),y.current=[]}return()=>{y.current?.map(R=>R.destroy()),S.current?.map(R=>R.destroy()),C.current?.remove(),y.current=void 0,S.current=void 0,C.current=void 0}}},[o,s,b,h,c]);function P(){if(d){g(!1);return}S.current===void 0&&y.current&&C.current&&(S.current=HR(y.current,C.current)),!!S.current?.length&&g(!1),S.current?.map(R=>{if(R.startPreviewMode(),R.previewTimeline.type==="scroll"){let I=C.current?.$scroller[0];if(!I)return;let M=I.getBoundingClientRect().height,D=R.previewTimeline.steps.reduce((E,A)=>E+A.calcedDuration,R.getScrollStart(R.getAnimation()));I.firstChild?.style?.setProperty("height",`${D+M}px`),I.scrollTo({top:D,behavior:"smooth"})}})}function v(){g(!0),S.current?.map(T=>T.stopPreviewMode()),C.current?.$scroller?.[0].scrollTo({top:0,behavior:"auto"})}return a(RR,{"aria-label":"Preset preview",role:"button",width:r,height:i,boxShadow:t,backgroundColor:o,onClick:l,onMouseEnter:P,onMouseLeave:v,children:a(NR,{viewport:s,children:c?a(f,{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:o==="black"?"black":"gray",children:a(ul,{fontSize:48})}):w(wr.Fragment,{children:[a(IR,{ref:m,children:a(f,{width:"100%"})}),a(MR,{overflow:"hidden",className:n&&u?"has-cover":void 0,ref:p}),w(No,{children:[n&&u&&a(Dt.div,{exit:{opacity:0},transition:{duration:.1},children:a(BR,{cover:n})}),d&&!u?a("video",{muted:!0,autoPlay:!0,poster:n,controls:!1,src:d,width:"100%",height:"100%"}):null]})]})})})},NR=({children:e,viewport:o})=>{let[t,r]=R0();return Vy(()=>{(async()=>{await r(t.current,{opacity:.6},{duration:.2,ease:"easeOut"}),await r(t.current,{opacity:1},{duration:.2,ease:"easeIn"})})()},[o]),a("div",{ref:t,style:{width:"100%",height:"100%",opacity:1},children:e})},NC=FR;var Ar=B(H());N();dr();fe();pn();ux();lu();var WC=B(H());var wa=(0,WC.createContext)({editable:!1,scope:2,setScope(){}});k();var Eb="collapsed-preset-folders";function WR(e,o){try{let t=JSON.parse(window.localStorage.getItem(Eb)||"{}");t[o]||(t[o]=[]);let r=t[o].indexOf(e);r!==-1?t[o].splice(r,1):t[o].push(e),window.localStorage.setItem(Eb,JSON.stringify(t))}catch{}}function VR(e,o){try{return!JSON.parse(window.localStorage.getItem(Eb)||"{}")[o]?.includes?.(e)}catch{return!0}}function VC(e){return e===1?window.RM.constructorRouter.mag.user.get("_id"):window.RM.constructorRouter.mag.get("_id")}var GC=(0,Ar.memo)(({name:e,presets:o,children:t})=>{let{scope:r,editable:i}=(0,Ar.useContext)(wa),[n,s]=(0,Ar.useState)(e),[l,c]=(0,Ar.useState)(()=>VR(n,VC(r))),d=(0,Ar.useRef)(null),p=(0,Ar.useRef)(()=>u(n)),m=(0,Ar.useRef)(!1);p.current=()=>u(n),(0,Ar.useEffect)(()=>function(){m.current&&p.current()},[]);function u(y){if(!(y!==e)||!y){s(e);return}let P=o[0].type,v=o.map(T=>T._id);Lv(P,v,vd.sanitize(y))}let g=()=>{c(y=>!y),WR(n,VC(r))},h=y=>{y.key==="Enter"&&(y.preventDefault(),d.current?.blur?.())};function b(){m.current=!0}function x(){m.current=!1,u(n)}let S=i?a(yt,{padding:0,value:n,color:"white",height:"auto",onBlur:x,border:"none!important",onKeyDown:h,onFocus:b,onChange:y=>s(y.target.value),onClick:y=>y.stopPropagation(),ref:d}):a(L,{children:n});return w(f,{width:"100%",display:"flex",gap:16,flexDirection:"column","aria-label":`${e} preset folder`,children:[w(f,{gap:6,height:20,role:"button",color:"white",display:"flex",cursor:"pointer",alignItems:"center",onClick:g,children:[a(f,{as:"span",transition:"transform 0.3s ease",transform:`rotate(${l?"0def":"-90deg"})`,children:a(zo,{"data-testid":"ToggleFolderIcon",fontSize:20})}),S]}),l?a(f,{display:"flex",gap:16,flexWrap:"wrap",marginBottom:24,children:t}):null]})});bu();gM();k();var Ab=(e,o)=>{let t=new Intl.Collator(void 0,{numeric:!1});return e.sort((r,i)=>t.compare(String(r[o]),String(i[o])))},GR=(e,o)=>{if(e.length===0)return[];let t={},r=[];for(let s of e){if(!s.name.includes("/")){r.push(s);continue}let[l]=s.name.split("/");t.hasOwnProperty(l)?t[l].push(s):t[l]=[s]}let i=Object.keys(t).map(s=>{let l=t[s];return o!==2&&Ab(l,"name"),{folderName:s,type:"folder",presets:l}}),n=Ab(i,"folderName");return o!==2&&Ab(r,"name"),[...n,...r]},jR=e=>e.replace(/\s*\/\s*/,"/").trim(),qR=e=>{let o=jR(e),[t,r]=o.split("/");return t?o:r};function YR(e){return e.replace("/"," / ")}function Lb(e){let[,...o]=e.split("/");return o.length===0?e:o.join("/")}var ig=(0,ft.memo)(({presets:e,editable:o=!1,isOwner:t=!0,scope:r=2,setScope:i})=>{let n=(0,ft.useMemo)(()=>({editable:o,scope:r,setScope:i||(()=>{})}),[o,r,i]),s=(0,ft.useMemo)(()=>GR(e,r),[e,r]),l=s.length===0,c=null;if(l){let d=w(ft.Fragment,{children:["Press",a(Ov,{marginBottom:-6,display:"inline"}),"and save ",a("br",{})," any widgets as a preset"]});r===1&&(d=w(ft.Fragment,{children:["Press ",a(Tr,{marginBottom:3,display:"inline"})," to make ",a("br",{})," any preset global"]})),c=a(f,{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",children:t?a(L,{color:"darkGray",textAlign:"center",children:d}):w(L,{color:"darkGray",children:["No $",r===0?"project":"global"," presets saved yet"]})})}else c=a(f,{display:"flex",gap:16,flexWrap:"wrap",children:s.map(d=>d.type==="folder"?a(GC,{name:d.folderName,presets:d.presets,children:d.presets.map(p=>a(jC,{preset:p},p._id))},`${r}-${d.folderName}`):a(jC,{preset:d},d._id))});return a(wa.Provider,{value:n,children:a(Ft,{children:({ref:d})=>a(f,{ref:d,height:l?"100%":"auto",padding:16,children:c})})})}),jC=(0,ft.memo)(({preset:e})=>{let{isHovered:o,...t}=Ke(!1),{workspace:r}=(0,ft.useContext)(qe),{editable:i}=(0,ft.useContext)(wa),[n,s]=(0,ft.useState)(r?.viewport||"default"),l=(0,ft.useRef)(null),c=(0,ft.useMemo)(()=>e.widgets.map(u=>{let g=new zb({...u,_id:`preset-item-${u._id}`});return hi({viewport:n,disposable:!0,pageId:u.pid,target:g})}),[e,n]),d=(0,ft.useMemo)(()=>c.every(u=>u.get("hidden")),[c]),p=o?"0 0 0 4px rgba(162, 162, 162, 0.16)":void 0;function m(){r?.pastePreset({object:"rm_pastedata",mag_num_id:void 0,blocks:e.widgets,packs:e.packs,mag_edit_params:{fonts:e.fonts,textStyles:e.textStyles,listStyles:e.listStyles,linkStyles:e.linkStyles}},{disableDeleteViewportAttributes:!0,disableDeleteGlobalAttributes:!0,customLayersName:e.name}),se(he.PresetAdd,{presetCategory:e.category?.name??"saved",presetName:e.name})}return(0,ft.useEffect)(()=>{l.current&&mk(e,l.current)},[]),w(f,{gap:8,ref:l,width:192,display:"flex",flexDirection:"column","data-preset-id":e._id,"aria-label":`${e.name} preset`,...t,children:[a(NC,{width:192,height:192,boxShadow:p,widgets:e.widgets,onClick:m,viewport:n,cover:e.cover,hidden:d,backgroundColor:e.backgroundColor||"white",videoUrl:e.videoUrl}),w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,children:[a(XR,{preset:e}),w(f,{display:"flex",gap:6,alignItems:"center",children:[i?a(ZR,{preset:e}):null,a(JR,{viewport:n,setViewport:s}),i?a(KR,{preset:e}):null]})]})]})}),XR=(0,ft.memo)(({preset:e})=>{let[o,t]=(0,ft.useState)(()=>Lb(e.name)),{editable:r}=(0,ft.useContext)(wa),i=(0,ft.useRef)(()=>c(o)),n=(0,ft.useRef)(null),s=(0,ft.useRef)(!1);i.current=()=>c(o),(0,ft.useEffect)(()=>function(){s.current&&i.current()},[]);function l(m){m.key==="Enter"&&(m.preventDefault(),n.current?.blur?.())}function c(m,u={}){let g=qR(m);if(!(e.name!==g)||!g){u.updateState&&t(Lb(e.name));return}Gh({type:e.type,id:e._id},{name:g}),u.updateState&&t(Lb(g)),g.split("/")[1]&&se(he.PresetMisc,{action:"folder created by type in"})}function d(){s.current=!0,t(YR(e.name))}function p(){s.current=!1,c(o,{updateState:!0})}return r?a(yt,{padding:0,value:o,color:"white",height:"auto",textStyle:"small",onBlur:p,ref:n,onFocus:d,border:"none!important",onKeyDown:l,onChange:m=>t(m.target.value),textOverflow:"ellipsis"}):a(L,{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"white",textStyle:"small",children:o})}),KR=(0,ft.memo)(({preset:e})=>{let[o,t]=(0,ft.useState)(!1),{setScope:r}=(0,ft.useContext)(wa),i=(0,ft.useMemo)(()=>[{title:e.type==="global"?"Move to Project":"Move to Global",hidden:!window.RM.constructorRouter.mag.user.get("permissions")?.can_use_global_presets,closeOnClick:!0,onClick(){let n=e.type==="global"?"project":"global";Av(e._id,e.type,n);let l={project:0,global:1}[n];r(l),se(he.PresetMisc,{action:l===0?"saved move to project":"saved move to global"})}},{title:"Delete",closeOnClick:!0,onClick(){Ev({type:e.type,id:e._id})}}],[e]);return a("div",{onClick:n=>n.stopPropagation(),children:a(ml,{width:224,zIndex:9999,border:"none",borderRadius:8,listItems:i,popperOffset:[-85,-20],container:document.body,onToggleDropdown:t,boxShadow:"0px 2px 16px rgba(0, 0, 0, 0.16)",role:"menu",children:({toggleDropdown:n})=>a(qC,{"aria-haspopup":!0,onClick:n,"aria-label":"preset context menu trigger","aria-expanded":o?"true":"false",children:a(Tr,{})})})})}),ZR=(0,ft.memo)(({preset:e})=>{let{isHovered:o,...t}=Ke(!1),r=e.backgroundColor||"white",i=()=>{let l=r==="black"?"white":"black";Gh({type:e.type,id:e._id},{backgroundColor:l})},n="50%",s="50%";return o&&(r==="black"?n="100%":(n="0%",s="100%")),w(f,{width:10,height:10,role:"button",borderWidth:3,cursor:"pointer",overflow:"hidden",borderRadius:"50%",borderStyle:"solid",borderColor:"darkGray",boxSizing:"content-box",onClick:i,...t,children:[a(f,{transition:"width 0.2s ease",width:n,height:"100%",backgroundColor:"#ffffff"}),a(f,{transition:"width 0.2s ease",width:s,height:"100%",backgroundColor:"#000000"})]})}),JR=(0,ft.memo)(({viewport:e,setViewport:o})=>{let{isHovered:t,...r}=Ke(!1),i=["default","phone_portrait","tablet_portrait"],n=()=>{let c=(i.indexOf(e)+1)%i.length;o(i[c])},s={default:a(uu,{width:20}),phone_portrait:a(ry,{width:8}),tablet_portrait:a(ny,{width:13})};return a(ge,{width:24,height:24,display:"flex",variant:"unstyled",justifyContent:"center",onClick:n,color:t?"white":"darkGray",...r,children:s[e]})}),qC=F(ge)`
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  padding: 0;
  color: ${e=>e.theme.colors.gray};

  &:hover {
    color: ${e=>e.theme.colors.white};
  }
`;qC.defaultProps={variant:"unstyled"};var Kl=B(H());N();fe();oe();Wo();Vr();lu();kh();k();var Db={_id:"my-presets",isArchived:!1,name:"Saved",position:0,cover:Hs("./constructor/presets/my-preset.svg"),hoverCover:Hs("./constructor/presets/my-preset-hover.svg")},QR=(0,Kl.memo)(({onSelectCategory:e,onDeselectCategory:o,selectedCategory:t})=>{let[r]=Rv(),i=[a(YC,{category:Db,active:Db._id===t,onMouseEnter:()=>e(Db),onMouseLeave:()=>o()})],n=null;return r.forEach(s=>{s.parent?._id!==n&&i.push(a(ez,{title:s.parent.name})),i.push(a(YC,{category:s,active:s._id===t,onMouseEnter:()=>e(s),onMouseLeave:()=>o()})),n=s.parent._id}),a(Ft,{children:({ref:s})=>a(f,{ref:s,id:"preset-panel",padding:"0 8px",children:i})})}),ez=(0,Kl.memo)(({title:e})=>a(f,{height:40,marginLeft:8,children:a(L,{textStyle:"regular",color:"white",lineHeight:"40px",cursor:"default",children:e})})),YC=(0,Kl.memo)(({category:e,onMouseEnter:o,onMouseLeave:t,active:r,...i})=>{let{isHovered:n,onMouseEnter:s,...l}=Ke(!1),c=(0,Kl.useRef)({x:null,y:null}),d=e.cover?{backgroundImage:`url(${e.cover})`,backgroundSize:"contain",backgroundRepeat:"no-repeat"}:{backgroundColor:"red"};(n||r)&&d.backgroundImage&&e.hoverCover&&(d.backgroundImage=`url(${e.hoverCover})`);function m(g){l.onMouseLeave(g),t&&t(g),c.current={x:null,y:null}}function u(g){let{clientX:h,clientY:b}=g,{current:x}=c;if(x.x!==null&&x.y!==null){let S=Math.abs(h-x.x),y=Math.abs(b-x.y);(S<=1||S===0&&y===0)&&(s(g),o&&o(g))}c.current={x:h,y:b}}return w(tz,{...i,...l,active:r,onMouseLeave:m,onMouseMove:u,backgroundColor:n?"black":void 0,children:[a(f,{width:48,height:48,...d}),a(L,{color:"white",textStyle:"small",children:e.name})]})}),tz=F(f)`
  gap: 8px;
  height: 64px;
  padding: 8px;
  display: flex;
  align-items: center;
  border-radius: 8px;
  cursor: default;

  ${e=>e.active&&ae`
      background-color: ${e.theme.colors.black};
    `}
`,XC=QR;lu();Za();Kx();var Zl=B(H());N();Ay();fe();Sr();Ir();Gn();k();var KC=({text:e})=>a(f,{margin:"16px 16px 0 16px",borderRadius:4,padding:"8px 16px",backgroundColor:"blue",children:a(L,{color:"white",textStyle:"small",children:e})}),oz="Upgrade your plan to save presets",rz="Upgrade to the Team plan to add new global presets",ZC=({children:e,active:o})=>a(L,{textStyle:"small",color:o?"white":"gray",children:e}),JC=(0,Zl.memo)(({global:e,project:o,isOwner:t})=>{let[r,i]=(0,Zl.useState)(0),{isFreePlan:n}=(0,Zl.useContext)(cr),s=n&&t,l=r===0&&s,c=r===1&&!window.RM.constructorRouter.mag.user.get("permissions")?.can_use_global_presets,d=Fi("CanUsePresets"),p=u=>{let g=u===0?0:1,h=window.RM.constructorRouter.mag.user.get("permissions")?.can_use_global_presets;g===1&&!e.length&&!h?rt("global-presets"):i(g)},m=[{title:w(ZC,{active:r===0,children:["Project"," ",a(L,{textStyle:"small",color:"darkGray",children:o.length})]})},{title:w(ZC,{active:r===1,children:["Global"," ",a(L,{textStyle:"small",color:"darkGray",children:e.length})]})}];return w(f,{paddingTop:8,height:"100%",overflow:"hidden",display:"flex",flexDirection:"column",children:[a(ac,{items:m,activeColor:"white",borderActiveColor:"white",onChange:p,activeIndex:r}),l?a(KC,{text:oz}):null,c?a(KC,{text:rz}):null,a(ig,{scope:r,setScope:i,editable:t||d,presets:r===0?o:e})]})});ro();So();var QC=e=>e.transient,e4=e=>!e.transient;function iz(e){return e.reduce((o,t)=>{let{textStyles:r=[],listStyles:i=[],linkStyles:n=[]}=t;return t.type==="project"?(o.textStyles.project=o.textStyles.project.concat(r),o.listStyles.project=o.listStyles.project.concat(i),o.linkStyles.project=o.linkStyles.project.concat(n)):(o.textStyles.global=o.textStyles.global.concat(r),o.listStyles.global=o.listStyles.global.concat(i),o.linkStyles.global=o.linkStyles.global.concat(n)),o},{textStyles:{global:[],project:[]},listStyles:{global:[],project:[]},linkStyles:{global:[],project:[]}})}function Ob(e,o){let t=e.global.reduce((l,c)=>(l[c.name]={...c,transient:!0,scope:"global"},l),{});t=e.project.reduce((l,c)=>(l[c.name]={...c,transient:!0,scope:"project"},l),t);let r=Object.keys(t),i=o.project.map(l=>l.name).concat(o.global.map(l=>l.name)),n=Os(r,i),s=Object.values(wx(t,n)).map(l=>({...l,transient:!0}));return s.length>0?{project:o.project.concat(s.filter(l=>l.scope==="project")),global:o.global.concat(s.filter(l=>l.scope==="global"))}:o}function $b(e){let{global:o,project:t}=e;return o.find(QC)||t.find(QC)?{project:t.filter(e4),global:o.filter(e4)}:e}function t4(e,o){let t=iz(e),{textStyles:r,listStyles:i,linkStyles:n}=o;return{textStyles:Ob(t.textStyles,r),listStyles:Ob(t.listStyles,i),linkStyles:Ob(t.linkStyles,n)}}function o4(e){let{textStyles:o,listStyles:t,linkStyles:r}=e;return{textStyles:$b(o),listStyles:$b(t),linkStyles:$b(r)}}Be();Sr();Co();zI();Hn();mi();k();var nz=({children:e,button:o,...t})=>{let[r,i]=(0,bt.useState)("widgets"),{currentPanel:n,closePanels:s,panelPayload:l,togglePanel:c}=(0,bt.useContext)(Ct),{workspace:d,isCurrentPageLocked:p}=(0,bt.useContext)(qe),[m]=go(),[u]=Bv(),[g,h]=(0,bt.useState)(null),b=(0,bt.useRef)(),x=(0,bt.useRef)(!1),[S,y]=(0,bt.useState)(!1),C=(0,bt.useContext)(ce),{isFreePlan:P}=(0,bt.useContext)(cr),[{step:v}]=el(),T=(0,bt.useRef)(),R=(0,bt.useRef)(),I=(0,bt.useRef)(),M="widget-selector",D=n===M,E=D&&r==="presets",A=(0,bt.useMemo)(()=>{let ie=[...u.project,...u.global],ze=C.isOwner&&P;return ie.length===0&&ze},[u,C.isOwner,P]);Gi("w",{handler:()=>{c("widget-selector",!1)}},[p,m]),(0,bt.useEffect)(()=>{D&&l?.nestedPanel==="presets"&&(i("presets"),h("my-presets"))},[D]),(0,bt.useEffect)(()=>{v?.name==="TextWidget"&&n!==M&&(c(M,!1),i("widgets"))},[v]),(0,bt.useEffect)(()=>{(!n||n!=="widget-selector")&&(h(null),i("widgets"))},[n]),(0,bt.useEffect)(()=>{let ie=new AbortController;return zv({signal:ie.signal,projectId:C.project._id,ownerId:C.owner._id}),()=>ie.abort()},[C.project._id,C.owner._id]),(0,bt.useEffect)(function(){let ze=[...u.readymag,...u.global,...u.project];if(!ze.length)return;let ne=ze.reduce((X,Q)=>[...X,...Q.widgets],[]),J=Mt.getUsedFontsFromWidgetsModels({models:ne},Mt.fontsShortList);Mt.appendFontsCssToDocument({fonts:J,version:"edit"})},[u]),(0,bt.useEffect)(function(){let ze=[...u.readymag,...u.global,...u.project];if(ze.length===0||!E)return;let ne={textStyles:Wp(),listStyles:Gp(),linkStyles:ja()},J=t4(ze,ne);return ne.textStyles!==J.textStyles&&Np(J.textStyles),ne.listStyles!==J.listStyles&&Up(J.listStyles),ne.linkStyles!==J.linkStyles&&Vp(J.linkStyles),function(){let Q={textStyles:Wp(),listStyles:Gp(),linkStyles:ja()},te=o4(Q);Np(te.textStyles),Up(te.listStyles),Vp(te.linkStyles)}},[u,E]),(0,bt.useEffect)(()=>{Nr(["TextWidget","PictureWidgetSelect","ButtonWidgetSelect"],{show:!D})},[D]);function $(ie){i(ie),h(null),ie==="presets"&&se(he.PresetClick)}let j=(0,bt.useCallback)(ie=>{b.current&&(clearTimeout(b.current),b.current=void 0),!S&&h(ie)},[S]),pe=(0,bt.useCallback)(()=>{b.current&&(clearTimeout(b.current),b.current=void 0),b.current=setTimeout(()=>{x.current||h(null)},100)},[]),ee=(0,bt.useMemo)(()=>new Backbone.Model({workspace:d,onClose:ie=>{s(),d?.createWidget(ie,l)}}),[s,d]),G=(0,bt.useMemo)(()=>g==="my-presets"?[]:(u.readymag.filter(ie=>ie.category?._id===g)??[]).sort((ie,ze)=>ie.position-ze.position),[g,u.readymag]),K={buttonPadding:"0 16px",onAnimationStart:()=>y(!0),onAnimationComplete:()=>{I.current?.update?.(),T.current?.update?.(),R.current?.update?.(),y(!1)}},we=(0,bt.useMemo)(()=>g==="my-presets"&&A?!1:g!==null&&r==="presets",[g,r,A]),xe=(0,bt.useCallback)(ie=>{j(ie._id)},[j]),_e=(0,bt.useMemo)(()=>{let ie=by(v);return ie.modifiers.push({name:"offset",enabled:!0,options:{offset:[0,48]}}),ie},[v]);return w(Xt,{name:"widget-selector",button:o,skidding:-84,panelPosition:{height:"auto"},ArrowProps:{backgroundColor:Me("black",.96)},onToggle:()=>{Hd(["PictureWidget","ButtonWidget"]),He(["PictureWidget","ButtonWidget"])},...t,children:[a(ws,{isOpen:we,children:a(f,{backgroundColor:"black",onMouseEnter:()=>x.current=!0,onMouseLeave:()=>{x.current=!1,pe()},children:a(f,{width:432,height:"100%",backgroundColor:"black",borderRadius:8,children:g==="my-presets"?a(JC,{global:u.global,project:u.project,isOwner:C.isOwner}):a(ig,{presets:G})})})}),a(f,{zIndex:1,maxHeight:"100%",borderRadius:8,backgroundColor:"#313131",children:w(Gr,{dynamicHeight:!0,value:r,transition:{mass:1,stiffness:210,damping:20,duration:.2},onChange:$,children:[a(mo,{value:"widgets",renderButton:()=>a(gt,{targetSteps:["TextWidget","PictureWidgetSelect","ButtonWidgetSelect"],stepContext:{isPresetPanel:r==="presets"},listenReferenceResize:!0,modifiers:[{name:"offset",enabled:!0,options:{offset:[0,24]}}],show:r==="widgets"?!1:void 0,position:"right",popperRef:T,children:a(Hb,{children:"Widgets"})}),...K,children:ie=>a(f,{ref:ie,paddingLeft:8,children:a(zd,{model:ee,context:Ya,children:a(gt,{targetSteps:["TextWidget","PictureWidgetSelect","ButtonWidgetSelect"],indent:8,listenReferenceResize:!0,modifiers:_e.modifiers,componentsProps:_e.componentProps,show:r!=="widgets"?!1:void 0,popperRef:R,children:a(f,{children:a($C,{disableKeyboardNavigation:r==="presets",highlightedWidget:v?.widgetSelectionType})})})})})}),a(mo,{value:"presets",renderButton:()=>w(f,{position:"relative",children:[a(gt,{indent:24,eduTips:"eduTipUsePresets",leaveDelay:100,instance:!0,closeOnTargetClick:!0,position:"right",children:a(Hb,{divider:!0,children:"Presets"})}),r==="presets"?a(f,{as:"span",position:"absolute",top:12,right:0,onClick:ie=>ie.stopPropagation(),children:a(Ro,{href:"https://help.readymag.com/hc/en-us/articles/14645512799259-Presets"})}):null]}),...K,children:ie=>a(f,{ref:ie,height:"calc(100vh - 210px)",children:a(sz,{open:A&&g==="my-presets",popperRef:I,children:a(XC,{selectedCategory:g,onSelectCategory:xe,onDeselectCategory:pe})})})})]})})]})},sz=({children:e,open:o,popperRef:t})=>a(St,{indent:8,open:o,skidding:20,placement:"right-start",listenReferenceResize:!0,componentsProps:{arrow:{marginTop:"-10px",color:"blue"},tooltip:{backgroundColor:"blue"}},text:"Upgrade your plan to save new presets",popperRef:t,children:a("span",{children:e})}),Hb=F(ge)`
  color: white;
  height: 48px;
  width: 100%;
  text-align: left;
  position: relative;
  padding-left: 0px;
  padding-right: 0px;
  box-sizing: border-box;
  position: relative;

  ${e=>e.divider&&ae`
      &:before {
        content: '';
        position: absolute;
        left: 0;
        top: -1px;
        width: 100%;
        height: 2px;
        background-color: rgba(162, 162, 162, 0.24);
      }
    `}
`;Hb.defaultProps={textStyle:"subheading"};var r4=nz;var Kt=B(H());Jt();jt();Bo();N();fe();var i4=B(H());N();zt();Ve();fl();fe();jt();Ch();pn();Wo();k();var az=208;function ng({children:e,title:o,expanded:t=!1,onToggle:r,hideArrows:i=!1,...n}){let s=(0,i4.useContext)(qe),{isHovered:l,...c}=Ke();return s.viewport!=="default"?a(f,{width:224,borderRadius:"8px",color:"black",backgroundColor:Le(.04,V.lightGray),overflow:"hidden",backdropFilter:"blur(4px)",...n,children:a(Gr,{dynamicHeight:!0,value:t?1:0,onChange:()=>r?.(!t),transition:{duration:.2,ease:Hp.easeOutQuint},children:a(mo,{value:1,renderButton:()=>w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",height:46,width:192,padding:"13px 0",margin:"0 auto",cursor:"pointer",role:"button",...c,children:[a(ve,{children:o}),!i&&a(f,{color:l?"black":"gray",transition:".1s ease",children:t?a($v,{}):a(Hv,{})})]}),containerHeight:az,children:d=>a(f,{ref:d,children:e(t)})})})}):null}var xa=B(H()),cz=B(Qo());zt();N();fe();Ve();TI();oe();var d4=B($t());Eu();ro();var n4=B(pt());Bo();Du();var s4=e=>{let o=`mirror-${e.id}-${Date.now()}`,t=Object.create(e,{_listenId:{value:n4.default.uniqueId("l")},_events:{value:{},writable:!0},id:{value:o},mirroredId:{value:e.id},viewport:{value:"default",writable:!0},widgets_collection:{value:void 0,writable:!0},mirror:{value:!0},attributes:{value:new Proxy(e.attributes,{get(r,i){let n=`viewport_${t.viewport}`,s=t.viewport===e.getViewport();return i==="_id"||i==="hotspots_group_id"?o:s?r[i]:t.viewport!=="default"&&i in e[n]||Oe.viewport_fields_common.includes(i)?e[n][i]:i in e.viewport_default?e.viewport_default[i]:r[i]}})},getViewport:{value(){return this.viewport}},setViewport:{value(r){this.viewport=r}},get:{value(r){return this.attributes[r]}},set:{value(){return this}},sync:{value(){}},save:{value(){}},destroy:{value(r){t.stopListening(e),this.widgets_collection?.models.forEach(i=>i.destroy()),this.destroyed=!0,e.destroy.call(this,r)}},triggerReady:{value(){}}});return e.widgets_collection&&(t.widgets_collection=new Au(e.widgets_collection.models.map(r=>s4(r)),{parent_widget:t,page:t.collection.page})),t.listenTo(e,"all",function(r,i,n,s){/:/.test(r)&&!s?s={socketUpdate:!0}:s&&typeof s=="object"?s={...s,socketUpdate:!0}:typeof n=="object"&&(n={...n,socketUpdate:!0}),i?.id===t.mirroredId&&t.trigger(r,t,n,s)}),t},a4=s4;Fs();jt();Tk();oe();N();k();var lz=e=>a("svg",{viewBox:"0 0 20 12",xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{d:"M0 11h20v1H0v-1zM4 0h12a2 2 0 012 2v8H2V2a2 2 0 012-2z",fill:"currentColor",fillRule:"nonzero"})}),pz=f.withComponent(F(lz)`
      display: block;
    `),l4=pz;var Fb=B(H());jt();Ch();k();Jt();k();var zc=206,sg=138,p4=16,c4=e=>{let o=dt.calcBoundingBoxForBlock(e,!0,!1),t=dt.calcBoundingBoxForBlock(e,!0,!0),r=dt.getScaleToFit(t,{width:zc-p4*2,height:sg-p4*2}),i=Math.min(r,1),n=o.left+o.width/2-(t.left+t.width/2),s=o.top+o.height/2-(t.top+t.height/2);e.$el[0].style.setProperty("transform",`scale(${i}) translate(${n}px, ${s}px)`)},dz=F(f)`
  & > * {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    box-sizing: border-box;
    width: ${zc}px;
    height: ${sg}px;
    border-radius: 7px;
  }

  & > * > * {
    // position static           fixed-  .
    position: static !important;
    z-index: 0 !important;
    flex: none;
    margin: 0 !important;
  }
`,uz=()=>{let e=(0,xa.useRef)(null),{workspace:o,selectedBlocks:t,viewport:r,blocks:i,page:n,mag:s,eCommerceManager:l}=(0,xa.useContext)(qe),c=(0,xa.useContext)(Ct),d=t.length===1?t[0]:void 0,p=d?.model.get("hidden"),m=d?.model.viewport_default.hidden,u=()=>{o?.trigger("viewportShortcutPressed","default"),d?.scrollTo(),m?(d?.blink(),c?.togglePanel("stackpanel")):d&&d.selectFromWidgetBar()};return(0,xa.useEffect)(()=>{let g,h,b;if(r!=="default"&&d&&!p){let x=i.find(y=>y.model.attributes.type==="background")?.model;h=a4(d.model),h.setViewport("default");let S=new zu({page:n,mag:s,$container:(0,d4.default)(e.current),width:h.attributes.w,height:h.attributes.h,background:Pk({...x?.viewport_default,video:x?.attributes.video},{width:zc,height:sg}),eCommerceManager:l,viewport:r});g=new Eo[h.attributes.type](h,S),g.isStandalone=!0,g.autoRasterize=!1,g.$standaloneContainer=S.$el,g.render(),g.redrawPosition(g.model,{forceRedraw:!0}),c4(g),g.listenTo(h,"change change:w change:h change:angle change:blocks change:shadow",y=>{let C=y.changedAttributes(),P=()=>{g.redrawPosition(g.model,{forceRedraw:!0}),c4(g)};if(C){if(typeof C=="object"&&("h"in C||"w"in C||"angle"in C))P();else if(typeof C=="object"&&("blocks"in C||"style"in C||"entityMap"in C)){P();let v=g.model.attributes.h,T=g.model.attributes.entityMap;setTimeout(()=>{v!==g.model.attributes.h?P():g.model.attributes.type==="text"&&T!==g.model.attributes.entityMap&&g.refreshState()},1e3)}}else return}),(g.$el[0]?.querySelector(".frameborder")).style.setProperty("display","none")}return()=>{g?.stopListening(),g?.destroy(),h?.destroy(),b?.remove()}},[r,p,d,i,s,n]),w(q,{children:[d&&!p&&w(f,{position:"relative",width:zc,height:sg,boxShadow:"0 0 0 1px rgba(64, 64, 64, 0.08)",borderRadius:"8px",margin:"0 auto",children:[a(dz,{overflow:"hidden",ref:e}),m&&w(q,{children:[a(f,{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",borderRadius:"8px",backgroundColor:Le(.2,V.black)}),a(ul,{position:"absolute",top:0,bottom:0,right:0,left:0,margin:"auto",color:"white"})]})]}),a(f,{boxSizing:"content-box",display:"flex",width:zc,height:16,alignItems:"center",color:"darkGray",margin:"0 auto",padding:"12px 0 14px 0",children:d?w(q,{children:[a(l4,{"aria-label":"Switch to desktop",cursor:"pointer",onClick:u,width:20,height:12,css:ae`
                &:hover {
                  opacity: 0.8;
                }
              `}),a(ve,{textStyle:"small",margin:"0 0 0 8px",children:m?"Hidden on desktop":""})]}):null})]})};var u4=uz;Ds();var va=(e,o,t={},r={})=>{let i=co.extend(e),n=new i({propsData:t});n.$mount();for(let s of Object.keys(r))n.$on(s,r[s]);return o.appendChild(n.$el),n},Jr=e=>{e.$destroy(),e.$el.parentNode?.removeChild(e.$el)};cM();zt();Ve();je();qv();oe();N();k();var mz=e=>a("svg",{viewBox:"0 0 16 2",xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{d:"M.536 1.95a1 1 0 011-1h12.828a1 1 0 010 2H1.536a1 1 0 01-1-1z",fill:"currentColor",fillRule:"evenodd"})}),gz=f.withComponent(F(mz)`
      display: block;
    `),m4=gz;$e();vt();Be();Wo();Uo();Md();pr();k();var g4=["phone_portrait","tablet_portrait","default"],[hz]=lr({keyholeExpanded:sessionStorage.getItem("keyholeExpanded")==="true",autolayoutsExpanded:sessionStorage.getItem("autolayoutsExpanded")!=="false"});function h4({viewport:e,viewportWidth:o,selectMode:t,isActive:r,isHovered:i,disableHover:n,onRemoveDevice:s,onViewportWidthClick:l,onAddDevice:c,onDeviceClick:d,onMouseEnter:p,onMouseLeave:m,dataTestid:u,disableRemoveDevice:g,disableViewportWidth:h}){let{isHovered:b,...x}=Ke();function S(y){y.stopPropagation()}return w(f,{"aria-label":Ep[e.name],position:"relative",height:48,display:"flex",alignItems:"center",justifyContent:"flex-start",transition:".1s ease-in",padding:t?"0 16px":"0 8px",backgroundColor:!n&&(t||i||r)?"#E1E1E1":"transparent",borderRadius:8,marginBottom:t?4:0,onClick:r?void 0:t?c:d,cursor:!r||t?"pointer":void 0,role:"button",userSelect:"none",onMouseEnter:p,onMouseLeave:m,"data-testid":u,children:[a(f,{width:38,children:a(Ue,{variant:"clean",textStyle:"small",color:"gray",disabled:h,onClick:y=>{S(y),typeof l<"u"&&l(),typeof m<"u"&&m()},children:o})}),a(f,{width:61,display:"inline-flex",justifyContent:"center",children:a($u,{type:e.name})}),a(f,{flexGrow:1,display:"inline-flex",justifyContent:"flex-end",children:t?a(gt,{targetSteps:e.name==="phone_portrait"?"CreateLayoutSelect":void 0,indent:24,children:a(f,{color:i?"black":"gray",children:a(oc,{marginRight:-4})})}):e.name==="default"?a(ve,{textStyle:"small",color:"gray",children:"Primary"}):a(Ue,{color:b?"black":"gray",...x,disabled:g,variant:"unstyled","aria-label":"remove-viewport",onClick:y=>{typeof s<"u"&&(S(y),s())},children:a(m4,{width:"16px",height:"16px"})})})]})}function Nb({children:e,button:o,...t}){let{viewport:r,viewports:i,setViewport:n,page:s,workspace:l,selectedBlocks:c}=(0,Kt.useContext)(qe),{projectMag:d,currentPageNum:p}=(0,Kt.useContext)(ce),{currentPanel:m,openPanel:u}=(0,Kt.useContext)(Ct),[g,h]=(0,Kt.useState)(r),[b,x]=(0,Kt.useState)(!1),S=(0,Kt.useRef)(),[y,C]=(0,Kt.useState)(!1),[{step:P}]=el(),v=(0,Kt.useMemo)(()=>i.sort((ne,J)=>g4.indexOf(ne.name)-g4.indexOf(J.name)),[i]),T=v.every(ne=>ne.enabled),{isHovered:R,...I}=Ke(),[M,D]=(0,Kt.useState)(null),E=tl(),[A]=go(),[$,j]=hz(),pe=(0,Kt.useMemo)(()=>c?.length===1||!1,[c]),[ee,G]=(0,Kt.useState)(pe);function K(ne){D(null),(ne==="default"||s?.getViewportParam(ne,"enabled"))&&n(ne),ne==="phone_portrait"&&He("SwitchToMobileLayout")}function we(ne,J){D(null),J?(s?.setViewportParam(ne,"enabled",!0),n(ne)):(s?.setViewportParam(ne,"enabled",!1),ne===r&&n("default"));let{viewport_phone_portrait:X,viewport_tablet_portrait:Q}=s?.attributes||{},te=ne==="tablet_portrait"?{viewport_tablet_portrait:Q}:{viewport_phone_portrait:X};s?.save(te,{patch:!0}),ne==="phone_portrait"&&!E?se(he.ViewportFeature,{featureType:"mobile viewport"}):ne==="tablet_portrait"&&!E&&se(he.ViewportFeature,{featureType:"tablet viewport"})}let xe=ne=>{j({...$,keyholeExpanded:ne})},_e=ne=>{j({...$,autolayoutsExpanded:ne}),sessionStorage.setItem("autolayoutsExpanded",ne?"true":"false")};(0,Kt.useEffect)(()=>{pe?(xe(!0),G(!0)):(xe(!1),G(!1))},[pe]),(0,Kt.useEffect)(()=>{let ne=J=>{v.find(Q=>Q.name===J)?.enabled&&(u("viewports"),n(J))};return l?.on("viewportShortcutPressed",ne),()=>{l?.off("viewportShortcutPressed",ne)}},[l,v]),(0,Kt.useEffect)(()=>{r!==g&&h(r),r==="phone_portrait"&&He("CreateLayoutSelect")},[r]),(0,Kt.useEffect)(()=>{r!==g&&n(g)},[g]),(0,Kt.useEffect)(()=>{b||S.current&&Jr(S.current)},[b]),(0,Kt.useEffect)(()=>{let ne=v.filter(J=>J.enabled===!0);E&&m==="viewports"&&r==="default"&&P?.name==="CreateLayout"&&b&&ne.length===1&&He("CreateLayout"),E&&m==="viewports"&&r==="default"&&P?.name==="OpenMobileLayout"&&b&&ne.length===2&&He("OpenMobileLayout")},[b,m,r,v]),(0,Kt.useEffect)(()=>{E&&r==="default"&&P?.name==="CreateLayoutSelect"&&Nr("CreateLayoutSelect",{show:!b})},[b,r]);let ie=r==="phone_portrait"&&(m==="viewports"||m===void 0),ze=`page-${p}-${r}`;return a(Xt,{name:"viewports",button:o,skidding:28,alwaysOpen:ie,onToggle:ne=>{x(ne)},panelPosition:{height:"auto"},"data-testid":"viewport-panel",ArrowProps:{stroke:Le(.84,V.gray)},...t,children:({popoverShown:ne})=>(r==="phone_portrait"||ne)&&w(q,{children:[r!=="default"&&w(q,{children:[ee&&a(ng,{title:"This widget on desktop",expanded:$.keyholeExpanded,width:"100%",marginBottom:6,hideArrows:!0,boxShadow:`0 0 0 2px inset ${Le(.84,V.gray)}`,children:J=>J?a(u4,{}):void 0},"collapsiblePanel"),a(ng,{title:"Arrange widgets",expanded:$.autolayoutsExpanded,onToggle:_e,width:"100%",boxShadow:`0 0 0 2px inset ${Le(.84,V.gray)}`,children:J=>J?a(pk,{},ze):void 0})]}),y?a(f,{"aria-label":"New viewport select",children:v.map(J=>J.enabled?null:a(h4,{selectMode:!0,viewport:J,viewportWidth:d.getViewportWidth(J.name),dataTestid:`add-${J.name}-viewport-button`,onAddDevice:()=>{we(J.name,!0),C(!1),window.RM.constructorRouter.trigger("notice:triggerMetrics","viewportAdded")}},Ep[J.name]))}):null,w(f,{"aria-label":"Viewport panel",backgroundColor:"lightGray",borderRadius:"2rm",boxShadow:`0 0 0 2px inset ${Le(.84,V.gray)}`,display:ne?"block":"none",marginTop:6,children:[w(f,{display:"flex",justifyContent:"space-between",padding:"11px 15px 13px 15px",children:[w(f,{display:"flex",alignItems:"baseline",children:[a(ve,{textStyle:"subheading",children:"Devices"}),a(f,{marginLeft:"1rm",children:a(ve,{color:"gray",textStyle:"small",children:"(D)"})})]}),!T&&!y&&a(gt,{targetSteps:["CreateLayoutSelect"],indent:16,children:a(Ue,{"aria-label":"Add viewport",color:R?"black":"gray",...I,variant:"unstyled",onClick:()=>C(!y),"data-testid":"add-viewport",disabled:A,children:a(oc,{})})})]}),w(f,{padding:"0 8px 8px",children:[a(f,{position:"relative",top:24,children:a(gt,{position:"right",targetSteps:["SwitchToMobileLayout"],indent:16,children:a("div",{})})}),v.map(J=>{let X=r===J.name,Q=M===J.name;return J.enabled?a(h4,{isActive:X,isHovered:Q,disableHover:X&&M!==null&&!Q,viewport:J,viewportWidth:d.getViewportWidth(J.name),onDeviceClick:()=>K(J.name),onRemoveDevice:()=>we(J.name,!1),onMouseEnter:()=>D(J.name),onMouseLeave:()=>D(null),onViewportWidthClick:()=>u("guides"),dataTestid:`${J.name}-viewport-button`,disableRemoveDevice:A,disableViewportWidth:A},J.name):null})]})]})]})})}var oi=B(H());N();Jt();var Pi=B($t()),We=B(pt());je();Ds();var lye=B(pt()),f4=B(Wb());Array.from||(Array.from=function(e){return[].slice.call(e)});function fz(){function e(u){u.parentElement.removeChild(u)}function o(u,g,h){let b=h===0?u.children[0]:u.children[h-1].nextSibling;u.insertBefore(g,b)}function t(u,g){return u.map(h=>h.elm).indexOf(g)}function r(u,g,h){if(!u)return[];let b=u.map(S=>S.elm),x=[...g].map(S=>b.indexOf(S));return h?x.filter(S=>S!==-1):x}function i(u,g){this.$nextTick(()=>this.$emit(u.toLowerCase(),g))}function n(u){return g=>{this.realList!==null&&this["onDrag"+u](g),i.call(this,u,g)}}let s=["Start","Add","Remove","Update","End","TouchMove"],l=["Choose","Sort","Filter","Clone"],c=["Move",...s,...l].map(u=>"on"+u);var d=null;return{name:"draggable",props:{options:Object,onList:{type:Array,required:!1,default:null},value:{type:Array,required:!1,default:null},noTransitionOnDrag:{type:Boolean,default:!1},clone:{type:Function,default:u=>u},element:{type:String,default:"div"},move:{type:Function,default:null}},data(){return{transitionMode:!1,componentMode:!1}},render(u){let g=this.$slots.default;if(g&&g.length===1){let x=g[0];x.componentOptions&&x.componentOptions.tag==="transition-group"&&(this.transitionMode=!0)}let h=g,{footer:b}=this.$slots;return b&&(h=g?[...g,...b]:[...b]),u(this.element,null,h)},mounted(){if(this.componentMode=this.element.toLowerCase()!==this.$el.nodeName.toLowerCase(),this.componentMode&&this.transitionMode)throw new Error(`Transition-group inside component is not supported. Please alter element value or remove transition-group. Current element value: ${this.element}`);var u={};s.forEach(h=>{u["on"+h]=n.call(this,h)}),l.forEach(h=>{u["on"+h]=i.bind(this,h)});let g=Object.assign({},this.options,u,{onMove:(h,b)=>this.onDragMove(h,b)});!("draggable"in g)&&(g.draggable=">*"),this._sortable=new f4.default(this.rootContainer,g),this.computeIndexes(),this.$el._draggable=this},beforeDestroy(){this._sortable.destroy()},computed:{rootContainer(){return this.transitionMode?this.$el.children[0]:this.$el},isCloning(){return!!this.options&&!!this.options.group&&this.options.group.pull==="clone"},realList(){return this.list?this.list:this.value}},watch:{options:{handler(u){for(var g in u)c.indexOf(g)===-1&&this._sortable.option(g,u[g])},deep:!0},realList(){this.computeIndexes()}},methods:{doDrop(u,g){this._sortable&&this._sortable.forceDrop(u,g)},dropIntoGroup(u){this._sortable&&this._sortable.dropIntoGroup(u)},getChildrenNodes(){if(this.componentMode)return this.$children[0].$slots.default;let u=this.$slots.default;return this.transitionMode?u[0].child.$slots.default:u},computeIndexes(){this.$nextTick(()=>{this.visibleIndexes=r(this.getChildrenNodes(),this.rootContainer.children,this.transitionMode)})},getUnderlyingVm(u){let g=t(this.getChildrenNodes()||[],u);if(g===-1)return null;let h=this.realList[g];return{index:g,element:h}},getUnderlyingPotencialDraggableComponent({__vue__:u}){return!u||!u.$options||u.$options._componentTag!=="transition-group"?u:u.$parent},emitChanges(u){this.$nextTick(()=>{this.$emit("change",u)})},alterList(u){this.list?u(this.list):(this.alteredList||(this.alteredList=[...this.value]),u(this.alteredList),this.$nextTick(()=>{this.alteredList&&(this.$emit("input",[...this.alteredList]),this.alteredList=null)}))},spliceList(){let u=g=>g.splice(...arguments);this.alterList(u)},updatePosition(u,g){let h=b=>b.splice(g,0,b.splice(u,1)[0]);this.alterList(h)},getRelatedContextFromMoveEvent({to:u,related:g}){let h=this.getUnderlyingPotencialDraggableComponent(u);if(!h)return{component:h};let b=h.realList,x={list:b,component:h};if(u!==g&&b&&h.getUnderlyingVm){let S=h.getUnderlyingVm(g);if(S)return Object.assign(S,x)}return x},getVmIndex(u){let g=this.visibleIndexes,h=g.length;return u>h-1?h:g[u]},getComponent(){return this.$slots.default[0].componentInstance},resetTransitionData(u){if(!this.noTransitionOnDrag||!this.transitionMode)return;var g=this.getChildrenNodes();g[u].data=null;let h=this.getComponent();h.children=[],h.kept=void 0},onDragTouchMove(u){u.data.draggedContext=this.getUnderlyingVm(u.data.dragEl),u.data.nextDraggedContext=this.getUnderlyingVm(u.data.next),u.data.prevDraggedContext=this.getUnderlyingVm(u.data.prev),u.data.sortable=this,this.$emit("touchMove",u,u.item)},onDragStart(u){this.context=this.getUnderlyingVm(u.item),u.item._underlying_vm_=this.clone(this.context.element),u.context=this.context,d=u.item},onDragAdd(u){let g=u.item._underlying_vm_;if(u.data&&u.data.context&&(g=u.data.context.element),g===void 0)return;e(u.item);let h=this.getVmIndex(u.newIndex);this.alteredList&&u.data&&u.data.prevContext&&(h=this.alteredList.indexOf(u.data.prevContext.element)+1),this.spliceList(h,0,g),this.computeIndexes();let b={element:g,newIndex:h};this.emitChanges({added:b})},onDragRemove(u){if(o(this.rootContainer,u.item,u.oldIndex),this.isCloning){e(u.clone);return}let g=this.context&&this.context.index;u.data&&u.data.context&&(g=this.alteredList?this.alteredList.indexOf(u.data.context.element):this.value.indexOf(u.data.context.element));let h=this.context&&this.context.element;u.data&&u.data.context&&(h=u.data.context.element),this.spliceList(g,1);let b={element:h,oldIndex:g};this.resetTransitionData(g),this.emitChanges({removed:b})},onDragUpdate(u){e(u.item),u.data.camebackTo?u.data.camebackTo.before?u.data.camebackTo.parent.insertBefore(u.item,u.data.camebackTo.before):u.data.camebackTo.parent.appendChild(u.item):o(u.from,u.item,u.oldIndex);let g=this.context.index;u.data&&u.data.context&&(g=this.alteredList?this.alteredList.indexOf(u.data.context.element):this.value.indexOf(u.data.context.element));let h=this.getVmIndex(u.newIndex);this.alteredList&&u.data&&u.data.prevContext&&(h=this.alteredList.indexOf(u.data.prevContext.element),h<g&&h++);let b=this.context.element;u.data&&u.data.context&&(b=u.data.context.element),this.updatePosition(g,h);let x={element:b,oldIndex:g,newIndex:h};this.emitChanges({moved:x})},computeFutureIndex(u,g){if(!u.element)return 0;let h=[...g.to.children].filter(y=>y.style.display!=="none"),b=h.indexOf(g.related),x=u.component.getVmIndex(b);return h.indexOf(d)!==-1||!g.willInsertAfter?x:x+1},onDragMove(u,g){let h=this.move;if(!h||!this.realList)return!0;let b=this.getRelatedContextFromMoveEvent(u),x=this.context,S=this.computeFutureIndex(b,u);return Object.assign(x,{futureIndex:S}),Object.assign(u,{relatedContext:b,draggedContext:x}),u.draggable=this,h(u,g)},onDragEnd(u){this.computeIndexes(),d=null}}}}var Jl=fz();Ds();var Gb=B(pt());var Vb=B($t());Ds();var Ub=B(pt());Cu();of();var bz={components:{PermissionController:hl},inject:["layerList"],props:["widget","group","fakeLayer","isNotVisible"],data:function(){return Object.assign({w_name:"",tmpName:"",locked:!!this.widget.model.get("is_locked"),viewportIcon:"no",noHoverButtons:!1,editable:!1,isDragOver:!1,isGlobal:!1},{hidden:this.widget.model.get("hidden")})},computed:Object.assign({selected:function(){return this.widget.selected},customName:function(){return this.widget.model.get("name")},_id:function(){return this.widget.model&&this.widget.model.get("_id")||""},stdName:function(){return this.widget.getStandardName()},icon_style:function(){return this.widget.getIconStyle()},isLoading:function(){return this.widget.isLoading},rawSvg:function(){let e="",o=this.widget.getIconData&&this.widget.getIconData()||this.iconData;return o&&o.$svg&&(e='<div class="container">'+o.$svg.clone().get(0).outerHTML+"</div>"),e}},{}),watch:Object.assign({locked:function(e){this.widget.model.get("is_locked")!=e&&this.widget.model.save("is_locked",e)}},{hidden:function(e){this.widget.model.get("hidden")!=e&&this.widget.workspace.save_group([{_id:this.widget.model.get("_id"),hidden:e}])}}),created:function(){co.set(this.widget,"iconData",this.widget.iconData||null),co.set(this.widget,"selected",this.widget.selected||!1),co.set(this.widget,"$svg",this.widget.$svg||null),co.set(this.widget.model.attributes,"type",this.widget.model.attributes.type||""),co.set(this.widget.model.attributes,"name",this.widget.model.attributes.name||""),this.layerList&&!this.fakeLayer&&(this.layerList[this.widget.model.attributes._id]=this),this.widget.model.attributes.type=="shape"&&co.set(this.widget.model.attributes,"tp",this.widget.model.attributes.tp||""),this.widget.model.attributes.type=="text"&&co.set(this.widget.model.attributes,"text",this.widget.model.attributes.text||"")},mounted:function(){this.$s=this.$refs.editable,this.$s.onkeydown=this.onkeydown,this.locked=!!this.widget.model.get("is_locked"),this.isGlobal=!!this.widget.model.get("is_global"),this.widget.model.on("change:hidden",this.onHiddenChanged),this.widget.model.on("change:is_locked",this.onLockedChanged),this.widget.model.on("change:is_global",this.onGlobalChanged),this.widget.bindUploader instanceof Function&&(this._uploader=new Yn(this.widget,{fileInput:(0,Vb.default)(this.$refs.fileinput),dropZone:(0,Vb.default)(this.$el),unique:!0}),this._uploader.on("drop dragleave",()=>{this.isDragOver=!1}),this._uploader.on("dragover",()=>{this.isDragOver=!0}),this.widget.bindUploader(this._uploader)),this.widget.workspace.page.on("change:viewport",this.onChangeViewport),this.onChangeViewport()},destroyed:function(){this._uploader&&this._uploader.destroy(),this.widget.model.off("change:hidden",this.onHiddenChanged),this.widget.model.off("change:is_locked",this.onLockedChanged)},updated:function(){this.layerList&&!this.fakeLayer&&(this.layerList[this.widget.model.attributes._id]=this)},methods:{onChangeViewport:function(){let e=this.widget.workspace.viewport,o=this.widget.workspace.page.getViewportParam("phone_portrait","enabled");return e==="default"&&o&&!(this.widget.model.viewport_phone_portrait&&this.widget.model.viewport_phone_portrait.hidden)?this.viewportIcon="phone_portrait":e==="phone_portrait"&&!(this.widget.model.viewport_default&&this.widget.model.viewport_default.hidden)?this.viewportIcon="default":e==="tablet_portrait"&&!(this.widget.model.viewport_default&&this.widget.model.viewport_default.hidden)?this.viewportIcon="default":this.viewportIcon="no",this.viewportIcon},switchToViewport:function(e){this.viewportIcon!=="no"&&(this.widget.workspace.trigger("viewportShortcutPressed",this.viewportIcon),this.widget.selected?this.$emit("onWidgetSelect",this.widget,e):this.widget.scrollTo())},layerDblClick:function(){this.$emit("onWidgetDblClick")},layerClick:function(e){e.target==this.$refs.lock||e.target==this.$refs.hide||e.target==this.$refs.vp_icon||e.target==this.$refs.editable&&this.editable||this.$el.cooldown&&this.$el.cooldown>+new Date||this.$emit("onWidgetSelect",this.widget,e)},onHiddenChanged:function(e){this.hidden=e.get("hidden")},onLockedChanged:function(e){this.locked=e.get("is_locked")},onGlobalChanged:function(e){this.isGlobal=e.get("is_global")},rename:function(e){if(this.editable){e.preventDefault(),e.stopPropagation();return}if(this.$emit("changeEditState",!0),this.widget.model.get("type")=="background")return!1;this.editable=!0,Ub.default.delay(()=>{this.$refs.editable.focus()},50)},onkeydown:function(e){if(e.keyCode==13)return e.preventDefault(),this.$s.blur(),!1;if(e.keyCode==27)return this.$s.innerText=this.stdName||this.customName,this.editable=!1,e.preventDefault(),!1},onblur:function(){this.widget.model.save("name",this.$refs.editable.innerText.trim()),this.editable=!1,this.$emit("changeEditState",!1)},editableFocus:()=>{Ub.default.defer(()=>{document.execCommand("selectAll",!1,null)})}}},wz=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"layer",class:{selected:e.widget.selected,hidden:e.hidden,locked:e.locked,"is-global":e.isGlobal,"not-visible":e.isNotVisible},attrs:{"aria-label":"Layer","data-id":e._id,"layer-id":e._id},on:{dblclick:e.layerDblClick,click:function(r){return r.stopPropagation(),e.layerClick(r)}}},[t("div",{ref:"icon",staticClass:"icon",class:{preloader:e.isLoading,replace:e.isDragOver},style:e.icon_style,domProps:{innerHTML:e._s(e.rawSvg)}}),e._v(" "),t("div",{staticClass:"w_name"},[t("span",{ref:"editable",class:{editable:e.editable},attrs:{contenteditable:e.editable},on:{focus:e.editableFocus,dblclick:e.rename,click:function(r){e.widget.selected&&e.rename(r)},blur:e.onblur}},[e._v(e._s(e.customName||e.stdName))])]),e._v(" "),t("input",{ref:"fileinput",attrs:{name:"upload",type:"file","data-url":"/api/upload/lambda/"}}),e._v(" "),t("i",{ref:"vp_icon",staticClass:"viewport_icon",class:[e.viewportIcon+"_icon",{"no-hover":e.noHoverButtons}],attrs:{"aria-label":"Viewport"},on:{click:function(r){return e.switchToViewport(r)},mouseleave:function(r){e.noHoverButtons=!1}}}),e._v(" "),t("permission-controller",{attrs:{permission:"BaseWidgetCanHide"}},[t("div",{ref:"hide",staticClass:"hide",class:{active:e.hidden,"no-hover":e.noHoverButtons},attrs:{"aria-label":"Visibility toggle"},on:{click:function(r){e.noHoverButtons=!0,e.hidden=!e.hidden},mouseleave:function(r){e.noHoverButtons=!1}}})]),e._v(" "),t("permission-controller",{attrs:{permission:"BaseWidgetCanLock"}},[t("div",{ref:"lock",staticClass:"lock",class:{active:e.locked,"no-hover":e.noHoverButtons},attrs:{"aria-label":"Lock"},on:{click:function(r){e.noHoverButtons=!0,e.locked=!e.locked},mouseleave:function(r){e.noHoverButtons=!1}}})]),e._v(" "),t("div",{staticClass:"ph"})],1)},xz=[],vz=void 0,yz=void 0,kz=void 0,_z=!1;function Sz(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="layer.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var Cz=Sz({render:wz,staticRenderFns:xz},vz,bz,yz,_z,kz,!1,void 0,void 0,void 0),lg=Cz;var Pz={props:["group","expanded","noArrow"],methods:{iconstyle:function(e){return this.group[e].getIconStyle&&this.group[e].getIconStyle({small:!0})||""},toggleExpand:function(){this.$emit("click")},rawSvg:function(e){let o="",t=this.group[e].iconData||this.group[e].getIconData&&this.group[e].getIconData();return t&&t.$svg&&(o='<div class="container">'+t.$svg.clone().get(0).outerHTML+"</div>"),o}}},Tz=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"groupicon",class:{"no-arrow":e.noArrow},on:{click:e.toggleExpand}},[t("div",{staticClass:"icon-wrapper"},[e.group.length==2?t("div",{staticClass:"tilegrid two"},[t("div",{staticClass:"tile",style:e.iconstyle(0),domProps:{innerHTML:e._s(e.rawSvg(0))}}),e._v(" "),t("div",{staticClass:"tile",style:e.iconstyle(1),domProps:{innerHTML:e._s(e.rawSvg(1))}})]):e.group.length==3?t("div",{staticClass:"tilegrid three"},[t("div",{staticClass:"tile",style:e.iconstyle(0),domProps:{innerHTML:e._s(e.rawSvg(0))}}),e._v(" "),t("div",{staticClass:"tilegrid"},[t("div",{staticClass:"tile",style:e.iconstyle(1),domProps:{innerHTML:e._s(e.rawSvg(1))}}),e._v(" "),t("div",{staticClass:"tile",style:e.iconstyle(2),domProps:{innerHTML:e._s(e.rawSvg(2))}})])]):e.group.length>=4?t("div",{staticClass:"tilegrid four"},[t("div",{staticClass:"tile",style:e.iconstyle(0),domProps:{innerHTML:e._s(e.rawSvg(0))}}),e._v(" "),t("div",{staticClass:"tile",style:e.iconstyle(1),domProps:{innerHTML:e._s(e.rawSvg(1))}}),e._v(" "),t("div",{staticClass:"tile",style:e.iconstyle(2),domProps:{innerHTML:e._s(e.rawSvg(2))}}),e._v(" "),t("div",{staticClass:"tile",style:e.iconstyle(3),domProps:{innerHTML:e._s(e.rawSvg(3))}})]):e._e()]),e._v(" "),e.noArrow?e._e():t("svg",{ref:"expand",staticClass:"grouptriangle",class:{expanded:e.expanded},attrs:{width:"9px",height:"6px",viewBox:"0 0 9 6",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},on:{click:function(r){e.$emit("expand",r)}}},[t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("path",{attrs:{id:"expand-icon",d:"M6.70324633,2.40243474 C7.14328123,2.73246092 7.14264107,3.2680192 6.70324633,3.59756526 L2.29675367,6.90243474 C1.85671877,7.23246092 1.5,7.0536886 1.5,6.50245535 L1.5,-0.502455354 C1.5,-1.05338405 1.85735893,-1.2319808 2.29675367,-0.902434744 L6.70324633,2.40243474 Z",fill:"#FFFFFF",transform:"translate(4.500000, 3.000000) rotate(-270.000000) translate(-4.500000, -3.000000) "}})])])])},Iz=[],Mz=void 0,Bz=void 0,Rz=void 0,zz=!1;function Ez(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="group_icon.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var Az=Ez({render:Tz,staticRenderFns:Iz},Mz,Pz,Bz,zz,Rz,!1,void 0,void 0,void 0),b4=Az;of();vt();var w4=(e=[])=>e.filter(o=>o.selected).length===1&&e.length>1,Lz={components:{Layer:lg,GroupIcon:b4,Draggable:Jl,PermissionController:hl},inject:["layerList"],props:{widget:{},group:null,onTouchMove:null,onMoveGhost:null,noArrow:!1,fakeGroup:!1,noDragndrop:!1,isNotVisible:Boolean,filterPredicate:{type:Function,default:()=>!1}},data:function(){return{hidden:!1,editable:!1,draggableDisabled:!1,expanded:w4(this.widget.widgets)}},computed:{layerClasses:function(){return{fold:!this.expanded,selected:this.selected&&!this.widget.hovered,hidden:this.hidden,expanded:this.expanded,groupHidden:this.groupHidden,groupLocked:this.groupLocked,"not-visible":this.isNotVisible}},selected:function(){let e=!0;return Gb.default.each(this.widget.widgets,function(o){e=e&&o.selected}),e},oneWidgetSelected(){return w4(this.widget.widgets)},groupHidden:{get:function(){return this.widget.widgets.every(e=>e.model.get("hidden"))},set:function(){this.groupSave({hidden:!this.groupHidden})}},groupLocked:{get:function(){return this.widget.widgets.every(e=>e.model.get("is_locked"))},set:function(){this.groupSave({is_locked:!this.groupLocked})}},hasGlobalW:{get:function(){return this.widget.widgets.some(e=>e.model.get("is_global"))}},name:{get:function(){return this.group_model?this.group_model.get("name"):this.widget.groupName||"Group"},set:function(e){this.group_model||(this.group_model=new la({pack_id:this._id,mid:this.widget.widgets[0].workspace.mag.id})),this.group_model.save("name",e);let o=this.packs_data.find(t=>t.pack_id==this._id);o?o.name=e:this.packs_data.push(this.group_model.toJSON())}},_id:function(){return this.widget.pack_id},pack_id:function(){return"pack "+this._id},packs_data:function(){return this.widget.widgets[0].workspace.mag.attributes.packs},order:function(){return this.widget.sort(e=>-Number(e.model.get("z"))).map(e=>e.model.get("_id"))}},watch:{oneWidgetSelected(){this.expanded=!0}},created:function(){let e=this.packs_data&&this.packs_data.find(o=>o.pack_id==this._id);e&&(this.group_model=new la(e))},mounted:function(){this.$s=this.$refs.editable,this.$s&&(this.$s.onkeydown=this.onkeydown)},updated:function(){this.layerList&&(this.layerList[this.widget.pack_id]=this)},methods:{onMove:function(e){this.$emit("onMove",e)},onEnd:function(e){this.$emit("end",e)},layerClick:function(e){if((e.target.nearestViewportElement||e.target)!=this.$refs.groupicon.$refs.expand&&!(e.target==this.$refs.editable&&this.editable)){if(!this.selected){let t=this.widget.widgets[0].getPack();t&&t.scrollTo(),this.widget.widgets[0].selectFromWidgetBar(e,!0)}this.selected&&!this.groupHidden&&(Nr("MobileMenuVisible",{show:!1}),He("MobileMenuVisible"))}},toggleExpand:function(){let e=JSON.parse(window.sessionStorage.getItem("groupsState")||"{}");this.expanded=!this.expanded,e[this.widget.pack_id]=this.expanded,window.sessionStorage.setItem("groupsState",window.JSON.stringify(e)),this.$emit("expandChanged"),this.expanded&&He("ClickOnTriangleToOpenGroup")},reorder:function(){co.nextTick(()=>this.$emit("reorder"))},rename:function(){this.editable=!0,this.$emit("changeEditState",!0),Gb.default.delay(()=>{this.$s.focus()},50)},onblur:function(){this.editable=!1,this.$emit("changeEditState",!1),this.name=this.$refs.editable.innerText.trim()},onkeydown:function(e){if(e.keyCode==13)return e.preventDefault(),this.$s.blur(),!1;if(e.keyCode==27)return this.$s.innerText=this.name,this.editable=!1,e.preventDefault(),!1},ondragstart:function(e){this.$emit("start",e)},groupSave:function(e){let o=this.widget.widgets.map(t=>Object.assign({_id:t.model.get("_id")},e));this.widget.widgets[0].workspace.save_group(o)},onHideClick:function(){this.selected?He("MobileMenuVisible"):(Hd(["MobileMenuVisible"]),Nr("MobileMenuVisible",{show:!0})),this.groupHidden=!this.groupHidden,this.groupHidden&&He("DeleteVisibleMobileMenu")}}},Dz=function(){var e=this,o=e.$createElement,t=e._self._c||o;return e.widget.widgets.length==1?t("layer",{attrs:{"fake-layer":e.fakeGroup,widget:e.widget.widgets[0]},on:{onWidgetSelect:function(r,i){e.$emit("onWidgetSelect",r,i)}}}):e.widget.widgets.length>0?t("div",{staticClass:"group_layer layer",class:e.layerClasses,attrs:{"layer-id":e.pack_id},on:{click:e.layerClick}},[e.widget.widgets.length>1?t("div",{staticClass:"head",class:{hovered:e.widget.hovered,"has-global-w":e.hasGlobalW}},[t("group-icon",{ref:"groupicon",attrs:{group:e.widget.widgets,"no-arrow":e.noArrow,expanded:e.expanded},on:{expand:e.toggleExpand}}),e._v(" "),t("div",{staticClass:"w_name group_name"},[t("span",{ref:"editable",class:{editable:e.editable},attrs:{contenteditable:e.editable,onfocus:"document.execCommand('selectAll',false,null)"},on:{dblclick:e.rename,click:function(r){e.selected&&e.rename()},blur:e.onblur}},[e._v(e._s(e.name))])]),e._v(" "),t("div",{staticClass:"icons-container"},[t("permission-controller",{attrs:{permission:"BaseWidgetCanHide"}},[t("div",{ref:"hide",staticClass:"hide",on:{click:function(r){return r.stopPropagation(),e.onHideClick(r)}}})]),e._v(" "),t("permission-controller",{attrs:{permission:"BaseWidgetCanLock"}},[t("div",{ref:"lock",staticClass:"lock",on:{click:function(r){r.stopPropagation(),e.groupLocked=!e.groupLocked}}})])],1)],1):e._e(),e._v(" "),t("div",{staticClass:"group_container",class:{active:e.expanded}},[t("draggable",{staticClass:"draggable-container in-group-draggable",attrs:{move:function(r){e.$emit("move",r)},options:{moveByBlock:!0,disabled:e.noDragndrop||e.draggableDisabled,onMoveGhost:e.onMoveGhost,relParent:"sortable_relparent",denyX:!0,forceFallback:!0,group:e.group,animation:200,delay:20,onMove:e.onMove,onEnd:e.onEnd}},on:{start:e.ondragstart,touchMove:e.onTouchMove,onEnd:e.onEnd,end:e.onEnd},model:{value:e.widget.widgets,callback:function(r){e.$set(e.widget,"widgets",r)},expression:"widget.widgets"}},[e._l(e.widget.widgets,function(r){return[r.model?t("layer",{key:r.attributes._id,staticClass:"inpack",attrs:{"fake-layer":e.fakeGroup,widget:r,"is-not-visible":!e.filterPredicate(r)},on:{onWidgetDblClick:function(i){return e.$emit("onWidgetDblClick")},changeEditState:function(i){e.draggableDisabled=i,e.$emit("changeEditState",i)},onWidgetSelect:function(i,n){e.$emit("onWidgetSelect",i,n)}}}):e._e()]})],2)],1)]):t("div")},Oz=[],$z=void 0,Hz=void 0,Fz=void 0,Nz=!1;function Wz(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="layers_group.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var Vz=Wz({render:Dz,staticRenderFns:Oz},$z,Lz,Hz,Nz,Fz,!1,void 0,void 0,void 0),jb=Vz;ui();Ck();var Uz={props:["widget"],computed:{selected:function(){return this.widget.selected},w_name:function(){return et.capitalize(this.widget.model.get("type"))},isPack:function(){return!1},icon_style:function(){return this.widget.getIconStyle()},hasVideo:function(){return this.widget.model&&this.widget.model.get("selectedType")==="video"?!!Sk(this.widget.model.attributes):!1}},mounted:function(){this.widget.on("select",this.select)},beforeDestroy:function(){this.widget.off("select",this.select)},methods:{select:function(){this.$emit("select")}}},Gz=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"layer bg"},[t("div",{staticClass:"icon",class:{video:e.hasVideo},style:e.icon_style}),e._v(" "),t("div",{staticClass:"w_name"},[e._v(e._s(e.w_name))])])},jz=[],qz=void 0,Yz=void 0,Xz=void 0,Kz=!1;function Zz(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="background_icon.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var Jz=Zz({render:Gz,staticRenderFns:jz},qz,Uz,Yz,Kz,Xz,!1,void 0,void 0,void 0),x4=Jz;var Qz={},eE=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"grid_guides_layer layer",on:{click:function(r){return e.$emit("click")}}},[t("div",{staticClass:"icon"}),e._v(" "),t("div",{staticClass:"w_name"},[e._v("Grid & Guides")])])},tE=[],oE=void 0,rE=void 0,iE=void 0,nE=!1;function sE(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="grid_guides_icon.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var aE=sE({render:eE,staticRenderFns:tE},oE,Qz,rE,nE,iE,!1,void 0,void 0,void 0),v4=aE;Ky();Ho();of();vt();var qb=B(jp()),k4=B(H());oe();qa();Jh();fe();rc();N();je();k();var lE=F(f)`
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  margin: 0;
  width: 24px;
  height: 24px;
  border: none;
  border-radius: 50%;
  background-color: transparent;
  cursor: pointer;
  color: ${e=>e.theme.colors.gray};

  ${e=>e.isActive&&ae`
      background-color: ${e.theme.colors.blue};
      color: white;
    `};

  &:hover,
  &:active,
  &:focus {
    background-color: ${e=>e.theme.colors.blue};
    color: white;
  }
`,y4=F(ve)`
  &:hover {
    color: ${e=>e.theme.colors.black};
  }
`,Yb=({actions:e,container:o,workspace:t,isActive:r=!1})=>{let i=o(),[n,s]=(0,k4.useState)(!1);function l(m){m.stopPropagation(),s(!1)}function c(){let u=t.blocks.filter(g=>g.model.get("type")!=="background").filter(g=>{let h=g.model;if(h.get("is_global"))return window.RM.constructorRouter.mag.pages.models.every(C=>{let P=C.get("_id"),v=h.clone({viewport:"default",pageId:P}),T=h.clone({viewport:"phone_portrait",pageId:P}),R=h.clone({viewport:"tablet_portrait",pageId:P});return v.get("hidden")&&T.get("hidden")&&R.get("hidden")});let b=h.clone({viewport:"default"}),x=h.clone({viewport:"phone_portrait"}),S=h.clone({viewport:"tablet_portrait"});return b.get("hidden")&&x.get("hidden")&&S.get("hidden")});se(he.SettingsLayers,{settingsType:"delete all unused"}),t.deleteBlocks(u,{forceRemove:!0})}let p={title:n?w(f,{height:"24px",display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"3px",children:[a(y4,{role:"button",color:"tomato",textStyle:"small",onClick:c,children:"Remove"}),a(y4,{role:"button",color:"darkGray",textStyle:"small",onClick:l,children:"Cancel"})]}):"Remove unused",hoverVariant:Zh.danger,activeVariant:Zh.danger,active:n,onClick:m=>{n||(m.stopPropagation(),s(!0))}};return a(ml,{minWidth:240,popperOffset:[-84,28],listItems:[...e,p],container:i,onToggleDropdown:m=>{m||s(!1)},children:({toggleDropdown:m})=>a(lE,{as:"button",type:"button",isActive:r,"aria-label":"Layer filter","aria-haspopup":"true",onClick:m,children:a(Tr,{})})})},_4=({props:e,rootElement:o})=>{let t=(0,qb.createRoot)(o);function r(n){t.render(a(Fr,{withGlobalStyles:!1,children:a(Yb,{...e,...n})}))}function i(n){t.unmount(),t=(0,qb.createRoot)(o),r(n)}return r(),{render:r,rerender:i}};yr();ro();var fo={height:56,indentationWidth:16},ji={height:26},ya={height:2,middle:1},cg=2,S4=new Map([["aboveAll",["aboveAll"]],["frontFixed",["frontFixed","backFixed"]],["normal",["normal"]],["backFixed",["frontFixed","backFixed"]]]),Xb="layer-filter-value";Zx();function ug(e,o){return!e||!o?!1:S4.get(e)?.includes(o)}function yn(e,o,t){let r=[o],i=e.get(o),n=i&&i.children||[],s=l=>{for(let c of l)if(c.parentId&&r.includes(c.parentId)){if(c.type==="group"){let d=e.get(c.id);d&&(r.push(c.id),d?.children&&s(d?.children))}t(c)}};s(n)}function mg(e,o){if(!o)return 0;let t=(r,i=1)=>{let n=e.get(r);if(n){let s=n.parentId;return s?t(s,i+1):i}else return i};return t(o)}function ka(e,o){let t=o.map(r=>r?.model);switch(e){case"all":return!0;case"links":return cE(t);case"viewport":return pE(t);default:return!0}}function pE(e){return e.some(o=>!o.get("hidden"))}function cE(e){return e.some(o=>{if(o.get("clickLink"))return!0;if(o.get("type")==="text"){let t=Object.values(o.get("entityMap")??{});for(let r of t)if(r.type===Rd)return!0}})}function gg(){try{return window.sessionStorage.getItem(Xb)}catch(e){console.log(e)}}function hg(e){try{window.sessionStorage.setItem(Xb,e)}catch(o){console.log(o)}}var Kb=B(Mo());Zx();function Zb(e){return e instanceof Kb.default.View?!e.model.get("hidden"):Array.isArray(e.widgets)?e.widgets.some(o=>Zb(o)):!1}function Jb(e){if(!(e instanceof Kb.default.View))return Array.isArray(e.widgets)?e.widgets.some(o=>Jb(o)):!1;if(e.model.attributes.clickLink)return!0;if(e.model.get("type")==="text"){let o=Object.values(e.model.get("entityMap")??{});for(let t of o)if(t.type===Rd)return!0}return!1}var dE={filtersRoot:null,components:{Layer:lg,BackgroundIcon:x4,GuidesIcon:v4,GroupLayers:jb,Draggable:Jl,RmScroll:Tu,PermissionController:hl,HelpTourTooltip:Ni},props:{workspace:Object,showGuidePanel:{type:Boolean,default:!0},dark:Boolean},data:function(){return{showCounter:25,layers:{above_all:[],fixed_top:[],regular:[],fixed_bottom:[]},lastPercent:0,draggedFixed:"",fixedOverRegular:!1,mark_draggable:"",groupDrag:!1,boundTop:"",scrollOversizeTop:0,scrollOversizeBottom:0,oversize:"",draggableDisabled:!1,_groupsData:{},draggedItems:[],indrag:!1,helpTourStep:"SelectGrids",helpTourStepBackground:"OpenBackgroundLayer",filter:gg()??"all"}},beforeCreate:function(){this.onIndexChange__debounced=We.default.debounce(()=>{this.onIndexChange()},10)},mounted:function(){this._scroll=this.$refs.rmscroll,window.addEventListener("resize",this.updateScroll),Re.on("index:changed",this.onIndexChange__debounced),this.renderReactHeaderActions()},provide:function(){return this._layerList={},{layerList:this._layerList}},destroyed:function(){Re.off("index:changed",this.onIndexChange__debounced),this.workspace.page.off("change:viewport",this.onIndexChange),this.workspace.off("select",this.onSelect),window.removeEventListener("resize",this.updateScroll)},updated:function(){this.updateScroll()},methods:{getHeightScrolledContent(){return this._scroll&&this._scroll.$refs.scrollWrapper?(0,Pi.default)(this._scroll.$refs.scrollWrapper).height():"auto"},renderReactHeaderActions(){let e=this.getFilterActions(),o=this.filter!=="all",t=this.workspace;if(!this.$options.filtersRoot){let r=this.$refs.react_filters,i=()=>this.$refs.stack_panel;r&&(this.$options.filtersRoot=_4({rootElement:r,props:{container:i,actions:e,isActive:o,workspace:t}}));return}this.$options.filtersRoot.rerender({actions:e,isActive:o,workspace:t})},getFilterActions(){let e=this.filter,o;switch(this.workspace.getViewports().find(r=>r.isCurrent===!0)?.name){case"default":o="Show desktop widgets only";break;case"phone_portrait":o="Show mobile widgets only";break;case"tablet_portrait":o="Show tablet widgets only";break}return[{title:"Show all",onClick:()=>this.setFilterAndUpdateReact("all"),active:e==="all"},{title:o,onClick:()=>this.setFilterAndUpdateReact("viewport"),active:e==="viewport"},{title:"Show layers with links",onClick:()=>this.setFilterAndUpdateReact("links"),active:e==="links"}]},setFilterAndUpdateReact(e){if(e==="links"&&se(he.SettingsLayers,{settingsType:"show only with links"}),e==="viewport"&&se(he.SettingsLayers,{settingsType:"show current viewport"}),this.filter==="all"&&e!=="all"){let o=(0,Pi.default)(this._scroll.$refs.scrollWrapper);o.css("min-height",o.height())}this.filter=e,this.renderReactHeaderActions(),hg(e)},onGuidesClick:function(){this.$emit("showPanel","guides"),He("SelectGrids")},onPanelScroll:function(e){this.showCounter>this.layersCount||e.scroll_event&&(this.showCounter+=Math.ceil(Math.abs(e.scroll_percent-this.lastPercent)*e.content_size/50)+10,this.lastPercent=e.scroll_percent)},caption:function(e){return{above_all:"Fixed on all pages",fixed_top:"Front Fixed",regular:"Widgets",fixed_bottom:"Back Fixed"}[e]},needLine:function(e){for(var o=We.default.keys(this.filteredLayers),t=o.indexOf(e),r=!1,i=t+1;i<o.length;i++)this.layers[o[i]].length&&(r=!0);return r},layer_type:function(e){return We.default.isArray(e.widgets)?"group-layers":"layer"},getBlocks:function(){return(0,We.default)(this.workspace.blocks).chain().filter(e=>e.model.get("type")!="background").sortBy(e=>-e.model.get("z")).value()},fFlatten:function(e,o=!1,t=!1){for(var r=[],i=0;i<e.length;i++)e[i].widgets&&(!o||e[i].expanded)?(t&&r.push(e[i]),r=r.concat(e[i].widgets)):r.push(e[i]);return r},onWidgetDblClick:function(){We.default.defer(()=>{this.workspace.controls.selectSettingsControl()})},onWidgetSelect:function(e,o){if(o.shiftKey&&this.lastWidget){var t=[].concat(this.fFlatten(this.layers.above_all),this.fFlatten(this.layers.fixed_top),this.fFlatten(this.layers.regular),this.fFlatten(this.layers.fixed_bottom)),r=t.indexOf(e),i=t.indexOf(this.lastWidget),n=We.default.chain(t.slice(Math.min(r,i),Math.max(r,i)+1)).reduce((s,l)=>{var c=l.model.get("pack_id");if(!c)s.push(l);else{var d=s[s.length-1];d instanceof Array&&d[d.length-1].model.get("pack_id")==c?d.push(l):s.push([l])}return s},[]).reduce((s,l)=>{if(l instanceof Array){var c=l[0].model.get("pack_id");this._groups_processed[c].widgets.length!=l.length?s=s.concat(l):s.push(l)}else s.push(l);return s},[]).value();this.workspace.selectListBlocks(n,this.lastSelectedList),this.lastSelectedList=n}else this.lastWidget=e,this.lastSelectedList=[],e.scrollTo(),e.selectFromWidgetBar(o)},getCountBlocks:function(e){var o=0;return We.default.each(e,function(t){o+=1,t.widgets&&t.expanded&&(o+=t.widgets.length)}),o},getSelectedInGroup:function(e){var o=null;return We.default.each(this.layers,(t,r)=>{this.fInside(this.$refs[r],e)&&(o=this.$refs[r])}),o&&this.selectedList.length?We.default.filter(this.selectedList,t=>this.fInside(o,t.el)):this.selectedList},onDragStart:function(e){this.handleNextChange=!0,this.indrag=!0;var o=this.getSelectedInGroup(e.from),t=We.default.find(o,function(l){return l.el==e.item});if(e.getGhost().className=e.getGhost().className+(e.from.className.indexOf("in-group-draggable")!=-1?" fallback-in-group":" fallback-not-in-group"),(0,Pi.default)(e.getGhost()).toggleClass("fallback-in-group",(0,Pi.default)(e.from).hasClass("in-group-draggable")),(0,Pi.default)(e.getGhost()).toggleClass("fallback-not-in-group",!(0,Pi.default)(e.from).hasClass("in-group-draggable")),this.fInside(this.$refs.fixed_top,e.from)?this.draggedFixed="top":this.fInside(this.$refs.fixed_bottom,e.from)&&(this.draggedFixed="bottom"),this.draggedFixed){var r=(0,Pi.default)(this._scroll.$refs.content);r.css("height",(0,Pi.default)(this._scroll.$refs.content).height())}if(o.length>1&&t){this.groupDrag=!0,e.setDraggedGroup(o.slice()),e.getGhost().innerHTML="<div></div>",e.getGhost().className=e.getGhost().className.replace("layer","");var i=o.indexOf(t),n=o.length-i-1;this.oversize="both",this.scrollOversizeTop=i*56,this.scrollOversizeBottom=n*56;var s=co.extend(jb);this._layersGroupDrag=new s({el:e.getGhost().firstElementChild,parent:this,abstract:!0,propsData:{group:"draggable",noArrow:!0,fakeGroup:!0,onTouchMove:function(){},widget:{pack_id:"",hovered:!1,groupName:"Drag",widgets:this.selectedLayers.slice()}}}),this.draggedItems=We.default.map(o,l=>l.context.element)}else this.draggedItems=[e.context.element],e.context&&e.context.element&&e.context.element.widgets&&e.context.element.expanded&&(this.scrollOversizeBottom=e.context.element.widgets.length*56,this.scrollOversizeTop=0,this.oversize="bottom")},onDragEnd:function(e){this.indrag=!1;var o=(0,Pi.default)(this._scroll.$refs.content);if(o.css("height",""),clearTimeout(this.expandTimeout),this.draggedFixed){var t=e.item.attributes["layer-id"].value;this.$nextTick(()=>{this.scrollTo(document.querySelector('[layer-id="'+t+'"]'))})}this.expandTimeout=0,this.draggedFixed="",this.boundTop=!1,this.groupDrag=!1,this.mark_draggable="",this.fixedOverRegular=!1,this.oversize="",this.lastRelatedContext&&(this.lastRelatedContext.element.hovered=!1,this.lastRelatedContext=null),this._layersGroupDrag&&(this._layersGroupDrag.$destroy(),this._layersGroupDrag=null)},onMove:function(e){e.related.parentNode.className.indexOf("in-group-draggable")!=-1?e.ghost.className=e.ghost.className.replace("fallback-not-in-group","fallback-in-group"):e.ghost.className=e.ghost.className.replace("fallback-in-group","fallback-not-in-group")},onMoveGhost:function(e,o,t){if(!t)return{dx:0,dy:0};var r=e.getBoundingClientRect(),i=(this.draggedFixed?this._scroll.$el:e.parentNode).getBoundingClientRect(),n=this._scroll.$el.parentNode.getBoundingClientRect(),s=0;if(this.draggedFixed&&!this.fixedOverRegular){if(this.$refs.fixed_top){let l=e.parentNode.getBoundingClientRect();r.bottom-l.bottom>25&&(this.fixedOverRegular=!0,this.mark_draggable="fixed_bottom")}this.$refs.fixed_bottom&&e.parentNode.getBoundingClientRect().top-r.top>25&&(this.fixedOverRegular=!0,this.mark_draggable="fixed_top"),this.fixedOverRegular&&(this.draggedFixed=="top"?(this.oversize="bottom",this.scrollOversizeBottom=Math.max(0,(this.getCountBlocks(this.layers.regular)-1)*56),this.scrollOversizeTop=0):(this.oversize="top",this.scrollOversizeTop=Math.max(0,(this.getCountBlocks(this.layers.regular)-1)*56),this.scrollOversizeBottom=0))}return r.top+s-Math.max(i.top,n.top)<t?{dx:0,dy:t-(r.top+s-Math.max(i.top,n.top))}:r.bottom-s-Math.min(i.bottom,n.bottom)>t?{dx:0,dy:t-(r.bottom-s-Math.min(i.bottom,n.bottom))}:{dx:0,dy:0}},onIndexChange:function(){this.handleNextChange=!1,this._unwatch&&We.default.each(this._unwatch,function(s){s()}),this._unwatch=[];let e=[{from:"aboveAll",to:"above_all"},{from:"frontFixed",to:"fixed_top"},{from:"normal",to:"regular"},{from:"backFixed",to:"fixed_bottom"}],o=JSON.parse(window.sessionStorage.getItem("groupsState")||"{}"),t=RM.constructorRouter.indexController.getOrder(this.workspace.page,this.workspace.viewport);this._groups_processed=this._groups_processed||{};let r={};We.default.each(e,s=>{r[s.to]=We.default.reduce(t[s.from],(l,c)=>{if(c instanceof Array){let d=[];l.push(d),We.default.each(c,p=>{let m=this.workspace.blocks.find(u=>u.id===p);m&&(m.model.get("pack_id")?d.push(p):l.push(p))})}else l.push(c);return l},[])});let i=We.default.flatten(We.default.map(r,s=>s)),n=!1;We.default.each(this.workspace.blocks,s=>{s.model.get("type")!=="background"&&(i.includes(s.id)||(n=!0,s.model.get("is_above")?r.above_all.push(s.id):s.model.get("fixed_position")?r.fixed_top.push(s.id):r.regular.push(s.id)))}),We.default.each(e,s=>{let l=We.default.flatten(r[s.to]).reduce((d,p)=>(d.u.includes(p)?d.d.push(p):d.u.push(p),d),{d:[],u:[]}).d,c={};n=n||l.length,r[s.to]=We.default.compact(r[s.to].map(d=>{if(d instanceof Array){let p=We.default.compact(d.map(m=>{if(l.includes(m)){if(c[m])return null;c[m]=1}return m}));return p.length?p:null}if(l.includes(d)){if(c[d])return null;c[d]=1}return d}))}),We.default.each(e,s=>{this.layers[s.to]=r[s.to].map(l=>{if(l instanceof Array){let c=We.default.compact(l.map(m=>this.workspace.blocks.find(u=>u.id===m)));if(c.length===0)return null;let d=c[0].model.get("pack_id"),p=this._groups_processed[d]?this._groups_processed[d]:{hovered:!1,pack_id:d,expanded:o[d]||!1};return p.widgets=c,this._groups_processed[d]=p,p}return this.workspace.blocks.find(c=>c.id===l)}),this.layers[s.to]=We.default.compact(this.layers[s.to])}),this._unwatch.push(this.$watch("layers.above_all",this.watchOnLayers)),this._unwatch.push(this.$watch("layers.fixed_top",this.watchOnLayers)),this._unwatch.push(this.$watch("layers.regular",this.watchOnLayers)),this._unwatch.push(this.$watch("layers.fixed_bottom",this.watchOnLayers)),n&&(this.handleNextChange=!0,this.watchNewZindex()),this.$nextTick(()=>{this.updateScroll()})},watchNewZindex:function(){if(!this.handleNextChange)return;this.handleNextChange=!0;var e=[].concat(this.layers.above_all,this.layers.fixed_top,this.layers.regular,this.layers.fixed_bottom),o=[],t={},r={},i=function(m,u,g){for(var h in u)if(u.hasOwnProperty(h)&&m.attributes[h]!=u[h])return g.push(u),!0;return!1},n=m=>{let u={};return m=We.default.reduce(m,(g,h)=>{if(h.widgets)g.push(h);else{let b=r[h.attributes._id];b?(u[b]||(u[b]=[],g.push({widgets:u[b]})),u[b].push(h)):g.push(h)}return g},[]),We.default.compact(m.map(g=>g.widgets?g.widgets.length===1?g.widgets[0].id:g.widgets.length===0?void 0:We.default.flatten(g.widgets.map(h=>h.widgets?h.widgets.map(b=>b.id):h.id)):g.id))},s=null;We.default.each(e,m=>{if(m.attributes&&m.attributes.pack_id&&!t[m.attributes.pack_id]){var u=m.attributes.pack_id,g=We.default.filter(e,h=>h.attributes&&h.attributes.pack_id==m.attributes.pack_id);t[m.attributes.pack_id]=1,this._groups_processed[u]&&this._groups_processed[u].widgets.length==0&&We.default.each(g,function(h){r[h.attributes._id]=h.attributes.pack_id})}});var l={aboveAll:n(this.layers.above_all),frontFixed:n(this.layers.fixed_top),normal:n(this.layers.regular),backFixed:n(this.layers.fixed_bottom)},c=!1,d;We.default.each(e,m=>{m.widgets instanceof Array?m.widgets.length==1?(d=i(m.widgets[0],{_id:m.widgets[0].attributes._id,pack_id:null},o),c=c||d):We.default.each(m.widgets,function(u){let g=u.widgets?u.widgets[0]:u;g.attributes.is_global&&g.attributes.pack_id!==m.pack_id&&(s=s||{},s.added=s.added||[],s.added.push(u.widgets?We.default.map(u.widgets,h=>h.attributes._id):u.attributes._id),s.added=We.default.flatten(s.added),s.pack=We.default.flatten(m.widgets.map(h=>h.widgets instanceof Array?We.default.map(h.widgets,b=>b.attributes._id):h.attributes._id)),s.pack_id=m.pack_id),u.widgets?We.default.each(u.widgets,function(h){d=i(h,{_id:h.attributes._id,pack_id:m.pack_id},o),c=c||d}):(d=i(u,{_id:u.attributes._id,pack_id:m.pack_id},o),c=c||d)}):(m.attributes.is_global&&m.attributes.pack_id&&(s=s||{},s.removed=s.removed||[],s.removed.push(m.attributes._id)),d=i(m,{_id:m.attributes._id,pack_id:r[m.attributes._id]||null},o),c=c||d)}),RM.constructorRouter.indexController.setOrderForPage(l,this.workspace.page,this.workspace.viewport,s),c&&(this.scrollCooldown=+new Date+300,this.workspace.save_group(o));let p=RM.constructorRouter.indexController.getPagesToSave();this.workspace.syncManager.saveGroup(p,{patch:!0,silent:!0}),se(he.EditorActions,{action:"change order",changeOrderMethod:"layers"}),this.$nextTick(()=>{this.onIndexChange()})},watchOnLayers:We.default.debounce(function(){this.watchNewZindex()},10),getLayerFromPoint:function(e,o,t){for(var r=window.document.elementFromPoint(e,o);r&&!(typeof r.className=="string"&&r.className.indexOf("layer")!==-1);)r=r.parentNode;try{if(r&&r.parentNode.sortable.options.group.name!==t)return null}catch{return null}return r},getElementByClassFromPoint:function(e,o,t,r){for(var i=window.document.elementFromPoint(e,o);i&&!(typeof i.className=="string"&&i.className.indexOf(t)!==-1);)i=i.parentNode;if(r){if(i&&i.sortable&&i.sortable.options.group.name==r)return i;for(var n=i;n&&!(typeof n.className=="string"&&n.className.indexOf("layer")!==-1);)n=n.parentNode;try{if(n&&n.parentNode.sortable.options.group.name!==r)return null}catch{return null}}return i},getEmptyContainerFromPoint:function(e,o,t){for(var r=window.document.elementFromPoint(e,o);r;){if(typeof r.className=="string"&&r.className.indexOf("draggable-container")!==-1){if(r.className.indexOf("empty-draggble")!==-1||r.childElementCount==0)break;return null}r=r.parentNode}try{if(r&&r.sortable.options.group.name!==t)return null}catch{return null}return r},fInside:function(e,o){for(e instanceof Array&&(e=We.default.flatten(e)[0]);o&&o!=e&&(o=o.parentNode););return!!o},checkCanGroup:function(e){return We.default.uniq(We.default.map(e,function(o){var t=!!(o.widgets?o.widgets[0].model.get("fixed_position"):o.model.get("fixed_position"));return t})).length>1||We.default.uniq(We.default.map(e,function(o){var t=!!(o.widgets?o.widgets[0].model.get("is_global"):o.model.get("is_global"));return t})).length>1},onTouchMove:function(e,o){var t=e.data;if(t.dy){for(var r=t.next&&t.next.className.indexOf("sortable-fallback")==-1?t.next:null,i=t.prev,n=0,s=t.ghost,l=s.getBoundingClientRect(),c=e.from.sortable.options.group.name,d,p,m,u,g=this.getLayerFromPoint((l.left+l.right)/2,l.bottom,c)||r,h=g&&g!=t.dragEl&&!this.fInside(g,t.dragEl)&&g.getBoundingClientRect(),b=this.getLayerFromPoint((l.left+l.right)/2,l.top,c)||i,x=b&&b!=t.dragEl&&!this.fInside(b,t.dragEl)&&b.getBoundingClientRect(),S=this.getElementByClassFromPoint((l.left+l.right)/2,l.top,"draggable-container",c),y=this.getElementByClassFromPoint((l.left+l.right)/2,l.bottom,"draggable-container",c),C=We.default.chain([[this.$refs.fixed_top,S],[this.$refs.fixed_bottom,S],[this.$refs.fixed_top,y],[this.$refs.fixed_bottom,y]]).reduce((pe,ee)=>this.fInside.apply(this,We.default.flatten(ee))&&!this.fInside(We.default.flatten(ee)[0],t.dragEl)?ee[1]:pe,null).value();r&&r.className.indexOf("selected")!=-1&&this.groupDrag&&(r=r.nextElementSibling););for(;i&&i.className.indexOf("selected")!=-1&&this.groupDrag&&(i=i.previousElementSibling););r&&r.className.indexOf("group_layer")!==-1&&r.className.indexOf("expanded")!==-1?(d=r.getBoundingClientRect(),r=r.querySelector(".in-group-draggable").firstElementChild,n=-1,m=r.parentNode):r?d=r.getBoundingClientRect():(r=this.getLayerFromPoint((l.left+l.right)/2,l.bottom,c),r==s||!r?r=null:(d=r.className.indexOf("group_layer")==-1&&r.getBoundingClientRect(),m=r.parentNode,n=-1)),i&&i.className.indexOf("group_layer")!==-1&&i.className.indexOf("expanded")!==-1?(i=i.querySelector(".in-group-draggable").lastElementChild,p=i.getBoundingClientRect(),m=i.parentNode,n=1):i?p=i&&i.getBoundingClientRect():(i=this.getLayerFromPoint((l.left+l.right)/2,l.top,c),i==s||!i?i=null:(p=i&&i.className.indexOf("group_layer")==-1&&i.getBoundingClientRect(),m=i&&i.parentNode,n=1));var P=this.getElementByClassFromPoint((l.left+l.right)/2,l.bottom,"head",c),v=P&&!this.fInside(t.dragEl,P)&&P.getBoundingClientRect(),T=this.getElementByClassFromPoint((l.left+l.right)/2,l.top,"head",c),R=T&&!this.fInside(t.dragEl,T)&&T.getBoundingClientRect(),I=34,M=15,D=15;if(C){if(C.childElementCount==0){e.result={toEmptyGroup:C},this.fInside(this.$refs.fixed_top,C)?this.mark_draggable="fixed_bottom":this.fInside(this.$refs.fixed_bottom,C)&&(this.mark_draggable="fixed_top");return}m=C,this.fInside.apply(this,We.default.flatten([this.$refs.fixed_top,C]))?(n=1,u=C.lastElementChild):(n=-1,u=C.firstElementChild)}else v&&v.top+I<=l.bottom?(u=P.nextElementSibling.querySelector(".layer"),n=-1,m=u.parentNode):R&&R.bottom-I>=l.top?(u=T.parentNode,n=-1,m=u.parentNode):(p&&t.dragEl.parentNode.lastElementChild==t.dragEl&&t.dragEl.parentNode.className.indexOf("in-group-draggable")!==-1&&t.dragEl.parentNode.parentNode.parentNode.parentNode.lastElementChild==t.dragEl.parentNode.parentNode.parentNode&&l.top-p.bottom>=-2?(u=t.dragEl.parentNode.parentNode.parentNode,n=1):h&&(g.className.indexOf("group_layer")==-1||g.className.indexOf("expanded")==-1)&&l.bottom-h.top>=I?(u=g,n=1):h&&t.dragEl.parentNode.lastElementChild==t.dragEl&&l.bottom-h.top>=D?(u=g,n=-1):x&&(b.className.indexOf("group_layer")==-1||b.className.indexOf("expanded")==-1)&&x.bottom-l.top>=I?(u=b,n=-1):x&&b.parentNode.lastElementChild==b&&x.bottom-l.top>=M&&(u=b,n=1),u&&u.parentNode!=t.dragEl.parentNode&&(m=u.parentNode));if(m&&u&&m.parentElement.parentElement.__vue__&&m.parentElement.parentElement.__vue__.widget){var E=m.parentElement.parentElement.__vue__.widget.widgets.concat([t.dragEl.__vue__.widget]);this.checkCanGroup(E)&&(u=null,m=null)}if(u&&u.className.indexOf("sortable-fallback")==-1)this.fInside(this.$refs.fixed_top,u)?this.mark_draggable="fixed_bottom":this.fInside(this.$refs.fixed_bottom,u)&&(this.mark_draggable="fixed_top"),e.result={target:u,direction:n,changeParent:m},this.expandTimeout&&(clearTimeout(this.expandTimeout),this.expandTimeout=0),this.lastRelatedContext&&(this.lastRelatedContext.element.hovered=!1,this.lastRelatedContext=null);else{var A=null;if(0){var $;if($&&$.element.widgets)var E}else{t.sortable.dropIntoGroup(null),this.expandTimeout&&(clearTimeout(this.expandTimeout),this.expandTimeout=0),this.lastRelatedContext&&(this.lastRelatedContext.element.hovered=!1,this.lastRelatedContext=null);var j=this.getEmptyContainerFromPoint((l.left+l.right)/2,l.top,c)||this.getEmptyContainerFromPoint((l.left+l.right)/2,l.bottom,c);j&&(this.fInside(this.$refs.fixed_top,j)?this.mark_draggable="fixed_bottom":this.fInside(this.$refs.fixed_bottom,j)&&(this.mark_draggable="fixed_top"),e.result={toEmptyGroup:j})}}}this.handleScroll(o)},handleScroll:We.default.throttle(function(e){if(e&&e.parentNode){var o=this._scroll.$el.getBoundingClientRect(),t=e.getBoundingClientRect(),r=0,i=5,n=5;this.layers.regular.length==1&&this.layers.fixed_bottom.length==0&&this.fixedOverRegular&&(n=100),o.bottom-t.bottom<n?r=4:t.top-o.top<i&&(r=-4),this._scroll.$el.children[0].scrollTop+=r,r&&this.$nextTick(()=>{this.handleScroll(e)})}},10),updateScroll:function(){this._scroll.resizableScroll.recalc()},expandChanged:function(){this.updateScroll()},scrollTo:function(e,o={}){if(!(e instanceof Element))return;let t={threshold:0};new IntersectionObserver((i,n)=>{i.forEach(s=>{if(s.intersectionRatio<1){let l=o.noAnimation?"auto":"smooth";s.target.scrollIntoView({block:"center",inline:"nearest",behavior:l})}n.unobserve(s.target),n.disconnect()})},t).observe(e)},onSelect:We.default.debounce(function(e,o){o=o||{};let t=null,r=this;if(!e||!e.length)return;e.forEach(()=>{let n=e[0].model.get("_id");if(r._layerList[n]){let s=r._layerList[n].$el;(!t||t.offsetTop>s.offsetTop)&&(t=s)}});let i=t&&(0,Pi.default)(t);i&&(i.height()>0||(t=i.parents(".layer")[0]),this.scrollTo(t,{noAnimation:o.noAnimation}))},20),getElementIndex:function(e){var o=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)e.nodeName.toUpperCase()!=="TEMPLATE"&&o++;return o},onFixedPositionChanged:function(e){this.scrollCooldown&&this.scrollCooldown>+new Date||this.$nextTick(()=>{var o=e.get("_id"),t=this._layerList[o];t&&t.$props.widget.selected&&this.scrollTo(t.$el)})},emptyDraggable:function(e){return this.draggedFixed?e.length==this.draggedItems.length&&We.default.difference(e,this.draggedItems)==0:!1},filterPredicate(e){switch(this.filter){case"all":return!0;case"links":return Jb(e);case"viewport":return Zb(e);default:return!0}}},computed:{bg:function(){return We.default.find(this.workspace.blocks,function(e){return e.attributes.type=="background"})},needCaptions:function(){var e=0;return We.default.each(this.layers,o=>{o.length&&e++}),e>1},flattenRegular:function(){return this.fFlatten(this.layers.regular)},flattenRegularFour:function(){return this.fFlatten(this.filteredLayers.regular).slice(0,4)},scrollOversize:function(){return(this.layers.regular.length-2)*56},layersFlat:function(){return[].concat(this.fFlatten(this.filteredLayers.above_all,!0,!0),this.fFlatten(this.filteredLayers.fixed_top,!0,!0),this.fFlatten(this.filteredLayers.regular,!0,!0),this.fFlatten(this.filteredLayers.fixed_bottom,!0,!0))},countFlatLayers:function(){return[].concat(this.fFlatten(this.layers.above_all,!0),this.fFlatten(this.layers.fixed_top,!0),this.fFlatten(this.layers.regular,!0),this.fFlatten(this.layers.fixed_bottom,!0)).length},layersCount:function(){return[].concat(this.fFlatten(this.layers.above_all),this.fFlatten(this.layers.fixed_top),this.fFlatten(this.layers.regular),this.fFlatten(this.layers.fixed_bottom)).length},selectedLayers:function(){return[].concat(this.fFlatten(this.layers.above_all),this.fFlatten(this.layers.fixed_top),this.fFlatten(this.layers.regular),this.fFlatten(this.layers.fixed_bottom)).filter(function(e){return!!e.selected})},selectedList:function(){var e=this;return[].concat(this.fFlatten(this.layers.above_all,!0),this.fFlatten(this.layers.fixed_top,!0),this.fFlatten(this.layers.regular,!0),this.fFlatten(this.layers.fixed_bottom,!0)).filter(function(o){return!!o.selected||o.widgets&&!!o.widgets[0].selected}).map(function(o){var t=o.model&&o.model.get("_id")||o.pack_id;if(!e._layerList[t])return null;var r=e._layerList[t].$el;return r?{el:r,context:e._layerList[t].$parent.getUnderlyingVm(r),oldIndex:e.getElementIndex(r),oldParent:r.parentNode}:null}).filter(function(o){return!!o})},noDragndrop:function(){return!window.RM.constructorRouter.mag.isPermissionAllowed("BaseWidgetCanChangeZindex")},filteredLayers:function(){return Object.fromEntries(Object.entries(this.layers).map(([e,o])=>[e,o.filter(this.filterPredicate)]))},isEmptyFilteredLayers:function(){let e=this.fFlatten(Object.values(this.filteredLayers).flat(1),!0,!0).length===0,o=this.layersCount>0,t=this.filter!=="all";return e&&o&&t}},watch:{workspace:{handler:function(e,o){this.onIndexChange(),o&&o.page.off("change:viewport",this.onIndexChange),e.page.on("change:viewport",this.onIndexChange),o&&o.off("select",this.onSelect),e.on("select",this.onSelect),this.onSelect(this.selectedLayers,{noAnimation:!0}),this.renderReactHeaderActions()},immediate:!0},selectedLayers:{handler:function(e){this.showCounter=Math.max(this.showCounter,this.layersFlat.indexOf(e[0])+25)},immediate:!0}}},uE=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("transition",{attrs:{name:"wb-panel"}},[t("div",{ref:"stack_panel",staticClass:"stack_panel",class:{"group-drag":e.groupDrag,dragging:e.indrag,dark:e.dark},attrs:{"aria-label":"Layer panel"}},[t("div",{staticClass:"inner fix-radius-clip",on:{click:e.updateScroll}},[t("div",{staticClass:"stack_panel-top"},[t("h2",{staticClass:"panel-top-caption"},[e._v("Layers")]),e._v(" "),t("div",{ref:"react_filters"})]),e._v(" "),t("div",{staticClass:"line last"}),e._v(" "),t("rm-scroll",{ref:"rmscroll",attrs:{"scroll-gap-start":8,"scroll-gap-end":8,"system-scroll":!0,"on-panel-scroll":e.onPanelScroll}},[t("div",{staticClass:"bound-top",class:{visible:e.boundTop=="top"}}),e._v(" "),e.isEmptyFilteredLayers?t("div",{staticClass:"empty-text-wrapper",style:{height:e.getHeightScrolledContent()+"px"}},[t("span",{staticClass:"empty-text"},[e._v("No widgets to show")])]):e._e(),e._v(" "),t("div",{staticClass:"layers"},[t("div",{staticClass:"oversize",class:{visible:e.oversize=="top"||e.oversize=="both"},style:{height:(e.scrollOversizeTop?e.mark_draggable?e.scrollOversizeTop-56:e.scrollOversizeTop:0)+"px"}}),e._v(" "),e._l(e.layers,function(r,i){return[t("div",{key:i},[(e.filteredLayers[i].length>0||e.fixedOverRegular&&(i=="fixed_top"||i=="fixed_bottom"))&&e.needCaptions?t("div",{staticClass:"group-title"},[e._v(`
                `+e._s(e.caption(i))+`
              `)]):e._e(),e._v(" "),i=="regular"?t("div",{directives:[{name:"show",rawName:"v-show",value:e.fixedOverRegular,expression:"fixedOverRegular"}]},[t("div",{staticStyle:{"margin-top":"-4px"}},[e.flattenRegularFour.length>0?t("group-layers",{attrs:{"on-touch-move":e.onTouchMove,"no-arrow":!0,"fake-group":!0,widget:{groupName:" ",pack_id:"fake",widgets:e.flattenRegularFour}}}):e._e()],1),e._v(" "),t("div",{staticClass:"line"})]):e._e(),e._v(" "),e.filteredLayers[i].length>0||e.fixedOverRegular&&(i=="fixed_top"||i=="fixed_bottom")?t("div",{directives:[{name:"show",rawName:"v-show",value:!e.fixedOverRegular||e.fixedOverRegular&&(i=="fixed_top"||i=="fixed_bottom"),expression:"!fixedOverRegular || (fixedOverRegular && (idx == 'fixed_top' || idx == 'fixed_bottom'))"}],ref:i,refInFor:!0,staticClass:"sortable_relparent",class:i},[t("div",{key:e.filter,staticClass:"stack",style:{"min-height":(e.fFlatten(e.filteredLayers[i],!0).length-2)*50+"px"}},[t("draggable",{staticClass:"draggable-container",class:{"empty-draggble":r.length==0||e.emptyDraggable(r),"with-captions":e.needCaptions},attrs:{move:e.onMove,options:{denyX:!0,forceFallback:!0,onEnd:e.onDragEnd,onMoveGhost:e.onMoveGhost,disabled:e.noDragndrop||e.draggableDisabled,relParent:"sortable_relparent",group:i=="fixed_bottom"?"fixed_top":i,animation:200,delay:0,moveByBlock:!0,scroll:!0,scrollSensitivity:40}},on:{end:e.onDragEnd,start:e.onDragStart,touchMove:e.onTouchMove},model:{value:e.layers[i],callback:function(n){e.$set(e.layers,i,n)},expression:"layers[idx]"}},[r.length?[e._l(r,function(n){return[e.showCounter>e.layersFlat.indexOf(n)?t(e.layer_type(n),{key:e.workspace.page.id+(n.pack_id?n.pack_id:n.attributes._id),tag:"component",attrs:{group:i=="fixed_bottom"?"fixed_top":i,widget:n,"on-touch-move":e.onTouchMove,"on-move-ghost":e.onMoveGhost,"no-dragndrop":e.noDragndrop,"is-not-visible":!e.filterPredicate(n),"filter-predicate":e.filterPredicate},on:{expandChanged:e.expandChanged,onWidgetSelect:e.onWidgetSelect,start:e.onDragStart,move:e.onMove,onWidgetDblClick:e.onWidgetDblClick,changeEditState:function(s){e.draggableDisabled=s},end:function(s){e.watchOnLayers(),e.onDragEnd(s)}}}):e._e()]})]:e._e()],2)],1),e._v(" "),e.needLine(i)?t("div",{staticClass:"line"}):e._e()]):e._e()])]}),e._v(" "),t("div",{staticClass:"oversize",class:{visible:e.oversize=="bottom"||e.oversize=="both"},style:{height:(e.scrollOversizeBottom?e.mark_draggable?e.scrollOversizeBottom-56:e.scrollOversizeBottom:0)+"px"}})],2),e._v(" "),t("div",{staticClass:"bound-top",class:{visible:e.boundTop=="bottom"}})]),e._v(" "),e.layersCount!=0?t("div",{staticClass:"line last"}):e._e(),e._v(" "),t("div",[e.showGuidePanel?t("help-tour-tooltip",{attrs:{step:e.helpTourStep,position:"top",modifiers:[{name:"offset",options:{offset:[0,-10]}}]}}):e._e(),e._v(" "),e.showGuidePanel?t("permission-controller",{attrs:{permission:"GridsAndGuidesCanUse"}},[t("guides-icon",{on:{click:e.onGuidesClick}})],1):e._e(),e._v(" "),t("background-icon",{attrs:{widget:e.bg},nativeOn:{click:function(r){return e.$emit("showPanel","background")}}}),e._v(" "),t("div",{staticStyle:{position:"relative",top:"-32px"}},[t("help-tour-tooltip",{attrs:{step:e.helpTourStepBackground,position:"right",modifiers:[{name:"offset",options:{offset:[0,8]}}]}})],1)],1)],1)])])},mE=[],gE=void 0,hE=void 0,fE=void 0,bE=!1;function wE(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="stack-panel.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var xE=wE({render:uE,staticRenderFns:mE},gE,dE,hE,bE,fE,!1,void 0,void 0,void 0),C4=xE;var Lo=B(H());jt();zt();N();var Aa=B(Js());oe();var Q3=B(H());var bo=B(H());Fp();var ue=B(H()),ys=B(Qo());var ao=B(H());function T4(){for(var e=arguments.length,o=new Array(e),t=0;t<e;t++)o[t]=arguments[t];return(0,ao.useMemo)(()=>r=>{o.forEach(i=>i(r))},o)}var Ec=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function _a(e){let o=Object.prototype.toString.call(e);return o==="[object Window]"||o==="[object global]"}function fg(e){return"nodeType"in e}function rr(e){var o,t;return e?_a(e)?e:fg(e)&&(o=(t=e.ownerDocument)==null?void 0:t.defaultView)!=null?o:window:window}function bg(e){let{Document:o}=rr(e);return e instanceof o}function ep(e){return _a(e)?!1:e instanceof rr(e).HTMLElement}function ew(e){return e instanceof rr(e).SVGElement}function Sa(e){return e?_a(e)?e.document:fg(e)?bg(e)?e:ep(e)||ew(e)?e.ownerDocument:document:document:document}var Lr=Ec?ao.useLayoutEffect:ao.useEffect;function wg(e){let o=(0,ao.useRef)(e);return Lr(()=>{o.current=e}),(0,ao.useCallback)(function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return o.current==null?void 0:o.current(...r)},[])}function I4(){let e=(0,ao.useRef)(null),o=(0,ao.useCallback)((r,i)=>{e.current=setInterval(r,i)},[]),t=(0,ao.useCallback)(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[o,t]}function tp(e,o){o===void 0&&(o=[e]);let t=(0,ao.useRef)(e);return Lr(()=>{t.current!==e&&(t.current=e)},o),t}function op(e,o){let t=(0,ao.useRef)();return(0,ao.useMemo)(()=>{let r=e(t.current);return t.current=r,r},[...o])}function Ac(e){let o=wg(e),t=(0,ao.useRef)(null),r=(0,ao.useCallback)(i=>{i!==t.current&&o?.(i,t.current),t.current=i},[]);return[t,r]}function xg(e){let o=(0,ao.useRef)();return(0,ao.useEffect)(()=>{o.current=e},[e]),o.current}var Qb={};function Ca(e,o){return(0,ao.useMemo)(()=>{if(o)return o;let t=Qb[e]==null?0:Qb[e]+1;return Qb[e]=t,e+"-"+t},[e,o])}function M4(e){return function(o){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return r.reduce((n,s)=>{let l=Object.entries(s);for(let[c,d]of l){let p=n[c];p!=null&&(n[c]=p+e*d)}return n},{...o})}}var Pa=M4(1),rp=M4(-1);function vE(e){return"clientX"in e&&"clientY"in e}function Lc(e){if(!e)return!1;let{KeyboardEvent:o}=rr(e.target);return o&&e instanceof o}function yE(e){if(!e)return!1;let{TouchEvent:o}=rr(e.target);return o&&e instanceof o}function vg(e){if(yE(e)){if(e.touches&&e.touches.length){let{clientX:o,clientY:t}=e.touches[0];return{x:o,y:t}}else if(e.changedTouches&&e.changedTouches.length){let{clientX:o,clientY:t}=e.changedTouches[0];return{x:o,y:t}}}return vE(e)?{x:e.clientX,y:e.clientY}:null}var Ql=Object.freeze({Translate:{toString(e){if(!e)return;let{x:o,y:t}=e;return"translate3d("+(o?Math.round(o):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;let{scaleX:o,scaleY:t}=e;return"scaleX("+o+") scaleY("+t+")"}},Transform:{toString(e){if(e)return[Ql.Translate.toString(e),Ql.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:o,duration:t,easing:r}=e;return o+" "+t+"ms "+r}}}),P4="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function B4(e){return e.matches(P4)?e:e.querySelector(P4)}var Ta=B(H()),kE={display:"none"};function R4(e){let{id:o,value:t}=e;return Ta.default.createElement("div",{id:o,style:kE},t)}function z4(e){let{id:o,announcement:t,ariaLiveType:r="assertive"}=e,i={position:"fixed",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Ta.default.createElement("div",{id:o,style:i,role:"status","aria-live":r,"aria-atomic":!0},t)}function E4(){let[e,o]=(0,Ta.useState)("");return{announce:(0,Ta.useCallback)(r=>{r!=null&&o(r)},[]),announcement:e}}var V4=(0,ue.createContext)(null);function _E(e){let o=(0,ue.useContext)(V4);(0,ue.useEffect)(()=>{if(!o)throw new Error("useDndMonitor must be used within a children of <DndContext>");return o(e)},[e,o])}function SE(){let[e]=(0,ue.useState)(()=>new Set),o=(0,ue.useCallback)(r=>(e.add(r),()=>e.delete(r)),[e]);return[(0,ue.useCallback)(r=>{let{type:i,event:n}=r;e.forEach(s=>{var l;return(l=s[i])==null?void 0:l.call(s,n)})},[e]),o]}var CE={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},PE={onDragStart(e){let{active:o}=e;return"Picked up draggable item "+o.id+"."},onDragOver(e){let{active:o,over:t}=e;return t?"Draggable item "+o.id+" was moved over droppable area "+t.id+".":"Draggable item "+o.id+" is no longer over a droppable area."},onDragEnd(e){let{active:o,over:t}=e;return t?"Draggable item "+o.id+" was dropped over droppable area "+t.id:"Draggable item "+o.id+" was dropped."},onDragCancel(e){let{active:o}=e;return"Dragging was cancelled. Draggable item "+o.id+" was dropped."}};function TE(e){let{announcements:o=PE,container:t,hiddenTextDescribedById:r,screenReaderInstructions:i=CE}=e,{announce:n,announcement:s}=E4(),l=Ca("DndLiveRegion"),[c,d]=(0,ue.useState)(!1);if((0,ue.useEffect)(()=>{d(!0)},[]),_E((0,ue.useMemo)(()=>({onDragStart(m){let{active:u}=m;n(o.onDragStart({active:u}))},onDragMove(m){let{active:u,over:g}=m;o.onDragMove&&n(o.onDragMove({active:u,over:g}))},onDragOver(m){let{active:u,over:g}=m;n(o.onDragOver({active:u,over:g}))},onDragEnd(m){let{active:u,over:g}=m;n(o.onDragEnd({active:u,over:g}))},onDragCancel(m){let{active:u,over:g}=m;n(o.onDragCancel({active:u,over:g}))}}),[n,o])),!c)return null;let p=ue.default.createElement(ue.default.Fragment,null,ue.default.createElement(R4,{id:r,value:i.draggable}),ue.default.createElement(z4,{id:l,announcement:s}));return t?(0,ys.createPortal)(p,t):p}var _o;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(_o||(_o={}));function kg(){}function U4(e,o){return(0,ue.useMemo)(()=>({sensor:e,options:o??{}}),[e,o])}function G4(){for(var e=arguments.length,o=new Array(e),t=0;t<e;t++)o[t]=arguments[t];return(0,ue.useMemo)(()=>[...o].filter(r=>r!=null),[...o])}var Ti=Object.freeze({x:0,y:0});function IE(e,o){let{data:{value:t}}=e,{data:{value:r}}=o;return r-t}function j4(e,o){if(!e||e.length===0)return null;let[t]=e;return o?t[o]:t}function ME(e,o){let t=Math.max(o.top,e.top),r=Math.max(o.left,e.left),i=Math.min(o.left+o.width,e.left+e.width),n=Math.min(o.top+o.height,e.top+e.height),s=i-r,l=n-t;if(r<i&&t<n){let c=o.width*o.height,d=e.width*e.height,p=s*l,m=p/(c+d-p);return Number(m.toFixed(4))}return 0}var BE=e=>{let{collisionRect:o,droppableRects:t,droppableContainers:r}=e,i=[];for(let n of r){let{id:s}=n,l=t.get(s);if(l){let c=ME(l,o);c>0&&i.push({id:s,data:{droppableContainer:n,value:c}})}}return i.sort(IE)};function RE(e,o,t){return{...e,scaleX:o&&t?o.width/t.width:1,scaleY:o&&t?o.height/t.height:1}}function q4(e,o){return e&&o?{x:e.left-o.left,y:e.top-o.top}:Ti}function zE(e){return function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return i.reduce((s,l)=>({...s,top:s.top+e*l.y,bottom:s.bottom+e*l.y,left:s.left+e*l.x,right:s.right+e*l.x}),{...t})}}var EE=zE(1);function AE(e){if(e.startsWith("matrix3d(")){let o=e.slice(9,-1).split(/, /);return{x:+o[12],y:+o[13],scaleX:+o[0],scaleY:+o[5]}}else if(e.startsWith("matrix(")){let o=e.slice(7,-1).split(/, /);return{x:+o[4],y:+o[5],scaleX:+o[0],scaleY:+o[3]}}return null}function LE(e,o,t){let r=AE(o);if(!r)return e;let{scaleX:i,scaleY:n,x:s,y:l}=r,c=e.left-s-(1-i)*parseFloat(t),d=e.top-l-(1-n)*parseFloat(t.slice(t.indexOf(" ")+1)),p=i?e.width/i:e.width,m=n?e.height/n:e.height;return{width:p,height:m,top:d,right:c+p,bottom:d+m,left:c}}var DE={ignoreTransform:!1};function Ba(e,o){o===void 0&&(o=DE);let t=e.getBoundingClientRect();if(o.ignoreTransform){let{transform:d,transformOrigin:p}=rr(e).getComputedStyle(e);d&&(t=LE(t,d,p))}let{top:r,left:i,width:n,height:s,bottom:l,right:c}=t;return{top:r,left:i,width:n,height:s,bottom:l,right:c}}function A4(e){return Ba(e,{ignoreTransform:!0})}function OE(e){let o=e.innerWidth,t=e.innerHeight;return{top:0,left:0,right:o,bottom:t,width:o,height:t}}function $E(e,o){return o===void 0&&(o=rr(e).getComputedStyle(e)),o.position==="fixed"}function HE(e,o){o===void 0&&(o=rr(e).getComputedStyle(e));let t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{let n=o[i];return typeof n=="string"?t.test(n):!1})}function Cg(e,o){let t=[];function r(i){if(o!=null&&t.length>=o||!i)return t;if(bg(i)&&i.scrollingElement!=null&&!t.includes(i.scrollingElement))return t.push(i.scrollingElement),t;if(!ep(i)||ew(i)||t.includes(i))return t;let n=rr(e).getComputedStyle(i);return i!==e&&HE(i,n)&&t.push(i),$E(i,n)?t:r(i.parentNode)}return e?r(e):t}function Y4(e){let[o]=Cg(e,1);return o??null}function tw(e){return!Ec||!e?null:_a(e)?e:fg(e)?bg(e)||e===Sa(e).scrollingElement?window:ep(e)?e:null:null}function X4(e){return _a(e)?e.scrollX:e.scrollLeft}function K4(e){return _a(e)?e.scrollY:e.scrollTop}function nw(e){return{x:X4(e),y:K4(e)}}var To;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(To||(To={}));function Z4(e){return!Ec||!e?!1:e===document.scrollingElement}function J4(e){let o={x:0,y:0},t=Z4(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-t.width,y:e.scrollHeight-t.height},i=e.scrollTop<=o.y,n=e.scrollLeft<=o.x,s=e.scrollTop>=r.y,l=e.scrollLeft>=r.x;return{isTop:i,isLeft:n,isBottom:s,isRight:l,maxScroll:r,minScroll:o}}var FE={x:.2,y:.2};function NE(e,o,t,r,i){let{top:n,left:s,right:l,bottom:c}=t;r===void 0&&(r=10),i===void 0&&(i=FE);let{isTop:d,isBottom:p,isLeft:m,isRight:u}=J4(e),g={x:0,y:0},h={x:0,y:0},b={height:o.height*i.y,width:o.width*i.x};return!d&&n<=o.top+b.height?(g.y=To.Backward,h.y=r*Math.abs((o.top+b.height-n)/b.height)):!p&&c>=o.bottom-b.height&&(g.y=To.Forward,h.y=r*Math.abs((o.bottom-b.height-c)/b.height)),!u&&l>=o.right-b.width?(g.x=To.Forward,h.x=r*Math.abs((o.right-b.width-l)/b.width)):!m&&s<=o.left+b.width&&(g.x=To.Backward,h.x=r*Math.abs((o.left+b.width-s)/b.width)),{direction:g,speed:h}}function WE(e){if(e===document.scrollingElement){let{innerWidth:n,innerHeight:s}=window;return{top:0,left:0,right:n,bottom:s,width:n,height:s}}let{top:o,left:t,right:r,bottom:i}=e.getBoundingClientRect();return{top:o,left:t,right:r,bottom:i,width:e.clientWidth,height:e.clientHeight}}function Q4(e){return e.reduce((o,t)=>Pa(o,nw(t)),Ti)}function VE(e){return e.reduce((o,t)=>o+X4(t),0)}function UE(e){return e.reduce((o,t)=>o+K4(t),0)}function GE(e,o){if(o===void 0&&(o=Ba),!e)return;let{top:t,left:r,bottom:i,right:n}=o(e);Y4(e)&&(i<=0||n<=0||t>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}var jE=[["x",["left","right"],VE],["y",["top","bottom"],UE]],Oc=class{constructor(o,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;let r=Cg(t),i=Q4(r);this.rect={...o},this.width=o.width,this.height=o.height;for(let[n,s,l]of jE)for(let c of s)Object.defineProperty(this,c,{get:()=>{let d=l(r),p=i[n]-d;return this.rect[c]+p},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}},Ia=class{constructor(o){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...t)})},this.target=o}add(o,t,r){var i;(i=this.target)==null||i.addEventListener(o,t,r),this.listeners.push([o,t,r])}};function qE(e){let{EventTarget:o}=rr(e);return e instanceof o?e:Sa(e)}function ow(e,o){let t=Math.abs(e.x),r=Math.abs(e.y);return typeof o=="number"?Math.sqrt(t**2+r**2)>o:"x"in o&&"y"in o?t>o.x&&r>o.y:"x"in o?t>o.x:"y"in o?r>o.y:!1}var Qr;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Qr||(Qr={}));function L4(e){e.preventDefault()}function YE(e){e.stopPropagation()}var kt;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter"})(kt||(kt={}));var eP={start:[kt.Space,kt.Enter],cancel:[kt.Esc],end:[kt.Space,kt.Enter]},XE=(e,o)=>{let{currentCoordinates:t}=o;switch(e.code){case kt.Right:return{...t,x:t.x+25};case kt.Left:return{...t,x:t.x-25};case kt.Down:return{...t,y:t.y+25};case kt.Up:return{...t,y:t.y-25}}},_g=class{constructor(o){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=o;let{event:{target:t}}=o;this.props=o,this.listeners=new Ia(Sa(t)),this.windowListeners=new Ia(rr(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Qr.Resize,this.handleCancel),this.windowListeners.add(Qr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Qr.Keydown,this.handleKeyDown))}handleStart(){let{activeNode:o,onStart:t}=this.props,r=o.node.current;r&&GE(r),t(Ti)}handleKeyDown(o){if(Lc(o)){let{active:t,context:r,options:i}=this.props,{keyboardCodes:n=eP,coordinateGetter:s=XE,scrollBehavior:l="smooth"}=i,{code:c}=o;if(n.end.includes(c)){this.handleEnd(o);return}if(n.cancel.includes(c)){this.handleCancel(o);return}let{collisionRect:d}=r.current,p=d?{x:d.left,y:d.top}:Ti;this.referenceCoordinates||(this.referenceCoordinates=p);let m=s(o,{active:t,context:r.current,currentCoordinates:p});if(m){let u=rp(m,p),g={x:0,y:0},{scrollableAncestors:h}=r.current;for(let b of h){let x=o.code,{isTop:S,isRight:y,isLeft:C,isBottom:P,maxScroll:v,minScroll:T}=J4(b),R=WE(b),I={x:Math.min(x===kt.Right?R.right-R.width/2:R.right,Math.max(x===kt.Right?R.left:R.left+R.width/2,m.x)),y:Math.min(x===kt.Down?R.bottom-R.height/2:R.bottom,Math.max(x===kt.Down?R.top:R.top+R.height/2,m.y))},M=x===kt.Right&&!y||x===kt.Left&&!C,D=x===kt.Down&&!P||x===kt.Up&&!S;if(M&&I.x!==m.x){let E=b.scrollLeft+u.x,A=x===kt.Right&&E<=v.x||x===kt.Left&&E>=T.x;if(A&&!u.y){b.scrollTo({left:E,behavior:l});return}A?g.x=b.scrollLeft-E:g.x=x===kt.Right?b.scrollLeft-v.x:b.scrollLeft-T.x,g.x&&b.scrollBy({left:-g.x,behavior:l});break}else if(D&&I.y!==m.y){let E=b.scrollTop+u.y,A=x===kt.Down&&E<=v.y||x===kt.Up&&E>=T.y;if(A&&!u.x){b.scrollTo({top:E,behavior:l});return}A?g.y=b.scrollTop-E:g.y=x===kt.Down?b.scrollTop-v.y:b.scrollTop-T.y,g.y&&b.scrollBy({top:-g.y,behavior:l});break}}this.handleMove(o,Pa(rp(m,this.referenceCoordinates),g))}}}handleMove(o,t){let{onMove:r}=this.props;o.preventDefault(),r(t)}handleEnd(o){let{onEnd:t}=this.props;o.preventDefault(),this.detach(),t()}handleCancel(o){let{onCancel:t}=this.props;o.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}};_g.activators=[{eventName:"onKeyDown",handler:(e,o,t)=>{let{keyboardCodes:r=eP,onActivation:i}=o,{active:n}=t,{code:s}=e.nativeEvent;if(r.start.includes(s)){let l=n.activatorNode.current;return l&&e.target!==l?!1:(e.preventDefault(),i?.({event:e.nativeEvent}),!0)}return!1}}];function D4(e){return!!(e&&"distance"in e)}function O4(e){return!!(e&&"delay"in e)}var $c=class{constructor(o,t,r){var i;r===void 0&&(r=qE(o.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=o,this.events=t;let{event:n}=o,{target:s}=n;this.props=o,this.events=t,this.document=Sa(s),this.documentListeners=new Ia(this.document),this.listeners=new Ia(r),this.windowListeners=new Ia(rr(s)),this.initialCoordinates=(i=vg(n))!=null?i:Ti,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){let{events:o,props:{options:{activationConstraint:t,bypassActivationConstraint:r}}}=this;if(this.listeners.add(o.move.name,this.handleMove,{passive:!1}),this.listeners.add(o.end.name,this.handleEnd),this.windowListeners.add(Qr.Resize,this.handleCancel),this.windowListeners.add(Qr.DragStart,L4),this.windowListeners.add(Qr.VisibilityChange,this.handleCancel),this.windowListeners.add(Qr.ContextMenu,L4),this.documentListeners.add(Qr.Keydown,this.handleKeydown),t){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(O4(t)){this.timeoutId=setTimeout(this.handleStart,t.delay);return}if(D4(t))return}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handleStart(){let{initialCoordinates:o}=this,{onStart:t}=this.props;o&&(this.activated=!0,this.documentListeners.add(Qr.Click,YE,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Qr.SelectionChange,this.removeTextSelection),t(o))}handleMove(o){var t;let{activated:r,initialCoordinates:i,props:n}=this,{onMove:s,options:{activationConstraint:l}}=n;if(!i)return;let c=(t=vg(o))!=null?t:Ti,d=rp(i,c);if(!r&&l){if(D4(l)){if(l.tolerance!=null&&ow(d,l.tolerance))return this.handleCancel();if(ow(d,l.distance))return this.handleStart()}return O4(l)&&ow(d,l.tolerance)?this.handleCancel():void 0}o.cancelable&&o.preventDefault(),s(c)}handleEnd(){let{onEnd:o}=this.props;this.detach(),o()}handleCancel(){let{onCancel:o}=this.props;this.detach(),o()}handleKeydown(o){o.code===kt.Esc&&this.handleCancel()}removeTextSelection(){var o;(o=this.document.getSelection())==null||o.removeAllRanges()}},KE={move:{name:"pointermove"},end:{name:"pointerup"}},ip=class extends $c{constructor(o){let{event:t}=o,r=Sa(t.target);super(o,KE,r)}};ip.activators=[{eventName:"onPointerDown",handler:(e,o)=>{let{nativeEvent:t}=e,{onActivation:r}=o;return!t.isPrimary||t.button!==0?!1:(r?.({event:t}),!0)}}];var ZE={move:{name:"mousemove"},end:{name:"mouseup"}},sw;(function(e){e[e.RightClick=2]="RightClick"})(sw||(sw={}));var aw=class extends $c{constructor(o){super(o,ZE,Sa(o.event.target))}};aw.activators=[{eventName:"onMouseDown",handler:(e,o)=>{let{nativeEvent:t}=e,{onActivation:r}=o;return t.button===sw.RightClick?!1:(r?.({event:t}),!0)}}];var rw={move:{name:"touchmove"},end:{name:"touchend"}},lw=class extends $c{constructor(o){super(o,rw)}static setup(){return window.addEventListener(rw.move.name,o,{capture:!1,passive:!1}),function(){window.removeEventListener(rw.move.name,o)};function o(){}}};lw.activators=[{eventName:"onTouchStart",handler:(e,o)=>{let{nativeEvent:t}=e,{onActivation:r}=o,{touches:i}=t;return i.length>1?!1:(r?.({event:t}),!0)}}];var Dc;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Dc||(Dc={}));var Sg;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Sg||(Sg={}));function JE(e){let{acceleration:o,activator:t=Dc.Pointer,canScroll:r,draggingRect:i,enabled:n,interval:s=5,order:l=Sg.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:p,delta:m,threshold:u}=e,g=eA({delta:m,disabled:!n}),[h,b]=I4(),x=(0,ue.useRef)({x:0,y:0}),S=(0,ue.useRef)({x:0,y:0}),y=(0,ue.useMemo)(()=>{switch(t){case Dc.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Dc.DraggableRect:return i}},[t,i,c]),C=(0,ue.useRef)(null),P=(0,ue.useCallback)(()=>{let T=C.current;if(!T)return;let R=x.current.x*S.current.x,I=x.current.y*S.current.y;T.scrollBy(R,I)},[]),v=(0,ue.useMemo)(()=>l===Sg.TreeOrder?[...d].reverse():d,[l,d]);(0,ue.useEffect)(()=>{if(!n||!d.length||!y){b();return}for(let T of v){if(r?.(T)===!1)continue;let R=d.indexOf(T),I=p[R];if(!I)continue;let{direction:M,speed:D}=NE(T,I,y,o,u);for(let E of["x","y"])g[E][M[E]]||(D[E]=0,M[E]=0);if(D.x>0||D.y>0){b(),C.current=T,h(P,s),x.current=D,S.current=M;return}}x.current={x:0,y:0},S.current={x:0,y:0},b()},[o,P,r,b,n,s,JSON.stringify(y),JSON.stringify(g),h,d,v,p,JSON.stringify(u)])}var QE={x:{[To.Backward]:!1,[To.Forward]:!1},y:{[To.Backward]:!1,[To.Forward]:!1}};function eA(e){let{delta:o,disabled:t}=e,r=xg(o);return op(i=>{if(t||!r||!i)return QE;let n={x:Math.sign(o.x-r.x),y:Math.sign(o.y-r.y)};return{x:{[To.Backward]:i.x[To.Backward]||n.x===-1,[To.Forward]:i.x[To.Forward]||n.x===1},y:{[To.Backward]:i.y[To.Backward]||n.y===-1,[To.Forward]:i.y[To.Forward]||n.y===1}}},[t,o,r])}function tA(e,o){let t=o!==null?e.get(o):void 0,r=t?t.node.current:null;return op(i=>{var n;return o===null?null:(n=r??i)!=null?n:null},[r,o])}function oA(e,o){return(0,ue.useMemo)(()=>e.reduce((t,r)=>{let{sensor:i}=r,n=i.activators.map(s=>({eventName:s.eventName,handler:o(s.handler,r)}));return[...t,...n]},[]),[e,o])}var Hc;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Hc||(Hc={}));var pw;(function(e){e.Optimized="optimized"})(pw||(pw={}));var $4=new Map;function rA(e,o){let{dragging:t,dependencies:r,config:i}=o,[n,s]=(0,ue.useState)(null),{frequency:l,measure:c,strategy:d}=i,p=(0,ue.useRef)(e),m=x(),u=tp(m),g=(0,ue.useCallback)(function(S){S===void 0&&(S=[]),!u.current&&s(y=>y===null?S:y.concat(S.filter(C=>!y.includes(C))))},[u]),h=(0,ue.useRef)(null),b=op(S=>{if(m&&!t)return $4;if(!S||S===$4||p.current!==e||n!=null){let y=new Map;for(let C of e){if(!C)continue;if(n&&n.length>0&&!n.includes(C.id)&&C.rect.current){y.set(C.id,C.rect.current);continue}let P=C.node.current,v=P?new Oc(c(P),P):null;C.rect.current=v,v&&y.set(C.id,v)}return y}return S},[e,n,t,m,c]);return(0,ue.useEffect)(()=>{p.current=e},[e]),(0,ue.useEffect)(()=>{m||g()},[t,m]),(0,ue.useEffect)(()=>{n&&n.length>0&&s(null)},[JSON.stringify(n)]),(0,ue.useEffect)(()=>{m||typeof l!="number"||h.current!==null||(h.current=setTimeout(()=>{g(),h.current=null},l))},[l,m,g,...r]),{droppableRects:b,measureDroppableContainers:g,measuringScheduled:n!=null};function x(){switch(d){case Hc.Always:return!1;case Hc.BeforeDragging:return t;default:return!t}}}function tP(e,o){return op(t=>e?t||(typeof o=="function"?o(e):e):null,[o,e])}function iA(e,o){return tP(e,o)}function nA(e){let{callback:o,disabled:t}=e,r=wg(o),i=(0,ue.useMemo)(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;let{MutationObserver:n}=window;return new n(r)},[r,t]);return(0,ue.useEffect)(()=>()=>i?.disconnect(),[i]),i}function Pg(e){let{callback:o,disabled:t}=e,r=wg(o),i=(0,ue.useMemo)(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;let{ResizeObserver:n}=window;return new n(r)},[t]);return(0,ue.useEffect)(()=>()=>i?.disconnect(),[i]),i}function sA(e){return new Oc(Ba(e),e)}function H4(e,o,t){o===void 0&&(o=sA);let[r,i]=(0,ue.useReducer)(l,null),n=nA({callback(c){if(e)for(let d of c){let{type:p,target:m}=d;if(p==="childList"&&m instanceof HTMLElement&&m.contains(e)){i();break}}}}),s=Pg({callback:i});return Lr(()=>{i(),e?(s?.observe(e),n?.observe(document.body,{childList:!0,subtree:!0})):(s?.disconnect(),n?.disconnect())},[e]),r;function l(c){if(!e)return null;if(e.isConnected===!1){var d;return(d=c??t)!=null?d:null}let p=o(e);return JSON.stringify(c)===JSON.stringify(p)?c:p}}function aA(e){let o=tP(e);return q4(e,o)}var F4=[];function lA(e){let o=(0,ue.useRef)(e),t=op(r=>e?r&&r!==F4&&e&&o.current&&e.parentNode===o.current.parentNode?r:Cg(e):F4,[e]);return(0,ue.useEffect)(()=>{o.current=e},[e]),t}function pA(e){let[o,t]=(0,ue.useState)(null),r=(0,ue.useRef)(e),i=(0,ue.useCallback)(n=>{let s=tw(n.target);s&&t(l=>l?(l.set(s,nw(s)),new Map(l)):null)},[]);return(0,ue.useEffect)(()=>{let n=r.current;if(e!==n){s(n);let l=e.map(c=>{let d=tw(c);return d?(d.addEventListener("scroll",i,{passive:!0}),[d,nw(d)]):null}).filter(c=>c!=null);t(l.length?new Map(l):null),r.current=e}return()=>{s(e),s(n)};function s(l){l.forEach(c=>{let d=tw(c);d?.removeEventListener("scroll",i)})}},[i,e]),(0,ue.useMemo)(()=>e.length?o?Array.from(o.values()).reduce((n,s)=>Pa(n,s),Ti):Q4(e):Ti,[e,o])}function N4(e,o){o===void 0&&(o=[]);let t=(0,ue.useRef)(null);return(0,ue.useEffect)(()=>{t.current=null},o),(0,ue.useEffect)(()=>{let r=e!==Ti;r&&!t.current&&(t.current=e),!r&&t.current&&(t.current=null)},[e]),t.current?rp(e,t.current):Ti}function cA(e){(0,ue.useEffect)(()=>{if(!Ec)return;let o=e.map(t=>{let{sensor:r}=t;return r.setup==null?void 0:r.setup()});return()=>{for(let t of o)t?.()}},e.map(o=>{let{sensor:t}=o;return t}))}function dA(e,o){return(0,ue.useMemo)(()=>e.reduce((t,r)=>{let{eventName:i,handler:n}=r;return t[i]=s=>{n(s,o)},t},{}),[e,o])}function oP(e){return(0,ue.useMemo)(()=>e?OE(e):null,[e])}var iw=[];function uA(e,o){o===void 0&&(o=Ba);let[t]=e,r=oP(t?rr(t):null),[i,n]=(0,ue.useReducer)(l,iw),s=Pg({callback:n});return e.length>0&&i===iw&&n(),Lr(()=>{e.length?e.forEach(c=>s?.observe(c)):(s?.disconnect(),n())},[e]),i;function l(){return e.length?e.map(c=>Z4(c)?r:new Oc(o(c),c)):iw}}function mA(e){if(!e)return null;if(e.children.length>1)return e;let o=e.children[0];return ep(o)?o:e}function gA(e){let{measure:o}=e,[t,r]=(0,ue.useState)(null),i=(0,ue.useCallback)(d=>{for(let{target:p}of d)if(ep(p)){r(m=>{let u=o(p);return m?{...m,width:u.width,height:u.height}:u});break}},[o]),n=Pg({callback:i}),s=(0,ue.useCallback)(d=>{let p=mA(d);n?.disconnect(),p&&n?.observe(p),r(p?o(p):null)},[o,n]),[l,c]=Ac(s);return(0,ue.useMemo)(()=>({nodeRef:l,rect:t,setRef:c}),[t,l,c])}var hA=[{sensor:ip,options:{}},{sensor:_g,options:{}}],fA={current:{}},yg={draggable:{measure:A4},droppable:{measure:A4,strategy:Hc.WhileDragging,frequency:pw.Optimized},dragOverlay:{measure:Ba}},Ma=class extends Map{get(o){var t;return o!=null&&(t=super.get(o))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(o=>{let{disabled:t}=o;return!t})}getNodeFor(o){var t,r;return(t=(r=this.get(o))==null?void 0:r.node.current)!=null?t:void 0}},bA={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ma,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:kg},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:yg,measureDroppableContainers:kg,windowRect:null,measuringScheduled:!1},wA={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:kg,draggableNodes:new Map,over:null,measureDroppableContainers:kg},Tg=(0,ue.createContext)(wA),rP=(0,ue.createContext)(bA);function xA(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ma}}}function vA(e,o){switch(o.type){case _o.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:o.initialCoordinates,active:o.active}};case _o.DragMove:return e.draggable.active?{...e,draggable:{...e.draggable,translate:{x:o.coordinates.x-e.draggable.initialCoordinates.x,y:o.coordinates.y-e.draggable.initialCoordinates.y}}}:e;case _o.DragEnd:case _o.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case _o.RegisterDroppable:{let{element:t}=o,{id:r}=t,i=new Ma(e.droppable.containers);return i.set(r,t),{...e,droppable:{...e.droppable,containers:i}}}case _o.SetDroppableDisabled:{let{id:t,key:r,disabled:i}=o,n=e.droppable.containers.get(t);if(!n||r!==n.key)return e;let s=new Ma(e.droppable.containers);return s.set(t,{...n,disabled:i}),{...e,droppable:{...e.droppable,containers:s}}}case _o.UnregisterDroppable:{let{id:t,key:r}=o,i=e.droppable.containers.get(t);if(!i||r!==i.key)return e;let n=new Ma(e.droppable.containers);return n.delete(t),{...e,droppable:{...e.droppable,containers:n}}}default:return e}}function yA(e){let{disabled:o}=e,{active:t,activatorEvent:r,draggableNodes:i}=(0,ue.useContext)(Tg),n=xg(r),s=xg(t?.id);return(0,ue.useEffect)(()=>{if(!o&&!r&&n&&s!=null){if(!Lc(n)||document.activeElement===n.target)return;let l=i.get(s);if(!l)return;let{activatorNode:c,node:d}=l;if(!c.current&&!d.current)return;requestAnimationFrame(()=>{for(let p of[c.current,d.current]){if(!p)continue;let m=B4(p);if(m){m.focus();break}}})}},[r,o,i,s,n]),null}function kA(e,o){let{transform:t,...r}=o;return e!=null&&e.length?e.reduce((i,n)=>n({transform:i,...r}),t):t}function _A(e){return(0,ue.useMemo)(()=>({draggable:{...yg.draggable,...e?.draggable},droppable:{...yg.droppable,...e?.droppable},dragOverlay:{...yg.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function SA(e){let{activeNode:o,measure:t,initialRect:r,config:i=!0}=e,n=(0,ue.useRef)(!1),{x:s,y:l}=typeof i=="boolean"?{x:i,y:i}:i;Lr(()=>{if(!s&&!l||!o){n.current=!1;return}if(n.current||!r)return;let d=o?.node.current;if(!d||d.isConnected===!1)return;let p=t(d),m=q4(p,r);if(s||(m.x=0),l||(m.y=0),n.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){let u=Y4(d);u&&u.scrollBy({top:m.y,left:m.x})}},[o,s,l,r,t])}var iP=(0,ue.createContext)({...Ti,scaleX:1,scaleY:1}),vs;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(vs||(vs={}));var nP=(0,ue.memo)(function(o){var t,r,i,n;let{id:s,accessibility:l,autoScroll:c=!0,children:d,sensors:p=hA,collisionDetection:m=BE,measuring:u,modifiers:g,...h}=o,b=(0,ue.useReducer)(vA,void 0,xA),[x,S]=b,[y,C]=SE(),[P,v]=(0,ue.useState)(vs.Uninitialized),T=P===vs.Initialized,{draggable:{active:R,nodes:I,translate:M},droppable:{containers:D}}=x,E=R?I.get(R):null,A=(0,ue.useRef)({initial:null,translated:null}),$=(0,ue.useMemo)(()=>{var po;return R!=null?{id:R,data:(po=E?.data)!=null?po:fA,rect:A}:null},[R,E]),j=(0,ue.useRef)(null),[pe,ee]=(0,ue.useState)(null),[G,K]=(0,ue.useState)(null),we=tp(h,Object.values(h)),xe=Ca("DndDescribedBy",s),_e=(0,ue.useMemo)(()=>D.getEnabled(),[D]),ie=_A(u),{droppableRects:ze,measureDroppableContainers:ne,measuringScheduled:J}=rA(_e,{dragging:T,dependencies:[M.x,M.y],config:ie.droppable}),X=tA(I,R),Q=(0,ue.useMemo)(()=>G?vg(G):null,[G]),te=hh(),ye=iA(X,ie.draggable.measure);SA({activeNode:R?I.get(R):null,config:te.layoutShiftCompensation,initialRect:ye,measure:ie.draggable.measure});let de=H4(X,ie.draggable.measure,ye),Se=H4(X?X.parentElement:null),be=(0,ue.useRef)({activatorEvent:null,active:null,activeNode:X,collisionRect:null,collisions:null,droppableRects:ze,draggableNodes:I,draggingNode:null,draggingNodeRect:null,droppableContainers:D,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ae=D.getNodeFor((t=be.current.over)==null?void 0:t.id),Qe=gA({measure:ie.dragOverlay.measure}),O=(r=Qe.nodeRef.current)!=null?r:X,U=T?(i=Qe.rect)!=null?i:de:null,Y=!!(Qe.nodeRef.current&&Qe.rect),re=aA(Y?null:de),Ne=oP(O?rr(O):null),ke=lA(T?Ae??X:null),Te=uA(ke),ut=kA(g,{transform:{x:M.x-re.x,y:M.y-re.y,scaleX:1,scaleY:1},activatorEvent:G,active:$,activeNodeRect:de,containerNodeRect:Se,draggingNodeRect:U,over:be.current.over,overlayNodeRect:Qe.rect,scrollableAncestors:ke,scrollableAncestorRects:Te,windowRect:Ne}),Fe=Q?Pa(Q,M):null,wt=pA(ke),lt=N4(wt),xt=N4(wt,[de]),ot=Pa(ut,lt),ai=U?EE(U,ut):null,Ri=$&&ai?m({active:$,collisionRect:ai,droppableRects:ze,droppableContainers:_e,pointerCoordinates:Fe}):null,zi=j4(Ri,"id"),[Rt,Do]=(0,ue.useState)(null),Ln=Y?ut:Pa(ut,xt),li=RE(Ln,(n=Rt?.rect)!=null?n:null,de),Ei=(0,ue.useCallback)((po,Oo)=>{let{sensor:$o,options:pi}=Oo;if(j.current==null)return;let wo=I.get(j.current);if(!wo)return;let ar=po.nativeEvent,vr=new $o({active:j.current,activeNode:wo,event:ar,options:pi,context:be,onStart(di){let Tp=j.current;if(Tp==null)return;let Ip=I.get(Tp);if(!Ip)return;let{onDragStart:wd}=we.current,xd={active:{id:Tp,data:Ip.data,rect:A}};(0,ys.unstable_batchedUpdates)(()=>{wd?.(xd),v(vs.Initializing),S({type:_o.DragStart,initialCoordinates:di,active:Tp}),y({type:"onDragStart",event:xd})})},onMove(di){S({type:_o.DragMove,coordinates:di})},onEnd:ci(_o.DragEnd),onCancel:ci(_o.DragCancel)});(0,ys.unstable_batchedUpdates)(()=>{ee(vr),K(po.nativeEvent)});function ci(di){return async function(){let{active:Ip,collisions:wd,over:xd,scrollAdjustedTranslate:cx}=be.current,Mp=null;if(Ip&&cx){let{cancelDrop:Bp}=we.current;Mp={activatorEvent:ar,active:Ip,collisions:wd,delta:cx,over:xd},di===_o.DragEnd&&typeof Bp=="function"&&await Promise.resolve(Bp(Mp))&&(di=_o.DragCancel)}j.current=null,(0,ys.unstable_batchedUpdates)(()=>{S({type:di}),v(vs.Uninitialized),Do(null),ee(null),K(null);let Bp=di===_o.DragEnd?"onDragEnd":"onDragCancel";if(Mp){let fh=we.current[Bp];fh?.(Mp),y({type:Bp,event:Mp})}})}}},[I]),Dn=(0,ue.useCallback)((po,Oo)=>($o,pi)=>{let wo=$o.nativeEvent,ar=I.get(pi);if(j.current!==null||!ar||wo.dndKit||wo.defaultPrevented)return;let vr={active:ar};po($o,Oo.options,vr)===!0&&(wo.dndKit={capturedBy:Oo.sensor},j.current=pi,Ei($o,Oo))},[I,Ei]),Pp=oA(p,Dn);cA(p),Lr(()=>{de&&P===vs.Initializing&&v(vs.Initialized)},[de,P]),(0,ue.useEffect)(()=>{let{onDragMove:po}=we.current,{active:Oo,activatorEvent:$o,collisions:pi,over:wo}=be.current;if(!Oo||!$o)return;let ar={active:Oo,activatorEvent:$o,collisions:pi,delta:{x:ot.x,y:ot.y},over:wo};(0,ys.unstable_batchedUpdates)(()=>{po?.(ar),y({type:"onDragMove",event:ar})})},[ot.x,ot.y]),(0,ue.useEffect)(()=>{let{active:po,activatorEvent:Oo,collisions:$o,droppableContainers:pi,scrollAdjustedTranslate:wo}=be.current;if(!po||j.current==null||!Oo||!wo)return;let{onDragOver:ar}=we.current,vr=pi.get(zi),ci=vr&&vr.rect.current?{id:vr.id,rect:vr.rect.current,data:vr.data,disabled:vr.disabled}:null,di={active:po,activatorEvent:Oo,collisions:$o,delta:{x:wo.x,y:wo.y},over:ci};(0,ys.unstable_batchedUpdates)(()=>{Do(ci),ar?.(di),y({type:"onDragOver",event:di})})},[zi]),Lr(()=>{be.current={activatorEvent:G,active:$,activeNode:X,collisionRect:ai,collisions:Ri,droppableRects:ze,draggableNodes:I,draggingNode:O,draggingNodeRect:U,droppableContainers:D,over:Rt,scrollableAncestors:ke,scrollAdjustedTranslate:ot},A.current={initial:U,translated:ai}},[$,X,Ri,ai,I,O,U,ze,D,Rt,ke,ot]),JE({...te,delta:M,draggingRect:ai,pointerCoordinates:Fe,scrollableAncestors:ke,scrollableAncestorRects:Te});let bd=(0,ue.useMemo)(()=>({active:$,activeNode:X,activeNodeRect:de,activatorEvent:G,collisions:Ri,containerNodeRect:Se,dragOverlay:Qe,draggableNodes:I,droppableContainers:D,droppableRects:ze,over:Rt,measureDroppableContainers:ne,scrollableAncestors:ke,scrollableAncestorRects:Te,measuringConfiguration:ie,measuringScheduled:J,windowRect:Ne}),[$,X,de,G,Ri,Se,Qe,I,D,ze,Rt,ne,ke,Te,ie,J,Ne]),gh=(0,ue.useMemo)(()=>({activatorEvent:G,activators:Pp,active:$,activeNodeRect:de,ariaDescribedById:{draggable:xe},dispatch:S,draggableNodes:I,over:Rt,measureDroppableContainers:ne}),[G,Pp,$,de,S,xe,I,Rt,ne]);return ue.default.createElement(V4.Provider,{value:C},ue.default.createElement(Tg.Provider,{value:gh},ue.default.createElement(rP.Provider,{value:bd},ue.default.createElement(iP.Provider,{value:li},d)),ue.default.createElement(yA,{disabled:l?.restoreFocus===!1})),ue.default.createElement(TE,{...l,hiddenTextDescribedById:xe}));function hh(){let po=pe?.autoScrollEnabled===!1,Oo=typeof c=="object"?c.enabled===!1:c===!1,$o=T&&!po&&!Oo;return typeof c=="object"?{...c,enabled:$o}:{enabled:$o}}}),CA=(0,ue.createContext)(null),W4="button",PA="Droppable";function sP(e){let{id:o,data:t,disabled:r=!1,attributes:i}=e,n=Ca(PA),{activators:s,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:p,draggableNodes:m,over:u}=(0,ue.useContext)(Tg),{role:g=W4,roleDescription:h="draggable",tabIndex:b=0}=i??{},x=c?.id===o,S=(0,ue.useContext)(x?iP:CA),[y,C]=Ac(),[P,v]=Ac(),T=dA(s,o),R=tp(t);Lr(()=>(m.set(o,{id:o,key:n,node:y,activatorNode:P,data:R}),()=>{let M=m.get(o);M&&M.key===n&&m.delete(o)}),[m,o]);let I=(0,ue.useMemo)(()=>({role:g,tabIndex:b,"aria-disabled":r,"aria-pressed":x&&g===W4?!0:void 0,"aria-roledescription":h,"aria-describedby":p.draggable}),[r,g,b,x,h,p.draggable]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:I,isDragging:x,listeners:r?void 0:T,node:y,over:u,setNodeRef:C,setActivatorNodeRef:v,transform:S}}function aP(){return(0,ue.useContext)(rP)}var TA="Droppable",IA={timeout:25};function Ig(e){let{data:o,disabled:t=!1,id:r,resizeObserverConfig:i}=e,n=Ca(TA),{active:s,dispatch:l,over:c,measureDroppableContainers:d}=(0,ue.useContext)(Tg),p=(0,ue.useRef)({disabled:t}),m=(0,ue.useRef)(!1),u=(0,ue.useRef)(null),g=(0,ue.useRef)(null),{disabled:h,updateMeasurementsFor:b,timeout:x}={...IA,...i},S=tp(b??r),y=(0,ue.useCallback)(()=>{if(!m.current){m.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{d(Array.isArray(S.current)?S.current:[S.current]),g.current=null},x)},[x]),C=Pg({callback:y,disabled:h||!s}),P=(0,ue.useCallback)((I,M)=>{C&&(M&&(C.unobserve(M),m.current=!1),I&&C.observe(I))},[C]),[v,T]=Ac(P),R=tp(o);return(0,ue.useEffect)(()=>{!C||!v.current||(C.disconnect(),m.current=!1,C.observe(v.current))},[v,C]),Lr(()=>(l({type:_o.RegisterDroppable,element:{id:r,key:n,disabled:t,node:v,rect:u,data:R}}),()=>l({type:_o.UnregisterDroppable,key:n,id:r})),[r]),(0,ue.useEffect)(()=>{t!==p.current.disabled&&(l({type:_o.SetDroppableDisabled,id:r,key:n,disabled:t}),p.current.disabled=t)},[r,n,t,l]),{active:s,rect:u,isOver:c?.id===r,node:v,over:c,setNodeRef:T}}function lP(e){let o={aboveAll:new Map,frontFixed:new Map,normal:new Map,backFixed:new Map},t=new Map,r=0,i=null;for(let n of e.values()){let s=n.parentId,l=n.section;if((s?e.get(s)?.isCollapsed:!1)||!n.isFiltered)continue;let d=mg(e,s),p=o[l].get(i||"")||null;p||(i=null),n.setState(m=>({...m,visibleIndex:r,depth:d,prevVisibleId:i,nextVisibleId:null})),p&&(p.setState(m=>({...m,nextVisibleId:n.id})),o[l].set(p.id,p)),o[l].set(n.id,n),i=n.id,r++}for(let n in o){let s=n;t.set(n,o[s])}return t}Vh();ro();Vh();var np=class extends nn{constructor({id:t,zIndex:r,orderIndex:i,parentId:n,type:s,selectedBackgroundType:l,section:c,children:d,name:p,defaultName:m="",iconStyles:u,iconSvgStyles:g,isLocked:h,isHidden:b,isGlobal:x=!1,isSelected:S=!1,isCollapsed:y=!0,isHover:C=!1,isFiltered:P=!0,isDefaultVpAvaliable:v=!1,isPhoneVpAvaliable:T=!1,depth:R,index:I,visibleIndex:M,prevVisibleId:D,nextVisibleId:E}){super();z(this,"id");z(this,"zIndex");z(this,"orderIndex");z(this,"parentId");z(this,"type");z(this,"selectedBackgroundType");z(this,"section");z(this,"children");z(this,"name");z(this,"defaultName");z(this,"iconStyles");z(this,"iconSvgStyles");z(this,"isCollapsed");z(this,"isSelected");z(this,"isLocked");z(this,"isHidden");z(this,"isHover");z(this,"isFiltered");z(this,"isGlobal");z(this,"isDefaultVpAvaliable");z(this,"isPhoneVpAvaliable");z(this,"depth");z(this,"index");z(this,"visibleIndex");z(this,"prevVisibleId");z(this,"nextVisibleId");this.initStore(),this.setState({id:t,zIndex:r,orderIndex:i,parentId:n,type:s,selectedBackgroundType:l,section:c,children:d,name:p,defaultName:m,iconStyles:u,iconSvgStyles:g,isLocked:h,isHidden:b,isGlobal:x,isSelected:S,isCollapsed:y,isHover:C,isFiltered:P,isDefaultVpAvaliable:v,isPhoneVpAvaliable:T,depth:R,index:I,visibleIndex:M,prevVisibleId:D,nextVisibleId:E})}setIsHover(t){this.setState(r=>({...r,isHover:t}))}},{Provider:pP,useStore:sp}=nn.createContext();So();JI();function cP({order:e,blocks:o,packsData:t,isPhoneVpEnabled:r,filter:i="all"},{oldFlatOrder:n,oldBackgroundLayer:s}={}){let l=MA(e),c=new Map,d=new Map(t.map(y=>[y.pack_id,y])),p=new Map,m=new Map,u=new Map,g=null;for(let y of o){let C=y.model,P=C.get("_id");if(C.get("type")==="background"){g=s||new np({id:P,name:"Background",iconStyles:ks(y),iconSvgStyles:ap(y),isSelected:!!y?.isSelected(),selectedBackgroundType:C?.get("selectedType")}),p.set(P,y);continue}let T=C.get("z"),R=l.get(P)?.index??-1/0,I=C.get("is_above"),M=C.get("pack_id")||null,D=!!C.get("fixed_position");p.set(P,y);let E=l.get(P)?.section||null;if(E||(I?E="aboveAll":D?E="frontFixed":E="normal"),!E)continue;let A=n?.get(P)||new np({id:P,zIndex:T,orderIndex:R,section:E,parentId:M,type:"widget",name:C.get("name")||y.getStandardName(),defaultName:y.getStandardName(),iconStyles:ks(y),iconSvgStyles:ap(y),isHidden:!!C.get("hidden"),isLocked:!!C.get("is_locked"),isGlobal:!!C.get("is_global"),isFiltered:ka(i,[y]),isSelected:!!y?.isSelected(),isDefaultVpAvaliable:C&&C.viewport_default&&!C.viewport_default?.hidden,isPhoneVpAvaliable:r&&C&&C.viewport_phone_portrait&&!C.viewport_phone_portrait?.hidden});if(n?.get(P)&&A.setState($=>({...$,orderIndex:R,zIndex:T,section:E,parentId:M})),!A.parentId)c.set(A.id,A);else{let j=m.get(M),pe=[...j?.children||[]],ee=Math.min(j?.orderIndex??1/0,A.orderIndex),G=Math.max(j?.zIndex??-1/0,A.zIndex);pe.push(A),j||(j=n?.get(M)||new np({id:M,zIndex:G,orderIndex:ee,section:E,children:pe,parentId:d.get(M)?.parent_id||null,type:"group",name:d.get(M)?.name||"Group",defaultName:"Group",iconStyles:{},iconSvgStyles:{},isHidden:!1,isLocked:!1})),j.isSelected&&A.setState(K=>({...K,isSelected:!0})),j.setState(K=>({...K,zIndex:G,orderIndex:ee,children:pe,parentId:d.get(M)?.parent_id||null})),m.set(M,j),c.set(M,j)}}let h=new Map;for(let y of m.values())if(y?.children?.length<cg){let C=y.children;c.delete(y.id);for(let P of C){P.setState(T=>({...T,parentId:y.parentId}));let v=u.get(P.id);u.set(P.id,{...v,_id:P.id,pack_id:y.parentId}),c.set(P.id,P)}}else h.set(y.id,y);let b=Array.from(c.values()).sort((y,C)=>{let P=y.orderIndex-C.orderIndex;return[NaN,-1/0,1/0].includes(P)&&(P=C.zIndex-y.zIndex),P}),x=new Map;for(let y of h.values())if(y.children){let C=new Set,P=new Set,v=new Set,T=new Set;for(let A of y.children){let $=p.get(A.id);if($){let j=x.get(y?.id),pe=j?.blocks||[];pe.push($);let ee=j?.model||new la({pack_id:y.id,mid:$?.workspace?.mag?.id});x.set(y.id,{blocks:pe,model:ee})}[-1/0,1/0].includes(A.orderIndex)&&(A.orderIndex=y.orderIndex),A.isGlobal&&T.add(A.id),A.isHidden&&C.add(A.id),A.isSelected&&P.add(A.id),A.isLocked&&v.add(A.id)}let R=P.size===y.children.length,I=y.isCollapsed?!(!R&&P.size>0):!1;y.setState(A=>({...A,isSelected:R,isCollapsed:I,isHidden:C.size===(y?.children?.length||0),isLocked:v.size===(y?.children?.length||0),isGlobal:T.size===(y?.children?.length||0),isFiltered:ka(i,x.get(y.id)?.blocks||[])})),y.children.sort((A,$)=>{let j=A.orderIndex-$.orderIndex;return[NaN,-1/0,1/0].includes(j)&&(j=$.zIndex-A.zIndex),j});let{iconStyles:M,iconSvgStyles:D}=BA(y.children,p);y.setState(A=>({...A,iconStyles:M,iconSvgStyles:D}));let E=b.findIndex(A=>A.id===y.id);E>-1&&b.splice(E+1,0,...y.children)}return{sortedFlatOrderMap:new Map(b.map(y=>[y.id,y])),widgetPacksMap:x,blocksMap:p,backgroundLayer:g,changesSet:Array.from(u.values())}}function MA(e){let o=new Map,t=0,r=(i,n)=>{for(let s of i)Array.isArray(s)?r(s,n):(o.set(s,{id:s,index:t,section:n}),t++)};for(let i in e){let n=i;r(e[n],n)}return o}function ap(e,o){if(!e)return{};let t=e.model,r=e.getIconData?e.getIconData():o?.forGroups?e.iconData:null,i={};if(r?.$svg){let n=r.$svg.clone().get(0);t.get("type")==="hotspot"&&n.setAttribute("color","#ffffff");let{b64url:s}=qy.getNormalizedSvg(n);i={backgroundImage:`url(${s})`}}return i}function ks(e,o){if(!e)return{};let t=e?.getIconStyle?e.getIconStyle(o):{},r={};for(let i in t){let n=hx(i);r[n]=t[i]}return r}function BA(e,o){let t=[],r=[];for(let i=0;i<=3&&i<e.length;i++){let n=e[i],s=o.get(n.id),l=ks(s,{small:!0}),c=ap(s,{forGroups:!0});t.push(l),r.push(c)}return{iconStyles:t,iconSvgStyles:r}}So();function dP({items:e,selectedItems:o,startId:t}){if(!e)return null;if(t){if(!o.has(t))return e.get(t||"");let r=null,i=t;for(;i;){if(r=e.get(i||""),!r)continue;let n=r?.prevVisibleId;if(o.has(n||""))n&&(i=n);else break}return r}return null}function uP({items:e,selectedItems:o,startId:t,depth:r}){if(!e)return null;if(t){let i=e.get(t);for(;i;){let n=e.get(i.parentId||"");if(n&&!o.has(n.id)&&i.depth===r)return i.parentId;if(i&&i.type==="group"&&!o.has(i.id)&&i.depth+1===r)return i.id;i=e.get(i.prevVisibleId||"")}return null}return null}function mP({layers:e,activeId:o,overId:t,dragOffset:r,selectedItems:i,insertionMarker:n}){let s=e.getVisibleSectionByItemId(t),l=e.getVisibleItem(t),c=e.getVisibleItem(o),d=e.getPrevVisibleItem(t)||null,p=e.getNextVisibleItem(t)||null;c&&l&&(c?.visibleIndex<=l?.visibleIndex?(d=n==="atTheTop"?d:l,p=n==="atTheTop"?l:p):c?.visibleIndex>l?.visibleIndex&&(d=n==="atTheBottom"?dP({items:s?.value,selectedItems:i,startId:l?.id||null})||null:d,p=n==="atTheBottom"?p:l));let m=EA(r,fo.indentationWidth),u=(c?.depth||0)+m,g=zA(d,i,!!c?.isGlobal),h=Math.min(g,RA(p)),b=u;u>=g?b=g:u<h&&(b=h);function x(){return b===0||!d?null:b===d.depth?d.parentId:uP({items:s?.value,selectedItems:i,startId:d?.id||null,depth:b})??null}return{depth:b,maxDepth:g,minDepth:h,parentId:x()}}function RA(e){return e?e.depth:0}function zA(e,o,t){return e?e.parentId&&(o.has(e.parentId)||!!e.isGlobal!==t)?Math.max(0,e.depth-1):o.has(e.id)&&e.type==="group"?e.depth:e.type==="group"&&!e.isCollapsed?e.depth+1:e.depth:0}function EA(e,o){return Math.round(e/o)}function gP({layers:e,selectedItems:o,cursorTop:t,active:r,collisions:i}){let n,s=i[0],l=s?.data?.droppableContainer?.rect?.current,c=e.getVisibleItem(r.id);if(!l||!c)return;let d=l.top+l.height/2,p=t-d;o.has(s.id)||(p<0?n="atTheTop":n="atTheBottom");let m=e.getVisibleItem(s.id),u=m&&e.getNextVisibleItem(m.parentId),g=m&&e.getPrevVisibleItem(m.id),h=m&&e.getNextVisibleItem(m.id);return o.has(s.id)&&(p<0?g&&!o.has(g.id)||!g?n="atTheTop":n="atTheBottom":h&&!o.has(h.id)||!h?n="atTheBottom":n="atTheTop"),m?.type==="group"&&!m?.isCollapsed&&!!m.isGlobal!=!!c.isGlobal?n="atTheTop":h?.depth!==m?.depth&&u&&u.isGlobal!==!!c.isGlobal&&(n="atTheBottom"),n}So();var AA=1;function bP({allLayers:e,overId:o,selectedItems:t,projectedParentId:r,projectedDepth:i,insertionMarker:n,sections:s}){let l=[...e.values()],c=new Map,d=new Map,p=s.includes(o),m=e.get(r||""),u=p?o:e.get(o)?.section,g=hP(e,t);for(let y=0;y<g.length;y++){let C=g[y],P=e.get(C);if(!P)continue;if(ug(P.section,u)){if(!t.has(P.parentId||"")){if(m&&!!m?.isGlobal!=!!P.isGlobal){t.delete(C);continue}P.parentId!==r&&P.type!=="group"&&c.set(P.id,{_id:P.id,pack_id:r}),$A({item:P,projectedParentId:r,allLayers:e,changedPackMap:d}),P.depth=i,P.parentId=r}}else t.delete(C)}g=hP(e,t);let h=g.length>0&&e.get(g[0])||null;if(!h||!u)return{sortedItems:l,changesSet:[],globalGroupChanges:{}};let b=-1;if(h.id!==o&&(l.splice(h.index,1),b=LA({overId:o,items:l,sections:s,toSection:u,overIdIsSection:p})),b>-1){h.section=u;let y=p?b:n==="atTheBottom"?b+1:b;l.splice(y,0,h)}for(let y=1;y<g.length;y++){let C=g[y-1],P=g[y],v=l.findIndex(I=>I.id===P),T=nt(l.splice(v,1)[0]);T.section=u;let R=l.findIndex(I=>I.id===C);R>-1&&l.splice(R+1,0,T)}let x=new Map(l.map(y=>[y.id,y]));HA({changedPackMap:d,sortedItemsMap:x,changesMap:c});let S=DA({sortedItemsMap:x,changesMap:c});return{sortedItems:l,changesSet:Array.from(c.values()),globalGroupChanges:S}}function hP(e,o){let t=[];for(let r of o.values()){let i=e.get(r);i&&t.push({id:i.id,index:i.index})}return t.sort((r,i)=>r.index-i.index),t.map(r=>r.id)}function LA({overId:e,items:o,sections:t,toSection:r,overIdIsSection:i}){let n=new Map;for(let c=0;c<t.length;c++)n.set(t[c],{index:c});let s=n.get(r).index??-1;return s===-1?-1:o.findIndex(({id:c,section:d},p)=>i?r===d||n.get(d).index>s||p+1===o.length:c===e)}function DA({sortedItemsMap:e,changesMap:o}){let t={},r={removed:[]};for(let i of o.values()){let n=e.get(i._id||""),s=e.get(i.pack_id||"");!n||!n?.isGlobal||(s?(t?.pack_id||(t={added:[],pack_id:s.id,pack:OA(s.id,e)}),t?.added?.push(n.id)):r?.removed?.push(n.id))}return t.pack_id?t:r.removed&&r.removed.length>0?r:{}}function OA(e,o){let t=[];for(let r of o.values())r.parentId===e&&r.type!=="group"&&t.push(r.id);return t}function $A({item:e,projectedParentId:o,allLayers:t,changedPackMap:r}){if(e.parentId!==o){if(e.parentId){let i=r.get(e.parentId)?.childrenWidgets,n=r.get(e.parentId)?.childrenGroups;if(!i||!n){let{widgets:s,groups:l}=fP(t,e.parentId);i=s,n=l}e.type==="group"?n.delete(e.id):i.delete(e.id),r.set(e.parentId,{childrenWidgets:i,childrenGroups:n})}if(o){let i=r.get(o)?.childrenWidgets,n=r.get(o)?.childrenGroups;if(!i||!n){let{widgets:s,groups:l}=fP(t,o);i=s,n=l}e.type==="group"?n.add(e.id):i.add(e.id),r.set(o,{childrenWidgets:i,childrenGroups:n})}}}function fP(e,o){let t=e.get(o||""),r=new Set,i=new Set;if(!t||!t?.children)return{widgets:r,groups:i};for(let n of t?.children)n.type==="widget"?r.add(n.id):n.type==="group"&&i.add(n.id);return{widgets:r,groups:i}}function HA({changedPackMap:e,sortedItemsMap:o,changesMap:t}){for(let[r,i]of e){let n=o.get(r);if(!n)continue;let s=new Set([...i.childrenGroups,...i.childrenWidgets]),l=n.depth+1;if(s.size<cg)for(let c of s){let d=o.get(c);d&&(d.depth=n.depth,d.parentId=n.parentId,t.set(d.id,{_id:d.id,pack_id:d.parentId}))}else if(i.childrenGroups.size>0&&l>=AA)for(let c of i.childrenGroups){let d=o.get(c);if(d&&d.type==="group"){let p=d?.children||[];for(let m of p){let u=o.get(m.id);u&&(u.depth=l,u.parentId=n.id,t.set(u.id,{_id:u.id,pack_id:u.parentId}))}}}}}function wP({args:e,selectedItems:o,layers:t}){let{active:r,droppableContainers:i,droppableRects:n,pointerCoordinates:s}=e,l=[],c=r?.rect?.current?.initial?.top,d=t.getVisibleItem(r.id),p=t.getSections();if(!d||c===void 0||!s)return[];for(let m=0;m<i.length;m++){let u=i[m],g={data:{droppableContainer:u,value:0},id:u.id},h=n.get(u?.id);if(!h)continue;let b=p.includes(g.id),x=t.getVisibleItem(g.id),S=t.getPrevVisibleItem(g.id),y=t.getNextVisibleItem(g.id),C=t.getVisibleItem(x?.parentId||""),P=t.getVisibleItem(y?.parentId||"");if(!x&&!b||!ug(d.section,b?g.id:x?.section))continue;let T=h.top+h.height/2,R=Math.abs(T-s.y);g.data.value=R,o.has(g.id)&&S&&o.has(S.id)&&y&&o.has(y.id)&&(g.data.value=1/0),C&&!!C.isGlobal!=!!d.isGlobal&&P&&!!P.isGlobal!=!!d.isGlobal&&(g.data.value=1/0),l.push(g)}return l.sort((m,u)=>m.data.value-u.data.value),l}var Mg=class extends nn{constructor(){super();z(this,"selectedItems",new Set);z(this,"items",new Map);z(this,"visibleSectionItems",new Map);z(this,"visibleItems",new Map);z(this,"visibleIndexedItems",new Map);z(this,"visibleItemsArr",[]);z(this,"visibleSelectedItems",new Set);z(this,"visibleJustSelectedItems",[]);this.initStore()}resetState(){this.setState(t=>({...t,selectedItems:new Set,items:new Map,visibleSectionItems:new Map,visibleItems:new Map,visibleIndexedItems:new Map,visibleItemsArr:[],visibleSelectedItems:new Set,visibleJustSelectedItems:[]}))}refreshAllItems(t){let r=0;for(let i of t.values()){let n=mg(t,i.parentId);i.setState(s=>({...s,depth:n,index:r})),r++}this.setState(i=>({...i,items:t})),this.refreshState(t)}refreshState(t){let r=t||this.items,i=this.visibleSelectedItems,n=new Set,s=lP(r),l=new Set,c=[],d=new Map,p=new Map;for(let m of s.values())for(let[u,g]of m)d.set(u,g),p.set(g.visibleIndex,g),g.isSelected&&(l.add(g.id),n.add(g.id),g.type==="group"&&g.isCollapsed&&yn(r,g.id,h=>{n.add(h.id)}));for(let m of l)d.get(m)&&(l.add(m),i.has(m)||c.push(m));this.setState(m=>({...m,selectedItems:n,visibleSectionItems:s,visibleItems:d,visibleIndexedItems:p,visibleItemsArr:Array.from(d.values()),visibleSelectedItems:l,visibleJustSelectedItems:c}))}filterItems(t,r,i){for(let[n,s]of this.items){let l=i.get(n),c=r.get(n),d=!0;l&&l.blocks?d=ka(t,l.blocks):c&&(d=ka(t,[c])),s.setState(p=>({...p,isFiltered:d}))}this.refreshState()}setCollapse(t,r,i){let n=this.getAllItems();for(let s of t){let l=n.get(s);if(l){let c=i??!l.isCollapsed,d=r?r.has(l.id):l.isSelected;if(!c&&l?.children){let p=l.children;for(let m of p){let u=r?r.has(m.id):m.isSelected;m.setState(g=>({...g,isSelected:u}))}}l.setState(p=>({...p,isSelected:d,isCollapsed:c}))}}this.refreshState()}refreshLayerState(t,r){let i=this.getAllItems(),n=t.model,s=n.get("_id"),l=i.get(s);if(l){let c=l.isSelected,d=l.isFiltered,p=!!t?.isSelected(),m=ka(r,[t]);l.setState(g=>({...g,name:n.get("name")||t?.getStandardName(),iconStyles:ks(t),iconSvgStyles:ap(t),isHidden:n.get("hidden"),isLocked:n.get("is_locked"),isGlobal:n.get("is_global"),isSelected:p,isFiltered:m}));let u=i.get(l.parentId||"");if(u&&u?.children){let g=new Set,h=new Set,b=new Set,x=new Set,S=-1;for(let y=0;y<u.children.length;y++){let C=u.children[y];S=C.id===l.id?y:S,C.isHidden&&g.add(C.id),C.isLocked&&h.add(C.id),C.isSelected&&b.add(C.id),C.isFiltered&&x.add(C.id)}if(S>-1){let y=ks(t,{small:!0}),C=ap(t,{forGroups:!0}),P=Array.isArray(u.iconStyles)?nt(u.iconStyles):[],v=Array.isArray(u.iconSvgStyles)?nt(u.iconSvgStyles):[];P[S]=y,v[S]=C,u.setState(T=>({...T,iconStyles:P,iconSvgStyles:v,isHidden:g.size===(u?.children?.length||0),isLocked:h.size===(u?.children?.length||0),isSelected:b.size===(u?.children?.length||0),isFiltered:x.size>0}))}}if(d!==m)this.refreshState();else if(c!==p){let g=new Set(this.visibleSelectedItems);g.delete(s);let{selectedItems:h,visibleSelectedItems:b}=this.getSelectedItemsParams(g);this.setState(x=>({...x,selectedItems:h,visibleSelectedItems:b}))}}}selectAndOpenGroupIfNeeded(t){let r=this.getAllItems(),i=Array.from(this.selectedItems.values()),n=Array.from(t.values()),s=Os(i,n),l=!1;for(let c of t){let d=r.get(c);if(!d)continue;let p=r.get(d?.parentId||""),m=t.has(p?.id||"");p?.isCollapsed&&!m&&(p.setState(g=>({...g,isCollapsed:!1})),l=!0),d.setState(g=>({...g,isSelected:!0}))}for(let c of s){let d=r.get(c);d&&d.setState(p=>({...p,isSelected:!1}))}if(l)this.refreshState();else{let{selectedItems:c,visibleSelectedItems:d,visibleJustSelectedItems:p}=this.getSelectedItemsParams(t);this.setState(m=>({...m,selectedItems:c,visibleSelectedItems:d,visibleJustSelectedItems:p}))}}getSelectedItemsParams(t){let r=this.items,i=this.visibleItems,n=this.visibleSelectedItems,s=new Set,l=[],c=new Set;for(let d of t){let p=r.get(d),m=i.get(d);p&&c.add(d),m&&s.add(d),m&&!n.has(d)&&l.push(d),p?.type==="group"&&yn(r,p.id,u=>{c.add(u.id)})}return{selectedItems:c,visibleSelectedItems:s,visibleJustSelectedItems:l}}getProjection(t){return mP({layers:this,selectedItems:this.getVisibleSelectedItems(),...t})}getInsertionMarkerPos(t){return gP({layers:this,selectedItems:this.getVisibleSelectedItems(),...t})}getVisibleItem(t){return t&&this.visibleItems.get(t)||null}getVisibleItemByIndex(t){return this.visibleIndexedItems.get(t)}getPrevVisibleItem(t){let r=this.getVisibleItem(t);return r?this.getVisibleItem(r.prevVisibleId):null}getNextVisibleItem(t){let r=this.getVisibleItem(t);return r?this.getVisibleItem(r.nextVisibleId):null}getVisibleSection(t){return this.visibleSectionItems.get(t||"")}getVisibleSectionByItemId(t){let r=this.visibleSectionItems;for(let[i,n]of r){if(t===i)return{id:i,value:n};if(r.get(i)?.get(t))return{id:i,value:n}}return null}getSections(t){if(t?.onlyNotEmpty){let r=[];for(let[i,n]of this.visibleSectionItems)n.size>0&&r.push(i);return r}return Array.from(this.visibleSectionItems.keys())}getAllVisibleItems(){return this.visibleItems}getAllItems(){return this.items}getVisibleSelectedItems(){return this.visibleSelectedItems}getSelectedItems(){return this.selectedItems}moveSelectedBlocks(t){return bP({allLayers:this.getAllItems(),selectedItems:this.getSelectedItems(),sections:this.getSections(),...t})}getClosestCollisions(t){return wP({layers:this,selectedItems:this.getVisibleSelectedItems(),...t})}doesSectionNeedToBeRendered(t){let r=this.getVisibleItemByIndex(t);return this.doSectionsNeedToBeRendered()&&r?.prevVisibleId===null}doSectionsNeedToBeRendered(){return this.getSections({onlyNotEmpty:!0}).length>1}getTopOfItem(t){let r=this.getVisibleItem(t),i=this.doSectionsNeedToBeRendered(),n=this.getSections({onlyNotEmpty:!0});if(r){let s=(r?.visibleIndex||0)*fo.height,l=0,c=i?n.findIndex(d=>d===r.section):-1;return c>-1&&(l=(c+1)*ji.height),l+s}return 0}getScrollPositionForSelectedItems(t){let r=this.visibleJustSelectedItems,i=1/0,n=-1/0;for(let s of r){let l=this.getTopOfItem(s),c=fo.height,d=l+c;i=Math.min(i,l),n=Math.max(n,d)}if(i<1/0&&n>-1/0){let s=n-i,l=i+s/2,c=t/2,d=l-c;return{top:i,scrollToPos:d,bottom:n}}return null}},{useStore:ei,Provider:xP}=nn.createContext();var lo=B(H());function vP(e,o,t){let r=e.slice();return r.splice(t<0?r.length+t:t,0,r.splice(o,1)[0]),r}function FA(e,o){return e.reduce((t,r,i)=>{let n=o.get(r);return n&&(t[i]=n),t},Array(e.length))}function Bg(e){return e!==null&&e>=0}function NA(e,o){if(e===o)return!0;if(e.length!==o.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==o[t])return!1;return!0}function WA(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}var yP=e=>{let{rects:o,activeIndex:t,overIndex:r,index:i}=e,n=vP(o,r,t),s=o[i],l=n[i];return!l||!s?null:{x:l.left-s.left,y:l.top-s.top,scaleX:l.width/s.width,scaleY:l.height/s.height}};var Rg={scaleX:1,scaleY:1},kP=e=>{var o;let{activeIndex:t,activeNodeRect:r,index:i,rects:n,overIndex:s}=e,l=(o=n[t])!=null?o:r;if(!l)return null;if(i===t){let d=n[s];return d?{x:0,y:t<s?d.top+d.height-(l.top+l.height):d.top-l.top,...Rg}:null}let c=VA(n,i,t);return i>t&&i<=s?{x:0,y:-l.height-c,...Rg}:i<t&&i>=s?{x:0,y:l.height+c,...Rg}:{x:0,y:0,...Rg}};function VA(e,o,t){let r=e[o],i=e[o-1],n=e[o+1];return r?t<o?i?r.top-(i.top+i.height):n?n.top-(r.top+r.height):0:n?n.top-(r.top+r.height):i?r.top-(i.top+i.height):0:0}var _P="Sortable",SP=lo.default.createContext({activeIndex:-1,containerId:_P,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:yP,disabled:{draggable:!1,droppable:!1}});function CP(e){let{children:o,id:t,items:r,strategy:i=yP,disabled:n=!1}=e,{active:s,dragOverlay:l,droppableRects:c,over:d,measureDroppableContainers:p}=aP(),m=Ca(_P,t),u=l.rect!==null,g=(0,lo.useMemo)(()=>r.map(T=>typeof T=="object"&&"id"in T?T.id:T),[r]),h=s!=null,b=s?g.indexOf(s.id):-1,x=d?g.indexOf(d.id):-1,S=(0,lo.useRef)(g),y=!NA(g,S.current),C=x!==-1&&b===-1||y,P=WA(n);Lr(()=>{y&&h&&p(g)},[y,g,h,p]),(0,lo.useEffect)(()=>{S.current=g},[g]);let v=(0,lo.useMemo)(()=>({activeIndex:b,containerId:m,disabled:P,disableTransforms:C,items:g,overIndex:x,useDragOverlay:u,sortedRects:FA(g,c),strategy:i}),[b,m,P.draggable,P.droppable,C,g,x,c,u,i]);return lo.default.createElement(SP.Provider,{value:v},o)}var UA=e=>{let{id:o,items:t,activeIndex:r,overIndex:i}=e;return vP(t,r,i).indexOf(o)},GA=e=>{let{containerId:o,isSorting:t,wasDragging:r,index:i,items:n,newIndex:s,previousItems:l,previousContainerId:c,transition:d}=e;return!d||!r||l!==n&&i===s?!1:t?!0:s!==i&&o===c},jA={duration:200,easing:"ease"},PP="transform",qA=Ql.Transition.toString({property:PP,duration:0,easing:"linear"}),YA={roleDescription:"sortable"};function XA(e){let{disabled:o,index:t,node:r,rect:i}=e,[n,s]=(0,lo.useState)(null),l=(0,lo.useRef)(t);return Lr(()=>{if(!o&&t!==l.current&&r.current){let c=i.current;if(c){let d=Ba(r.current,{ignoreTransform:!0}),p={x:c.left-d.left,y:c.top-d.top,scaleX:c.width/d.width,scaleY:c.height/d.height};(p.x||p.y)&&s(p)}}t!==l.current&&(l.current=t)},[o,t,r,i]),(0,lo.useEffect)(()=>{n&&s(null)},[n]),n}function TP(e){let{animateLayoutChanges:o=GA,attributes:t,disabled:r,data:i,getNewIndex:n=UA,id:s,strategy:l,resizeObserverConfig:c,transition:d=jA}=e,{items:p,containerId:m,activeIndex:u,disabled:g,disableTransforms:h,sortedRects:b,overIndex:x,useDragOverlay:S,strategy:y}=(0,lo.useContext)(SP),C=KA(r,g),P=p.indexOf(s),v=(0,lo.useMemo)(()=>({sortable:{containerId:m,index:P,items:p},...i}),[m,i,P,p]),T=(0,lo.useMemo)(()=>p.slice(p.indexOf(s)),[p,s]),{rect:R,node:I,isOver:M,setNodeRef:D}=Ig({id:s,data:v,disabled:C.droppable,resizeObserverConfig:{updateMeasurementsFor:T,...c}}),{active:E,activatorEvent:A,activeNodeRect:$,attributes:j,setNodeRef:pe,listeners:ee,isDragging:G,over:K,setActivatorNodeRef:we,transform:xe}=sP({id:s,data:v,attributes:{...YA,...t},disabled:C.draggable}),_e=T4(D,pe),ie=!!E,ze=ie&&!h&&Bg(u)&&Bg(x),ne=!S&&G,J=ne&&ze?xe:null,Q=ze?J??(l??y)({rects:b,activeNodeRect:$,activeIndex:u,overIndex:x,index:P}):null,te=Bg(u)&&Bg(x)?n({id:s,items:p,activeIndex:u,overIndex:x}):P,ye=E?.id,de=(0,lo.useRef)({activeId:ye,items:p,newIndex:te,containerId:m}),Se=p!==de.current.items,be=o({active:E,containerId:m,isDragging:G,isSorting:ie,id:s,index:P,items:p,newIndex:de.current.newIndex,previousItems:de.current.items,previousContainerId:de.current.containerId,transition:d,wasDragging:de.current.activeId!=null}),Ae=XA({disabled:!be,index:P,node:I,rect:R});return(0,lo.useEffect)(()=>{ie&&de.current.newIndex!==te&&(de.current.newIndex=te),m!==de.current.containerId&&(de.current.containerId=m),p!==de.current.items&&(de.current.items=p)},[ie,te,m,p]),(0,lo.useEffect)(()=>{if(ye===de.current.activeId)return;if(ye&&!de.current.activeId){de.current.activeId=ye;return}let O=setTimeout(()=>{de.current.activeId=ye},50);return()=>clearTimeout(O)},[ye]),{active:E,activeIndex:u,attributes:j,data:v,rect:R,index:P,newIndex:te,items:p,isOver:M,isSorting:ie,isDragging:G,listeners:ee,node:I,overIndex:x,over:K,setNodeRef:_e,setActivatorNodeRef:we,setDroppableNodeRef:D,setDraggableNodeRef:pe,transform:Ae??Q,transition:Qe()};function Qe(){if(Ae||Se&&de.current.newIndex===P)return qA;if(!(ne&&!Lc(A)||!d)&&(ie||be))return Ql.Transition.toString({...d,property:PP})}}function KA(e,o){var t,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(t=e?.draggable)!=null?t:o.draggable,droppable:(r=e?.droppable)!=null?r:o.droppable}}var A1e=[kt.Down,kt.Right,kt.Up,kt.Left];N();var Fc=B(H());oe();So();k();var ZA=F(f)`
  background-color: ${e=>e.theme.colors.white};
  border-radius: 1px;
  height: ${ya.height}px;
`,IP=(0,Fc.memo)(({overId:e,insertionMarkerPos:o,paddingLeft:t})=>{let[r,i,n,s]=ei(d=>[d.getVisibleItem,d.getVisibleSection,d.getSections,d.doSectionsNeedToBeRendered],!0),l=(0,Fc.useMemo)(()=>!!i(e),[e]),c=(0,Fc.useMemo)(()=>{let d=r(e),p=i(e),m=s(),u=n({onlyNotEmpty:!0});if(d&&!l){let g=(d?.visibleIndex||0)*fo.height,h=0,b=m?u.findIndex(x=>x===d.section):-1;return b>-1&&(h=(b+1)*ji.height),g+h-ya.middle}else if(p&&l){let g=0,h=0;for(let b=0;b<u.length;b++){let x=u[b],S=i(x)?.size||0;if(h+=ji.height,x===e)return h+g-ya.middle;g+=S*fo.height}return 0}else return 0},[e,l]);return a(q,{children:o&&a(f,{paddingLeft:`${t}px`,children:a(f,{position:"relative",height:"0",children:a(f,{padding:"0 16px",top:"0",left:"0",zIndex:"1",width:"100%",position:"absolute",transform:`translate(0,${l?c:c+(o==="atTheTop"?0:fo.height)}px)`,children:a(ZA,{})})})})})},(e,o)=>$s(e,o));function MP(){return a(f,{height:ya.middle})}var hp=B(H());N();oe();k();var JA={aboveAll:"Fixed on all pages",frontFixed:"Front Fixed",normal:"Widgets",backFixed:"Back Fixed"},QA=F(f)`
  color: ${e=>e.theme.colors.white};
`;function BP({id:e}){let{setNodeRef:o}=Ig({id:e});return a(QA,{ref:o,children:a(f,{fontWeight:600,opacity:.5,fontSize:"12px",padding:"12px 0px 2px 16px",height:ji.height,userSelect:"none",children:JA[e]})})}N();var _s=B(H());zt();N();oe();N();Ve();k();function RP(e){return a(f,{display:"flex",justifyContent:"center",alignItems:"center",...e,children:a("svg",{width:"10",height:"7",viewBox:"0 0 10 7",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.75927 6.1142C5.36017 6.57981 4.63985 6.57981 4.24076 6.1142L0.414978 1.65079C-0.141028 1.00212 0.319881 -1.01881e-08 1.17423 0L8.82579 9.12439e-08C9.68015 1.01432e-07 10.1411 1.00212 9.58505 1.65079L5.75927 6.1142Z",fill:V.gray})})})}function zP(){return a("svg",{width:"8",height:"14",viewBox:"0 0 8 14",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.99997 0C0.8954 0 -3.05176e-05 0.89543 -3.05176e-05 2V12C-3.05176e-05 13.1046 0.8954 14 1.99997 14H5.99997C7.10454 14 7.99997 13.1046 7.99997 12V2C7.99997 0.895431 7.10454 0 5.99997 0H1.99997ZM2.49997 12C2.22383 12 1.99997 12.2239 1.99997 12.5C1.99997 12.7761 2.22383 13 2.49997 13H5.49997C5.77611 13 5.99997 12.7761 5.99997 12.5C5.99997 12.2239 5.77611 12 5.49997 12H2.49997Z"})})}function EP(){return a("svg",{width:"12",height:"17",viewBox:"0 0 12 17",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0C3.79094 0 2 1.79061 2 3.99983V5C2 5.55228 2.44772 6 3 6C3.55228 6 4 5.55228 4 5V3.99983C4 2.89533 4.89536 2 6 2C7.10457 2 8 2.89543 8 4V8H6H2C0.895431 8 0 8.89543 0 10V15C0 16.1046 0.895431 17 2 17H10C11.1046 17 12 16.1046 12 15V10C12 8.89543 11.1046 8 10 8V4C10 1.79086 8.20914 0 6 0Z"})})}function AP(){return w("svg",{width:"30px",height:"22px",viewBox:"0 0 30 22",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[a("title",{children:"icon"}),a("desc",{children:"Created with Sketch."}),a("defs",{}),a("g",{id:"Page-1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:a("g",{id:"Widget-bar---Layers",transform:"translate(-548.000000, -751.000000)",fill:"#FFFFFF",children:a("g",{id:"WIDGETS-layers-Copy-2",transform:"translate(531.000000, 184.000000)",children:a("g",{id:"background",transform:"translate(8.000000, 554.000000)",children:a("g",{id:"Video",children:w("g",{id:"icon",transform:"translate(9.000000, 13.000000)",children:[a("rect",{id:"Rectangle-9-Copy-16",x:"0",y:"0",width:"22",height:"22",rx:"4.08000004"}),a("path",{d:"M18.4090909,10.9838522 L27.5612379,3.64006124 L27.5612379,3.64006124 C28.20737,3.12159726 29.1514616,3.22509267 29.6699255,3.8712247 C29.8835647,4.13747092 30,4.46862374 30,4.80998678 L30,17.1577176 L30,17.1577176 C30,17.9861447 29.3284271,18.6577176 28.5,18.6577176 C28.158637,18.6577176 27.8274841,18.5412822 27.5612379,18.3276431 L18.4090909,10.9838522 Z",id:"Triangle-6"})]})})})})})})]})}N();var LP=B(H());Fp();zt();k();function zg({isBackgroundVideo:e,iconStyles:o,iconSvg:t}){let r=Hi(()=>Array.isArray(o)?o:[o],[o]),i=Hi(()=>Array.isArray(t)?t:[t],[t]),n=Hi(()=>r.length>1,[r]),{gridTemplateColumns:s,gridTemplateRows:l,gridTemplateAreas:c}=(0,LP.useMemo)(()=>{let d="";switch(r.length){case 1:return{gridTemplateColumns:"1fr",gridTemplateRows:"1fr",gridTemplateAreas:'"icon-0"'};case 2:return{gridTemplateColumns:"1fr 1fr",gridTemplateRows:"1fr",gridTemplateAreas:'"icon-0 icon-1"'};case 3:return d=`
        "icon-0 icon-1"
        "icon-0 icon-2"
        `,{gridTemplateColumns:"1fr 1fr",gridTemplateRows:"1fr 1fr",gridTemplateAreas:d};case 4:return d=`
        "icon-0 icon-1"
        "icon-2 icon-3"
        `,{gridTemplateColumns:"1fr 1fr",gridTemplateRows:"1fr 1fr",gridTemplateAreas:d};default:return{gridTemplateColumns:"1fr",gridTemplateRows:"1fr"}}},[r]);return a(f,{pointerEvents:"none",children:a(f,{width:"48px",height:"48px",borderRadius:n?"8px":"0",overflow:"hidden",position:e?"relative":"static",children:a(f,{width:"100%",height:"100%",display:"grid",gap:"2px",gridTemplateColumns:s,gridTemplateRows:l,gridTemplateAreas:c,children:r.map((d,p)=>a(f,{backgroundPosition:"center",backgroundSize:e?"auto 150%":"contain",backgroundRepeat:"no-repeat",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:n?"0px":"8px",overflow:"hidden",style:{...d,gridArea:`icon-${p}`},children:e?a(f,{position:"absolute",top:"0",left:"0",height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:({theme:m})=>Le(.3,m?.colors?.black||"black"),children:a(AP,{})}):a(f,{width:n?"15px":"32px",height:n?"15px":"32px",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",style:i[p]})},p))})})})}pn();Vh();var Eg=class extends nn{constructor(){super();z(this,"filter","all");z(this,"layers",new Mg);z(this,"blocksMap",new Map);z(this,"packBlocks",{});z(this,"widgetPacksMap",new Map);z(this,"dragIsActive",!1);z(this,"editModeIsActive",!1);z(this,"backgroundLayer",null);z(this,"accumulatedOrderChanges",[]);z(this,"shiftIsPressed",!1);z(this,"ctrlIsPressed",!1);this.initStore();let t=this.getInitialFilter();this.setState(r=>({...r,filter:t}))}updateLayers(t){let{sortedFlatOrderMap:r,blocksMap:i,widgetPacksMap:n,backgroundLayer:s,changesSet:l}=cP({...t,filter:this.filter},{oldFlatOrder:this.layers.getAllItems(),oldBackgroundLayer:this.backgroundLayer});this.layers.refreshAllItems(r),this.setState(c=>({...c,blocksMap:i,widgetPacksMap:n,packBlocks:t.packs,backgroundLayer:s,accumulatedOrderChanges:l}))}resetState(){this.layers.resetState(),this.setState(t=>({...t,layers:this.layers,blocksMap:new Map,packBlocks:{},widgetPacksMap:new Map,dragIsActive:!1,editModeIsActive:!1,backgroundLayer:null,accumulatedOrderChanges:[]}))}getBlock(t){return this.blocksMap.get(t)}getPackBlock(t){return this.packBlocks[t]}getWidgetPack(t){return this.widgetPacksMap.get(t)}isDragActive(){return this.dragIsActive}isEditModeActive(){return this.editModeIsActive}isShiftPressed(){return this.shiftIsPressed}isCtrlPressed(){return this.ctrlIsPressed}setEditModeIsActive(t){return this.setState(r=>({...r,editModeIsActive:t}))}setDragIsActive(t){this.setState(r=>({...r,dragIsActive:t}))}setShiftIsPressed(t){this.setState(r=>({...r,shiftIsPressed:t}))}setCtrlIsPressed(t){this.setState(r=>({...r,ctrlIsPressed:t}))}getInitialFilter(){let t=this.filter,r=gg();return r&&r!==t&&t==="all"?r:t}getFilter(){return this.filter}setFilter(t){this.setState(r=>({...r,filter:t})),this.layers.filterItems(t,this.blocksMap,this.widgetPacksMap)}refreshBackgroundState(t){let r=this.backgroundLayer;r&&r.setState(i=>({...i,iconStyles:ks(t),selectedBackgroundType:t?.model?.get("selectedType")}))}mergeOrderChanges(t){let r=new Map(t.map(i=>[i?._id,i]));for(let i of this.accumulatedOrderChanges){let n=i._id;if(!n)continue;let s=r.get(i._id);r.set(n,{...i,...s})}return this.setState(i=>({...i,accumulatedOrderChanges:[]})),Array.from(r.values())}},{Provider:DP,useStore:ti}=nn.createContext();jt();dr();N();var qi=B(H());So();Pd();var dw=B(Js());k();var OP=(0,qi.memo)(({onLayerRename:e})=>{let o=(0,qi.useRef)(null),[t,r]=sp(u=>[u.name,u.defaultName]),[i]=ti(u=>[u.setEditModeIsActive],!0),[n,s]=(0,qi.useState)(!1),[l,c]=(0,qi.useState)(()=>t);(0,qi.useEffect)(()=>{c(t)},[t]),(0,qi.useEffect)(()=>(n?document.addEventListener("keydown",d):document.removeEventListener("keydown",d),i(n),()=>{document.removeEventListener("keydown",d)}),[n]);let d=u=>{u.code===dw.Key.Enter?o.current?.blur():u.code===dw.Key.Escape&&(c(r),o.current?.blur())},p=()=>{s(!0),yd(()=>{o?.current?.select()})};return w(f,{position:"relative",color:({theme:u})=>u?.colors.white||"white",children:[a(yt,{ref:o,userSelect:n?"auto":"none",onClick:u=>u.stopPropagation(),onBlur:()=>{s(!1),e(l)},textStyle:"small",value:l,padding:"0",border:"none !important",color:"inherit",onChange:u=>c(u.target.value),css:u=>ae`
          ::selection {
            background-color: ${u.colors.black};
          }
        `}),!n&&a(f,{onDoubleClick:u=>{u.stopPropagation(),p()},position:"absolute",top:"0",left:"0",width:"100%",height:"100%"})]})});k();var eL=F(f,{excludeProps:["isActive","isProjected"]})`
  list-style: none;
  position: 'relative';
  padding-left: ${({paddingLeft:e})=>e}px;
  z-index: 1;
  background-color: ${({isActive:e,theme:o})=>e?`${Le(.58,o.colors.darkGray)}`:"transperent"};
  border: 1px solid
    ${({isProjected:e,theme:o})=>e?`${Le(.84,o.colors.gray)}`:`${Le(1,o.colors.gray)}`};
`,uw=F(f,{excludeProps:["isDisplayed","isHidden"]})`
  width: 24px;
  height: 24px;
  display: flex;
  justify-content: center;
  align-items: center;
  color: ${({theme:e})=>e?.colors.gray};
  display: ${({isDisplayed:e})=>e?"flex":"none"};
  visibility: ${({isHidden:e})=>e?"hidden":"visible"};
  transition: color 0.2s;

  &:hover {
    color: ${({theme:e})=>e?.colors.lightGray};
    cursor: pointer;
  }
  &:not(:last-child) {
    margin-right: 4px;
  }
`,$P=e=>{let{viewport:o}=(0,_s.useContext)(qe);return a(tL,{viewport:o,...e})},tL=(0,_s.memo)(e=>{let{viewport:o,attributes:t,isProjected:r,onSelected:i,onLayerHover:n,onLayerHide:s,onLayerLock:l,onLayerRename:c,onLayerSwitchToViewport:d}=e,[p]=ei(K=>[K.setCollapse],!0),[m]=ti(K=>[K.isDragActive],!0),[u,g,h,b,x,S,y,C,P,v,T,R,I,M]=sp(K=>[K.id,K.type,K.depth,K.isHidden,K.isHover,K.isGlobal,K.isLocked,K.isSelected,K.isCollapsed,K.isDefaultVpAvaliable,K.isPhoneVpAvaliable,K.iconStyles,K.iconSvgStyles,K.setIsHover],!0),D=(0,_s.useMemo)(()=>o?o==="default"?T?"phone_portrait":null:["phone_portrait","tablet_portrait"].includes(o)&&v?"default":null:null,[o,v,T]);(0,_s.useEffect)(()=>{n(u,x)},[x]);let E=K=>{m()?M(!1):M(K)},A=()=>{m()?M(!1):M(!0)},$=()=>{p([u])},j=()=>{s(u,!b)},pe=()=>{l(u,!y)},ee=K=>{c(u,K)},G=()=>{D&&d(u,D)};return a(eL,{paddingLeft:fo.indentationWidth*h,isActive:C,isProjected:r,onClick:()=>i(u),onMouseEnter:()=>E(!0),onMouseLeave:()=>E(!1),onMouseMove:A,children:w(f,{width:"100%",maxWidth:"100%",display:"flex",height:fo.height-2,padding:"3px 16px",...t,children:[w(f,{display:"flex",flexGrow:"1",minWidth:"0",alignItems:"center",flexDirection:"row",style:{opacity:b?.2:1},children:[a(zg,{iconStyles:R,iconSvg:I}),g==="group"&&a(f,{display:"flex",width:"18px",paddingLeft:"6px",onClick:K=>{K.stopPropagation(),$()},children:a(RP,{width:"12px",height:"16px",transform:`rotate(${P?-90:0}deg)`,transition:"transform 0.3s",fill:({theme:K})=>K?.colors.gray||"gray"})}),a(f,{paddingLeft:"8px",flexGrow:"1",minWidth:"0",maskImage:"linear-gradient(to right, #000000 70%, rgba(0, 0, 0, 0) 90%, rgba(0, 0, 0, 0))",children:a(OP,{onLayerRename:ee})})]}),w(f,{flexShrink:"0",flexBasis:"auto",height:"100%",alignItems:"center",display:"flex",children:[D&&a(uw,{isDisplayed:x,onClick:K=>{K.stopPropagation(),G()},children:D==="phone_portrait"?a(zP,{}):a(uu,{width:"20px"})}),a(uw,{isDisplayed:x,onClick:K=>{K.stopPropagation(),j()},children:b?a(ul,{}):a(sy,{})}),a(uw,{isDisplayed:x||y,isHidden:b,onClick:K=>{K.stopPropagation(),pe()},children:y?a(cu,{}):a(EP,{})})]}),S&&a(f,{display:"relative",userSelect:"none",children:a(f,{position:"absolute",right:"25px",fontSize:"10px",children:"G"})})]})})});var Ag=B(H());So();k();var HP=(0,Ag.memo)(e=>{let[o]=sp(n=>[n.id]),{attributes:t,listeners:r,setNodeRef:i}=TP({id:o});return a(oL,{ref:i,attributes:t,listeners:r,...e})},(e,o)=>$s(e,o)),oL=(0,Ag.forwardRef)(({listeners:e,...o},t)=>a("li",{ref:t,...e,children:a($P,{...o})}));var G3=B(L3()),j3=B(U3());k();var q3=(0,hp.memo)(e=>{let{virtualizedListRef:o,projectedParentId:t,...r}=e,[i,n,s,l,c,d]=ei(u=>[u.visibleItemsArr,u.getVisibleItemByIndex,u.getVisibleSection,u.getSections,u.doesSectionNeedToBeRendered,u.doSectionsNeedToBeRendered],!0);(0,hp.useEffect)(()=>{o?.current?.recomputeRowHeights(0)},[i]);let p=({index:u})=>c(u)?ji.height+fo.height:fo.height,m=(0,hp.useMemo)(()=>{let u=0,g=l({onlyNotEmpty:!0}),h=d();for(let b=0;b<g.length;b++){let x=g[b],S=s(x)?.size||0,y=h?ji.height:0,C=S*fo.height;u+=y+C}return u},[i]);return a(j3.default,{style:{height:m+"px"},children:({width:u,height:g})=>a(G3.default,{ref:o,width:u,height:g,overscanRowCount:1,style:{overflowX:"visible",overflowY:"visible"},rowCount:i.length,rowHeight:h=>p(h),rowRenderer:({index:h,style:b})=>{let x=n(h),S=c(h);return x?a(f,{style:b,children:w(pP,{value:x,children:[S&&a(BP,{id:x.section}),a(HP,{isProjected:t?x.id===t:!1,...r})]})},x.id):a(q,{})}})})});N();Vr();var sr=B(H());Lp();k();var hO=1,fO=5,bO=15,wO=.1,Y3=(0,sr.memo)(({children:e,onMouseMove:o})=>{let[t,r]=ti(S=>[S.isShiftPressed,S.dragIsActive]),[i,n,s]=ei(S=>[S.visibleItemsArr,S.visibleJustSelectedItems,S.getScrollPositionForSelectedItems],!0),{wrapperRef:l}=(0,sr.useContext)(Mv),c=(0,sr.useRef)(null),d=(0,sr.useRef)({}),p=(0,sr.useRef)(!0),m=(0,sr.useRef)(0),u=(0,sr.useRef)(!1),g=(0,sr.useRef)(!1),{callback:h}=Oi(b,100);(0,sr.useEffect)(()=>{p.current?requestAnimationFrame(()=>b()):h()},[n]),(0,sr.useEffect)(()=>{if(c?.current){let S=c?.current?.getBoundingClientRect();d.current=S.height}},[i]);function b(){if(t())return;let S=l?.current;if(S&&!r){let y=S.clientHeight,C=S.scrollTop,P=C,v=(d.current||0)+C,T=s(y);T!==null&&(T.top<P||T.bottom>v)&&S.scrollTo({top:T.scrollToPos,behavior:p.current?void 0:"smooth"}),p.current=!1}}function x(S,y=0){if(!S)return;let C=l?.current;if(!C||!u.current)return;let P=S.height*wO,v=P+S.top,T=2*P+S.top,R=3*P+S.top,I=S.bottom-3*P,M=S.bottom-2*P,D=S.bottom-P,E=m.current,A=.1,$=0,j=null;if(E<v||E>D?($=Math.min(y+A,bO),j=C.scrollTop+(E<v?-$:$)):E<T||E>M?($=Math.min(y+A,fO),j=C.scrollTop+(E<T?-$:$)):(E<R||E>I)&&($=Math.min(y+A,hO),j=C.scrollTop+(E<R?-$:$)),j=j&&Math.min(C.scrollHeight,Math.max(0,Number(j.toFixed(2)))),$=Number($.toFixed(2)),j!==null){let pe=Math.abs(j-C.scrollTop);C.scrollTo({top:j}),requestAnimationFrame(()=>x(S,pe)),g.current=!0}else g.current=!1}return(0,sr.useEffect)(()=>{u.current=r;let S=c?.current?.getBoundingClientRect(),y=l?.current,C={height:S?.height||0,top:(S?.top||0)+(y?.scrollTop||0),bottom:(S?.bottom||0)+(y?.scrollTop||0)};g.current=!1;let P=v=>{o&&o(v);let T=v.clientY;m.current=T,!g.current&&S&&y&&x(C)};return r&&document.addEventListener("mousemove",P),()=>{r&&document.removeEventListener("mousemove",P)}},[r]),a(f,{ref:c,height:"100%",children:e})});N();function X3(e){let o={aboveAll:[],frontFixed:[],normal:[],backFixed:[]},t=xO(e);for(let r in t){let i=r,n=t[i];o[i]=K3(n)}return o}function xO(e){let o={aboveAll:{id:"aboveAll",children:[]},frontFixed:{id:"frontFixed",children:[]},normal:{id:"normal",children:[]},backFixed:{id:"backFixed",children:[]}},t={aboveAll:o.aboveAll,frontFixed:o.frontFixed,normal:o.normal,backFixed:o.backFixed},r=e.map(i=>({id:i.id,parentId:i.parentId,children:[],section:i.section}));for(let i of r){let{id:n,children:s,section:l}=i,c=i.parentId??o[l].id,d=t[c]??r.find(p=>p.id===c);t[n]={id:n,children:s},d.children.push(i)}return o}function K3(e){let o=e.children,t=[];for(let r of o)Array.isArray(r?.children)&&r.children.length>0?t=[...t,K3(r)]:t.push(r.id);return t}So();function Z3({id:e,items:o,prevSelection:t,isCmdPressed:r=!1,isShiftPressed:i=!1,options:n={}}){if(!o)return new Set([e]);let s=o.get(e)?.parentId||"";return i?yO(e,o,t):r?kO(e,s,o,t,n):vO(e,o)}function vO(e,o){let t=new Set([e]);return o&&yn(o,e,r=>{t?.add(r.id)}),t}function yO(e,o,t){let r=wh(t),i=-1,n=-1,s=0;for(let l of o.values()){let c=l.id;(c===e||r.has(c))&&(i===-1&&(i=s),n=s),s++}s=0;for(let l of o.values()){let c=l.id;if(l.type==="group"&&!l.isCollapsed){s++;continue}n>=s&&s>=i&&(r?.add(c),yn(o,e,d=>{r?.add(d.id)})),s++}return Yg(r,o)}function kO(e,o,t,r,i){let n=wh(r);return n&&n?.has(e)&&!i?.dontChangeExisting?n.has(o)?(n.delete(o),n.delete(e)):(n.delete(e),t&&yn(t,e,s=>n?.delete(s.id))):(n?.add(e),t&&yn(t,e,s=>{n?.add(s.id)})),Yg(n,t)}function Yg(e,o){let t=new Set(e),r=new Set;for(let i of t){if(r.has(i))continue;let n=o.get(i)?.parentId;if(n){let s=!0;yn(o,n,l=>{t.has(l.id)||(s=!1),r.add(l.id)}),s&&!t.has(n)&&t.add(n)}}return t}var nd=class extends ip{};z(nd,"activators",[{eventName:"onPointerDown",handler:(o,{onActivation:t,shouldBeActivated:r})=>{let{nativeEvent:i}=o;return!i.isPrimary||i.button!==0||!(i.target instanceof HTMLElement)||r&&!r()?!1:(t?.({event:i}),!0)}}]);k();var J3=(0,bo.memo)(({virtualizedListRef:e,onChangeOrder:o,onLayersSelect:t,onLayerHover:r,onLayerHide:i,onLayerLock:n,onLayerRename:s,onLayerSwitchToViewport:l})=>{let[c,d,p,m,u,g,h,b,x]=ei(Q=>[Q.visibleItemsArr,Q.getAllVisibleItems,Q.getProjection,Q.getAllItems,Q.getSelectedItems,Q.getVisibleItem,Q.getInsertionMarkerPos,Q.moveSelectedBlocks,Q.getClosestCollisions],!0),[S,y,C,P]=ti(Q=>[Q.isEditModeActive,Q.isShiftPressed,Q.isCtrlPressed,Q.setDragIsActive],!0),v=(0,bo.useRef)({top:0,left:0}),[T,R]=(0,bo.useState)(),[I,M]=(0,bo.useState)(null),[D,E]=(0,bo.useState)(null),[A,$]=(0,bo.useState)(0),[j,pe]=(0,bo.useState)(""),ee=Hi(()=>{let Q=d().keys();return Array.from(Q)},[c]),G=(0,bo.useMemo)(()=>I&&D?p({activeId:I,overId:D,dragOffset:A,insertionMarker:T}):null,[I,D,A,T]),K=(0,bo.useCallback)((Q,te=!1)=>{let ye=u(),de=Z3({id:Q,items:m(),prevSelection:ye,isCmdPressed:C(),isShiftPressed:y(),options:{dontChangeExisting:te}});t(Q,de,ye)},[t]),we=(0,bo.useCallback)(Q=>{let te=Q.active.id;P(!0),M(te),g(te)?.isSelected||K(te,!0),E(te),pe(document?.body?.style.getPropertyValue("cursor")||"")},[K]),xe=(0,bo.useCallback)(Q=>{v.current={top:Q.clientY,left:Q.clientX}},[]),_e=(0,bo.useCallback)(Q=>{let te=v?.current?.top||0,ye=Q.collisions,de=Q.active;ye&&R(h({active:de,cursorTop:te,collisions:ye})),$(Q.delta.x)},[]),ie=(0,bo.useCallback)(Q=>{let te=Q.over?.id??null;E(te)},[]),ze=Bd(({over:Q})=>{if(J(),G&&Q){let{sortedItems:te,changesSet:ye,globalGroupChanges:de}=b({overId:Q.id,projectedDepth:G.depth,projectedParentId:G.parentId,insertionMarker:T});o(X3(te),ye,de)}},[T,G]),ne=(0,bo.useCallback)(()=>{J()},[]),J=(0,bo.useCallback)(()=>{E(null),M(null),$(0),R(void 0),P(!1),document.body.style.setProperty("cursor",j)},[]),X=G4(U4(nd,{activationConstraint:{distance:10},shouldBeActivated:()=>!S()}));return w(f,{height:"inherit",padding:`${ya.middle}px 0 0`,children:[D&&a(IP,{overId:D,insertionMarkerPos:T,paddingLeft:fo.indentationWidth*(G?.depth||0)}),a(nP,{sensors:X,collisionDetection:Q=>x({args:Q}),onDragStart:we,onDragMove:_e,onDragOver:ie,onDragEnd:ze,autoScroll:{layoutShiftCompensation:!1,enabled:!1},onDragCancel:ne,children:a(CP,{items:ee,strategy:kP,children:w(Y3,{onMouseMove:xe,children:[a(q3,{virtualizedListRef:e,projectedParentId:G?.parentId||null,onSelected:K,onLayerHover:r,onLayerHide:i,onLayerLock:n,onLayerRename:s,onLayerSwitchToViewport:l}),a(MP,{})]})})})]})});N();Vr();k();function e5(e){let[o]=ei(i=>[i.visibleItemsArr]),t=(0,Q3.useRef)(null);function r(i){let n=i.target,{scrollTop:s,scrollLeft:l}=n;t.current&&t.current?.Grid&&t.current.Grid.handleScrollEvent({scrollTop:s,scrollLeft:l})}return a("span",{style:{padding:o.length>0?"5px 0px":"0px"},children:a(Ft,{onScroll:r,children:({ref:i})=>a(f,{height:"inherit",ref:i,children:a(J3,{virtualizedListRef:t,...e})})})})}Ho();Lp();lf();ro();So();N();fe();var Ts=B(H());var ld=B($t()),Zi=B(pt());So();st();ZI();Ho();Cu();tf();Ax();var Xo=B($t()),sd=B(pt());So();st();Cu();ou();Ky();function _O(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("path",{attrs:{d:"M10 8h7a1 1 0 010 2h-7v7a1 1 0 01-2 0v-7H1a1 1 0 110-2h7V1a1 1 0 112 0v7z",fill:"#B8B8B8","fill-rule":"evenodd"}})])]}var t5={render:_O};var SO={components:{Draggable:Jl,NumericInput:Vn,RmScroll:Tu,SlideshowAddBtnImg:t5},props:["slideshowData","selectedType","block"],data:function(){return{slideshowLoading:!1,slideshowDragging:!1,slideshowIsDnd:!1,highlightTimeout:null,pictureListRect:null,rectTopLine:null,rectBottomLine:null,dragTranslate:null,dragTranslateBottom:null,scrollElement:null,slideshowUpdating:{num:null,loading:!1,starting:!1},slideshowDelay:4,slideshowCrossfade:.5}},computed:{slideshowHasPictures:function(){return this.slideshowData&&!sd.default.isEmpty(this.slideshowData.pictures)}},watch:{selectedType:function(){this.onTypeChange()},slideshowData:function(){this.onSlideshowChange()}},mounted:function(){this.slideshowDelaySave._debounced=sd.default.debounce(this.slideshowDelaySave,300),this.slideshowCrossfadeSave._debounced=sd.default.debounce(this.slideshowCrossfadeSave,300),this.slideshowUploader=new Yn(this,{fileTypes:"jpeg|jpg|png|gif",fileTypesErrorMessage:"We support only JPG, GIF and PNG picture formats.",uploadInputRefName:"slideshowUploadInput"}),this.slideshowUploader.on("start",this.onStartSlideshowUpload),this.slideshowUploader.on("done",this.onDoneSlideshowUpload),this.slideshowUploader.on("fail",this.onFailSlideshowUpload),this.block.workspace.on("main-dragover",this.highlightDropZone),this.defaultSlideshowUpdating={num:null,id:null,loading:!1,starting:!1},this.slideshowHasPictures&&(this.slideshowDelay=this.slideshowData.delay,this.slideshowCrossfade=this.slideshowData.crossfade,this.scrollElement=(0,Xo.default)(this.$refs.rmscroll.$el).find(".resizable-content-wrapper")),this.selectedType==="slideshow"&&this.block.runSlideshow()},beforeDestroy:function(){this.block.stopSlideshow()},destroyed:function(){this.slideshowUploader.off(),this.block.workspace.off("main-dragover",this.highlightDropZone)},methods:{showSelectSlideshowFile:function(e){(0,Xo.default)(e.target).hasClass("slideshowUploadInput")||this.slideshowLoading||this.slideshowHasPictures||(0,Xo.default)(this.$refs.slideshowUploadInput).trigger("click","stop")},highlightDropZone:function(){this.slideshowHasPictures&&((0,Xo.default)(this.$refs.dropZoneHighlighter).css({display:"block"}),clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout(function(){(0,Xo.default)(this.$refs.dropZoneHighlighter).css({display:"none"})}.bind(this),300))},onStartSlideshowUpload:function(){this.slideshowUpdating.starting?this.slideshowUpdating.loading=!0:this.slideshowLoading=!0,this.slideshowUploader.viewport=this.block.model.getViewport()},onDoneSlideshowUpload:function(e,o){if(this.slideshowDragging=!1,this.slideshowLoading=!1,this.slideshowUpdating.loading&&(this.slideshowUpdating.loading=!1),!o||!o.result){console.error("error file upload!");return}let t={save:!0};this.slideshowUpdating.starting?(t.num=this.slideshowUpdating.num,t.id=this.slideshowUpdating.id,this.block.updateSlideshowPicture(o.result,t),this.slideshowUpdating=this.defaultSlideshowUpdating):this.block.saveSlideshowPicture(o.result,t)},onFailSlideshowUpload:function(e,o,t){console.error("An error occurred while loading the slideshow image: ",t),t!==le.MSG_UPLOAD_IMAGE_SIZE_ERROR&&window.alert("Sorry, picture loading failed")},onSlideshowDragStart:function(){this.block.stopSlideshow(),this.slideshowIsDnd=!0,this.pictureListRect=this.$refs.picturesList.getBoundingClientRect(),this.rectTopLine=this.pictureListRect.top,this.rectBottomLine=this.pictureListRect.top+this.pictureListRect.height},onSlideshowDragEnd:function(){this.dragTranslate=null,this.dragTranslateBottom=null,this.$refs.picturesList.querySelectorAll(".real-slide").forEach(function(o){(0,Xo.default)(o).removeClass("selected")});let e=this.recalcSlideshowNums();this.block.updateSlideshowPicturePosition(e),this.$emit("updatePictures",e),setTimeout(function(){this.slideshowIsDnd=!1}.bind(this),200)},onSlideshowTouchMove:function(e){this.rectTopLine&&e.data.y<=this.rectTopLine+15?(this.dragTranslate||(this.dragTranslate=(0,Xo.default)(e.item).css("transform")),(0,Xo.default)(e.item).css("transform",this.dragTranslate)):this.rectBottomLine&&e.data.y+16>=this.rectBottomLine&&(this.dragTranslateBottom||(this.dragTranslateBottom=(0,Xo.default)(e.item).css("transform")),(0,Xo.default)(e.item).css("transform",this.dragTranslateBottom)),this.rectBottomLine&&e.data.y+20>=this.rectBottomLine&&this.scrollElement.scrollTop(this.scrollElement.scrollTop()-e.data.dy*4)},slideshowDelayChange:function(e){this.slideshowDelaySave._debounced(e)},slideshowDelaySave:function(e){this.slideshowHasPictures&&(this.$emit("updateDelay",+e.toFixed(1)),this.block.updateSideshowDelay(+e.toFixed(1)))},slideshowCrossfadeChange:function(e){this.slideshowCrossfadeSave._debounced(e)},slideshowCrossfadeSave:function(e){this.slideshowHasPictures&&(this.$emit("updateCrossfade",+e.toFixed(1)),this.block.updateSideshowCrossfade(+e.toFixed(1)))},recalcSlideshowNums:function(){let e=nt(this.slideshowData.pictures);return e.forEach(function(o,t){o.num=t+1}),e},onSlideshowChange:function(){this.slideshowDelay=this.slideshowData.delay,this.slideshowCrossfade=this.slideshowData.crossfade},onTypeChange:function(){this.selectedType!=="slideshow"&&this.slideshowHasPictures&&this.$refs.picturesList.querySelectorAll(".real-slide").forEach(function(e){(0,Xo.default)(e).removeClass("selected")})},selectSlide:function(e){this.slideshowIsDnd||!e.target.dataset.id||(this.$refs.picturesList.querySelectorAll(".real-slide").forEach(function(o){(0,Xo.default)(o).removeClass("selected")}),(0,Xo.default)(e.target).parents(".list-item-wrap").addClass("selected"),this.block.selectSlideshowPicture(e.target.dataset.id))},onAddPictureClick:function(){this.slideshowLoading||!this.slideshowHasPictures||(0,Xo.default)(this.$refs.slideshowUploadInput).trigger("click","stop")},onDeleteSlideshowPicture:function(e){if(e.stopPropagation(),this.slideshowIsDnd||!e.target.dataset.id)return;let o=this.slideshowData.pictures.findIndex(function(r){return r.uuid===e.target.dataset.id}),t=nt(this.slideshowData.pictures);t.splice(o,1),t=sd.default.sortBy(t,"num"),this.$emit("updatePictures",t),this.block.deleteSlideshowPicture(e.target.dataset.id)},onUpdateSlideshowPicture:function(e){this.slideshowIsDnd||this.slideshowLoading||this.slideshowUpdating.starting||!e.target.dataset.id||(this.slideshowUpdating={id:e.target.dataset.id,loading:!1,starting:!0},(0,Xo.default)(this.$refs.slideshowUploadInput).trigger("click","stop"))},save:function(){this.block.model.save()},getThumbnailUrl:function(e){return this.block.getThumbnailUrl(e)}}},CO=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"view slideshow"},[t("div",{ref:"slideshowDropZone",staticClass:"upload",class:{dragging:e.slideshowDragging,hasPictures:e.slideshowHasPictures},attrs:{"drag-over":"handleDragOver"},on:{dragenter:function(r){e.slideshowDragging=!0},dragend:function(r){e.slideshowDragging=!1},dragleave:function(r){e.slideshowDragging=!1},click:e.showSelectSlideshowFile}},[t("input",{ref:"slideshowUploadInput",staticClass:"slideshowUploadInput",attrs:{type:"file",name:"upload","data-url":"/api/upload/lambda/"}}),e._v(" "),e.slideshowHasPictures?e._e():t("div",{staticClass:"param-caption"},[e._v("Slideshow")]),e._v(" "),e.slideshowHasPictures?e._e():t("div",{directives:[{name:"show",rawName:"v-show",value:!e.slideshowLoading,expression:"!slideshowLoading"}],staticClass:"upload-wrapper"},[t("div",{staticClass:"center-wrapper"},[t("div",{staticClass:"caption-upload-dop"},[e._v(e._s(e.slideshowDragging?"Drop here":"Drop file here"))])])]),e._v(" "),e.slideshowHasPictures?e._e():t("div",{directives:[{name:"show",rawName:"v-show",value:e.slideshowLoading,expression:"slideshowLoading"}],staticClass:"first-loading"},[t("div",{staticClass:"rm-loader"})]),e._v(" "),e.slideshowHasPictures?t("div",{ref:"dropZoneHighlighter",staticClass:"upload-wrapper-if-pictures"},[t("div",{staticClass:"center-wrapper"},[e._v("Drop file here")])]):e._e(),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.slideshowHasPictures,expression:"slideshowHasPictures"}],ref:"picturesList",staticClass:"pictures-list"},[t("rm-scroll",{ref:"rmscroll",attrs:{"scroll-gap-start":8,"scroll-gap-end":8,"system-scroll":!0}},[t("draggable",{ref:"draggableContainer",staticClass:"draggable-container-slideshow",class:{"draggble-running":e.slideshowIsDnd},attrs:{options:{denyX:!0,forceFallback:!0,scroll:!0,scrollSensitivity:40,animation:200,delay:0,group:"",ghostClass:"sl-ghost-item",dragClass:"sl-drag-item",chosenClass:"sl-drag-item",disabled:e.slideshowLoading}},on:{start:e.onSlideshowDragStart,end:e.onSlideshowDragEnd,touchMove:e.onSlideshowTouchMove},model:{value:e.slideshowData.pictures,callback:function(r){e.$set(e.slideshowData,"pictures",r)},expression:"slideshowData.pictures"}},[t("transition-group",{attrs:{type:"transition",name:e.slideshowIsDnd?null:"flip-list"}},e._l(e.slideshowData.pictures,function(r,i){return t("div",{key:r.uuid,staticClass:"list-item-wrap real-slide",attrs:{"data-id":r.uuid}},[t("div",{staticClass:"pic-num-item-wrap"},[t("div",{staticClass:"pic-num-item"},[e._v(e._s(i+1))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.slideshowUpdating.loading||e.slideshowUpdating.id!==r.uuid,expression:"!slideshowUpdating.loading || slideshowUpdating.id !== picture.uuid"}],staticClass:"pic-list-item",style:{backgroundImage:"url("+e.getThumbnailUrl(r)+")"},attrs:{"data-id":r.uuid},on:{click:e.selectSlide}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.slideshowUpdating.loading&&e.slideshowUpdating.id===r.uuid,expression:"slideshowUpdating.loading && slideshowUpdating.id === picture.uuid"}],staticClass:"pic-list-item-loading",attrs:{title:"Loading..."}},[t("div",{staticClass:"rm-loader"})]),e._v(" "),t("div",{staticClass:"pic-actions-item"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.slideshowUpdating.loading&&!e.slideshowLoading,expression:"!slideshowUpdating.loading && !slideshowLoading"}],staticClass:"update-image",attrs:{title:"Update","data-id":r.uuid},on:{click:e.onUpdateSlideshowPicture}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.slideshowLoading&&!e.slideshowUpdating.loading,expression:"!slideshowLoading && !slideshowUpdating.loading"}],staticClass:"delete-image",attrs:{title:"Delete","data-id":r.uuid},on:{click:e.onDeleteSlideshowPicture}})])])}),0)],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.slideshowLoading&&!e.slideshowUpdating.loading&&!e.slideshowIsDnd,expression:"!slideshowLoading && !slideshowUpdating.loading && !slideshowIsDnd"}],staticClass:"list-item-wrap"},[t("div",{staticClass:"add-picture-wrap",attrs:{title:"Add Picture"},on:{click:e.onAddPictureClick}},[t("slideshow-add-btn-img",{staticClass:"svg add-picture-icon",staticStyle:{"pointer-events":"none"}})],1)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.slideshowLoading&&!e.slideshowUpdating.loading,expression:"slideshowLoading && !slideshowUpdating.loading"}],staticClass:"list-item-wrap"},[t("div",{staticClass:"add-picture-loading",attrs:{title:"Loading..."}},[t("div",{staticClass:"rm-loader"})])])],1)],1)]),e._v(" "),e.slideshowHasPictures?t("div",{staticClass:"animation-options"},[t("div",{staticClass:"options-row first-row"},[t("div",{staticClass:"option-label"},[e._v("Delay")]),e._v(" "),t("numeric-input",{staticClass:"option-value",attrs:{value:e.slideshowDelay,min:e.slideshowCrossfade,max:60,step:.1,"use-float":!0},on:{change:e.slideshowDelayChange}}),e._v(" "),e._m(0)],1),e._v(" "),t("div",{staticClass:"options-row-separator"}),e._v(" "),t("div",{staticClass:"options-row second-row"},[t("div",{staticClass:"option-label"},[e._v("Crossfade")]),e._v(" "),t("numeric-input",{staticClass:"option-value",attrs:{value:e.slideshowCrossfade,min:0,max:e.slideshowDelay,step:.1,"use-float":!0},on:{change:e.slideshowCrossfadeChange}}),e._v(" "),e._m(1)],1)]):e._e()])},PO=[function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"option-value-dimension-wrap"},[t("div",{staticClass:"option-value-dimension"},[e._v("s")])])},function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"option-value-dimension-wrap"},[t("div",{staticClass:"option-value-dimension"},[e._v("s")])])}],TO=void 0,IO=void 0,MO=void 0,BO=!1;function RO(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="background-slideshow.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var zO=RO({render:CO,staticRenderFns:PO},TO,SO,IO,BO,MO,!1,void 0,void 0,void 0),o5=zO;var i5=B(Qo());Vs();N();Ap();fe();var Ps=B(H());bM();Vs();Ck();OI();fi();wu();oe();$e();st();WI();tM();rf();Ir();k();function r5(){let{model:{video:e},rawModel:o,modelSet:t,modelSave:r}=(0,Ps.useContext)(Ya),i=_k(e),n=Number(Xn.getPermissions().video_upload_limit||0),s=(0,Ps.useMemo)(()=>{if(i)return yk(e)?.thumbnail},[i,e]),l=(0,Ps.useMemo)(()=>window.RM.constructorRouter.mag.get("_id"),[]),[c,d]=(0,Ps.useState)(!1),[p,m]=(0,Ps.useState)();async function u(x){m(void 0),d(!0);try{let S=kk(x);if(!S.isValid)S.errorType==="SubscriptionLimitError"?rt("video-upload",{currentLimit:n}):m(S.errorMessage);else{let y=o.getViewport(),C=await xk(x,l);t({video:{size:x.size,provider_name:"self",thumbnail_url:C.thumbPath,url:C.videoPath,loop:e&&typeof e.loop=="boolean"?e.loop:!0,version:le.VIDEO_BACKGROUND_VERSION,opacity:100}},{viewport:y}),r()}}catch{m("Could not upload file")}finally{d(!1)}}function g({value:x}){i&&t({video:{...e,opacity:x}})}function h(x){i&&t({video:{...e,loop:x}})}function b(){t({video:{}})}return i?w(f,{backgroundColor:"#f3f3f3",backgroundImage:`url('${s}')`,backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"relative",children:[a(f,{position:"absolute",top:0,left:0,zIndex:0,width:"100%",height:"100%",backgroundColor:"#2E2D2C",opacity:.88}),w(f,{position:"relative",zIndex:1,children:[a(f,{padding:"8px 16px 0",children:w(f,{borderBottom:"2px solid",borderColor:Me("gray",.24),paddingBottom:38,children:[a(L,{as:"div",color:"white",marginBottom:4,children:"Background video"}),w(L,{as:"div",color:"gray",textStyle:"small",children:[My(e.size)," total size, muted"]})]})}),w(f,{marginBottom:16,children:[a(Xh,{leftSlot:a(L,{textStyle:"small",color:"white",children:"Loop"}),rightSlot:a(Wt,{checked:e.loop,onChange:h})}),a(Xh,{showBorder:!1,leftSlot:a(L,{textStyle:"small",color:"white",children:"Opacity"}),rightSlot:a(cn,{textAlign:"right",color:"white",value:typeof e.opacity=="number"?e.opacity:100,min:0,max:100,onChange:g})})]}),a(f,{display:"flex",alignItems:"center",padding:"0px 16px",children:a(ge,{boxSizing:"border-box",width:"100%",height:40,variant:"bordered",borderColor:Me("white",.16),textStyle:"small",color:"white",lineHeight:"38px",onClick:b,children:"Replace"})})]})]}):a(Di,{id:"rm-background-video-upload",onChange:u,accept:"video/mp4",readFileData:!1,cursor:c?"default":"pointer",dropFile:!c,children:a(f,{backgroundColor:"#f3f3f3",padding:"8px 16px",width:"100%",height:"100%",onMouseEnter:()=>{p&&setTimeout(()=>{m(void 0)},1e3)},children:w(f,{width:"100%",height:"100%",pointerEvents:c?"none":void 0,display:"flex",flexDirection:"column",justifyContent:"space-between",children:[a(L,{children:c?"Uploading...":"Background video"}),a(L,{textStyle:"small",cursor:"pointer",color:p?"tomato":"blue",display:"block",lineHeight:"16px",width:"100%",children:p||(c?"It might take some time":a(q,{children:"Drop an MP4 file here"}))}),a(f,{children:c?null:a(Ce,{href:"https://help.readymag.com/hc/en-us/articles/360021875172-Background",target:"_blank",rel:"noopener noreferrer",textStyle:"small",lineHeight:"16px",children:"Learn how to convert videos"})})]})})})}var EO={props:{widgetModel:{type:Object,default:null}},mounted:function(){Xa({component:r5,domElement:this.$el,model:this.widgetModel})},beforeDestroy:function(){i5.default.unmountComponentAtNode(this.$el)}},AO=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"view video video-panel"})},LO=[],DO=void 0,OO=void 0,$O=void 0,HO=!1;function FO(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="background-video.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var NO=FO({render:AO,staticRenderFns:LO},DO,EO,OO,HO,$O,!1,void 0,void 0,void 0),n5=NO;var fp=B(pt());oM();var WO={},VO=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"0 0 40 40"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M20 8C13.3726 8 8 13.3726 8 20C8 26.6274 13.3726 32 20 32C26.6274 32 32 26.6274 32 20C32 13.3726 26.6274 8 20 8ZM24.1142 19.2407C24.5798 19.6398 24.5798 20.3601 24.1142 20.7592L19.6508 24.585C19.0021 25.141 18 24.6801 18 23.8257V16.1742C18 15.3198 19.0021 14.8589 19.6508 15.4149L24.1142 19.2407Z"}})])},UO=[],GO=void 0,jO="data-v-1e670728",qO=void 0,YO=!1;function XO(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="arrow-right.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var KO=XO({render:VO,staticRenderFns:UO},GO,WO,jO,YO,qO,!1,void 0,void 0,void 0),s5=KO;eM();var ZO={},JO=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("svg",{attrs:{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M23.9917 12.9488C23.916 14.6685 22.7602 17.0232 20.5245 20.0118C18.2134 23.1338 16.2579 24.6946 14.6582 24.6946C13.6676 24.6946 12.8286 23.7444 12.1439 21.8427C11.6862 20.0998 11.2291 18.3571 10.7715 16.6143C10.2628 14.7138 9.71728 13.7624 9.13401 13.7624C9.00685 13.7624 8.56179 14.0404 7.79985 14.5944L7 13.5236C7.83895 12.7577 8.66668 11.9916 9.48098 11.2246C10.5999 10.2197 11.4399 9.6913 11.9997 9.63805C13.3228 9.50598 14.1371 10.4458 14.4428 12.4574C14.7729 14.6279 15.0016 15.978 15.1301 16.5064C15.5114 18.3072 15.931 19.2064 16.3894 19.2064C16.7453 19.2064 17.2797 18.6223 17.9924 17.4543C18.7042 16.2862 19.0856 15.3974 19.137 14.7868C19.2385 13.7787 18.857 13.2732 17.9924 13.2732C17.5852 13.2732 17.1658 13.3706 16.7342 13.5629C17.5696 10.7191 19.1659 9.33795 21.5221 9.41677C23.2688 9.47019 24.0923 10.6473 23.9917 12.9488Z"}})])},QO=[],e$=void 0,t$="data-v-5533b0b7",o$=void 0,r$=!1;function i$(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="vimeo-logo.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var n$=i$({render:JO,staticRenderFns:QO},e$,ZO,t$,r$,o$,!1,void 0,void 0,void 0),a5=n$;var s$={},a$=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("svg",{attrs:{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24.7728 12.5609C24.7728 12.5609 24.5969 11.3852 24.0572 10.8674C23.3727 10.1879 22.6055 10.1845 22.2536 10.1447C19.7348 9.97217 15.9564 9.97217 15.9564 9.97217H15.9486C15.9486 9.97217 12.1703 9.97217 9.65136 10.1447C9.2995 10.1845 8.53256 10.1879 7.84784 10.8674C7.30814 11.3852 7.13252 12.5609 7.13252 12.5609C7.13252 12.5609 6.95251 13.9416 6.95251 15.3223V16.6167C6.95251 17.9973 7.13252 19.378 7.13252 19.378C7.13252 19.378 7.30814 20.5537 7.84784 21.0715C8.53256 21.751 9.43199 21.7296 9.83259 21.8008C11.2726 21.9317 15.9525 21.9722 15.9525 21.9722C15.9525 21.9722 19.7348 21.9668 22.2536 21.7942C22.6055 21.7544 23.3727 21.751 24.0572 21.0715C24.5969 20.5537 24.7728 19.378 24.7728 19.378C24.7728 19.378 24.9525 17.9973 24.9525 16.6167V15.3223C24.9525 13.9416 24.7728 12.5609 24.7728 12.5609ZM14.0942 18.1852L14.0934 13.3914L18.9571 15.7967L14.0942 18.1852Z"}})])},l$=[],p$=void 0,c$="data-v-5a5c80d2",d$=void 0,u$=!1;function m$(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="youtube-logo.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var g$=m$({render:a$,staticRenderFns:l$},p$,s$,c$,u$,d$,!1,void 0,void 0,void 0),l5=g$;Ax();var h$="Paste a link",f$="Youtube or Vimeo only",b$={components:{ArrowIcon:s5,XMarkIcon:Zy,VimeoLogo:a5,YoutubeLogo:l5},model:{event:"change:url",prop:"url"},props:{url:String,highlightOnError:Boolean,disabled:Boolean,showSocial:!0,isVideoProcessed:!1,isInputHovered:!1},data:function(){return{isError:!1,isInputHoveredOrNot:this.isInputHovered}},computed:{searchUrl:{get:function(){return this.url},set:function(e){this.$emit("change:url",e)}},showIcon:function(){return!!this.url},isRemove:function(){return this.isVideoProcessed||this.isError},isUpload:function(){return this.isURL(this.url)&&!this.isVideoProcessed},highlightInput:function(){return this.highlightOnError&&this.isError},placeholder:function(){return this.isInputHoveredOrNot?f$:h$}},methods:{changePlaceholder:function(e){this.isInputHoveredOrNot=e},handlePaste:function(e){let o=(e.clipboardData||window.clipboardData).getData("text");this.processInputVideo(o)},onIconClick:function(){this.isRemove?(this.$emit("change:url",null),this.$emit("remove")):this.processInputVideo()},onEnter:function(){this.processInputVideo()},processInputVideo:function(e=this.url){e&&this.isURL(e)&&this.getVideoFromUrl(e)},parseStartTime:function(e){let o,t,r=0;return o=Ex("t",e),!o||(t=o.match(/(\d+)(m?)(\d*)(s?)/),fp.default.isEmpty(t)||!parseInt(t[1],10))?null:(t[2].toLowerCase()==="m"?r+=parseInt(t[1],10)*60:r+=parseInt(t[1],10),parseInt(t[3],10)&&(r+=parseInt(t[3],10)),r)},getVideoFromUrl:function(e){let o=e,t,r,i;if(r=Qs.isVimeo(o),t=Qs.isYoutube(o),!t&&!r){this.$emit("wrongUrl"),this.isError=!0,this.highlightremovalTimeout=setTimeout(function(){this.isError=!1}.bind(this),200);return}i=this.parseStartTime(o),o=o.replace(/\/?#?$/,"");let n={url:o,provider_name:Qs.getVideoProvider(o)};i&&(n.start_time=i),t&&(n.video_id=Qs.getYoutubeIdFromUrl(o)),Qs.getEmbedData(o,fp.default.bind(function(s){this.url=s.url?s.url:this.url,Qs.getHighResVideoThumbnail({provider:n.provider_name,thumbnail_url:s.thumbnail_url,video_url:this.url}).then(fp.default.bind(function(l){s.thumbnail_url=l,this.$emit("loaded",fp.default.extend(s,n))},this))},this),fp.default.bind(function(s){this.$emit("error",s)},this)),this.$emit("dataObtained",n)},uploadVideoFromSearch:function(e){this.getVideoFromUrl(e)},isURL:_d}},w$=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"video-panel-search"},[t("div",{staticClass:"video-panel-input-wrapper"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchUrl,expression:"searchUrl"}],class:{"video-panel-input":!0,"has-icon":e.showIcon},attrs:{type:"text",spellcheck:"false",placeholder:e.placeholder,disabled:e.disabled},domProps:{value:e.searchUrl},on:{keyup:function(r){return!r.type.indexOf("key")&&e._k(r.keyCode,"enter",13,r.key,"Enter")?null:e.onEnter(r)},paste:e.handlePaste,mouseenter:function(r){return e.changePlaceholder(!0)},mouseleave:function(r){return e.changePlaceholder(!1)},input:function(r){r.target.composing||(e.searchUrl=r.target.value)}}}),e._v(" "),e.showIcon?t("div",{staticClass:"video-panel-icon input-icon",class:{"is-remove":e.isRemove,"is-upload":e.isUpload},on:{click:e.onIconClick}},[e.isUpload?t("arrow-icon"):e._e(),e._v(" "),e.isRemove?t("x-mark-icon"):e._e()],1):e._e(),e._v(" "),t("transition",{attrs:{name:"fade"}},[e.highlightInput?t("div",{staticClass:"video-panel-error"}):e._e()])],1),e._v(" "),t("transition",{attrs:{name:"fade"}},[e.showSocial?t("div",{staticClass:"video-panel-social"},[t("div",{staticClass:"video-panel-social-icon video-panel-social-youtube",attrs:{title:"Youtube"}},[t("youtube-logo")],1),e._v(" "),t("div",{staticClass:"video-panel-social-icon video-panel-social-vimeo",attrs:{title:"Vimeo"}},[t("vimeo-logo")],1)]):e._e()])],1)},x$=[],v$=void 0,y$=void 0,k$=void 0,_$=!1;function S$(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="video-search.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var C$=S$({render:w$,staticRenderFns:x$},v$,b$,y$,_$,k$,!1,void 0,void 0,void 0),p5=C$;var P$={name:"EllipsisPlus",props:{text:String,line:{type:Number,default:2},ellipsis:{type:String,default:"..."},showButton:{type:Boolean,default:!1},expandText:{type:String,default:""},collapseText:{type:String,default:""}},data(){return{tmpTxt:"",show:!1,marginLeft:0,collapseMarginLeft:0}},created(){},mounted(){if(!this.line)return;let e=this.$refs.txt.offsetWidth;this.$refs.txt.innerHTML=this.text;let o=this.$refs.container.offsetWidth,t=0,r=0,i=this.$refs.ellipsis.offsetWidth;if(this.showButton){r=Math.ceil(parseFloat(getComputedStyle(this.$refs.more,null).width.replace("px",""))),t=r,this.$refs.ellipsis.style.display="none";let d=0,p=this.$refs.more.cloneNode();this.expandText!==this.collapseText&&(this.$refs.more.style.display="none",p.innerHTML=this.collapseText,p.style.display="inline-block",this.$refs.container.appendChild(p),r=Math.ceil(parseFloat(getComputedStyle(p,null).width.replace("px",""))),d=p.offsetLeft),p.offsetTop<=this.$refs.ellipsis.offsetTop+5?this.marginLeft=o-r-d+i:this.marginLeft=o-r-d,p.remove(),this.$refs.more.style.display="inline-block",this.$refs.ellipsis.style.display="inline-block"}let n=getComputedStyle(this.$refs.container,null),s=parseFloat(n.lineHeight.replace("px",""));if(this.$refs.txt.innerHTML=this.text,Math.floor(this.$refs.container.offsetHeight/s)<=this.line){this.tmpTxt=this.text,this.show=!0,this.showButton=!1;return}let l=Math.floor((o*this.line-t-i)/e),c=1;this.$refs.txt.innerHTML=this.text.substr(0,l),Math.round(this.$refs.container.offsetHeight/s)>this.line&&(c=-1);for(let d=l;d<this.text.length;d=d+c){if(d<0||d>this.text.length)return;if(this.$refs.txt.innerHTML=this.text.substr(0,d),c===1&&Math.round(this.$refs.container.offsetHeight/s)>this.line){if(this.tmpTxt=this.text.substr(0,d-1),this.$refs.txt.innerHTML=this.tmpTxt,this.showButton){let p=this.$refs.more.offsetLeft;this.collapseMarginLeft=o-t-p-1}break}else if(c===-1&&Math.round(this.$refs.container.offsetHeight/s)===this.line){if(this.tmpTxt=this.text.substr(0,d),this.$refs.txt.innerHTML=this.tmpTxt,this.showButton){let p=this.$refs.more.offsetLeft;this.collapseMarginLeft=o-t-p-1}break}}},methods:{handleClick(){this.show?this.collapse():this.expand()},expand(){this.show||(this.show=!0,this.$refs.txt.innerHTML=this.text)},collapse(){this.show&&(this.show=!1,this.$refs.txt.innerHTML=this.tmpTxt)}}},T$=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{ref:"container",staticClass:"ellipsis-plus"},[t("span",{ref:"txt",staticClass:"ellipsis-plus-txt"},[e._v("\u4E2D")]),e._v(" "),t("span",{ref:"ellipsis",staticClass:"ellipsis-plus-ellipsis",style:{display:e.show?"none":"inline-block"}},[e._v(`
    `+e._s(e.ellipsis)+`
  `)]),e._v(" "),e.showButton?t("button",{ref:"more",staticClass:"ellipsis-plus-button",style:{"margin-left":e.show?e.marginLeft+"px":e.collapseMarginLeft+"px"},on:{click:e.handleClick}},[e._v(`
    `+e._s(e.show?e.collapseText:e.expandText)+`
  `)]):e._e()])},I$=[],M$=void 0,B$=void 0,R$=void 0,z$=!1;function E$(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="ellipsis-plus.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var A$=E$({render:T$,staticRenderFns:I$},M$,P$,B$,z$,R$,!1,void 0,void 0,void 0),c5=A$;Yy();var ad=B($t());ui();var L$={model:{event:"change"},props:{value:{type:Number,default:1},width:{type:Number,default:120},handleWidth:{type:Number,default:30},gradientColor:{type:String,default:"none"},gap:{type:Number,default:0}},computed:{percent:function(){return Math.round(this.value*100)},gradientLeft:function(){return et.getRGBA(this.gradientColor,1)},gradientRight:function(){return et.getRGBA(this.gradientColor,0)}},watch:{value:function(e){e!==(0,ad.default)(this.$el).data("opacity")&&(0,ad.default)(this.$el).data("rmopacitydragChange")({opacity:e})}},mounted:function(){(0,ad.default)(this.$el).rmOpacityDrag({opacity:this.value,onchange:this.onOpacityChange,onenddrag:this.onOpacityEndDrag,width:this.width,handleWidth:this.handleWidth,gap:this.gap}).data("rmopacitydrag-change")},methods:{opacityMouseEnter:function(){this.$emit("opacity-active",!0)},opacityMouseLeave:function(){this.$emit("opacity-active",!1)},onOpacityEndDrag:function(){this.$emit("opacity-active",!1)},onOpacityChange:function(e){(0,ad.default)(this.$refs.handle).hasClass("opacity-dragging")&&this.$emit("opacity-active",!0),Math.abs(this.value-e)>.001&&this.$emit("change",e)}}},D$=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"rm-opacity-slider",style:{background:"linear-gradient(to right, "+e.gradientLeft+", "+e.gradientRight+")"},on:{mouseenter:e.opacityMouseEnter,mouseleave:e.opacityMouseLeave}},[t("div",{ref:"handle",staticClass:"opacity-handle"},[e._t("default")],2)])},O$=[],$$=void 0,H$=void 0,F$=void 0,N$=!1;function W$(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="rm-opacity-drag.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var V$=W$({render:D$,staticRenderFns:O$},$$,L$,H$,N$,F$,!1,void 0,void 0,void 0),d5=V$;QI();function U$(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"32",height:"32",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[t("rect",{attrs:{fill:"#262626",opacity:".4",width:"32",height:"32",rx:"16"}}),t("path",{attrs:{d:"M16 13.058c.744 0 1.38.254 1.908.761.528.508.792 1.12.792 1.835 0 .715-.264 1.326-.792 1.834A2.654 2.654 0 0116 18.25c-.744 0-1.38-.254-1.908-.762s-.792-1.119-.792-1.834c0-.715.264-1.327.792-1.835A2.654 2.654 0 0116 13.058m6.6-3.75a2.36 2.36 0 011.697.676c.469.45.703.994.703 1.631v8.077c0 .637-.234 1.181-.703 1.632A2.36 2.36 0 0122.6 22H9.4a2.36 2.36 0 01-1.697-.676A2.181 2.181 0 017 19.692v-8.077c0-.637.234-1.18.703-1.631A2.36 2.36 0 019.4 9.308h2.1l.478-1.226c.119-.295.336-.549.652-.762.315-.213.639-.32.97-.32h4.8c.331 0 .655.107.97.32.316.213.533.467.652.762l.478 1.226h2.1M16 19.692c1.156 0 2.145-.395 2.967-1.185.822-.79 1.233-1.741 1.233-2.853s-.41-2.063-1.233-2.853c-.822-.79-1.81-1.186-2.967-1.186-1.156 0-2.145.396-2.967 1.186-.822.79-1.233 1.741-1.233 2.853s.41 2.063 1.233 2.853c.822.79 1.81 1.185 2.967 1.185",fill:"#FFF","fill-rule":"nonzero"}})])])]}var u5={render:U$};function G$(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"46",height:"13",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("g",{attrs:{fill:"#FFF","fill-rule":"evenodd"}},[t("path",{attrs:{d:"M10.27 6.134c-.045.995-.744 2.357-2.095 4.087-1.397 1.806-2.58 2.71-3.546 2.71-.599 0-1.106-.55-1.52-1.65l-.83-3.026c-.307-1.1-.636-1.65-.99-1.65-.076 0-.345.16-.806.48L0 6.467c.507-.443 1.007-.886 1.5-1.33.676-.582 1.184-.887 1.522-.918.8-.077 1.292.467 1.477 1.631.2 1.256.338 2.038.415 2.343.23 1.042.484 1.563.761 1.563.215 0 .538-.338.97-1.014.43-.676.66-1.19.691-1.544.062-.583-.17-.876-.692-.876-.246 0-.5.057-.76.168.505-1.646 1.47-2.445 2.894-2.4 1.056.031 1.553.713 1.493 2.045"}}),t("path",{attrs:{d:"M14.606 1.197c-.016.38-.208.746-.578 1.096a2.069 2.069 0 01-1.476.594c-.877 0-1.3-.38-1.27-1.142.016-.395.25-.776.704-1.142a2.355 2.355 0 011.512-.548c.323 0 .592.126.807.377.216.252.315.507.3.765zm2.007 8.16a7.74 7.74 0 01-1.777 2.201c-1.03.887-2.061 1.33-3.091 1.33-.478 0-.843-.153-1.097-.459-.253-.306-.373-.703-.357-1.192.015-.504.172-1.284.472-2.34.3-1.054.45-1.62.45-1.696 0-.398-.138-.597-.414-.597-.093 0-.354.161-.785.482l-.531-.62 1.477-1.33c.661-.582 1.153-.887 1.477-.918.507-.046.88.102 1.119.446.238.343.326.788.265 1.337a70.9 70.9 0 00-.646 3.543c-.016.656.223.983.715.983.215 0 .6-.226 1.154-.679a9.624 9.624 0 001.13-1.064l.439.573z"}}),t("path",{attrs:{d:"M31.022 9.357a7.739 7.739 0 01-1.777 2.201c-1.03.887-2.061 1.33-3.091 1.33-1.001 0-1.485-.55-1.454-1.651.015-.49.111-1.078.288-1.766.176-.688.273-1.223.288-1.605.016-.58-.162-.872-.532-.872-.402 0-.88.475-1.435 1.423-.587.994-.904 1.958-.95 2.891-.03.658.034 1.163.195 1.515-1.074.03-1.826-.146-2.255-.528-.384-.337-.56-.894-.529-1.675.015-.49.09-.98.227-1.469.135-.49.21-.925.226-1.308.031-.566-.177-.849-.624-.849-.385 0-.801.437-1.248 1.308a6.637 6.637 0 00-.739 2.731c-.03.857.025 1.453.166 1.79-1.056.03-1.806-.19-2.25-.664-.368-.396-.536-.999-.505-1.807.015-.397.085-.95.212-1.66.127-.709.197-1.261.212-1.658.03-.275-.039-.412-.207-.412-.093 0-.354.155-.785.464l-.554-.62c.077-.06.561-.504 1.454-1.33.646-.596 1.084-.902 1.315-.918.4-.03.723.134.969.493.246.36.37.777.37 1.251 0 .153-.016.298-.047.436.23-.352.5-.658.808-.918.707-.612 1.5-.956 2.376-1.033.754-.06 1.292.115 1.616.528.26.336.384.819.369 1.446.108-.092.223-.191.346-.299.354-.413.7-.741 1.038-.986.57-.413 1.162-.643 1.777-.689.738-.06 1.269.114 1.592.526.276.335.4.815.37 1.44-.016.427-.12 1.048-.312 1.863-.193.816-.289 1.284-.289 1.406-.015.32.016.54.092.663.077.122.261.182.554.182.215 0 .6-.226 1.154-.679a9.62 9.62 0 001.13-1.064l.439.573z"}}),t("path",{attrs:{d:"M34.436 6.938c.015-.41-.153-.617-.507-.617-.46 0-.929.316-1.405.948-.476.632-.722 1.236-.737 1.815-.009 0-.009.099 0 .297a5.195 5.195 0 001.958-1.256c.445-.487.676-.883.691-1.187zm5.238 2.396c-.446.733-1.323 1.466-2.63 2.2-1.63.931-3.285 1.397-4.96 1.397-1.247 0-2.14-.413-2.678-1.239-.384-.566-.569-1.238-.553-2.019.015-1.238.569-2.416 1.661-3.533 1.2-1.224 2.615-1.836 4.245-1.836 1.508 0 2.308.611 2.4 1.832.061.778-.37 1.579-1.292 2.403-.985.9-2.224 1.473-3.715 1.717.276.381.692.572 1.246.572 1.107 0 2.315-.28 3.623-.84.938-.394 1.676-.803 2.215-1.227l.438.573z"}}),t("path",{attrs:{d:"M43.33 7.709a2.875 2.875 0 00-.173-1.138c-.13-.345-.32-.518-.565-.518-.785 0-1.431.422-1.938 1.265a4.425 4.425 0 00-.693 2.207c-.015.383.054.72.208 1.012.169.337.407.505.716.505.691 0 1.284-.405 1.776-1.218.416-.675.638-1.38.67-2.115m2.607.086c-.062 1.406-.585 2.62-1.57 3.644-.984 1.023-2.207 1.535-3.668 1.535-1.215 0-2.138-.39-2.769-1.17-.46-.58-.715-1.305-.76-2.175-.078-1.314.398-2.521 1.43-3.62 1.107-1.223 2.499-1.833 4.176-1.833 1.076 0 1.891.359 2.445 1.076.523.658.761 1.505.716 2.543"}})])])]}var m5={render:G$};function j$(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"40",height:"17",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("defs",[t("path",{attrs:{id:"a",d:"M.032 16.196h23.325V.071H.032v16.125z"}})]),t("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[t("path",{attrs:{d:"M14.607 13.126h-1.484v-.848c-.563.637-1.04.958-1.56.958-.456 0-.773-.212-.931-.596-.097-.233-.165-.598-.165-1.133v-6.17h1.484v6.324c.035.216.128.296.317.296.284 0 .54-.244.855-.682V5.337h1.484v7.79zM7.89 10.813c.077.77-.165 1.154-.626 1.154-.46 0-.703-.383-.624-1.154V7.728c-.079-.772.164-1.133.624-1.133.461 0 .704.361.626 1.133v3.085zm1.483-2.931c0-.833-.169-1.458-.468-1.851-.396-.533-1.016-.751-1.64-.751-.708 0-1.246.218-1.64.75-.305.394-.468 1.026-.468 1.859l-.002 2.77c0 .827.145 1.399.45 1.789.394.53 1.035.812 1.66.812.624 0 1.276-.281 1.671-.812.3-.39.437-.962.437-1.79V7.882zM3.515 8.884v4.242H1.953V8.884S.333 3.684 0 2.714h1.64l1.097 4.063 1.09-4.063h1.64l-1.952 6.17zM29.872 6.576c-.233 0-.5.121-.736.351l-.002 4.678c.237.233.505.352.738.352.408 0 .592-.296.592-1.067V7.573c0-.77-.184-.997-.592-.997M35.697 7.503c0-.713-.186-.927-.655-.927-.472 0-.673.196-.673.917v.853l1.328-.001v-.842z",fill:"#FFF"}}),t("g",{attrs:{transform:"translate(15.779 .006)"}},[t("mask",{attrs:{id:"b",fill:"#fff"}},[t("use",{attrs:{"xlink:href":"#a"}})]),t("path",{attrs:{d:"M19.276 11.95c.349 0 .551-.186.632-.56.013-.076.01-.409.01-.969h1.485v.219c0 .45-.038.768-.05.908-.048.31-.16.59-.331.836-.391.56-.972.836-1.71.836-.74 0-1.303-.263-1.712-.79-.3-.385-.493-.959-.493-1.778V7.953c0-.824.175-1.46.475-1.85.41-.528.972-.807 1.694-.807.71 0 1.273.28 1.67.807.295.39.46.992.46 1.816v1.577H18.59v1.385c-.005.711.2 1.07.685 1.07zm-3.107-1.143c0 .712-.061 1.215-.156 1.542-.189.573-.6.87-1.163.87-.503 0-1.018-.298-1.49-.875l-.003.776h-1.406V2.786h1.406l-.001 3.369c.456-.555.974-.87 1.494-.87.563 0 .941.32 1.13.898.095.31.19.809.19 1.539v3.085zm-5.39 2.313H9.296v-.848c-.562.637-1.04.958-1.56.958-.455 0-.772-.212-.93-.596-.097-.233-.165-.598-.165-1.133V5.408h1.484v6.247c.034.217.127.296.316.296.284 0 .541-.244.855-.682V5.408h1.485v7.712zm-5.624 0H3.593V4.251h-1.64V2.787l4.92-.001V4.25H5.156v8.87zm17.97-9.57s-.228-1.58-.928-2.276C21.31.361 20.316.356 19.86.304 16.596.07 11.7.07 11.7.07h-.01s-4.896 0-8.16.232c-.456.053-1.45.058-2.337.971C.493 1.97.266 3.55.266 3.55S.032 5.405.032 7.26V9c0 1.855.234 3.71.234 3.71s.227 1.58.927 2.276c.887.913 2.052.884 2.571.98 1.867.176 7.93.23 7.93.23s4.902-.007 8.166-.239c.456-.053 1.45-.058 2.337-.971.7-.696.927-2.276.927-2.276s.233-1.855.233-3.71V7.26c0-1.855-.233-3.71-.233-3.71z",fill:"#FFF",mask:"url(#b)"}})])])])]}var g5={render:j$};function q$(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("circle",{attrs:{cx:"12",cy:"12",r:"12","fill-rule":"evenodd"}})])]}var h5={render:q$};function Y$(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"24",height:"23",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("path",{attrs:{d:"M21.443 22.962l.024.039H2a2 2 0 01-1.7-3.053L8.377 6.894a2 2 0 013.414.022l5.16 8.577.344-.567a2 2 0 013.42 0l3.03 4.999a2 2 0 01-1.71 3.037h-.593zM20.01 8a4 4 0 110-8 4 4 0 010 8z",fill:"#FFF","fill-rule":"evenodd"}})])]}var f5={render:Y$};function X$(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"24",height:"23",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("g",{attrs:{fill:"#FFF","fill-rule":"evenodd"}},[t("path",{attrs:{d:"M21.443 18.962l.024.039H2a2 2 0 01-1.7-3.053L8.377 2.894a2 2 0 013.414.022l5.16 8.577.344-.567a2 2 0 013.42 0l3.03 4.999a2 2 0 01-1.71 3.037h-.593zM20.01 8a4 4 0 110-8 4 4 0 010 8z"}}),t("rect",{attrs:{y:"22",width:"24",height:"1",rx:".5"}}),t("rect",{attrs:{y:"20",width:"24",height:"1",rx:".5"}})])])]}var b5={render:X$};function K$(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"20",height:"24",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("path",{attrs:{d:"M18.973 13.994l-16.284 9.77c-.918.55-2.034.104-2.493-.997A2.601 2.601 0 010 21.77V2.23C0 .998.832 0 1.858 0c.288 0 .573.08.831.235l16.284 9.77c.917.551 1.29 1.89.83 2.992-.18.431-.47.781-.83.997z",fill:"#FFF","fill-rule":"evenodd"}})])]}var w5={render:K$};Wn();vt();var Z$={components:{BackgroundSlideshow:o5,BackgroundVideo:n5,VideoSearch:p5,EllipsisPlus:c5,RmSwitcher:Pu,RmOpacityDrag:d5,ColorPicker:Xy,UnsplashImg:u5,VimeoImg:m5,YoutubeImg:g5,ColorImg:h5,PictureImg:f5,SlideshowImg:b5,VideoImg:w5,HelpTourTooltip:Ni},props:["workspace","dark"],data:function(){let e=Zi.default.findWhere(this.workspace.blocks,{name:"Background"}),o=e.model.attributes.slideshow?Zi.default.extend({video:{}},nt(e.model.attributes)):Zi.default.extend({video:{}},nt(e.model.attributes),{slideshow:nt(e.defaultSlideshow)});return{widget:e.model,block:e,attrs:o,state:"upload",videoState:e.model.get("video")&&e.model.get("video").video_id?"video":"select",loading:!1,dragging:!1,videoLoading:!1,picSearchText:"",videoSearchText:e.model.get("video")&&e.model.get("video").url,picOpacityActive:!1,videoOpacityActive:!1,error:null,picture:null,videoImg:{youtube:"YoutubeImg",vimeo:"VimeoImg"},tabImg:{color:"ColorImg",picture:"PictureImg",slideshow:"SlideshowImg",video:"VideoImg"},colorPickerHeight:240,helpTourStep:"ClickOnPaletteIcon"}},computed:{selectedType:function(){return this.attrs.selectedType?this.attrs.selectedType:"color"},canSelectBackgroundFromSwatches:function(){return Ze.isPermissionAllowed("BaseWidgetCanSelectColorFromSwatches")},canSelectBackgroundFromPalette:function(){return Ze.isPermissionAllowed("BaseWidgetCanSelectColorFromPalette")}},watch:{"attrs.picture":function(){this.onPictureChange()},"attrs.video":function(){this.onVideoChange()}},created:function(){this.$watch("attrs",function(e){this.widget.set(nt(e))},{deep:!0}),this.widget.on("change",function(e,o){this.attrs=Zi.default.extend({},this.attrs,e.changed),(!o||!o.undo&&!o.redo)&&this.save._debounced()},this)},mounted:function(){import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-FK4O2EWF.js").then(({default:e})=>{e("controls-video_settings")}),Zi.default.isNumber(this.widget.get("opacity"))||this.widget.set("opacity",1,{silent:!0}),this.save._debounced=Zi.default.debounce(this.save,300),this.loadPreviewImage.__once=Zi.default.once(this.loadPreviewImage),this.workspace.on("main-dragover",this.highlightDropZone,this),this.uploader=new Yn(this,{fileTypes:"jpeg|jpg|png|gif",fileTypesErrorMessage:"We support only JPG, GIF and PNG picture formats.",dropZone:(0,ld.default)([this.$refs.backgroundSlideshowPanel,this.$refs.backgroundPicturePanel])}),this.uploader.on("start",this.onStartUpload),this.uploader.on("done",this.onDoneUpload),this.uploader.on("fail",this.onFailUpload),this.uploader.on("uploadFromUrl",this.uploadFromUrl),this.block.panel=this,this.widget.get("picture")&&this.setPreviewImage(()=>{this.showPictureState()}),He("OpenBackgroundLayer"),Re.trigger("panel:showed","background-panel")},destroyed:function(){this.workspace.off("main-dragover",this.highlightDropZone),this.widget.off("change",null,this),this.uploader.off()},methods:{selectTab:function(e){this.widget.set("selectedType",e)},updateColor:function(e){this.widget.set("color",e)},onStartUpload:function(e){this.loading=!0,this.uploader.viewport=this.widget.getViewport();let o=e.target&&e.target.files.length&&e.target.files[0];o&&Su(o).then(t=>{this.loading&&t.ext&&lc.allowedLambdaExt(t.ext)&&this.block.setTempPicture(t)}).catch(()=>{})},onDoneUpload:function(e,o){if(this.dragging=!1,!o||!o.result){console.error("error file upload!");return}this.uploader.viewport!==this.widget.getViewport()&&(this.loading=!1),this.block.changePicture(o.result,{viewport:this.uploader.viewport})},onFailUpload:function(){this.block.removePicture(),this.showUploadState()},onChangeSlideshowPictures:function(e){this.attrs.slideshow.pictures=e},onChangeSlideshowDelay:function(e){this.attrs.slideshow.delay=e},onChangeSlideshowCrossfade:function(e){this.attrs.slideshow.crossfade=e},showUploadState:function(){this.state="upload",delete this.uploader.viewport},showPictureState:function(){this.loading=!1,this.block.off("imagesReady",this.showPreview),this.state="picture"},showSelectFile:function(e){(0,ld.default)(e.target).hasClass("uploadInput")||this.loading||(0,ld.default)(this.$refs.uploadInput).trigger("click","stop")},loadPreviewImage:function(e){this.block.loadPreviewUrl({w:le.backgroundPreviewWidth,h:le.backgroundPreviewHeight},{viewport:this.uploader.viewport,success:()=>{delete this.uploader.viewport,this.widget.get("picture")&&this.widget.get("picture").previewUrl?this.setPreviewImage(e):console.error("No preview for background")}})},setPreviewImage:function(e){this.loading=!0;let o,t=this.widget.get("picture"),r=(0,ld.default)("<img>").addClass("preload_image").appendTo("body");if(lc.useLambdaUrl(t))o=this.getPreviewUrl();else{if(o=t&&t.previewUrl,!o)return this.loadPreviewImage(e);r.on("error",Zi.default.bind(function(){r.off().remove(),this.loadPreviewImage.__once(e),this.loading=!1},this))}r.attr("src",o).on("load",Zi.default.bind(function(){r.off().remove(),this.block.trigger("loadimage","preview"),e&&e()},this))},getPreviewUrl:function(){let e=this.widget.get("picture");if(!e)return"";if(lc.useLambdaUrl(e)){let o={width:le.backgroundPreviewWidth,height:le.backgroundPreviewHeight};return lc.getLambdaUrl(e,o)}return e.previewUrl},showPicOpacity:function(e){this.picOpacityActive=e},showVideoOpacity:function(e){this.videoOpacityActive=e},uploadFromSearch:function(){this.picSearchText&&(this.isURL(this.picSearchText)?this.uploadFromUrl(this.picSearchText):RM.views.searchUnsplash&&RM.views.searchUnsplash.show(this.picSearchText,{upload:this.uploadImageFromSearch,preview:this.previewImageFromSearch,initialSize:"large"}))},uploadFromUrl:function(e){this.uploader.viewport=this.widget.getViewport(),this.uploadXHR=this.block.loadFromUrl(e,{save:!1,success:()=>{this.picSearchText="",delete this.uploadXHR},error:()=>{this.loading=!1,this.block.picUrl="",this.block.renewPic(),delete this.uploadXHR}}),this.loading=!0},uploadImageFromSearch:function(e){this.block.cancelPictureLoading(),this.loading=!0,this.uploadFromUrl(e)},previewImageFromSearch:function(e,o){this.block.previewPic(e,o)},searchUnsplash:function(){RM.views.searchUnsplash&&RM.views.searchUnsplash.show("",{upload:this.uploadImageFromSearch,preview:this.previewImageFromSearch})},onPictureChange:function(){let e=this.widget.get("picture"),o=this.widget.previous("picture")||{};e?o.url!=e.url&&(this.block.trigger("unloadimage","preview"),this.block.on("imagesReady",this.showPictureState,this),this.setPreviewImage()):this.showUploadState(),delete this.uploader.viewport},deletePicture:function(){this.widget.get("picture")&&this.widget.get("picture").url?!this.uploader.uploading&&!this.uploadXHR&&this.block.removePicture():this.showUpload(),this.loading=!1,this.uploadXHR&&this.uploadXHR.abort(),this.uploader.abort(),this.block.off("imagesReady",this.showPreview)},onVideoChange:function(){this.widget.get("selectedType")=="video"&&(this.widget.previous("video")&&this.widget.previous("video").url!==this.widget.get("video")?.url&&this.block.video.render(),this.widget.get("video")&&this.widget.get("video").url?(this.videoSearchText=this.attrs.video.url,this.videoState="video",this.block.video.show()):(this.videoState="select",this.block.video.hide()))},save:function(){this.widget.save()},isURL:_d}},J$=function(){var e,o=this,t=o.$createElement,r=o._self._c||t;return r("transition",{attrs:{name:"wb-panel"}},[r("div",{staticClass:"background-panel"},[r("div",{staticClass:"background-panel-bg"},[r("div",{staticClass:"views"},[r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedType==="color",expression:"selectedType === 'color'"}],staticStyle:{position:"absolute",width:"100%",top:"16px"}},[r("help-tour-tooltip",{attrs:{step:o.helpTourStep,position:"right",indent:8}})],1),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedType==="color",expression:"selectedType === 'color'"}],staticClass:"view color"},[r("color-picker",{ref:"colorpicker",attrs:{color:o.attrs.color,"colorbox-type":"vertical","colorbox-width":224,"swatches-min":14,"swatches-per-line":7,"favourites-max":8,"favourites-per-line":4,"favourite-gap":11,"show-alpha":!1,"always-visible":!0,"colorbox-height":o.colorPickerHeight,"colorbox-border-radius":0,"swatches-only-mode":o.canSelectBackgroundFromSwatches&&!o.canSelectBackgroundFromPalette},on:{"update:color":o.updateColor}})],1),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedType==="picture",expression:"selectedType === 'picture'"}],ref:"backgroundPicturePanel",staticClass:"view picture",class:{loaded:o.picture}},[r("div",{directives:[{name:"show",rawName:"v-show",value:o.state==="upload",expression:"state === 'upload'"}],staticClass:"upload",class:{dragging:o.dragging},attrs:{"drag-over":"handleDragOver"},on:{dragenter:function(i){o.dragging=!0},dragend:function(i){o.dragging=!1},dragleave:function(i){o.dragging=!1},click:o.showSelectFile}},[r("div",{staticClass:"param-caption"},[o._v("Picture")]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!o.loading,expression:"!loading"}],staticClass:"upload-wrapper"},[r("div",{staticClass:"caption-drop"},[o._v("Drop file here")])]),o._v(" "),r("input",{ref:"uploadInput",staticClass:"uploadInput",attrs:{type:"file",name:"upload","data-url":"/api/upload/lambda/"}})]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.loading,expression:"loading"}],staticClass:"picture_preloader rmpreloader"},[r("div",{staticClass:"shadow"}),o._v(" "),r("div",{staticClass:"arc"})]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.state==="upload"&&!o.loading,expression:"state === 'upload' && !loading"}],staticClass:"social"},[r("span",{on:{click:o.searchUnsplash}},[r("unsplash-img",{staticClass:"svg unsplash",attrs:{title:"Unsplash"}})],1),o._v(" "),r("div",{staticClass:"search"},[r("input",{directives:[{name:"model",rawName:"v-model.trim",value:o.picSearchText,expression:"picSearchText",modifiers:{trim:!0}}],class:{"has-icon":o.picSearchText!=""},attrs:{type:"text",spellcheck:"false",placeholder:"Search or paste URL",value:""},domProps:{value:o.picSearchText},on:{keyup:function(i){return!i.type.indexOf("key")&&o._k(i.keyCode,"enter",13,i.key,"Enter")?null:o.uploadFromSearch(i)},input:function(i){i.target.composing||(o.picSearchText=i.target.value.trim())},blur:function(i){return o.$forceUpdate()}}}),o._v(" "),r("div",{staticClass:"input-icon",class:{hidden:o.picSearchText==="","upload-icon":o.isURL(o.picSearchText)},on:{click:o.uploadFromSearch}})])]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.state==="picture",expression:"state === 'picture'"}],staticClass:"preview"},[r("div",{staticClass:"image",style:{backgroundImage:"url("+o.getPreviewUrl()+")"}}),o._v(" "),r("div",{staticClass:"mask"}),o._v(" "),r("div",{staticClass:"delete",attrs:{title:"Replace"},on:{click:o.deletePicture}}),o._v(" "),r("rm-opacity-drag",{ref:"opacity",staticClass:"opacity",attrs:{width:205,"handle-width":24,gap:4,"gradient-color":o.attrs.color},on:{"opacity-active":o.showPicOpacity},model:{value:o.attrs.opacity,callback:function(i){o.$set(o.attrs,"opacity",i)},expression:"attrs.opacity"}},[r("span",{directives:[{name:"show",rawName:"v-show",value:o.picOpacityActive,expression:"picOpacityActive"}],staticClass:"opacity-percents"},[o._v(o._s(Math.ceil(o.attrs.opacity*100)))])])],1)]),o._v(" "),r("background-slideshow",{directives:[{name:"show",rawName:"v-show",value:o.selectedType==="slideshow",expression:"selectedType === 'slideshow'"}],ref:"backgroundSlideshowPanel",attrs:{"slideshow-data":o.attrs.slideshow,"selected-type":o.selectedType,block:o.block},on:{updatePictures:o.onChangeSlideshowPictures,updateDelay:o.onChangeSlideshowDelay,updateCrossfade:o.onChangeSlideshowCrossfade}}),o._v(" "),r("background-video",{directives:[{name:"show",rawName:"v-show",value:o.selectedType==="video",expression:"selectedType === 'video'"}],attrs:{"widget-model":o.widget}})],1),o._v(" "),r("div",{class:(e={},e.tabs=!0,e.dark=o.dark,e)},o._l(["color","picture","slideshow","video"],function(i){var n;return r("div",{key:i,staticClass:"tab",class:(n={active:o.selectedType===i},n[i]=!0,n),style:{fill:i==="color"?"#"+o.attrs.color:""},on:{click:function(s){return o.selectTab(i)}}},[r(o.tabImg[i],{tag:"component",staticClass:"svg",staticStyle:{"pointer-events":"none"}})],1)}),0)])])])},Q$=[],eH=void 0,tH="data-v-dcaca926",oH=void 0,rH=!1;function iH(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="background-panel.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var nH=iH({render:J$,staticRenderFns:Q$},eH,Z$,tH,rH,oH,!1,void 0,void 0,void 0),Xg=nH;jt();Pd();N();oe();zt();var x5=F(f,{excludeProps:["borderStyling"]})`
  width: 100%;
  height: 2px;
  background-color: ${e=>Le(e.borderStyling==="primary"?.8:.76,e.theme.colors.gray)};
`;var v5=B(H()),bp=(0,v5.createContext)({});k();function k5(){let{workspace:e}=(0,Ts.useContext)(qe),{nameOfOpenedPanel:o,setNameOfOpenedPanel:t}=(0,Ts.useContext)(bp),r=(0,Ts.useRef)(null),i=(0,Ts.useRef)(null),[n]=ti(l=>[l.backgroundLayer]),s=()=>{t("background")};return(0,Ts.useEffect)(()=>{o==="background"&&(r.current&&Jr(r.current),i.current&&(r.current&&Jr(r.current),r.current=va(Xg,i.current,{workspace:e,dark:!0})))},[o]),w(q,{children:[o==="layers"&&w(f,{padding:"0 16px 12px 16px",children:[a(x5,{}),w(f,{cursor:"pointer",height:fo.height,padding:"2px 0",display:"flex",alignItems:"center",onClick:s,children:[a(zg,{iconStyles:n?.iconStyles,isBackgroundVideo:n?.selectedBackgroundType==="video"}),a(f,{paddingLeft:"8px",children:a(L,{cursor:"pointer",textStyle:"small",userSelect:"none",children:n?.name})})]})]}),a(f,{ref:i,position:"relative",css:ae`
          & .background-panel {
            position: relative !important;
            padding: 0 !important;
            width: 224px !important;
            height: 292px !important;
            left: 0 !important;
            bottom: 0 !important;
          }
        `})]})}var pd=B(H());jt();je();k();function _5(){let{workspace:e}=(0,pd.useContext)(qe),{dropdownContainer:o}=(0,pd.useContext)(_c),[t,r]=ti(c=>[c.filter,c.setFilter]),[i,n]=(0,pd.useState)(()=>l(t));function s(c){c==="links"&&se(he.SettingsLayers,{settingsType:"show only with links"}),c==="viewport"&&se(he.SettingsLayers,{settingsType:"show current viewport"}),r(c),n(l(c)),hg(c)}function l(c){let d;switch(e?.getViewports().find(m=>m.isCurrent===!0)?.name){case"default":d="Show desktop widgets only";break;case"phone_portrait":d="Show mobile widgets only";break;case"tablet_portrait":d="Show tablet widgets only";break}return[{title:"Show all",onClick:()=>s("all"),active:c==="all"},{title:d,onClick:()=>s("viewport"),active:c==="viewport"},{title:"Show layers with links",onClick:()=>s("links"),active:c==="links"}]}return a(q,{children:e&&a(Yb,{workspace:e,container:()=>o,actions:i,isActive:t!=="all"})})}k();var sH=F(f)`
  width: 224px;
  background-color: ${e=>Le(.04,e.theme.colors.black)};
  color: ${e=>Le(.04,e.theme.colors.white)};
  backdrop-filter: blur(4px);
  border-radius: 8px;
  max-height: 100%;
  overflow: hidden;
  display: flex;
  flex-direction: column;
`;function Dw(){let{nameOfOpenedPanel:e}=(0,Lo.useContext)(bp),{page:o,workspace:t,blocks:r,mag:i,viewport:n}=(0,Lo.useContext)(qe),s=(0,Lo.useRef)(new Eg).current,{callback:l}=Oi(()=>{if(!o)return;let C=window.RM.constructorRouter.indexController.getOrder(o,n);d(C)},100),c=C=>{if(C.model.get("type")==="background")s.refreshBackgroundState(C);else{let P=s.layers.refreshLayerState;C.model.get("type")==="shape"?yd(()=>P(C,s.getFilter())):P(C,s.getFilter())}},d=C=>{let P=i?.get("packs")||[],v=t?.packs,T=t?.blocks||[],R=t?.page.getViewportParam("phone_portrait","enabled");s.updateLayers({order:C,blocks:T,packsData:P,packs:v,isPhoneVpEnabled:R})},p=(0,Lo.useCallback)((C,P,v)=>{let T=s.isCtrlPressed(),R=s.isShiftPressed();if(v.has(C)&&R||v.has(C)&&v.size===1)return;let I=s.getWidgetPack(C),M=I&&I.blocks.length>0?I.blocks[0]:s.getBlock(C),D=Array.from(P.values()),E=Array.from(v.values()),A=Os(D,E),$=Os(E,D),j=[],pe=[],ee=[];for(let G of P){let K=s.getBlock(G);K&&(A.includes(G)&&j.push(K),pe.push(K))}for(let G of $){let K=s.getBlock(G);K&&ee.push(K)}if(R)t&&t.selectListBlocks(pe,[]);else{t&&t.trigger("block:click",M,{shiftKey:!1,ctrlKey:T});for(let G of j)G.select(!0);for(let G of ee)G.deselect();if(t&&t.trigger("select",pe,ee,!0),!$.includes(C)){let G=s.isDragActive(),K=M?.model.get("hidden");!G&&!K&&M&&M?.scrollTo()}}},[t]),m=(0,Lo.useCallback)((C,P,v)=>{if(!o)return;let T=s.mergeOrderChanges(P);window.RM.constructorRouter.indexController.setOrderForPage(C,o,n,v);let R=window.RM.constructorRouter.indexController.getPagesToSave();t&&(T.length>0&&t.save_group(T),t.syncManager.saveGroup(R,{patch:!0,silent:!0,skipHistory:T.length>0}))},[t]),u=C=>{let P=new Set(C.map(R=>R.id)),v=s.layers.getAllItems(),T=Yg(P,v);s.layers.selectAndOpenGroupIfNeeded(T)},g=(0,Lo.useCallback)(()=>{},[]),h=(C,P)=>{let v=s.getBlock(C),T=s.getWidgetPack(C),R=[];if(v)R.push({_id:v.model.get("_id"),...P});else if(T){let I=T.blocks;for(let M of I)M.model&&R.push({_id:M.model.get("_id"),...P})}return R},b=(0,Lo.useCallback)((C,P)=>{let v=h(C,{hidden:P});t&&t.save_group(v)},[t]),x=(0,Lo.useCallback)((C,P)=>{let v=h(C,{is_locked:P});t&&t.save_group(v)},[t]),S=(0,Lo.useCallback)((C,P)=>{let v=s.getWidgetPack(C),T=v?v?.model:s.getBlock(C)?.model;if(T&&T.save({name:P}),v){let R=i?.attributes?.packs,I=R.find(M=>M.pack_id===C);I?I.name=P:R.push(T.toJSON())}},[]),y=(0,Lo.useCallback)((C,P)=>{let v=s.getBlock(C);t&&t.trigger("viewportShortcutPressed",P),v&&v.scrollTo()},[t]);return(0,Lo.useEffect)(()=>{if(o){s.resetState();let v=window.RM.constructorRouter.indexController.getOrder(o,n);d(v)}let C=v=>{v.key===Aa.Key.Shift?s.setShiftIsPressed(!0):(v.key===Aa.Key.Control||v.key===Aa.Key.Meta)&&s.setCtrlIsPressed(!0)},P=v=>{v.key===Aa.Key.Shift?s.setShiftIsPressed(!1):(v.key===Aa.Key.Control||v.key===Aa.Key.Meta)&&s.setCtrlIsPressed(!1)};return Re.on("index:changed",l),window.addEventListener("keydown",C),window.addEventListener("keyup",P),()=>{Re.off("index:changed",l),window.removeEventListener("keydown",C),window.removeEventListener("keyup",P)}},[t]),(0,Lo.useEffect)(()=>{for(let C of r)C?.model?.on("change change:picture",()=>c(C));return()=>{for(let C of r)C?.model?.off("change change:picture",()=>c(C))}},[r]),(0,Lo.useEffect)(()=>(t&&t.on("select",u),()=>{t&&t.off("select",u)}),[t]),a(sH,{children:w(DP,{value:s,children:[e==="layers"&&w(f,{display:"flex",overflow:"hidden",flexDirection:"column",children:[w(f,{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:"0",padding:"0 16px",children:[a("h2",{style:{fontWeight:500,userSelect:"none"},children:"Layers"}),a(_5,{})]}),a(f,{flexGrow:"1",overflow:"auto",children:a(xP,{value:s.layers,children:a(e5,{onLayersSelect:p,onChangeOrder:m,onLayerHover:g,onLayerHide:b,onLayerLock:x,onLayerRename:S,onLayerSwitchToViewport:y})})})]}),a(f,{flexShrink:"0",children:a(k5,{})})]})})}oe();zt();Sr();jt();Uo();vt();yr();k();function S5({children:e,button:o,...t}){let{togglePanel:r,openPanel:i}=(0,oi.useContext)(Ct),n=(0,oi.useRef)(null),s=(0,oi.useRef)(null),{user:l}=(0,oi.useContext)(cr),[c,d]=(0,oi.useState)(!1),{selectedBlocks:p,workspace:m,page:u,viewport:g}=(0,oi.useContext)(qe),[h,b]=(0,oi.useState)("layers"),[x]=go(),S=Ht();Gi("q",{handler:()=>r("stackpanel",!1)},[x]),(0,oi.useEffect)(()=>{if(!Ge("constructor.activateNewStackPanel"))if(c&&s.current){n.current&&Jr(n.current);let P={showPanel:v=>{b(v),v==="background"&&s.current&&(n.current&&Jr(n.current),n.current=va(Xg,s.current,{workspace:m,dark:!0}))}};n.current=va(C4,s.current,{workspace:m,showGuidePanel:!1,dark:!0},P),S.step?.name==="ClickOnPaletteIcon"&&Nr("ClickOnPaletteIcon",{show:!1})}else c||(b("layers"),n.current&&Jr(n.current),n.current=null,S.step?.name==="ClickOnPaletteIcon"&&Nr("ClickOnPaletteIcon",{show:!0}))},[c,m,l,u,g]);let y=P=>{let v=h!=="layers";v&&Ge("constructor.activateNewStackPanel")&&b("layers"),v&&!P&&i("stackpanel"),d(P)},C=P=>P&&p.length===0||h!=="layers";return a(Xt,{id:"toolbar-popover",name:"stackpanel",skidding:-28,button:o,onToggle:y,panelPosition:{width:0,marginLeft:"-112px"},watchingClick:C,ArrowProps:{backgroundColor:({theme:P})=>Ge("constructor.activateNewStackPanel")?Le(.04,P?.colors.black||"black"):"rgba(40, 40, 40, 0.96)",popperPadding:132,stroke:({theme:P})=>Ge("constructor.activateNewStackPanel")?"transparent":h!=="background"?Le(.96,P?.colors.gray||"gray"):"transparent"},...t,children:Ge("constructor.activateNewStackPanel")?a(bp.Provider,{value:{nameOfOpenedPanel:h,setNameOfOpenedPanel:b},children:a(Dw,{})}):w(f,{height:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-end",ref:s,css:P=>ae`
            & .stack_panel {
              max-height: 100% !important;
              width: 224px !important;
            }
            & .line.last {
              background: ${Le(.8,P.colors.gray)};
              opacity: 1;
            }
            & .background-panel {
              position: relative !important;
              padding: 0 !important;
              width: 224px !important;
              height: 292px !important;
              left: 0 !important;
              bottom: 0 !important;
            }
            & .stack_panel .inner {
              padding: 0;
              margin-bottom: 0;
              box-shadow: 0 0 0 2px inset ${Le(.96,P.colors.gray)};
            }
            & .stack_panel .layer.selected {
              background: ${Le(.2,P.colors.darkGray)};
            }
          `,children:[a(f,{position:"relative",top:88,left:224,children:a(gt,{targetSteps:["MobileMenuVisible","ClickOnTriangleToOpenGroup","BeforeAddAnimations"],position:"right",indent:8,children:a("div",{})})}),a(f,{position:"relative",top:148,left:224,children:a(gt,{targetSteps:["DeleteVisibleMobileMenu"],position:"right",indent:8,children:a("div",{})})})]})})}Gn();oe();N();k();var aH=F(f)`
  position: relative;

  &::before {
    content: '';
    z-index: -1;
    width: 100%;
    height: 100%;
    position: absolute;
    backdrop-filter: ${e=>`blur(${e.blur})`};
  }
`;function Kg({children:e,blur:o="4px",...t}){return a(aH,{blur:o,...t,children:e})}fe();N();var C5=B(Qo());pn();je();var Zg=B(H());k();function lH(){let e=(0,Zg.useRef)(null);return(0,Zg.useEffect)(()=>{let o=()=>{e.current&&new window.YT.Player(e.current,{events:{onStateChange:t=>{t.data===1&&se(he.EditorTips2,{tip:"mobile layout",action:"play video"})}}})};window.youTubeApiIsReady?o():window.ytQueue.push({cb:o})},[]),a("iframe",{ref:e,width:"360",height:"224",src:"https://www.youtube.com/embed/JgoEncb3iDM?si=8jiXXcNZZ_yeqbd4&modestbranding=1&enablejsapi=1",title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0})}function pH({children:e}){return a(f,{borderRadius:"4px",position:"absolute",zIndex:"100000",right:"16px",top:"16px",backgroundColor:"blue",width:"392px",padding:"8px 16px 16px 16px",children:e})}function P5({isOpen:e,onClose:o}){return e?(0,C5.createPortal)(w(pH,{children:[w(f,{display:"flex",width:"100%",justifyContent:"flex-end",marginBottom:"8px",alignItems:"center",gap:"8px",children:[a(jv,{onClick:()=>{se(he.EditorTips2,{tip:"mobile layout",action:"open youtube"}),window.open("https://www.youtube.com/watch?v=JgoEncb3iDM","_blank")},color:"white",cursor:"pointer"}),a(f,{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,children:a(Nt,{onClick:o,color:"white",cursor:"pointer"})})]}),a(lH,{}),a(ve,{color:"white",fontWeight:"500",fontSize:"12px",lineHeight:"14px",paddingTop:"12px",children:"In this video, you\u2019ll learn how to optimize your Readymag designs for mobile, discover inheritance principles, and\xA0master composition tools."})]}),document.getElementById("mobile-layout-video")):null}pr();mi();k();var I5=()=>{let e=(0,T5.useContext)(qe),[o]=go(),[{visible:t,message:r}]=ol(),i=()=>{window.RM.constructorRouter.trigger("notice:triggerEduTipClose"),se(he.EditorTips2,{tip:"mobile layout",action:"close"})};return e.page?w(f,{id:"widgetbar",display:"flex",height:56,position:"absolute",bottom:16,left:16,borderRadius:"9px 8px 8px 9px",zIndex:3e3,children:[a(P5,{onClose:i,isOpen:t&&r==="eduTipMobileLayoutVideo"}),a($S,{}),a(Kg,{display:"flex",width:224,height:56,borderRadius:"8px",margin:"0 0 0 8px",backgroundColor:Me("darkGray",.96),children:w(sl,{children:[a(OC,{width:"56px",button:({isPanelShown:n})=>a(FS,{disableTooltip:n})}),a(Nb,{width:"56px",button:({isPanelShown:n})=>a(US,{currentViewport:e.viewport,disableTooltip:n})}),a(qs,{disabled:o,children:a(S5,{width:"56px",button:({isPanelShown:n})=>a(bS,{disableTooltip:n})})}),a(an,{permission:"BaseWidgetCanAdd",children:a(qs,{disabled:o,children:a(r4,{width:"56px",height:"56px",button:({isPanelShown:n})=>a(xS,{disableTooltip:n})})})})]})})]}):null};var md=B(H());oe();N();Co();Gn();Jt();jt();var M5=B(H());$e();Co();Wn();Yh();k();var In=(0,M5.createContext)({isEditorModeEnabled:!1,canChangeLockedLayoutMode:!1}),{Provider:cH}=In;function B5({children:e}){let o=Ze.getCurrentRole(),t=!!(o&&o==="editor"),r=window.RM.constructorRouter.canChangeLockedLayoutMode();return a(cH,{value:{isEditorModeEnabled:t,canChangeLockedLayoutMode:r},children:e})}function R5({isActive:e,...o}){let t=e?"Layout locked":"Layout unlocked";return a(St,{placement:"right",indent:8,leaveDelay:100,text:`${t} (L)`,instance:!0,children:a(Ue,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",width:56,height:56,onClick:()=>{let r=e?"editor":"member";window.RM.constructorRouter.changeEditorMode(r,!0)},"aria-label":t,...o,children:a(Zs,{isActive:e})})})}$e();Uo();jn();k();var z5=({id:e="guideIcon",width:o,height:t,hoverBox:r})=>{let i=Vo(o,t,r);return w("svg",{id:e,viewBox:"0 0 24 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:o,height:t,style:{padding:i},children:[w("line",{x1:"3",y1:"1",x2:"3",y2:"25",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[a("animate",{attributeName:"x1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x1",to:"3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"12",y1:"1",x2:"12",y2:"25",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[a("animate",{attributeName:"x1",to:"10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x1",to:"12",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"12",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"12",y1:"1",x2:"12",y2:"25",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[a("animate",{attributeName:"x1",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x1",to:"12",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"12",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"21",y1:"1",x2:"21",y2:"25",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[a("animate",{attributeName:"x1",to:"23",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x1",to:"21",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"23",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animate",{attributeName:"x2",to:"21",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};vt();mi();k();function E5({disableTooltip:e,width:o="100%",...t}){return a(gt,{targetSteps:"SelectGrids",indent:8,defaultText:"Grid and Layout",eduTips:"eduTipUseGrids",disabled:e,leaveDelay:100,instance:!0,closeOnTargetClick:!0,children:a(Ue,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",width:o,height:"100%","aria-label":"Grid and Layout","data-testid":"guides-button",...t,children:a(z5,{width:"24px",height:"26px",hoverBox:{width:56,height:56}})})})}var Mn=B(H());N();var wp=B(pt());Yy();ou();vt();Bo();je();function dH(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("path",{attrs:{fill:"currentColor",d:"M0 0h1v20H0zM6 0h1v20H6zM9 0h1v20H9zM15 0h1v20h-1z"}})])]}var A5={render:dH};function uH(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16",height:"20",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("path",{attrs:{fill:"currentColor",opacity:"0.4",d:"M0 0h1v20H0z"}}),t("path",{attrs:{fill:"currentColor",d:"M6 0h1v20H6zM9 0h1v20H9z"}}),t("path",{attrs:{fill:"currentColor",opacity:"0.4",d:"M15 0h1v20h-1z"}})])]}var L5={render:uH};function mH(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"40px",viewBox:"0 0 16 40",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Shape")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-16.000000, -169.000000)",fill:"currentColor"}},[t("path",{attrs:{d:"M17,169 L16,169 L16,209 L17,209 L17,169 Z M22,169 L21,169 L21,209 L22,209 L22,169 Z M26,169 L27,169 L27,209 L26,209 L26,169 Z M32,169 L31,169 L31,209 L32,209 L32,169 Z",id:"Shape"}})])])])]}var D5={render:mH};function gH(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Shape")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-17.000000, -230.000000)",fill:"currentColor"}},[t("path",{attrs:{d:"M33,230 L17,230 L17,231 L33,231 L33,230 Z M33,233 L17,233 L17,234 L33,234 L33,233 Z M17,236 L33,236 L33,237 L17,237 L17,236 Z M33,239 L17,239 L17,240 L33,240 L33,239 Z",id:"Shape"}})])])])]}var O5={render:gH};function hH(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 2")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-49.000000, -230.000000)",fill:"currentColor","fill-rule":"nonzero"}},[t("g",{attrs:{id:"Group-2",transform:"translate(49.000000, 230.000000)"}},[t("rect",{attrs:{id:"Rectangle",x:"0",y:"0",width:"16",height:"1"}}),t("rect",{attrs:{id:"Rectangle",opacity:"0.4",x:"0",y:"3",width:"16",height:"1"}}),t("rect",{attrs:{id:"Rectangle",opacity:"0.4",x:"0",y:"6",width:"16",height:"1"}}),t("rect",{attrs:{id:"Rectangle",x:"0",y:"9",width:"16",height:"1"}})])])])])]}var $5={render:hH};function fH(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 3")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-97.000000, -230.000000)"}},[t("g",{attrs:{id:"Group-3",transform:"translate(97.000000, 230.000000)"}},[t("rect",{attrs:{id:"Rectangle",stroke:"currentColor",opacity:"0.4",x:"0.5",y:"0.5",width:"15",height:"9"}}),t("rect",{attrs:{id:"Rectangle",fill:"currentColor","fill-rule":"nonzero",x:"0",y:"0",width:"1",height:"10"}})])])])])]}var H5={render:fH};function bH(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 4")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-129.000000, -230.000000)"}},[t("g",{attrs:{id:"Group-4",transform:"translate(129.000000, 230.000000)"}},[t("rect",{attrs:{id:"Rectangle",stroke:"currentColor",opacity:"0.4",x:"0.5",y:"0.5",width:"15",height:"9"}}),t("rect",{attrs:{id:"Rectangle",fill:"currentColor","fill-rule":"nonzero",x:"0",y:"0",width:"16",height:"1"}})])])])])]}var F5={render:bH};function wH(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 6")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-193.000000, -230.000000)"}},[t("g",{attrs:{id:"Group-6",transform:"translate(193.500000, 230.000000)"}},[t("rect",{attrs:{id:"Rectangle",stroke:"currentColor",opacity:"0.4",x:"0",y:"0.5",width:"15",height:"9"}}),t("rect",{attrs:{id:"Rectangle",fill:"currentColor","fill-rule":"nonzero",x:"14.5",y:"0",width:"1",height:"10"}})])])])])]}var N5={render:wH};function xH(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 5")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-161.000000, -230.000000)",stroke:"#282828"}},[t("g",{attrs:{id:"Group-5",transform:"translate(161.250000, 230.500000)"}},[t("rect",{attrs:{id:"Rectangle",stroke:"currentColor",opacity:"0.4",x:"0.25",y:"0",width:"15",height:"9"}}),t("rect",{attrs:{id:"Rectangle",fill:"currentColor","stroke-width":"0.5",x:"0",y:"8.75",width:"15.5",height:"1"}})])])])])]}var W5={render:xH};function vH(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"17px",height:"17px",viewBox:"0 0 17 17",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Artboard",transform:"translate(-33.000000, -58.000000)"}},[t("g",{attrs:{id:"[-Grid-Guides-Snap-Sizes-]",transform:"translate(34.000000, 9.914060)"}},[t("g",{attrs:{id:"Group",transform:"translate(0.000000, 49.000000)"}},[t("rect",{attrs:{id:"Rectangle",stroke:"currentColor",x:"0",y:"0",width:"15",height:"15"}}),t("path",{attrs:{d:"M4.5,0.5 L3.5,0.5 L3.5,3.5 L0.5,3.5 L0.5,4.5 L3.5,4.5 L3.5,10.5 L0.5,10.5 L0.5,11.5 L3.5,11.5 L3.5,14.5 L4.5,14.5 L4.5,11.5 L10.5,11.5 L10.5,14.5 L11.5,14.5 L11.5,11.5 L14.5,11.5 L14.5,10.5 L11.5,10.5 L11.5,4.5 L14.5,4.5 L14.5,3.5 L11.5,3.5 L11.5,0.5 L10.5,0.5 L10.5,3.5 L4.5,3.5 L4.5,0.5 Z M10.5,10.5 L10.5,4.5 L4.5,4.5 L4.5,10.5 L10.5,10.5 Z",id:"Shape","fill-opacity":"0.4",fill:"currentColor",opacity:"0.4"}})])])])])])]}var V5={render:vH};function yH(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"17px",height:"17px",viewBox:"0 0 17 17",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 2")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Artboard",transform:"translate(-33.000000, -9.000000)"}},[t("g",{attrs:{id:"Group-2",transform:"translate(34.000000, 9.914060)"}},[t("rect",{attrs:{id:"Rectangle","stroke-opacity":"0.4",stroke:"currentColor",opacity:"0.4",x:"0",y:"0",width:"15",height:"15"}}),t("path",{attrs:{d:"M4.5,0.5 L3.5,0.5 L3.5,3.5 L0.5,3.5 L0.5,4.5 L3.5,4.5 L3.5,10.5 L0.5,10.5 L0.5,11.5 L3.5,11.5 L3.5,14.5 L4.5,14.5 L4.5,11.5 L10.5,11.5 L10.5,14.5 L11.5,14.5 L11.5,11.5 L14.5,11.5 L14.5,10.5 L11.5,10.5 L11.5,4.5 L14.5,4.5 L14.5,3.5 L11.5,3.5 L11.5,0.5 L10.5,0.5 L10.5,3.5 L4.5,3.5 L4.5,0.5 Z M10.5,10.5 L10.5,4.5 L4.5,4.5 L4.5,10.5 L10.5,10.5 Z",id:"Shape",fill:"currentColor"}})])])])])]}var U5={render:yH};Hx();vt();Qa();var kH={components:{RmSwitcher:Pu,NumericInput:Vn,ColumnIcon:A5,GutterIcon:L5,GuideCount:D5,BaselineCount:O5,BaselineSize:$5,MarginLeft:H5,MarginRight:N5,MarginBottom:W5,MarginTop:F5,HelpTourTooltip:Ni,GridOuter:V5,GridInner:U5},props:{workspace:{type:Object,default:null}},data:function(){let e=RM.constructorRouter.workspace.viewport,o=e==="default"||e==="phone_portrait",t=this.workspace.mag.get("opts");return{noHoverButtons:!1,loadedData:!1,selectedTab:"guides",index:1,baseline_height:0,baseline_group:0,gg:null,grids:null,guides:null,guidesData:{columns:0,padding:0,columnWidth:0,baseline_height:0,baseline_group:0,margin:{top:0,left:0,right:0,bottom:0},grid_step:8,grid_count:8},editParamsData:{grid:!1,snap:!1,guides:!1,sizes:!1},initialEditParamsDataForHelpTour:{grid:!1,snap:!1,guides:!0,sizes:!1},initialEditParamsDataForHelpTourIsSet:!1,viewportWidth:void 0,scaleEnabled:!1,viewport:e,customViewportWidthEnabled:o,scaleRatio:this.getScaleRatio(e),helpTourStep:"ChangeGrids",helpTourStepSnap:"ClickOnSnapButton",helpTourStepSizes:"ClickOnSizesButton",opts:{...t}}},computed:{baseline_group_h:function(){return this.baseline_group*this.baseline_height||0},grid_count_h:function(){return this.guidesData.grid_count*this.guidesData.grid_step||0},preciseColumnWidth(){return this.getPreciseColumnWidthByViewportWidth(this.viewportWidth)},isColumnWidthFloating(){return Math.round(this.preciseColumnWidth)!==this.preciseColumnWidth},minWidth(){return Mr.prototype.getViewportSetting("width",this.viewport)},maxWidth(){return Mr.prototype.getViewportSetting("max_width",this.viewport)},minColumnWidth(){return Math.max(Math.ceil(this.getPreciseColumnWidthByViewportWidth(this.minWidth)),0)},maxColumnWidth(){return Math.floor(this.getPreciseColumnWidthByViewportWidth(this.maxWidth))},isScaleLayout(){return this.opts.scalableviewer},isDesktopLayout(){return this.viewport==="default"}},watch:{editParamsData:{handler:function(){this.gg.mag.edit_params.set(this.editParamsData),this.saveParams()},deep:!0},guidesData:{handler:function(){this.gg.guides.model.set({...this.guidesData,margin:{...this.guidesData.margin}}),this.saveParams()},deep:!0},selectedTab:{handler:function(){this.gg.guides.model.set({...this.guidesData,selectedTab:this.selectedTab}),this.saveParams()}},index:function(){if(this.index===3&&He("ChangeGrids"),this.loadedData){let e;try{e=JSON.parse(window.sessionStorage.getItem("RM-lastUsedGuidesSet")||"{}"),e[RM.constructorRouter.workspace.page.get("mid")]=this.index}catch{e={},e[RM.constructorRouter.workspace.page.get("mid")]=this.index}window.sessionStorage.setItem("RM-lastUsedGuidesSet",JSON.stringify(e)),this.gg.guides.models.setPage(RM.constructorRouter.workspace.page,this.index),this.editParamsData.guides=!0}},baseline_height:function(e,o){e<8&&(this.baseline_height=o>e?0:8),this.guidesData.baseline_height=this.baseline_height},baseline_group:function(e,o){e<2&&(this.baseline_group=o>e?0:2),this.guidesData.baseline_group=this.baseline_group},viewportWidth(e,o){let t=this.workspace.viewport;if(o===void 0||e===o||!this.customViewportWidthEnabled)return;let r=Math.max(this.minWidth,Math.min(this.maxWidth,e));if(e!==r)this.viewportWidth=r;else{let i={default:"desktopWidth",phone_portrait:"phoneWidth",tablet_portrait:"tabletWidth"}[t];this.gg.mag.set({[i]:e}),this.saveViewportWidth(e);let n=RM.constructorRouter.zoom.getZoom(),s=RM.constructorRouter.workspace.$container[0],l=(o*n-window.innerWidth)/2,c=(e*n-window.innerWidth)/2;s.scrollLeft=(s.scrollLeft||0)+Math.max(c,0)-Math.max(l,0)}}},mounted:function(){this.gg=RM.constructorRouter.gg,this.gg.mag.edit_params.on("change",this.updateStateFromModel),this.gg.mag.on("change:phoneWidth change:desktopWidth",this.updateStateFromModel),this.gg.created?this.loadGuides():this.gg.on("create",this.loadGuides.bind(this)),this.workspace.mag.on("change:opts",this.handleChangeOpts),this.workspace.page.on("change:viewport",this.onChangeViewport),window.addEventListener("resize",this.onWindowResize)},destroyed(){C0("ChangeGrids"),this.workspace.mag.off("change:opts",this.handleChangeOpts),this.workspace.page.off("change:viewport",this.onChangeViewport),this.gg.mag.edit_params.off("change",this.updateStateFromModel),this.gg.mag.off("change:phoneWidth change:desktopWidth",this.updateStateFromModel),window.removeEventListener("resize",this.onWindowResize),He("ChangeGrids")},methods:{setOpts(e,o){let t={...this.workspace.mag.get("opts"),[e]:o};this.workspace.mag.set("opts",t),this.opts=t,this.saveOpts(t)},saveOpts:wp.default.debounce(function(e){p0(RM.constructorRouter.mag.get("num_id"),e)},500),handleSetGridsClick(){this.index===3&&He("ChangeGrids")},getPreciseColumnWidthByViewportWidth(e){return(e-(this.guidesData.margin.left||0)-(this.guidesData.margin.right||0)-this.guidesData.padding*(this.guidesData.columns-1))/this.guidesData.columns},getViewportWidthByColumnWidth(e){return e*this.guidesData.columns+this.guidesData.padding*(this.guidesData.columns-1)+this.guidesData.margin.left+this.guidesData.margin.right},getViewportWidthByGutter(e,o){return o*this.guidesData.columns+e*(this.guidesData.columns-1)+this.guidesData.margin.left+this.guidesData.margin.right},handleChangeOpts:function(e,o){this.opts={...o}},loadGuides:function(){this.guides=this.gg.guides,this.guides.created||this.gg.guides.create(!1),this.guides.model&&(this.updateStateFromModel(),this.$nextTick(()=>{this.loadedData=!0})),this.guides.on("modelLoaded",e=>{this.updateStateFromModel(e),this.$nextTick(()=>{this.loadedData=!0})})},updateBaselineGroup:function(e){e>this.baseline_group_h?this.baseline_group++:e<this.baseline_group_h&&this.baseline_group--},updateGridCount:function(e){e>this.grid_count_h?this.guidesData.grid_count++:e<this.grid_count_h&&this.guidesData.grid_count--,this.guidesData.grid_count=Math.max(this.guidesData.grid_count,2)},updateStateFromModel:function(){let e=this.guides.model,o=Ht(),t=o.started,r=t&&o.step.name==="ChangeGrids";!this.initialEditParamsDataForHelpTourIsSet&&t&&r?(this.initialEditParamsDataForHelpTourIsSet=!0,this.editParamsData.snap=this.initialEditParamsDataForHelpTour.snap,this.editParamsData.grid=this.initialEditParamsDataForHelpTour.grid,this.editParamsData.guides=this.initialEditParamsDataForHelpTour.guides,this.editParamsData.sizes=this.initialEditParamsDataForHelpTour.size):(this.editParamsData.snap=this.gg.mag.edit_params.get("snap"),this.editParamsData.grid=this.gg.mag.edit_params.get("grid"),this.editParamsData.guides=this.gg.mag.edit_params.get("guides"),this.editParamsData.sizes=this.gg.mag.edit_params.get("sizes")),this.viewportWidth=this.gg.mag.getViewportWidth(this.workspace.viewport),this.editParamsData.grid&&this.editParamsData.guides&&(this.editParamsData.grid=!1),this.index=e.get("index"),this.selectedTab=e.get("selectedTab"),this.guidesData.columns=e.get("columns"),this.guidesData.padding=e.get("padding"),this.baseline_height=e.get("baseline_height"),this.baseline_group=e.get("baseline_group")||0,this.guidesData.baseline_height=this.baseline_height,this.guidesData.baseline_group=this.baseline_group,this.guidesData.grid_step=e.get("grid_step")||8,this.guidesData.grid_count=e.get("grid_count")||8,this.guidesData.margin.top=e.get("margin").top,this.guidesData.margin.left=e.get("margin").left,this.guidesData.margin.right=e.get("margin").right,this.guidesData.margin.bottom=e.get("margin").bottom},onViewportWidthChange(e){this.viewportWidth!==e&&(this.guidesData.columnWidth=0,this.viewportWidth=e)},onGutterChange(e){this.guidesData.padding!==e&&(this.guidesData.columnWidth=0,this.guidesData.padding=e)},onColumnWidthChange(e){this.guidesData.columnWidth=e,this.viewportWidth=this.getViewportWidthByColumnWidth(e)},onColumnCountChange(e){this.guidesData.columns!==e&&(this.guidesData.columnWidth=0,this.guidesData.columns=e)},onLeftMarginChange(e){this.guidesData.margin.left!==e&&(this.guidesData.columnWidth=0,this.guidesData.margin.left=e)},onRightMarginChange(e){this.guidesData.margin.right!==e&&(this.guidesData.columnWidth=0,this.guidesData.margin.right=e)},saveParams:wp.default.debounce(function(){wp.default.isEmpty(this.gg.mag.edit_params.changed)||this.gg.mag.edit_params.save(),wp.default.isEmpty(this.gg.guides.model.changed)||this.gg.guides.model.save()},200),saveViewportWidth:wp.default.debounce(function(e){let o=this.workspace.viewport,t={default:"desktopWidth",phone_portrait:"phoneWidth",tablet_portrait:"tabletWidth"}[o];this.gg.mag.save({[t]:e},{patch:!0})},200),changeTab:function(e){this.selectedTab=e},setIndex:function(e){this.index=e,this.handleSetGridsClick()},toggleEditParam:function(e,o){o==="grid"&&(this.changeTab("grid"),this.editParamsData.guides=!1),o==="guides"&&(this.changeTab("guides"),this.editParamsData.grid=!1,se(he.SettingsViewer,{settingsType:"guides set"})),o==="snap"&&!e[o]&&He("ClickOnSnapButton"),o==="sizes"&&!e[o]&&He("ClickOnSizesButton"),e[o]=!e[o],this.noHoverButtons=!0},onChangeViewport(){let e=this.workspace.viewport;this.viewport=e,this.viewportWidth=this.gg.mag.getViewportWidth(e),this.scaleRatio=this.getScaleRatio(e)},getScaleRatio(e){return Math.round(Sd.getLimitedRatio(this.workspace.mag.getViewportWidth(e),this.workspace.mag.get("opts").scalewidth,Oe.dictionary.default.min_scale_width,!1)*100)},onWindowResize(){this.scaleRatio=this.getScaleRatio(this.viewport)},toggleScaleLayout(){this.setOpts("scalableviewer",!this.opts.scalableviewer),this.noHoverButtons=!0,se(he.SettingsViewer,{settingsType:"scale layout from guides"})},handleChangeScaleWidth(e){this.setOpts("scalewidth",e)}}},_H=function(){var e,o=this,t=o.$createElement,r=o._self._c||t;return r("transition",{attrs:{name:"wb-panel"}},[r("div",{staticClass:"guides-panel equal-columns",class:(e={},e[o.viewport]=!0,e)},[o.loadedData?r("help-tour-tooltip",{attrs:{step:o.helpTourStep,position:"top",indent:8,modifiers:[{name:"arrow",options:{padding:{left:170}}}]}}):o._e(),o._v(" "),r("div",{staticClass:"guides-panel-bg"},[r("div",{staticClass:"guides-panel-header"},[r("div",{staticClass:"type-selector"},[r("button",{class:{active:o.selectedTab==="guides"},on:{click:function(i){return i.stopPropagation(),o.changeTab("guides")}}},[o._v("Guides")]),o._v(" "),r("button",{class:{active:o.selectedTab==="grid"},on:{click:function(i){return i.stopPropagation(),o.changeTab("grid")}}},[o._v("Grid")])]),o._v(" "),r("div",{staticClass:"set-selector"},o._l([{value:1,title:"Set 1"},{value:2,title:"Set 2"},{value:3,title:"Set 3"}],function(i){return r("button",{key:i.value,class:{active:i.value===o.index},attrs:{"aria-label":i.title},on:{click:function(n){return n.stopPropagation(),o.setIndex(i.value)}}},[r("span")])}),0)]),o._v(" "),r("div",{staticClass:"scale-layout",class:{disabled:!o.isScaleLayout}},[r("div",{staticClass:"item"},[r("span",[o._v("Scale layout")]),o._v(" "),r("rm-switcher",{attrs:{value:o.isDesktopLayout?o.isScaleLayout:!0,width:40,height:24,"color-on":"#0080FF","color-off":"#B8B8B8",callback:o.toggleScaleLayout,"is-disabled":!o.isDesktopLayout}})],1),o._v(" "),r("div",{staticClass:"item"},[r("span",{staticClass:"caption"},[r("label",{attrs:{for:"scale-layout-width"}},[o._v("Limit scale at")])]),o._v(" "),r("div",[r("numeric-input",{staticClass:"numeric-input big-numberic-input",attrs:{id:"scale-layout-width","label-selector":"<.item","get-label":function(i){return i.find(".caption")},value:o.opts.scalewidth,min:1024,max:9999,disabled:!o.isScaleLayout||!o.isDesktopLayout},on:{change:o.handleChangeScaleWidth}})],1)]),o._v(" "),r("div",{staticClass:"item"},[r("div",[r("span",{directives:[{name:"show",rawName:"v-show",value:o.scaleEnabled&&!o.customViewportWidthEnabled,expression:"scaleEnabled && !customViewportWidthEnabled"}],staticClass:"gray"},[o._v("Scale layout")]),o._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:o.customViewportWidthEnabled,expression:"customViewportWidthEnabled"}]},[o._v("Width")]),o._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:o.customViewportWidthEnabled,expression:"customViewportWidthEnabled"}],staticClass:"gray"},[o._v(`
              `+o._s(o.guidesData.columnWidth||!o.isScaleLayout?"Centered":"Stretched")+`
            `)]),o._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:o.isScaleLayout&&o.isDesktopLayout,expression:"isScaleLayout && isDesktopLayout"}],staticClass:"scale-ratio gray"},[o._v(o._s(o.scaleRatio)+"%")])]),o._v(" "),r("div",[r("numeric-input",{staticClass:"numeric-input big-numberic-input",attrs:{min:o.minWidth,max:o.maxWidth,value:o.viewportWidth,"label-selector":"<.item","get-label":function(i){return i.children(":first")},disabled:!o.customViewportWidthEnabled},on:{change:o.onViewportWidthChange}})],1)])]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedTab==="grid",expression:"selectedTab === 'grid'"}],staticClass:"row row-big"},[r("div",{staticClass:"block block-grid-inner"},[r("GridInner",{staticClass:"svg-icon icon"}),o._v(" "),r("numeric-input",{staticClass:"numeric-input grid-inner",attrs:{min:4,max:Math.floor(999/o.guidesData.grid_count),"label-selector":".icon",dir:"v"},model:{value:o.guidesData.grid_step,callback:function(i){o.$set(o.guidesData,"grid_step",i)},expression:"guidesData.grid_step"}})],1),o._v(" "),r("div",{staticClass:"block block-grid-outer"},[r("GridOuter",{staticClass:"svg-icon icon"}),o._v(" "),r("numeric-input",{staticClass:"numeric-input grid-outer readonly",attrs:{"mouse-only":!0,min:o.guidesData.grid_step*2,max:Math.floor(999/o.guidesData.grid_step)*o.guidesData.grid_step,"label-selector":".icon",value:o.grid_count_h,dir:"v"},on:{change:function(i){return o.updateGridCount(i)}}})],1)]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedTab==="guides",expression:"selectedTab === 'guides'"}],staticClass:"row row-big guide-row"},[r("div",{staticClass:"block block-guide-count"},[r("GuideCount",{staticClass:"guide-icon icon"}),o._v(" "),r("numeric-input",{staticClass:"numeric-input guide-count",attrs:{value:o.guidesData.columns,"label-selector":".icon",dir:"h",min:0,max:99},on:{change:o.onColumnCountChange}})],1),o._v(" "),[r("div",{staticClass:"block block-column-width"},[r("ColumnIcon",{staticClass:"column-icon icon",class:{disabled:!o.guidesData.columns},attrs:{title:"Column width"}}),o._v(" "),r("div",{staticClass:"guide-column-input-wrapper",class:{"is-auto":!o.guidesData.columns||o.guidesData.columns&&!o.guidesData.width&&o.isColumnWidthFloating,disabled:!o.guidesData.columns}},[r("numeric-input",{staticClass:"numeric-input guides-column-width",style:o.guidesData.columns?{}:{visibility:"hidden"},attrs:{value:o.guidesData.columns?o.guidesData.columnWidth||Math.round(o.preciseColumnWidth):0,"label-selector":"< .block-column-width","get-label":function(i){return i.find(".icon")},dir:"h",min:o.minColumnWidth,max:o.maxColumnWidth,disabled:!o.guidesData.columns,autosize:""},on:{change:o.onColumnWidthChange}})],1)],1),o._v(" "),r("div",{staticClass:"block block-guide-padding"},[r("GutterIcon",{staticClass:"gutter-icon icon",class:{disabled:o.guidesData.columns<2},attrs:{title:"Gutter"}}),o._v(" "),r("numeric-input",{staticClass:"numeric-input guides-padding",attrs:{value:o.guidesData.padding,"label-selector":"< .block-guide-padding","get-label":function(i){return i.find(".gutter-icon")},dir:"h",min:0,max:999,disabled:o.guidesData.columns<2,autosize:""},on:{change:o.onGutterChange}})],1)]],2),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedTab==="guides",expression:"selectedTab === 'guides'"}],staticClass:"guides-big-row-wrapper"},[r("div",{staticClass:"row guides-big-row"},[r("div",{staticClass:"block-small baseline"},[r("div",{staticClass:"block-small baseline-count"},[r("BaselineCount",{staticClass:"svg-icon icon"}),o._v(" "),r("numeric-input",{staticClass:"numeric-input",attrs:{"label-selector":".icon",min:0,max:Math.floor(999/o.baseline_group),"debounce-keyboard":500},model:{value:o.baseline_height,callback:function(i){o.baseline_height=i},expression:"baseline_height"}})],1),o._v(" "),r("div",{staticClass:"block-small",class:{disabled:o.baseline_height==0}},[r("BaselineSize",{staticClass:"svg-icon icon"}),o._v(" "),r("numeric-input",{staticClass:"numeric-input readonly",attrs:{"mouse-only":!0,"label-selector":".icon",value:o.baseline_group_h,min:0,max:Math.floor(999/o.baseline_height)*o.baseline_height},on:{change:o.updateBaselineGroup}})],1)]),o._v(" "),r("div",{staticClass:"block-small"},[r("MarginLeft",{staticClass:"svg-icon icon",class:{disabled:!o.guidesData.columns}}),o._v(" "),r("numeric-input",{staticClass:"numeric-input",attrs:{value:o.guidesData.margin.left,"label-selector":".icon",dir:"h",min:0,max:999,disabled:!o.guidesData.columns},on:{change:o.onLeftMarginChange}})],1),o._v(" "),r("div",{staticClass:"block-small"},[r("MarginTop",{staticClass:"svg-icon icon",class:{disabled:!o.guidesData.columns}}),o._v(" "),r("numeric-input",{staticClass:"numeric-input",attrs:{"label-selector":".icon",min:0,max:999,disabled:!o.guidesData.columns},model:{value:o.guidesData.margin.top,callback:function(i){o.$set(o.guidesData.margin,"top",i)},expression:"guidesData.margin.top"}})],1),o._v(" "),r("div",{staticClass:"block-small"},[r("MarginBottom",{staticClass:"svg-icon icon",class:{disabled:!o.guidesData.columns}}),o._v(" "),r("numeric-input",{staticClass:"numeric-input",attrs:{"label-selector":".icon",min:0,max:999,disabled:!o.guidesData.columns},model:{value:o.guidesData.margin.bottom,callback:function(i){o.$set(o.guidesData.margin,"bottom",i)},expression:"guidesData.margin.bottom"}})],1),o._v(" "),r("div",{staticClass:"block-small"},[r("MarginRight",{staticClass:"svg-icon icon",class:{disabled:!o.guidesData.columns}}),o._v(" "),r("numeric-input",{staticClass:"numeric-input",attrs:{value:o.guidesData.margin.right,"label-selector":".icon",dir:"h",min:0,max:999,disabled:!o.guidesData.columns},on:{change:o.onRightMarginChange}})],1)])])]),o._v(" "),r("div",{staticClass:"buttons-wrapper"},[r("div",{staticClass:"button",class:{active:o.editParamsData.guides,"no-hover":o.noHoverButtons},on:{click:function(i){return i.stopPropagation(),o.toggleEditParam(o.editParamsData,"guides")},mouseleave:function(i){o.noHoverButtons=!1}}},[r("div",{staticClass:"caption"},[o._v("Guides")]),o._v(" "),r("div",{staticClass:"letter"},[o._v("H")])]),o._v(" "),r("div",{staticClass:"button",class:{active:o.editParamsData.grid,"no-hover":o.noHoverButtons},on:{click:function(i){return i.stopPropagation(),o.toggleEditParam(o.editParamsData,"grid")},mouseleave:function(i){o.noHoverButtons=!1}}},[r("div",{staticClass:"caption"},[o._v("Grid")]),o._v(" "),r("div",{staticClass:"letter"},[o._v("G")])]),o._v(" "),r("div",{staticClass:"button",class:{active:o.editParamsData.snap,"no-hover":o.noHoverButtons},on:{click:function(i){return i.stopPropagation(),o.toggleEditParam(o.editParamsData,"snap")},mouseleave:function(i){o.noHoverButtons=!1}}},[r("div",{staticStyle:{position:"relative",top:"24px"}},[o.loadedData?r("help-tour-tooltip",{attrs:{step:o.helpTourStepSnap,position:"left",indent:26}}):o._e()],1),o._v(" "),r("div",{staticClass:"caption"},[o._v("Snap")]),o._v(" "),r("div",{staticClass:"letter"},[o._v("S")])]),o._v(" "),r("div",{staticClass:"button",class:{active:o.editParamsData.sizes,"no-hover":o.noHoverButtons},on:{click:function(i){return i.stopPropagation(),o.toggleEditParam(o.editParamsData,"sizes")},mouseleave:function(i){o.noHoverButtons=!1}}},[r("div",{staticStyle:{position:"relative",top:"24px"}},[o.loadedData?r("help-tour-tooltip",{attrs:{step:o.helpTourStepSizes,position:"left",indent:142}}):o._e()],1),o._v(" "),r("div",{staticClass:"caption"},[o._v("Sizes")]),o._v(" "),r("div",{staticClass:"letter"},[o._v("X")])])])],1)])},SH=[],CH=void 0,PH="data-v-349392fc",TH=void 0,IH=!1;function MH(e,o,t,r,i,n,s,l,c,d){let p=(typeof t=="function"?t.options:t)||{};return p.__file="guides-panel.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var BH=MH({render:_H,staticRenderFns:SH},CH,kH,PH,IH,TH,!1,void 0,void 0,void 0),G5=BH;Jt();jt();k();function j5({children:e,button:o,...t}){let[r,i]=(0,Mn.useState)(!1),n=(0,Mn.useRef)(),s=(0,Mn.useRef)(null),{page:l}=(0,Mn.useContext)(qe);(0,Mn.useEffect)(()=>{if(r&&s.current){n.current&&Jr(n.current);let p={workspace:window.RM.constructorRouter.workspace};n.current=va(G5,s.current,p)}else r||n.current&&Jr(n.current)},[s.current,r]);let c=d=>{i(d)};return a(Xt,{name:"guides",skidding:28,button:o,onToggle:c,panelPosition:{height:"auto"},withArrow:!1,...t,children:a(f,{height:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-end",ref:s},String(l?.id))})}$e();Uo();vt();jn();k();var q5=({id:e="helpIcon",width:o,height:t,hoverBox:r,margin:i})=>{let n=Vo(o,t,r);return w("svg",{xmlns:"http://www.w3.org/2000/svg",id:e,viewBox:"0 0 18 24",fill:"none",width:o,height:t,style:{padding:n,margin:i},children:[w("path",{d:"M0.000110626 5.92295L0.000648499 5.90145C0.17284 2.58286 2.52025 0 6.5589 0C10.3314 0 12.9769 2.41067 12.9769 5.60403C12.9769 7.92078 11.8186 9.56441 9.67399 10.9419C7.62336 12.2569 7.04417 13.1491 7.04417 14.8867V16.0607H7.04125C7.04 16.6329 6.57577 17.0963 6.00329 17.0963C5.43082 17.0963 4.96659 16.6329 4.96533 16.0607H4.96222V14.5893C4.94657 12.5073 5.85449 11.1924 8.06166 9.78357C10.034 8.49996 10.7697 7.41986 10.7697 5.69795C10.7697 3.47512 9.00088 1.86279 6.48063 1.86279C3.97604 1.86279 2.23848 3.42816 2.03498 5.90145H2.0299C2.03033 5.9136 2.03055 5.92581 2.03055 5.93806C2.03055 6.49879 1.576 6.95334 1.01527 6.95334C0.454554 6.95334 0 6.49879 0 5.93806L0.000110626 5.92295Z",fill:"currentColor",transform:"rotate(0, 5, 10)",children:[a("animateTransform",{attributeName:"transform",type:"rotate",from:"0, 5, 10",to:"45, 5, 10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animateTransform",{attributeName:"transform",type:"rotate",to:"0, 5, 10",from:"45, 5, 10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("path",{d:"M6 24C4.89543 24 4 23.1046 4 22C4 20.8954 4.89543 20 6 20C7.10457 20 8 20.8954 8 22C8 23.1046 7.10457 24 6 24Z",fill:"currentColor",children:[a("animateTransform",{attributeName:"transform",type:"translate",to:"0 -3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),a("animateTransform",{attributeName:"transform",type:"translate",from:"0 -3",to:"0 0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};k();function Y5({disabledTooltip:e,width:o="100%",...t}){return a(gt,{instance:!0,closeOnTargetClick:!0,targetSteps:"HelpButton",indent:8,defaultText:"Help",disabled:e,leaveDelay:100,children:a(Ue,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",height:"100%",width:o,"aria-label":"Help","data-testid":"help-button",onClick:()=>He("HelpButton"),...t,children:a(q5,{width:"20px",height:"24px",hoverBox:{width:56,height:56}})})})}fe();var $w=B(H());N();fi();fe();oe();je();var Ko=B(H());je();N();GI();var X5=B(H());II();var RH={analytics:!1,webWidget:{color:{theme:"#F8A42B"}}},zH="https://static.zdassets.com/ekr/snippet.js?key=",K5=(e,o,t)=>{let{isReady:r}=cy({src:`${zH}${e}`,attrs:o,checkExisting:()=>typeof window<"u"&&typeof window.zE<"u",onLoad:()=>{window.zESettings=RH}});(0,X5.useEffect)(()=>{r&&!window.zECBIsSet&&(window.zE("webWidget:on","userEvent",i),window.zECBIsSet=!0)},[r]);function i({action:s,properties:l}){s&&t?.(s.toLowerCase(),l)}function n(){r&&window.zE("webWidget","toggle")}return{toggleWidget:n,isReady:r}};st();Gn();py();vu();fe();Ve();oe();$e();je();N();oe();N();k();var EH=e=>w("svg",{width:236,height:118,viewBox:"0 0 236 118",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[a("circle",{cx:59.1855,cy:59,r:58.8145,fill:"#884FFF"}),a("circle",{cx:176.814,cy:59,r:58.8145,fill:"#EC520B"}),a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M43.8551 50.7046C40.8611 48.7517 38.8818 45.3705 38.8818 41.5265C38.8818 35.4809 43.7778 30.58 49.8172 30.58H68.5529C74.5924 30.58 79.4883 35.4809 79.4883 41.5265C79.4883 45.3705 77.5091 48.7517 74.515 50.7046C77.5091 52.6575 79.4883 56.0387 79.4883 59.8826C79.4883 65.9282 74.5924 70.8292 68.5529 70.8292H68.3536C65.4987 70.8292 62.8993 69.734 60.9518 67.9405V78.1387C60.9518 84.2519 55.9488 89.1851 49.8667 89.1851C43.8397 89.1851 38.8818 84.2965 38.8818 78.2385C38.8818 74.3946 40.861 71.0135 43.8549 69.0606C40.861 67.1077 38.8818 63.7265 38.8818 59.8826C38.8818 56.0387 40.8611 52.6575 43.8551 50.7046ZM60.9518 59.8826C60.9518 63.9747 64.2658 67.292 68.3536 67.292H68.5529C72.6409 67.292 75.9547 63.9747 75.9547 59.8826C75.9547 55.7905 72.6409 52.4733 68.5529 52.4733H68.3536C64.2658 52.4733 60.9518 55.7905 60.9518 59.8826ZM57.4183 52.4733H49.8172C45.7293 52.4733 42.4154 55.7905 42.4154 59.8826C42.4154 63.9664 45.7159 67.2785 49.7923 67.292H49.8039H57.4183V52.4733ZM49.8172 70.8292C49.8089 70.8292 49.8006 70.8292 49.7923 70.8292C45.7159 70.8425 42.4154 74.1547 42.4154 78.2385C42.4154 82.3182 45.7664 85.6479 49.8667 85.6479C54.0221 85.6479 57.4183 82.2736 57.4183 78.1387V70.8292H49.8172ZM57.4183 48.9359H49.8172C45.7293 48.9359 42.4154 45.6186 42.4154 41.5265C42.4154 37.4344 45.7293 34.1172 49.8172 34.1172H57.4183V48.9359ZM68.5529 48.9359H60.9518V34.1172H68.5529C72.6409 34.1172 75.9547 37.4344 75.9547 41.5265C75.9547 45.6186 72.6409 48.9359 68.5529 48.9359Z",fill:"white"}),a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M204.153 88.9623V79.3865C204.153 77.4762 203.092 76.515 201.335 76.515C199.249 76.515 197.529 78.0409 197.456 79.8912V88.9502H193.93V79.3745C193.93 77.4642 192.869 76.503 191.112 76.503C189.026 76.503 187.306 78.0289 187.232 79.8792V88.9382H183.707V73.9679H186.879L187.232 75.2415L187.403 75.3977L187.574 75.2415C188.282 74.2803 190.038 73.6435 191.454 73.6435C193.991 73.6435 195.821 74.6287 196.748 76.1906L197.626 75.2295C198.505 74.2683 200.274 73.6315 201.677 73.6315C205.556 73.6315 207.679 75.8662 207.679 79.0501V88.9382H204.153V88.9623ZM145.949 88.1813L205.093 29.934L206.325 31.1475L147.181 89.3948L145.949 88.1813ZM150.487 42.3332H149.841V52.6658H146.376V28.6004H154.794C158.576 28.6004 161.894 31.0754 161.894 35.3527C161.894 39.4737 158.356 42.1049 154.574 42.1049L162.358 51.993V52.6538H158.405L150.487 42.3332ZM154.989 38.921C156.892 38.921 158.637 37.6114 158.637 35.4848C158.637 33.3582 156.892 32.0486 154.989 32.0486H149.914V38.921H154.989Z",fill:"#EBEBEB"})]}),AH=f.withComponent(F(EH)`
      display: block;
    `),Z5=AH;oe();N();k();var LH=e=>a("svg",{width:17,height:17,viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{d:"M3.18575 12.6523C2.93808 12.9 2.93808 13.3015 3.18575 13.5492C3.43342 13.7968 3.83497 13.7968 4.08264 13.5492L12.2316 5.40021V10.5826C12.2316 10.9329 12.5155 11.2168 12.8658 11.2168C13.2161 11.2168 13.5 10.9329 13.5 10.5826V3.86912C13.5 3.51886 13.2161 3.23492 12.8658 3.23492H6.15232C5.80206 3.23492 5.51812 3.51886 5.51812 3.86912C5.51812 4.21938 5.80206 4.50332 6.15232 4.50332H11.3347L3.18575 12.6523Z",fill:"white"})}),DH=f.withComponent(F(LH)`
      display: block;
    `),J5=DH;k();var Q5=F(ge)`
  display: flex;
  justify-content: center;
  align-items: center;

  width: 100%;
  height: 56px;

  border-radius: 30px;

  color: ${({theme:e})=>e.colors.white};
`,eT=({show:e=!1,figmaPluginUrl:o,learnMoreUrl:t,onModalClose:r})=>{let i=()=>{se(he.Popup,{content:"import from figma"}),window.open(o,"_blank")},n=()=>{window.open(t,"_blank")};return w(qn,{underlayStyles:{backdropFilter:"blur(5px)"},showCloseButton:!0,show:e,onExit:r,children:[w(f,{display:"flex",flexDirection:"column",alignItems:"center",children:[a(f,{display:"flex",children:a(Z5,{})}),w(f,{padding:"24px 0 40px 0",display:"flex",flexDirection:"column",alignItems:"center",position:"relative",children:[a(f,{padding:"0 0 16px 0",children:a(ve,{id:"import-from-figma",display:"flex",alignItems:"center",textAlign:"center",whiteSpace:"pre-wrap",fontSize:24,height:"auto",margin:"auto",color:V.white,lineHeight:"6rm",children:"Import from Figma"})}),a(f,{width:"75%",children:a(ve,{id:"import-from-figma-text",display:"flex",alignItems:"center",textAlign:"center",whiteSpace:"pre-wrap",fontSize:16,height:"auto",color:V.gray,children:"Open the plugin and transfer your designs"})})]})]}),a(f,{width:"100%",children:w(Q5,{variant:"clean",backgroundColor:"#0A85FF",onClick:i,children:["Get plugin",a(J5,{})]})}),a(f,{width:"100%",children:a(Q5,{variant:"clean",marginTop:"4rm",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.1)",onClick:n,children:"Learn more"})})]})};yr();oe();N();k();var OH=e=>a("svg",{width:88,height:88,xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{d:"M84 80a4 4 0 110 8H4a4 4 0 110-8h80zm0-16a4 4 0 110 8H4a4 4 0 110-8h80zm0-16a4 4 0 110 8H4a4 4 0 110-8h80zm0-16a4 4 0 110 8H4a4 4 0 110-8h80zm0-16a4 4 0 110 8H4a4 4 0 110-8h80zm0-16a4 4 0 110 8H4a4 4 0 110-8h80z",fill:"#F8A42B",fillRule:"evenodd"})}),$H=f.withComponent(F(OH)`
      display: block;
    `),tT=$H;N();fe();oe();Ve();k();function HH({text:e,children:o,href:t,onClick:r,"data-testid":i,absoluteIcon:n,marginBottom:s}){return w(f,{as:"a",width:88,href:t,cursor:"pointer",marginBottom:s??"4rm",onClick:l=>{r&&l.preventDefault(),r&&r()},"data-testid":i,display:"block",textDecoration:"none",textAlign:"left",target:"_blank",position:"relative",children:[a(f,{as:"span",css:ae`
          &:hover {
            display: block;
            opacity: 0.8;
          }
        `,children:o}),a(L,{textStyle:"small",marginTop:"8px",color:"black",paddingTop:n?"100%":void 0,display:"block",css:ae`
          &:hover {
            color: ${V.red};
          }
        `,children:e})]})}var ri=HH;oe();N();k();var FH=e=>a("svg",{width:88,height:88,fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0a6 6 0 00-6 6v76a6 6 0 006 6h76a6 6 0 006-6V6a6 6 0 00-6-6H6zm22 48a4 4 0 100-8 4 4 0 000 8zm36-4a4 4 0 11-8 0 4 4 0 018 0zm-20 4a4 4 0 100-8 4 4 0 000 8z",fill:"#B9B9B9"})}),NH=f.withComponent(F(FH)`
      display: block;
    `),oT=NH;oe();N();k();var WH=e=>a("svg",{width:88,height:88,xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{d:"M80 4a4 4 0 118 0v80a4 4 0 11-8 0V4zM64 4a4 4 0 118 0v80a4 4 0 11-8 0V4zM48 4a4 4 0 118 0v80a4 4 0 11-8 0V4zM32 4a4 4 0 118 0v80a4 4 0 11-8 0V4zM16 4a4 4 0 118 0v80a4 4 0 11-8 0V4zM0 4a4 4 0 118 0v80a4 4 0 11-8 0V4z",fill:"#282828",fillRule:"evenodd"})}),VH=f.withComponent(F(WH)`
      display: block;
    `),rT=VH;oe();N();k();var UH=e=>a("svg",{width:88,height:88,xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{d:"M82 0a6 6 0 016 6v76a6 6 0 01-6 6H6a6 6 0 01-6-6V6a6 6 0 016-6h76zM52 28a8 8 0 00-8 8l-.004-.25A8 8 0 1036 44a8 8 0 107.996 8.25L44 52a8 8 0 108-8l.25-.004A8 8 0 0052 28z",fill:"#8E0D99",fillRule:"evenodd"})}),GH=f.withComponent(F(UH)`
      display: block;
    `),iT=GH;oe();N();k();var jH=e=>a("svg",{width:88,height:88,fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0a6 6 0 00-6 6v76a6 6 0 006 6h76a6 6 0 006-6V6a6 6 0 00-6-6H6zm6 16a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm16 0a4 4 0 11-8 0 4 4 0 018 0zM16 28a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm16 0a4 4 0 100-8 4 4 0 000 8zM16 44a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm16 0a4 4 0 100-8 4 4 0 000 8zM16 60a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm16 0a4 4 0 100-8 4 4 0 000 8zM12 80a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm16 0a4 4 0 11-8 0 4 4 0 018 0z",fill:"#089400"})}),qH=f.withComponent(F(jH)`
      display: block;
    `),Ow=qH;oe();N();k();var YH=e=>a("svg",{width:88,height:88,xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{d:"M82 0a6 6 0 016 6v76a6 6 0 01-6 6H6a6 6 0 01-6-6V6a6 6 0 016-6h76zM70.828 17.172a4 4 0 00-5.656 0l-48 48-.151.159a4 4 0 005.807 5.497l48-48 .151-.159a4 4 0 00-.15-5.497z",fill:"#EC520B",fillRule:"evenodd"})}),XH=f.withComponent(F(YH)`
      display: block;
    `),nT=XH;oe();N();k();var KH=e=>w("svg",{width:88,height:99,viewBox:"0 0 88 99",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[a("path",{d:"M24.9965 97.0113V88H36.4219L26.7036 97.7184C26.0736 98.3483 24.9965 97.9022 24.9965 97.0113Z",fill:"#F8A42B"}),a("path",{d:"M0 6C0 2.68629 2.68629 0 6 0H82C85.3137 0 88 2.68629 88 6V82C88 85.3137 85.3137 88 82 88H6C2.68629 88 0 85.3137 0 82V6Z",fill:"#F8A42B"})]}),ZH=f.withComponent(F(KH)`
      display: block;
    `),sT=ZH;oe();N();k();var JH=e=>a("svg",{width:88,height:88,viewBox:"0 0 88 88",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0C2.68629 0 0 2.68629 0 6V82C0 85.3137 2.68629 88 6 88H82C85.3137 88 88 85.3137 88 82V6C88 2.68629 85.3137 0 82 0H6ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM24 16C26.2091 16 28 14.2091 28 12C28 9.79086 26.2091 8 24 8C21.7909 8 20 9.79086 20 12C20 14.2091 21.7909 16 24 16ZM40 12C40 14.2091 38.2091 16 36 16C33.7909 16 32 14.2091 32 12C32 9.79086 33.7909 8 36 8C38.2091 8 40 9.79086 40 12Z",fill:"#00793F"})}),QH=f.withComponent(F(JH)`
      display: block;
    `),aT=QH;oe();N();k();var eF=e=>a("svg",{width:88,height:88,viewBox:"0 0 88 88",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.00391 0C2.6902 0 0.00390625 2.68629 0.00390625 6V82C0.00390625 85.3137 2.6902 88 6.00391 88H82.0039C85.3176 88 88.0039 85.3137 88.0039 82V6C88.0039 2.68629 85.3176 0 82.0039 0H6.00391ZM30.005 31.7156C30.005 29.4896 32.344 28.0389 34.3382 29.028L58.8568 41.1902C61.0793 42.2927 61.0793 45.4628 58.8568 46.5653L34.3382 58.7275C32.344 59.7167 30.005 58.266 30.005 56.04V31.7156ZM36.1157 25.4447C31.4627 23.1366 26.005 26.5216 26.005 31.7156V56.04C26.005 61.2339 31.4627 64.6189 36.1157 62.3109L60.6343 50.1487C65.8201 47.5763 65.8201 40.1793 60.6343 37.6069L36.1157 25.4447Z",fill:"#0080FF"})}),tF=f.withComponent(F(eF)`
      display: block;
    `),lT=tF;oe();N();k();var oF=e=>a("svg",{width:88,height:88,viewBox:"0 0 88 88",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0C2.68629 0 0 2.68629 0 6V82C0 85.3137 2.68629 88 6 88H82C85.3137 88 88 85.3137 88 82V6C88 2.68629 85.3137 0 82 0H6ZM29.1494 42.5687C29.1494 39.3341 31.7725 36.712 35.0082 36.712H41.0254V42.5687V48.4255H35.0082C31.7725 48.4255 29.1494 45.8033 29.1494 42.5687ZM49.8927 33.8627L49.7344 33.8627L43.8756 33.8627V22.1492H49.8927C53.1284 22.1492 55.7515 24.7714 55.7515 28.006C55.7515 31.2406 53.1284 33.8627 49.8927 33.8627ZM58.6017 28.006C58.6017 31.0513 57.0376 33.7315 54.6686 35.2874C57.0376 36.8433 58.6017 39.5234 58.6017 42.5687C58.6017 47.3769 54.7026 51.2747 49.8927 51.2747H49.7344C47.4783 51.2747 45.4225 50.4172 43.8756 49.0103V49.8501V51.2747V57.0524C43.8756 61.9142 39.8912 65.8375 35.0476 65.8375C30.2478 65.8375 26.2992 61.9497 26.2992 57.1315C26.2992 54.0862 27.8634 51.406 30.2324 49.8501C27.8634 48.2942 26.2992 45.6141 26.2992 42.5687C26.2992 39.5234 27.8634 36.8433 30.2324 35.2874C27.8634 33.7315 26.2992 31.0513 26.2992 28.006C26.2992 23.1978 30.1984 19.3 35.0082 19.3H41.0254H42.4505H43.8756H49.8927C54.7026 19.3 58.6017 23.1978 58.6017 28.006ZM49.7344 36.712H49.8927C53.1284 36.712 55.7515 39.3341 55.7515 42.5687C55.7515 45.8033 53.1284 48.4255 49.8927 48.4255H49.7344C46.4986 48.4255 43.8756 45.8033 43.8756 42.5687C43.8756 39.3341 46.4986 36.712 49.7344 36.712ZM35.0082 51.2747C31.7725 51.2747 29.1494 53.8969 29.1494 57.1315C29.1494 60.3561 31.8019 62.9883 35.0476 62.9883C38.3371 62.9883 41.0254 60.3207 41.0254 57.0524V51.2747H35.0082ZM35.0082 33.8627H41.0254V22.1492H35.0082C31.7725 22.1492 29.1494 24.7714 29.1494 28.006C29.1494 31.2406 31.7725 33.8627 35.0082 33.8627Z",fill:"#884FFF"})}),rF=f.withComponent(F(oF)`
      display: block;
    `),pT=rF;dy();Jt();k();var cT=`${le.readymag_host}/learn`,dT=`${le.readymag_host}/templates`,iF="https://forum.readymag.com",uT="https://help.readymag.com",nF="https://www.youtube.com/@Readymag",sF="https://help.readymag.com/hc/en-us/articles/360020647532-Shortcuts",aF="https://www.figma.com/community/plugin/1482359008944255522/figma-to-readymag",lF="https://help.readymag.com/hc/en-us/articles/35761265655067-Figma-Integration-with-Readymag",pF={id:"ze-snippet"},cF=(e,o)=>{let t={"web widget opened":"zendesk_widget_opened","help center search":"zendesk_search","contact form submitted":"zendesk_widget_contact_submitted","help center article viewed":"zendesk_widget_article_viewed","help center view original article clicked":"zendesk_widget_original_article_clicked"},r={"web widget opened":void 0,"help center search":{search_term:o?.term,search_source:"zendesk_widget"},"contact form submitted":void 0,"help center article viewed":{page_title:o?.name},"help center view original article clicked":{page_title:o?.name}},i=t[e],n=r[e];i&&(window.gtag("event",i,n),e==="contact form submitted"&&se(he.Zendesk,{action:"ticket created",zone:"editor"}))},dF=({onHelpTourClick:e,onHelpPageClick:o,onVideosPageClick:t})=>{let[r,i]=(0,Ko.useState)(!1),[n,s]=(0,Ko.useState)(!1),{closePanels:l}=(0,Ko.useContext)(Ct),c=Ge("viewer.intercomChat"),{showMessenger:d,intercomAuth:p,messageCount:m}=mu({}),{toggleWidget:u}=K5(le.zendeskApiKey,pF,cF),g=Fi("PageCanAddFromTemplate"),h=(0,Ko.useCallback)(()=>{se(he.EditorHelp,{action:"quick tour"}),e?.()},[]),b=(0,Ko.useCallback)(()=>{se(he.EditorHelp,{action:"how to videos"}),t?.(),window.open(nF,"_blank")},[t]),x=(0,Ko.useCallback)(()=>{se(he.EditorHelp,{action:"import from figma"}),s(!0)},[]),S=(0,Ko.useCallback)(()=>{se(he.EditorHelp,{action:"shortcut"}),window.open(sF,"_blank")},[]),y=(0,Ko.useCallback)(()=>{se(he.EditorHelp,{action:"help page"}),o?.(),window.open(uT,"_blank")},[o]),C=(0,Ko.useCallback)(()=>{se(he.EditorHelp,{action:"rm updates"}),ly(!0)},[]),P=(0,Ko.useCallback)(()=>{se(he.EditorHelp,{action:"templates"}),g||window.open(dT,"_blank")},[]),v=(0,Ko.useCallback)(()=>{se(he.EditorHelp,{action:"learn more"}),window.open(cT,"_blank")},[]),T=(0,Ko.useCallback)(()=>{se(he.EditorHelp,{action:"forum"}),window.open(iF,"_blank")},[]),R=(0,Ko.useCallback)(()=>{se(he.EditorHelp,{action:"ask support"}),typeof window.Intercom<"u"&&window.Intercom&&c&&p?.intercomAppId?window.Intercom("show"):u(),l()},[u,c,p?.intercomAppId,d]);return w(Dy,{gridTemplateColumns:"repeat(2, 1fr)",columnGap:"3rm",children:[a(ri,{text:"Product tour","data-testid":"start-quick-tour",onClick:h,children:a(rT,{})}),a(ri,{text:"How-to videos","data-testid":"how-to-videos",onClick:b,children:a(lT,{})}),Ge("viewer.figmaPluginMentions")&&a(ri,{text:"Figma import","data-testid":"figma-import",onClick:x,children:a(pT,{})}),n&&a(eT,{show:n,figmaPluginUrl:aF,learnMoreUrl:lF,onModalClose:()=>s(!1)}),a(ri,{text:"Ask support","data-testid":"open-support",onClick:R,absoluteIcon:!0,children:w(f,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[a(sT,{}),m>0&&a("div",{className:"intercom-custom-counter",children:m})]})}),a(ri,{href:uT,text:"Help page","data-testid":"open-help",onClick:y,children:a(tT,{})}),a(ri,{text:"Shortcuts","data-testid":"show-shortcuts",onClick:S,children:a(iT,{})}),a(ri,{onClick:T,text:"Forum","data-testid":"open-forum",children:a(aT,{})}),g?a(Jm,{isPopupShown:r,onChangePopupVisibility:i,margin:"0 0 16px",hoverColor:"rgb(8, 148, 0)",bottom:"142px",width:"220px",left:"-16px",placementStyles:"bottom: -8px; left: 52px;",analyticsZone:kd.EditorHelp,children:a(ri,{marginBottom:0,text:"Templates","data-testid":"open-templates",onClick:P,children:a(Ow,{})})}):a(ri,{href:dT,text:"Templates","data-testid":"open-templates",onClick:P,children:a(Ow,{})}),a(ri,{text:"R/m updates","data-testid":"open-updates",onClick:C,children:a(nT,{})}),a(ri,{href:cT,text:"Learn more","data-testid":"open-learn",onClick:v,children:a(oT,{})})]})},mT=dF;Be();Co();vt();k();function uF({HelpPanelHeader:e=null,onHelpPageClick:o,onVideosPageClick:t,...r}){let i=(0,$w.useContext)(Ee),n=Ht();return w(f,{height:"100%",display:"flex",position:"relative",flexDirection:"column",padding:"28px 24px 32px",id:"help-panel",overflowY:"auto",backdropFilter:"blur(4px)",backgroundColor:Me("lightGray",.96),...r,children:[a(St,{text:"Here's a vast knowledge base for your future creativity",indent:24,placement:"left",open:n.modalStatus==="unshowWithTooltip",componentsProps:{tooltip:{backgroundColor:"blue"},arrow:{color:"blue"}},children:a("div",{children:e})}),a(mT,{onHelpTourClick:()=>{i.dispatch({type:"setOnboardingType",onboardingType:"tour"})},onHelpPageClick:o,onVideosPageClick:t}),a(f,{display:"flex",flexDirection:"column",marginTop:"auto",gap:"2rm",children:a(f,{children:a(mF,{})})})]})}var mF=()=>{let e=(0,$w.useContext)(Ee),o=t=>{t||(window.RM.constructorRouter.trigger("notice:hide"),window.RM.constructorRouter.trigger("notice:triggerEduTipClose")),e.dispatch({type:"toggleShowTips"}),se(he.SettingsGeneral,{settingsType:"contextual tips",toggle:`${t?"on":"off"}`,zone:"editor"})};return w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[a(f,{children:a(L,{textStyle:"small",children:"Contextual tips"})}),a(f,{children:a(Wt,{backgroundChecked:"tomato",checked:e.showTips,onChange:o})})]})},gT=f.withComponent(uF);zt();Ve();k();var gF=()=>a(ve,{lineHeight:"48px",color:"black",textStyle:"subheading",children:"Help"});function hT({children:e,button:o,name:t,onHelpPageClick:r,onVideosPageClick:i,...n}){return a(Xt,{name:t,skidding:-84,button:o,ArrowProps:{stroke:Le(.84,V.gray)},...n,children:a(gT,{width:"100%",borderRadius:"2rm",padding:"0 16px 16px 16px",overflowX:"hidden",border:"2px solid rgba(184, 184, 184, 0.16)",HelpPanelHeader:a(gF,{}),onHelpPageClick:r,onVideosPageClick:i})})}$e();Co();RI();k();function fT({width:e="100%",disableTooltip:o,tooltipText:t,...r}){return a(St,{instance:!0,text:t,indent:8,open:o?!1:void 0,leaveDelay:100,closeOnTargetClick:!0,children:a(Ue,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",height:"100%",width:e,"aria-label":t,"data-testid":"projectSettings-button",...r,children:a(hy,{width:"24px",height:"24px",hoverBox:{width:56,height:56}})})})}var cd=B(H());N();oe();Jt();var Or=B(H());N();$e();Fo();Be();on();Od();st();pr();Wo();zp();var bT=e=>e?kr(new Date(e),"d MMMM, yyyy"):"";Ir();Od();je();fe();oe();Co();Ve();k();function La({children:e,...o}){return a(ge,{variant:"unstyled",display:"block",width:"100%",height:40,lineHeight:"40px",marginBottom:8,borderRadius:8,textStyle:"small",cursor:"pointer",color:"white",transition:".1s ease-in",userSelect:"none",...o,children:e})}var hF=()=>{let{isHovered:e,...o}=Ke(!1),{project:t}=(0,Or.useContext)(ce),r=Cr(t),[i,n]=(0,Or.useState)(!!t?.submitted_for_featured),s=(0,Or.useMemo)(()=>{let m=window.RM.constructorRouter.me.get("stripe")||{};return m.subscription_status==="active"||m.subscription_status==="trialing"},[]),l=async(m,u)=>{try{await m(`${le.readymag_host}/${t.num_id}/`),n(u),se(he.SettingsProject,{settingsType:`submit to examples ${u?"on":"off"}`})}catch{console.warn("sendToExamples error")}},c=()=>{if(!s){rt("submit-to-examples");return}i?l(_m,!1):l(km,!0)},d=w(L,{textStyle:"small",marginTop:8,marginBottom:8,children:["The R/m design team will review ",a("br",{}),"your website and email you ",a("br",{}),"if it is selected into"," ",a(Ce,{isUnderlined:!0,color:"white",target:"_blank",rel:"noopener noreferrer",href:"https://readymag.com/examples",css:ae`
          &:hover {
            color: white;
            text-decoration: none;
          }
        `,children:"Examples"})]}),p=w(L,{textStyle:"small",marginTop:8,marginBottom:8,children:["Revoke your submission",a("br",{}),"to Examples if you changed your mind"]});return r!=="unpublished"?a(q,{children:a(St,{interactive:!0,text:i?p:d,indent:4,componentsProps:{tooltip:{width:186},arrow:{marginLeft:68}},children:a(f,{children:a(La,{onClick:c,backgroundColor:e?"tomato":"gray",...o,children:i?"Revoke submission":"Submit to Examples"})})})}):null};function fF(){let{isHovered:e,...o}=Ke(!1),{isHovered:t,...r}=Ke(!1),{isHovered:i,...n}=Ke(!1),s=(0,Or.useContext)(ce),l=Cr(s.project),[c,d]=(0,Or.useState)(!1);return l==="unpublishedChanges"?c?w(f,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,children:[a(La,{onClick:s.restoreToPublished,backgroundColor:t?"tomato":"gray",...r,children:"Restore"}),a(La,{onClick:()=>d(!1),backgroundColor:i?"tomato":"gray",...n,children:"Cancel"})]}):a(La,{onClick:()=>d(!0),backgroundColor:e?"tomato":"gray",...o,children:e?bT(s.project.updated):"Restore to last published"}):null}function Hw(e){let{templateSettings:o,...t}=e,{isHovered:r,...i}=Ke(!1),n=(0,Or.useContext)(ce),s=Cr(n.project),l=(0,Or.useContext)(Ee),{showNotice:c}=Fd(),p=`${le.readymag_viewer_host}/${n.project.user.uri}/${n.project.uri}/`,m=!n.isPublishError&&!n.publishInProgress&&s==="sameAsPublished",u=(0,Or.useCallback)(async()=>{if(s!=="sameAsPublished"&&!n.publishInProgress)try{await n.publishWithNotice({alsoExport:l.exportAsTemlate,dontRenewScreenshots:l.dontRenewScreenshots,isSharedAsTemplate:l.isCopyableSwitcherEnabled,templateSettings:{price:o?.price,currency:o?.currency,purchaseLink:o?.purchaseLink,isPaid:o?.isPaid}})}catch(b){if(b instanceof Ja&&b.type==="warning"){await n.publishWithNotice({skipWarnings:!0,alsoExport:l.exportAsTemlate,dontRenewScreenshots:l.dontRenewScreenshots,isSharedAsTemplate:l.isCopyableSwitcherEnabled});let x=["type-widget-shots","type-code-injection","type-widget-shots","type-widget-lottie"];b.tag&&x.includes(b.tag)?rt("widgets"):rt("default")}else if(b instanceof Ja){let x={canBeClosed:!0,closeByTimer:!0};b.tag==="type-publish-noemail"?c(b.message,x):b.tag==="type-publish-limit"?rt("publish-limit"):b.tag==="type-free-publish-template-limit"?rt("free-publish-template-limit"):b.tag==="type-publish-paused-subcription"?c(b.message,x):rt("default")}else throw b}},[s,n.publishInProgress,l.exportAsTemlate,l.isCopyableSwitcherEnabled,n.project.isCopyableTemplate,o?.price,o?.currency,o?.purchaseLink,o?.isPaid]),g=s==="unpublished"||s==="unpublishedChanges",h=s==="unpublishedChanges";return m?a(La,{as:"a",href:p,target:"_blank",background:"transparent",color:"tomato",marginBottom:0,height:40,...i,children:r?"Open":"Published"}):a(La,{"data-testid":"publish-button",backgroundColor:g?"tomato":"transparent",color:g?"white":"tomato",onClick:u,marginBottom:0,height:s==="unpublished"?56:40,...t,children:n.publishInProgress?a(f,{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",children:a(mt,{size:h?24:28,bgColor:"transparent"})}):n.isPublishError?"Error":s==="unpublished"?"Publish":"Republish"})}function bF(){let{isHovered:e,...o}=Ke(!1),t=(0,Or.useContext)(ce);return Cr(t.project)!=="unpublished"?a(La,{onClick:t.unpublish,backgroundColor:e?"tomato":"gray",...o,children:"Unpublish"}):null}function wT(){return a(f,{padding:"0 16px",children:w(f,{padding:"14px 0 16px",borderTop:"2px solid",borderTopColor:Ua.transparentGrey,children:[a(hF,{}),a(fF,{}),a(bF,{}),a(Hw,{})]})})}var xT=B(H());$e();N();fe();Be();k();function vT(){return(0,xT.useContext)(ce)?.owner?.permissions?.can_use_version_history?a(f,{display:"flex",height:"12rm",marginLeft:"4rm",marginRight:"4rm",borderTop:"2px solid",borderTopColor:"#A2A2A23D",children:a(Ue,{onClick:K1,color:"black",children:a(ve,{fontSize:"6rm",fontWeight:500,children:"Version history"})})}):null}var Is=B(H());N();fe();Vr();var yT=B(H());N();$e();oe();k();var kT=(0,yT.memo)(({isSomeSelected:e,isAllSelected:o,onDoneClick:t,onSelectAllClick:r,dividerColor:i,canUseEmailProtection:n,...s})=>w(f,{display:"flex",height:88,paddingLeft:n?16:24,paddingRight:n?16:24,justifyContent:"center",alignItems:"center",position:"relative",...s,children:[!n&&a(f,{height:2,position:"absolute",top:-1,left:"8px",right:"8px",borderRadius:"2px",backgroundColor:i||"gray"}),a(ge,{"data-testid":n?"private-pages-select-all":"private-pages-done",textStyle:"small",color:n?"white":e?"tomato":"white",onClick:n?r:t,cursor:"pointer",backgroundColor:n?"tomato":"unset",borderRadius:n?"8px":"unset",height:n?"40px":"auto",width:n?"100%":"auto",marginBottom:n?16:0,css:ae`
            &:hover,
            &:focus,
            &:active {
              color: ${n?"white":e?"tomato":"white"};
              opacity: 1;
            }
          `,children:n?"Protect the whole project":e?"Done":"Close"})]}));kT.displayName="PrivatePagesFooter";var _T=kT;var xp=B(H());Be();N();Ve();Xd();Ks();fe();k();var Fw=(0,xp.memo)(({page:e,level:o=0,childIndex:t,onSelectPage:r,viewport:i,...n})=>{let s=(0,xp.useContext)(ce),l=!!(e.children&&e.children.length),c=(0,xp.useMemo)(()=>s.pagesParams[e._id]?s.pagesParams[e._id].parentId?s.pagesParams[s.pagesParams[e._id].parentId].viewNum:s.pagesParams[e._id].viewNum:e.num,[e,o,s.pagesParams]),d=p=>{p.preventDefault(),r(e)};return w(f,{"data-pageid":e._id,...n,children:[a(f,{width:200,height:132,padding:"4px",borderRadius:"4px",position:"relative",boxShadow:e.isPrivate?`0 0 0 4px ${V.red}`:void 0,onClick:d,cursor:"pointer",transformOrigin:"left",overflow:"hidden",flex:"0 0 auto",transform:`scale(${o?"0.92":"1"})`,children:a(f,{width:192,height:124,backgroundColor:"darkGray",borderRadius:"4px",position:"relative",children:a(Fn,{desktopUrl:e.screenshot,phonePortraitUrl:e.viewport_phone_portrait?.screenshot,tabletPortraitUrl:e.viewport_tablet_portrait?.screenshot,phoneViewportEnabled:e.viewport_phone_portrait?.enabled,tabletViewportEnabled:e.viewport_tablet_portrait?.enabled,viewport:i})})}),w(f,{display:"flex",marginBottom:l?"4px":void 0,marginTop:o>0?"-2px":"4px",marginLeft:"4px",children:[l&&a(f,{display:"flex",width:12,height:12,alignItems:"center",justifyContent:"center",zIndex:1,marginRight:"2px",marginTop:"2px",children:a(zo,{color:"white"})}),w(L,{textStyle:"small",color:"white",children:[c,t?`.${t}`:"",".\xA0",e.title?e.title:"Page Title"]})]}),e.children&&l?a(f,{children:e.children.map((p,m)=>a(Fw,{page:p,level:o+1,childIndex:m+1,onSelectPage:r,marginLeft:(o+1)*16},p._id))}):null]})});Fw.displayName="PrivatePage";var ST=Fw;var Bn=B(H());N();oe();_r();Be();k();var CT=(0,Bn.memo)(({id:e,children:o,footer:t,footerHeight:r,...i})=>{let n=(0,Bn.useContext)(Ee),[s,l]=(0,Bn.useState)(!1);(0,Bn.useEffect)(()=>{n.isPrivatePagesOpened?(n.isPageSettingsOpened||n.isTrashOpened)&&(l(!0),setTimeout(()=>{n.dispatch({type:n.isPageSettingsOpened?"togglePageSettings":"toggleTrash"}),l(!1)},0)):s&&l(!1),n.isPrivatePagesOpened?document.body.classList.add("private-pages-is-opened"):document.body.classList.remove("private-pages-is-opened")},[n.isPrivatePagesOpened]),(0,Bn.useEffect)(()=>{n.privatePageSelected&&c(n.privatePageSelected)},[n.privatePageSelected]);let c=d=>{if(!n.isPrivatePagesOpened)return;let p=document.getElementById("constructor-private-pages");if(!p)return;let m=p.querySelector(`[data-pageid="${d}"]`);m&&setTimeout(()=>{m.scrollIntoView({block:"center",behavior:"smooth"})},100)};return w(f,{id:e,height:"100%",width:240,paddingTop:0,backdropFilter:"blur(4px)",backgroundColor:Me("black",.96),zIndex:s?uo.sidebarZindex+1:uo.sidebarZindex,overflowX:"hidden",overflowY:"auto",...i,children:[a(f,{height:`calc(100% - ${r+(typeof r=="number"?"px":"")})`,overflow:"auto",children:o}),t({height:r})]})});CT.displayName="PrivatePagesPanel";var PT=CT;Be();jt();k();var TT=(0,Is.memo)(({children:e,...o})=>{let t=(0,Is.useContext)(Ee),r=(0,Is.useContext)(ce),{viewport:i}=(0,Is.useContext)(qe),n=u=>u.every(g=>g.isPrivate&&(g.children?n(g.children):!0)),[s,l]=(0,Is.useState)(()=>n(r.pages)),c=r.pages.some(u=>u.isPrivate),d=u=>{r.setPageIsPrivate({pageId:u._id,isPrivate:!u.isPrivate})},p=()=>{t.isPrivatePagesOpened&&t.dispatch({type:"togglePrivatePages"})},m=()=>{l(!s),r.setPageIsPrivate({isPrivate:!s,updateAll:!0})};return a(PT,{id:"constructor-private-pages",borderRadius:"2rm",footerHeight:"56px",footer:({height:u})=>a(_T,{dividerColor:"rgba(128, 128, 128, 0.4)",height:u,isSomeSelected:c,isAllSelected:s,canUseEmailProtection:!!r.project.user?.permissions.can_make_mag_private_by_email,onDoneClick:p,onSelectAllClick:m}),...o,children:a(Ft,{children:({ref:u})=>w(f,{ref:u,padding:"16px 16px 0 16px",children:[a(f,{display:"flex",alignItems:"center",height:"16px",marginBottom:"16px",children:a(L,{color:"white",textStyle:"subheading",textAlign:"left",children:"Select pages"})}),r.pagesTree.map(g=>a(ST,{page:g,onSelectPage:d,viewport:i,margin:"0 0 8px -4px"},g._id))]})})})});TT.displayName="PrivatePages";var IT=TT;Be();zt();Ve();var Zo=B(H());N();oe();fe();$e();hI();oe();Be();var Ms=B(H());N();fi();fe();Be();Sr();Ir();je();k();var Nw=(0,Ms.memo)(()=>{let{isCopyableSwitcherEnabled:e,dispatch:o}=(0,Ms.useContext)(Ee),{isFreePlan:t}=(0,Ms.useContext)(cr),r=(0,Ms.useContext)(ce),{project:i}=r,n=i.user?.permissions||{},s=!t&&!n.can_publish_shared_template;return(0,Ms.useEffect)(()=>{s&&e&&!i.is_published&&(o({type:"toggleTemplateShareMode"}),r.projectSave({isCopyableTemplate:!1},{patch:!0}))},[]),a(q,{children:w(f,{display:"flex",width:"100%",minHeight:24,justifyContent:"space-between",alignItems:"center",pointerEvents:s?"none":"auto",children:[a(L,{textStyle:"small",lineHeight:"24px",opacity:s?.4:1,children:"\u0421onvert to template"}),a(Wt,{disabled:s,backgroundChecked:"red",checked:e,onChange:async c=>{if(i.is_published){if(c&&!n.can_publish_shared_template)return rt("free-publish-template-limit");if(!c&&!n.can_publish)return rt("convert-template-to-published-limit")}o({type:"toggleTemplateShareMode"}),await r.projectSave({isCopyableTemplate:c},{patch:!0}),await r.projectMag.fetch(),se("settingsProject",{settingsType:`template toggle ${c?"on":"off"}`})}})]})})});Nw.displayName="TemplateToggle";var ii=B(H());N();Be();fe();Be();Fo();k();var Ww=(0,ii.memo)(()=>{let{fetchTemplateStats:e}=(0,ii.useContext)(ce),o=(0,ii.useContext)(Ee),[t,r]=(0,ii.useState)(null),[i,n]=(0,ii.useState)(!1),s=(0,ii.useMemo)(()=>!o.isCopyableSwitcherEnabled,[o.isCopyableSwitcherEnabled]);return(0,ii.useEffect)(()=>{n(!0),e().then(l=>{r(l)}).catch(l=>{console.error("Failed to load stats:",l),r(null)}).finally(()=>n(!1))},[]),i?a(f,{display:"flex",justifyContent:"center",alignItems:"center",margin:"7px 0 25px",children:a(mt,{color:"darkGray",bgColor:"transparent",size:24})}):t?w(f,{display:"flex",gap:"32px",width:"100%",marginBottom:15,padding:"0 16px",children:[w(f,{display:"flex",flex:1,flexDirection:"column",children:[a(L,{color:"gray",textStyle:"small",paddingBottom:5,children:"Views"}),a(L,{color:s?"gray":"black",children:t.views})]}),w(f,{display:"flex",flex:1,flexDirection:"column",children:[a(L,{color:"gray",textStyle:"small",paddingBottom:5,children:"Copies"}),a(L,{color:s?"gray":"black",children:t.copies})]})]}):a(f,{marginBottom:20,padding:"0 16px",children:a(L,{textStyle:"small",children:"Unable to load template stats..."})})});Ww.displayName="TemplateStatistics";var $r=B(H());N();oe();Ks();wu();fe();st();Be();Hn();$I();oe();Z6();dr();sf();k();var wF=F(Ce)`
  &:hover {
    opacity: 0.8;
  }
`,Vw=[{label:"$ USD",value:"USD"},{label:"\u20AC EUR",value:"EUR"},{label:"\xA3 GBP",value:"GBP"}],MT=({currency:e,price:o,purchaseLink:t,isPaid:r,onCurrencyChange:i,onPriceChange:n,onPurchaseLinkDone:s,onLinkValidityChange:l})=>{let c=(0,$r.useContext)(ce),d=(0,$r.useRef)(null),[p,m]=(0,$r.useState)(t||""),[u,g]=(0,$r.useState)(!1),h=(0,$r.useMemo)(()=>{let S=p.trim();return!!M0(S)},[p]),b=(0,$r.useMemo)(()=>`${le.readymag_viewer_host}/${c.project.user.uri}/${c.project.uri}/`,[c.project.uri,c.project.user.uri]);(0,$r.useEffect)(()=>{l?.(h)},[h,l,r]),(0,$r.useEffect)(()=>{m(t||""),g(!1)},[t,r]);let x=()=>{h?(g(!1),s(p)):g(!0)};return w(f,{display:"flex",flexDirection:"column",children:[w(f,{display:"flex",flexDirection:"column",borderTop:"2px solid #A2A2A23D",margin:"0 16px",children:[a(ls,{link:b||"",linkTitle:"Copy template link",margin:"15px 0 12px 0",openButton:!1,width:"100%",borderColor:"rgba(162, 162, 162, 0.24)",analytics:"copy link of user template"}),a(f,{background:"white",padding:"14px 16px",borderRadius:8,display:"flex",flexDirection:"column",gap:16,children:w(L,{textStyle:"small",color:"black",lineHeight:1.2,children:[w(wF,{target:"_blank",color:"red",href:"https://help.readymag.com/hc/en-us/articles/38187461081755-How-to-Sell-Your-Templates",children:["Learn more"," "]}),"how to sell templates"]})}),a(ls,{link:c.project.templateSettings?.shareSlug?`${le.readymag_auth_host}/start-with-template/${c.project.templateSettings?.shareSlug}?created_from_preview=true&copyable=true`:"",linkTitle:"Copy access link",margin:"12px 0 16px 0",openButton:!1,width:"100%",borderColor:"rgba(162, 162, 162, 0.24)",analytics:"copy template access link"})]}),a(f,{as:"div",ref:d,position:"relative",width:204,paddingLeft:8,children:a(Py,{items:Vw,showBorder:!1,onSelect:S=>{i(S.value)},container:d.current||void 0,labelStyle:"small",children:({toggleDropdown:S,ref:y})=>w(f,{ref:y,onClick:S,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",width:204,padding:"0 1px 0 8px",children:[a(L,{textStyle:"small",color:"black",children:Vw.find(C=>C.value===e)?.label||Vw[0].label}),a(zo,{color:"gray"})]})})}),w(f,{display:"flex",alignItems:"center",justifyContent:"space-between",margin:"10px 16px",children:[a(L,{textStyle:"small",children:"Price"}),a(f,{display:"flex",alignItems:"center",children:a(cn,{value:o,min:0,max:9999.99,step:.5,floating:2,textAlign:"right",autoWidth:!0,onChange:({value:S})=>{n(S)}})})]}),r&&w(f,{display:"flex",justifyContent:"space-between",margin:"0 16px",children:[u&&a(bl,{visibility:"visible",text:"Add a valid link\u2014Shopify, Gumroad or Lemonsqeezy one\u2014to Purchase Link field.",position:"absolute",marginTop:-11,width:250,right:"102%",zIndex:10}),a(yt,{name:"purchace-link",id:"purchace-link",type:"text",marginTop:"4px",paddingRight:8,textStyle:"small",spellCheck:!1,autoComplete:"off",autoCorrect:"off",placeholder:"Purchase link",value:p,textOverflow:"ellipsis",onChange:S=>{u&&g(!1),m(S.target.value)},onBlur:x,onKeyDown:S=>{S.key==="Enter"&&(x(),S.currentTarget.blur())},css:ae`
              &:focus {
                border-bottom: none;
              }
            `}),a(Ro,{text:"Add a link to an external marketplace (e.g. Lemon Squeezy, Gumroad, Shopify) where this template will be available for purchase",width:194,boxPosition:{marginLeft:"-169px"},arrowPosition:{left:"auto",right:4}})]})]})};Ve();oe();st();Sr();Lp();k();var BT=F(Ce)`
  &:hover {
    opacity: 0.8;
  }
`,RT=()=>{let e=(0,Zo.useContext)(Ee),o=(0,Zo.useContext)(ce),{isFreePlan:t}=(0,Zo.useContext)(cr),r=o.project.user?.permissions||{},i=!t&&!r.can_publish_shared_template,[n,s]=(0,Zo.useState)(!0),l=o.project.templateSettings||{},[c,d]=(0,Zo.useState)(l.currency||"USD"),[p,m]=(0,Zo.useState)(l.price??0),[u,g]=(0,Zo.useState)(l.purchaseLink||""),[h,b]=(0,Zo.useState)(l.isPaid??!1),x=(0,Zo.useCallback)(async D=>{d(D);try{await o.projectSave({"templateSettings.currency":D},{patch:!0})}catch(E){console.error("Error saving currency:",E)}},[o]),{callback:S,cancel:y}=Oi(async D=>{let E=D>0;try{await o.projectSave({"templateSettings.price":D,"templateSettings.isPaid":E},{patch:!0})}catch(A){console.error("Error saving price/isPaid:",A)}},500);(0,Zo.useEffect)(()=>()=>{y()},[y]);let C=(0,Zo.useCallback)(D=>{m(D);let E=D>0;b(E),S(D)},[S]),P=(0,Zo.useCallback)(async D=>{try{g(D),await o.projectSave({"templateSettings.purchaseLink":D},{patch:!0})}catch(E){console.error("Error saving purchaseLink:",E)}},[o]),v=i&&a(f,{display:"flex",margin:"0 16px",justifyContent:"space-between",alignItems:"center",backgroundColor:"white",padding:"14px 16px",borderRadius:8,children:w(L,{textStyle:"small",lineHeight:"16px",color:"black",children:["You've reached the limit of 20 templates. If you need more, please"," ",a(Ce,{target:"_blank",href:`mailto:${le.SUPPORT_MAIL}`,color:"tomato",css:ae`
            &:hover {
              color: ${V.black};
            }
          `,children:"contact us"})]})}),T=o.project.is_published,R=T&&o.project.isCopyableTemplate,I=T&&!o.project.isCopyableTemplate,M=o.project.isCopyableTemplate||T&&!o.project.isCopyableTemplate;return w(f,{display:"flex",height:"100%",flexDirection:"column",borderRadius:"2rm",backdropFilter:"blur(4px)",backgroundColor:Me("lightGray",.96),border:"2px solid rgba(184, 184, 184, 0.16)",padding:"6px 0 6px",children:[a(f,{display:"flex",marginBottom:24,padding:"0 16px",children:a(ge,{onClick:()=>e.dispatch({type:"ToggleTemplateShareSettings"}),children:a(Dv,{widths:24,color:"darkGray"})})}),a(f,{paddingBottom:15,borderBottom:"2px solid #A2A2A23D",margin:"0 16px 18px 16px",children:a(Nw,{})}),v||w(q,{children:[a(Ww,{}),!T&&a(f,{background:"white",padding:"14px 16px",borderRadius:8,display:"flex",flexDirection:"column",gap:16,margin:"0 16px",children:w(L,{textStyle:"small",color:"black",lineHeight:1.2,children:["All users will be able to copy your project to their account for free or buy it."," ",a(BT,{target:"_blank",color:"red",href:"https://help.readymag.com/hc/en-us/articles/35761106118171-Convert-project-to-templates",children:"Learn more"})]})}),I&&a(f,{background:"white",padding:"14px 16px",borderRadius:8,display:"flex",flexDirection:"column",gap:16,margin:"0 16px",children:w(L,{textStyle:"small",color:"black",lineHeight:1.2,children:["Enable the toggle. Then choose whether others will be able"," ",a(BT,{target:"_blank",color:"red",href:"https://help.readymag.com/hc/en-us/articles/35761106118171-Convert-project-to-templates",children:"to copy your template for free or buy it"}),"."]})}),R&&a(MT,{currency:c,price:p,purchaseLink:u,isPaid:h,onCurrencyChange:x,onPriceChange:C,onLinkValidityChange:s,onPurchaseLinkDone:P}),M&&a(f,{marginTop:"auto",margin:"0 16px 6px 16px",children:a(Hw,{disabled:h&&!n,templateSettings:{price:p,currency:c,purchaseLink:u,isPaid:h}})})]})]})};k();function zT({children:e,button:o,...t}){let r=(0,cd.useContext)(Ee),{openPanel:i}=(0,cd.useContext)(Ct),n=window?.location?.hash==="#settings-domain",s=n?3:void 0;return(0,cd.useEffect)(()=>{n&&i("project-settings")},[n,s]),a(Xt,{name:"project-settings",skidding:-28,button:o,ArrowProps:{stroke:Le(.84,V.gray)},...t,children:r.isTemplateShareSettingsOpened?a(RT,{}):w(q,{children:[a(ws,{isOpen:r.isPrivatePagesOpened,direction:"right",children:a(IT,{})}),w(f,{display:"flex",height:"100%",flexDirection:"column",borderRadius:"2rm",backdropFilter:"blur(4px)",backgroundColor:Me("lightGray",.96),border:"2px solid #B8B8B828",zIndex:"1",children:[a(f,{display:"flex",minHeight:"calc(100% - 280px)",flexGrow:1,children:a(uS,{exclude:["viewer"],defaultAccordionValue:s,renderButtonContainer:l=>a(f,{padding:"0 16px",children:l}),renderCollapseContainer:l=>a(f,{padding:"0 16px",children:l})})}),w(f,{children:[a(vT,{}),a(wT,{})]})]})]})})}var ET=B(H());oe();$e();Wo();N();fe();k();var Da=({text:e,backgroundColor:o="blue",width:t})=>a(f,{height:"56px",width:t,backgroundColor:o,borderRadius:8,padding:"0 16px",children:a(ve,{textStyle:"subheading",color:"white",lineHeight:"56px",userSelect:"none",children:e})});Gn();k();var AT=()=>{let{isEditorModeEnabled:e,canChangeLockedLayoutMode:o}=(0,ET.useContext)(In),[t]=go(),{isHovered:r,...i}=Ke(),n=Fi("CanUseDefaultMode")||o,s;return n?s=a(ge,{onClick:()=>{window.RM.constructorRouter.toggleSelfEditorMode()},...i,children:a(Da,{width:179,text:r?"Unlock layout":"Layout locked",backgroundColor:Me("darkGray",.96)})}):s=a(Da,{width:179,text:"Layout locked",backgroundColor:Me("darkGray",.96)}),e&&!t?s:null};$e();fe();Wo();oe();var OT=B(H());$e();var Bs=B(H());gy();Gn();Uo();vt();k();var Rs=(0,Bs.createContext)({});function LT({children:e}){let o=window.RM.constructorRouter.gg,[t,r]=(0,Bs.useState)(()=>!!o.mag.edit_params.get("blocks"));function i(){He("TurnOnTheBlocksMode"),window.RM.constructorRouter.toggleBlocksMode()}function n(s){r(s.get("blocks"))}return(0,Bs.useEffect)(()=>(o.mag.edit_params.on("change:blocks",n),()=>{o.mag.edit_params.off("change:blocks",n)}),[]),a(Rs.Provider,{value:{isBlocksEnabled:t,toggleBlocks:i},children:e})}function DT(){let{toggleBlocks:e}=(0,Bs.useContext)(Rs),o=Fi("CanUseBlocksMode"),t="Blocks (B)";return a(an,{permission:"CanUseBlocksMode",children:a(gt,{targetSteps:["TurnOnTheBlocksMode"],position:"left",indent:8,delay:1400,leaveDelay:100,defaultText:t,instance:!0,children:a(ge,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",width:56,height:56,"aria-label":t,onClick:e,disabled:!o,children:a(gu,{})})})})}k();function $T(){let{isHovered:e,...o}=Ke(),{isBlocksEnabled:t,toggleBlocks:r}=(0,OT.useContext)(Rs);return t?a(ge,{onClick:()=>{r()},...o,children:a(Da,{width:138,backgroundColor:Me("darkGray",.96),text:e?"Turn Off":w(q,{children:["Blocks"," ",a(L,{as:"span",textStyle:"subheading",color:"gray",children:"On"})]})})}):null}var dd=B(H());Sr();var Jg=B(H());N();fe();Ve();oe();Be();k();var xF=Cd`
  0% {
    opacity: 1;
  }
  50% {
    opacity: 0;
  }
`;function Uw({index:e=0}){return a(f,{display:"inline",animation:`${xF} 2.4s infinite steps(1) ${e*.4}s`,children:"."})}function vF({iAmOwner:e,name:o,avatarUrl:t}){let r=(0,Jg.useContext)(ce),[i,n]=(0,Jg.useState)(!1);return w(El,{onMouseEnter:()=>e&&n(!0),onMouseLeave:()=>n(!1),position:"relative",width:"auto",paddingRight:"30px",css:ae`
        &:hover {
          background: ${i?V.black:V.darkGray};
        }
      `,children:[a(Gt,{size:"medium",url:t,name:o,width:"54px",height:"54px",marginLeft:"1rm"}),w(f,{display:"flex",flexDirection:"column",marginLeft:"16px",children:[a(L,{color:"white",lineHeight:"1",children:o}),w(L,{color:"gray",lineHeight:"1",children:["editing now",a(Uw,{index:0}),a(Uw,{index:1}),a(Uw,{index:2})]})]}),i&&a(f,{color:"white",backgroundColor:"black",position:"absolute",left:0,right:0,top:0,bottom:0,borderRadius:"28px",lineHeight:"56px",textAlign:"center",onClick:()=>r.takeOverCurrentPage(),children:"Take Over"})]})}var HT=vF;Be();k();function FT(){let e=(0,dd.useContext)(ce),{user:o}=(0,dd.useContext)(cr),[t]=go(),r=(0,dd.useMemo)(()=>{let i=e.lockedPages[e.currentPageId];return i&&i!==o?.uri?e.collaborators.find(n=>n.uri===i):void 0},[e.currentPageId,e.collaborators,e.lockedPages,o?.uri]);return!r||t?null:r&&a(HT,{iAmOwner:e.isOwner,name:r.name,avatarUrl:r.pic})}var NT=B(H());Uo();vt();k();var WT=()=>{let e=(0,NT.useCallback)(()=>{_0()},[]);return a(wy,{onStop:e})};var VT=B(H());$e();Wo();oe();k();function UT(){let[e,o]=go(),{isHovered:t,onMouseEnter:r,onMouseLeave:i}=Ke(!1);return(0,VT.useEffect)(()=>{e||i({})},[e,i]),e?a(Ue,{onClick:()=>o(!1),onMouseEnter:r,onMouseLeave:i,children:a(Da,{width:148,backgroundColor:Me("darkGray",.96),text:t?"Turn off":"Comments"})}):null}fy();var zs=B(H());N();Wo();Jt();var GT=B(H());k();var Qg=(0,GT.forwardRef)((e,o)=>a("svg",{width:"26",height:"26",viewBox:"0 0 26 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:o,...e,children:a("path",{d:"M25 13C25 19.6274 19.6274 25 13 25C9.41592 25 6.57143 25 1 25C0.999999 20.7143 1 16.0433 1 13C1 6.37258 6.37258 1 13 1C19.6274 1 25 6.37258 25 13Z",stroke:"currentColor",strokeWidth:"2"})}));N();$e();Co();k();function eh({onClick:e,tooltipPlacement:o="top",disableTooltip:t}){let[r]=ts();return a(St,{placement:o,disabled:t,indent:8,leaveDelay:100,text:"Comments (C)",instance:!0,closeOnTargetClick:!0,children:a(f,{position:"relative",children:a(ge,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",width:56,height:56,"aria-label":"Comments",onClick:e,children:a(Wi,{show:!!r.totalNew,offset:[-8,0],children:a(Qg,{})})})})})}var jT=B(H());Co();$e();Yh();Gn();k();function qT(){let{canChangeLockedLayoutMode:e}=(0,jT.useContext)(In),o=Fi("CanUseDefaultMode")||e;return a(St,{placement:"right",indent:8,leaveDelay:100,text:"Default (V)",instance:!0,children:a(Ue,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",width:56,height:56,disabled:!o,onClick:()=>{window.RM.constructorRouter.disableCurrentMode()},"aria-label":"Default",children:a(Zs,{})})})}Ve();k();function yF({children:e}){let{closePanels:o}=(0,zs.useContext)(Ct),{isHovered:t,...r}=Ke();return a(f,{width:"100%",textAlign:"center",children:a(f,{display:"inline-block",width:56,height:56,marginTop:8,borderRadius:8,background:t?V.black:V.darkGray,transition:".2s ease",onClick:o,...r,children:e})})}function YT({children:e,button:o,hideButton:t=!1,...r}){let{isBlocksEnabled:i}=(0,zs.useContext)(Rs),{isEditorModeEnabled:n}=(0,zs.useContext)(In),[s,l]=go(),c=(0,zs.useCallback)(()=>{l(!s)},[s]),d=(0,zs.useMemo)(()=>{let p={key:"enable-blocks",children:a(DT,{})},m={key:"enable-edit-role",children:a(R5,{isActive:!0})},u={key:"default-mode",children:a(qT,{})},g={key:"comments-mode",children:a(eh,{tooltipPlacement:"right",onClick:c})};return s?[p,u,m]:i?[u,m,g]:n?[p,u,g]:[p,m,g]},[i,n,s,c]);return a(Xt,{skidding:t?28:0,name:"modes",button:t?()=>a("div",{}):o,withArrow:!1,panelPosition:{width:56,height:"auto"},...r,width:t?"0px":r.width,children:d.map(p=>a(yF,{children:p.children},p.key))})}var ud=B(H());$e();Yh();gy();mi();Uo();pr();vt();k();function XT({isPanelShown:e}){let{isBlocksEnabled:o}=(0,ud.useContext)(Rs),{isEditorModeEnabled:t}=(0,ud.useContext)(In),[r]=go(),[i]=ts(),[{message:n,visible:s}]=ol();return(0,ud.useEffect)(()=>{e&&He("ClickOnModesIcon")},[e]),a(gt,{eduTips:["eduTipUseBlocks","eduTipUseComments"],targetSteps:["ClickOnModesIcon"],defaultText:"Modes",position:n==="eduTipUseBlocks"&&s?"left":"top",indent:8,disabled:e,leaveDelay:100,instance:!0,closeOnTargetClick:!0,children:a(ge,{display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",height:"100%",width:"100%",position:"relative",color:"white","aria-label":"Modes","data-testid":"modes-button",children:a(Wi,{show:!!i.totalNew&&!e,offset:[2,10],children:r?a(Qg,{}):o?a(gu,{withTransition:!0}):t?a(Zs,{withTransition:!0,isActive:!0}):a(Zs,{withTransition:!0,isActive:!1})})})})}var Io=B(H());zt();N();fe();Wr();N();oe();k();var kF=Dt(F(f,{excludeProps:["isAbsolute"]})`
    width: 100%;
    height: 100%;
    overflow: hidden;
    ${e=>e.isAbsolute?"position: absolute":"position: relative"};
    top: 0;
    left: 0;
  `),_F=F("div",{excludeProps:["color","speed"]})`
  width: 100%;
  height: 100%;
  transform: translateX(-100%);
  background-image: linear-gradient(
    90deg,
    ${e=>e.color?Me(e.color,0):Me("white",0)} 0,
    ${e=>e.color?Me(e.color,.2):Me("white",.2)} 20%,
    ${e=>e.color?Me(e.color,.6):Me("white",.6)} 65%,
    ${e=>e.color?Me(e.color,0):Me("white",0)}
  );
  background-repeat: no-repeat;
  animation: shimmerLoading ${e=>e.speed?e.speed:"2s"} infinite;
  @keyframes shimmerLoading {
    to {
      transform: translateX(100%);
    }
  }
`;function SF({isVisible:e,isAbsolute:o,color:t,speed:r}){return a(No,{children:e&&a(kF,{initial:{opacity:1},exit:{opacity:0},isAbsolute:o,children:a(_F,{color:t,speed:r})})})}var Gw=SF;mI();Ve();var KT=B(H());zt();N();Ve();oe();k();var ZT=(0,KT.forwardRef)(({children:e,backgroundColor:o,height:t,overflow:r,zIndex:i},n)=>a(f,{ref:n,display:"flex",height:t||"100%",borderRadius:"2rm",maxHeight:"inherit",flexDirection:"column",paddingBottom:2,color:"black",backgroundColor:Me(o||"lightGray",.96),backdropFilter:"blur(4px)",zIndex:i||"auto",boxShadow:`0 0 0 2px inset ${Le(.84,V.gray)}`,overflow:r||"auto",children:e}));N();Vr();var JT=B(H());Wr();N();gI();k();var CF=Dt(f),PF={open:{height:"auto"},collapsed:{height:0}};function QT({duration:e,ease:o="easeOut",variants:t=PF,isVisible:r,children:i,...n}){let s=(0,JT.useRef)(null),l=Iv(s);return a(CF,{initial:r?"open":"collapsed",animate:r?"open":"collapsed",inherit:!1,variants:t,overflow:"hidden",transition:{ease:o,duration:typeof e=="number"?e:TF(l.height)/1e3},...n,children:typeof i=="function"?i(s):a("div",{ref:s,children:i})})}function TF(e){if(!e)return 0;let o=e/36;return Math.round((4+15*o**.25+o/5)*10)}k();function e8({children:e,isCollapsed:o,onScroll:t,initialScrollTop:r}){function i(n){r&&n.scrollTo({top:r})}return a(Ft,{onScroll:t,onFirstRender:i,children:({ref:n})=>a(f,{ref:n,flex:1,padding:"0 8px",children:a(QT,{duration:.2,isVisible:!o,children:e})})})}Jt();Be();jt();k();var IF={status:"unresolved"},MF=()=>{let e=sessionStorage.getItem(xf);return e?Number(e):(window.innerHeight||600)/3*2},BF=()=>a(f,{width:"100%",height:"100%",padding:"0 24px 0 16px",display:"flex",alignItems:"center",children:a(ve,{color:"darkGray",textStyle:"small",children:"Click anywhere on the page to leave a comment"})});function t8({children:e,button:o,...t}){let{openPanel:r,closePanels:i,currentPanel:n}=(0,Io.useContext)(Ct),{pages:s,me:l,owner:c,projectTeam:d,changeWorkspace:p,project:m}=(0,Io.useContext)(ce),{page:u,setViewport:g}=(0,Io.useContext)(qe),[h]=T1(),b=h!=="loaded"&&h!=="error",x=Ju(IF),[S]=ts(),[y,C]=dn(),P=(0,Io.useRef)(0);(0,Io.useEffect)(()=>{n===void 0&&!y?r("comments"):n==="comments"&&y&&!y.fromList&&i()},[n,y]);let v=(0,Io.useCallback)((ee,G)=>{let K=ee.parentComment??ee.comment;if(G==="selected"){C(null);return}(K.viewport==="default"||u?.getViewportParam(K.viewport,"enabled"))&&requestAnimationFrame(()=>{g(K.viewport)}),requestAnimationFrame(()=>{p({id:K.pageId}),C({comment:K,fromList:!0})})},[u,g]),T=(0,Io.useCallback)(ee=>{let G=ee.parentComment??ee.comment;C({comment:G,fromList:!0})},[]);function R(ee){ee&&y&&!y.fromList&&C({comment:y.comment,fromList:!0})}let[I,M]=(0,Io.useState)(MF()),D=(0,Io.useCallback)(ee=>{M(ee),sessionStorage.setItem(xf,`${ee}`)},[]),E=(0,Io.useRef)(null),{isResizable:A,onMouseDown:$}=Tv({ref:E,min:215,max:()=>window.innerHeight-32-72,onResizeComplete:D,initialHeight:I,direction:Pv.reverse}),j=(0,Io.useRef)(document.getElementById("main"));(0,Io.useLayoutEffect)(()=>(A?(j.current?.classList.remove("comment-cursor"),j.current?.classList.add("resize-comment-panel")):(j.current?.classList.remove("resize-comment-panel"),j.current?.classList.add("comment-cursor")),()=>{j.current?.classList.remove("resize-comment-panel")}),[A]);function pe(ee){ee.stopPropagation(),n==="comments"?r("modes"):n==="modes"?r("comments"):n===void 0&&(r("comments"),y&&C({comment:y.comment,fromList:!0}))}return a(Xt,{skidding:82,button:o,name:"comments",isAutoHeight:!0,closeOnOutsideClick:!1,ArrowProps:{stroke:Le(.84,V.gray)},disableInteractions:A,onToggle:R,"data-testid":"comment-panel",onButtonClick:pe,...t,children:w(ZT,{ref:E,height:I,zIndex:1,overflow:"hidden",children:[a(f,{width:"100%",padding:"4px 0 8px 0",display:"flex",justifyContent:"center",alignItems:"center",cursor:"row-resize",onMouseDown:$,children:a(f,{width:24,height:4,borderRadius:8,backgroundColor:"gray"})}),x.length===0?a(BF,{}):a(e8,{initialScrollTop:P.current,onScroll:ee=>{P.current=ee.target.scrollTop},children:a(Sl,{me:l,owner:c,projectTeam:d,viewState:S,children:a(Hf,{children:x.map(ee=>{let G=s.find(K=>K._id===ee.pageId);return G?a(vc,{readonly:ee.isTmp,comment:ee,projectNumId:m.num_id,selected:y?.comment?._id===ee._id,page:G,onClick:v,onStartEditing:T},ee._id):null})})})}),a(Gw,{isVisible:b,isAbsolute:!0})]})})}var Oa=B(H());var r8=B(H());Md();Ws();var o8=e=>Zt.post("/api/user/feedback/onboarding",e);yr();Sr();vt();var RF={isShown:!1,topic:null,rating:null},[zF,qw,jw]=lr(RF),th=(e={hookType:"default"})=>zF(e),vp=()=>{let{user:e,setUserOptions:o}=On();return(0,r8.useCallback)(r=>{let i=e&&e.opts?e.opts.hasSeenOnboardingSurvey:!0;tl()||i||Ge("constructor.onboardingSurvey")&&(qw({isShown:!0,topic:r,rating:null}),o({hasSeenOnboardingSurvey:!0}))},[e,o])},Yw=()=>{qw({...jw(),isShown:!1})},Xw=async({rating:e,feedback:o,followUpQuestions:t})=>{let{topic:r}=jw();if(r){qw({...jw(),rating:e});try{await o8({question:r,rating:e,feedback:o,followUpQuestions:t||[]})}catch(i){console.error("Failed to submit onboarding rating",i)}Yw()}};yr();var EF={"How helpful were the Help articles for getting started?":"constructor.onboardingSurveyLearnPanelToHelp","How helpful was the video for getting started?":"constructor.onboardingSurveyLearnPanelToYoutube"};function Kw({timeout:e=5*60*1e3,topic:o}){let t=vp(),r=(0,Oa.useRef)(null),i=(0,Oa.useRef)(null),n=EF[o],s=(0,Oa.useCallback)(()=>{n&&!Ge(n)||(r.current=Date.now())},[n]);return(0,Oa.useEffect)(()=>{let l=()=>{n&&!Ge(n)||r.current!==null&&i.current===null&&(i.current=setTimeout(()=>{t(o),r.current=null,i.current=null},e))};return window.addEventListener("focus",l),()=>{window.removeEventListener("focus",l),i.current!==null&&clearTimeout(i.current)}},[e,o,n,t]),s}dy();k();var i8=()=>{let{currentPanel:e}=(0,md.useContext)(Ct),o=(0,md.useContext)(qe),[t,r]=go(),{showMessenger:i,intercomAuth:n,shouldLoadIntercom:s,messageCount:l}=mu({});(0,md.useEffect)(()=>{s&&n?.intercomAppId&&i()},[n?.intercomAppId]);let c=Kw({topic:"How helpful were the Help articles for getting started?"}),d=Kw({topic:"How helpful was the video for getting started?"});return Gi("c",{activeOnLock:!0,handler:()=>{r(!t)}}),Gi("l",{handler:()=>{window.RM.constructorRouter.toggleSelfEditorMode()}}),Gi("b",{handler:()=>{window.RM.constructorRouter.toggleBlocksMode()}}),o.page?a(f,{right:16,height:56,bottom:16,zIndex:3020,gap:16,position:"absolute",children:a(f,{display:"flex",gap:"2rm",height:56,alignItems:"flex-end",children:a(LT,{children:w(B5,{children:[a(AF,{}),a(Kg,{width:224,height:56,display:"flex",borderRadius:"8px",backgroundColor:Me("darkGray",.96),children:w(sl,{children:[a(YT,{width:"56px",height:"100%",hideButton:t,button:({isPanelShown:p})=>a(XT,{isPanelShown:p})}),t?a(t8,{width:"56px",height:"100%",button:({isPanelShown:p})=>a(eh,{disableTooltip:p||e==="modes"})}):null,a(an,{permission:"GridsAndGuidesCanUse",children:a(qs,{disabled:t,children:a(j5,{width:"56px",height:"100%",button:({isPanelShown:p})=>a(E5,{width:"56px",disableTooltip:p})})})}),a(qs,{disabled:t,children:a(zT,{width:"56px",button:({isPanelShown:p})=>a(fT,{tooltipText:"Project settings",width:"56px",disableTooltip:p})})}),w(qs,{disabled:t,children:[a(hT,{name:"help",width:"56px",button:({isPanelShown:p})=>a(Y5,{disabledTooltip:p,width:"56px"}),onHelpPageClick:c,onVideosPageClick:d}),l>0&&a("div",{className:"intercom-custom-counter",children:l})]})]})}),a(f,{children:a(vm,{})})]})})})}):null},AF=()=>w(q,{children:[a(hu,{}),a(WT,{}),a($T,{}),a(AT,{}),a(UT,{}),a(FT,{})]});N();var Ji=B(H());N();fe();$e();Ur();wI();Eh();_r();Ve();oe();k();var LF={connection:`Seems there is a connection problem. Changes may not be saved until this
  alert disappears.`,socket:"You have been disconnected from the server.",duplicate:`It seems like you\u2019ve opened this project in another tab or browser. We\u2019ve
  interrupted this session in order to avoid conflicting copies.`,none:"unknown alert"};function DF({zIndex:e=uo.popupZindex,...o}){let[t,r]=(0,Ji.useState)("none"),[i,n]=(0,Ji.useState)(null),[s,l]=(0,Ji.useState)(null),[c,d]=(0,Ji.useState)(!0),{styles:p,attributes:m,update:u}=nl(i,s,{placement:"top"}),g=(0,Ji.useMemo)(()=>LF[t],[t]),h=t==="socket",b=t!=="none";(0,Ji.useEffect)(()=>{let S=()=>r("connection"),y=()=>r("socket"),C=()=>r("none");return window.RM.constructorRouter.on("showConnectionAlert",S),window.RM.constructorRouter.on("showSocketConnectionAlert",y),window.RM.constructorRouter.on("hideConnectionAlert",C),window.RM.constructorRouter.on("hideSocketConnectionAlert",C),()=>{window.RM.constructorRouter.off("showConnectionAlert",S),window.RM.constructorRouter.off("showSocketConnectionAlert",y),window.RM.constructorRouter.off("hideConnectionAlert",C),window.RM.constructorRouter.off("hideSocketConnectionAlert",C)}},[]),(0,Ji.useEffect)(()=>{u&&u()},[t]);let x=()=>{h||d(!c)};return b?a(q,{children:w(f,{display:"flex",zIndex:e,...o,children:[c&&w(f,{width:276,padding:16,marginBottom:18,borderRadius:"4px",textAlign:"center",backgroundColor:"white",boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.08)",ref:l,style:p.popper,...m.popper,children:[a(f,{children:a(L,{display:"block",textStyle:"regular",children:g})}),h&&a(ge,{marginTop:12,width:88,height:38,borderRadius:"4px",backgroundColor:"tomato",color:"white",css:ae`
                  &:hover {
                    color: ${V.white};
                    background: ${V.black};
                  }
                `,onClick:()=>window.location.reload(),children:"Reload"})]}),a(f,{ref:n,children:a(Pt,{height:56,width:56,marginRight:0,color:"tomato",disabled:h,onClick:x,children:a(Uv,{color:"white"})})})]})}):null}var n8=f.withComponent(DF);var yp=B(H());N();oe();N();k();var OF=e=>a("svg",{width:20,height:20,viewBox:"0 0 21 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.2391 4.25826C16.585 4.60423 16.585 5.16515 16.2391 5.51112L11.7084 10.0418L16.1942 14.5277C16.5397 14.8731 16.5397 15.4332 16.1942 15.7786C15.8488 16.1241 15.2887 16.1241 14.9433 15.7786L10.4574 11.2928L6.01577 15.7344C5.6698 16.0804 5.10888 16.0804 4.76291 15.7344C4.41694 15.3884 4.41694 14.8275 4.76291 14.4815L9.20455 10.0399L4.71807 5.55342C4.37262 5.20798 4.37262 4.6479 4.71807 4.30246C5.06351 3.95702 5.62358 3.95702 5.96903 4.30246L10.4555 8.78894L14.9862 4.25826C15.3322 3.91229 15.8931 3.91229 16.2391 4.25826Z",fill:"white"})}),$F=f.withComponent(F(OF)`
      display: block;
    `),s8=$F;oe();N();k();var HF=e=>a("svg",{width:22,height:22,viewBox:"0 0 23 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:a("path",{d:"M12.0902 17.6363C11.7344 17.3785 11.2656 17.3785 10.9098 17.6363L6.53895 20.8021C5.72218 21.3937 4.6584 20.5641 4.94951 19.5625L6.47371 14.3185C6.60383 13.8708 6.45385 13.3848 6.09919 13.1049L1.92264 9.80903C1.12416 9.17892 1.53081 7.83539 2.5264 7.81427L7.80425 7.70232C8.23952 7.69308 8.62383 7.39917 8.76898 6.96451L10.5143 1.73803C10.8429 0.753988 12.1571 0.75399 12.4857 1.73803L14.231 6.96451C14.3762 7.39917 14.7605 7.69308 15.1958 7.70232L20.4736 7.81427C21.4692 7.83539 21.8758 9.17892 21.0774 9.80903L16.9008 13.1049C16.5461 13.3848 16.3962 13.8708 16.5263 14.3185L18.0505 19.5625C18.3416 20.5641 17.2778 21.3937 16.461 20.8021L12.0902 17.6363Z",stroke:"white",strokeWidth:1.4})}),FF=f.withComponent(F(HF)`
      display: block;
    `),a8=FF;oe();Kp();vu();fe();$e();k();function l8(e,o){if(o)switch(e){case"How well did the product tour help you get started?":return["What didn't work for you?"];case"How helpful were the Help articles for getting started?":case"How helpful was the video for getting started?":return["What were you looking for?","What didn't work for you?"];case"How confident do you feel using Readymag so far?":return["What specific task or feature are you struggling with right now?"];default:return["Please share your feedback"]}else return["How's your first experience with Readymag going?"]}var Zw=F(er)`
  width: 100%;
  margin-top: 16px;
  overflow-y: auto !important;
`,NF=F(ge)`
  &:hover {
    opacity: 0.8;
    color: #ffffff;
  }
`,p8=()=>{let[{isShown:e,topic:o,rating:t}]=th(),[r,i]=(0,yp.useState)(null),[n,s]=(0,yp.useState)(!1),[l,c]=(0,yp.useState)(null),[d,p]=(0,yp.useState)(""),[m,u]=(0,yp.useState)("");if(!o)return null;let g=()=>s(!0),h=()=>s(!1),b=async M=>{c(M),await Xw({rating:M}),g()},x=M=>{p(M)},S=M=>{u(M)},y=async()=>{if(!l)return;let M=l<=3,D=l8(o,M),E=M&&D.length>1,A={rating:l,question:o,followUpQuestions:D,feedback:E&&m.trim()?`${d.trim()} / ${m.trim()}`:d.trim()};await Xw({rating:A.rating,feedback:A.feedback,followUpQuestions:A.followUpQuestions}),c(null),p(""),u(""),h()},C=r??t,P=!!l&&l<=3,v=!P,T=l8(o,P),R=P&&T.length>1,I=P?d!==""&&(!R||m!==""):d!=="";return w(q,{children:[e&&w(f,{id:"onboardingsurvey",display:"flex",width:"100%",children:[w(f,{backgroundColor:"#EC520B",borderRadius:"8px",padding:"18px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",width:"calc(100% - 56px)",children:[a(f,{color:"#ffffff",fontSize:"14px",flex:"1 1 auto",children:o}),a(f,{display:"flex",width:"148px",justifyContent:"flex-end",children:[1,2,3,4,5].map(M=>a(f,{width:"28px",height:"18px",paddingLeft:"10px",cursor:"pointer",onClick:()=>b(M),onMouseEnter:()=>i(M),onMouseLeave:()=>i(null),children:a(a8,{width:"100%",height:"auto",transition:"fill 0.2s ease",fill:C!==null&&C>=M?"#ffffff":"none"})},M))})]}),a(f,{width:"56px",height:"56px",borderRadius:"50%",backgroundColor:"#EC520B",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",onClick:Yw,children:a(f,{width:"20px",height:"20px",color:"#ffffff",fill:"currentColor",children:a(s8,{})})})]}),a(qn,{onExit:h,contentPadding:"0 48px 32px 48px",showCloseButton:!1,backgroundColor:"#fff",show:n,zIndex:4e3,children:w(f,{position:"relative",width:268,maxHeight:608,children:[w(f,{paddingTop:"40px",children:[a(f,{position:"absolute",width:"100%",top:"0",left:"0",height:"40px",background:"linear-gradient(180deg, #FFFFFF 0%, rgba(255, 255, 255, 0) 125.78%)"}),a(f,{children:a(L,{textStyle:"subheading",children:"Thank you for sharing!"})}),P?w(q,{children:[a(f,{position:"relative",width:"100%",children:a(Zw,{rows:1,autoSize:!0,maxHeight:T.length>1?196:420,placeholder:T[0],value:d,onChange:M=>x(M.target.value)})}),T.length>1&&a(f,{position:"relative",width:"100%",borderTop:"1px solid #e9e9e9",marginTop:d.length?7:47,marginBottom:m.length?0:47,children:a(Zw,{rows:1,autoSize:!0,maxHeight:196,placeholder:T[1],value:m,onChange:M=>S(M.target.value)})})]}):a(f,{position:"relative",width:"100%",children:a(Zw,{rows:1,autoSize:!0,placeholder:T[0],maxHeight:360,value:d,onChange:M=>x(M.target.value)})})]}),w(f,{display:"flex",flexDirection:"column",position:"relative",width:"100%",paddingTop:"40px",children:[a(f,{paddingBottom:"16px",children:a(NF,{onClick:y,width:"100%",disabled:!I,padding:"18px",borderRadius:"100px",backgroundColor:I?"#ed520a":"#808080",color:I?"#ffffff":"rgba(255, 255, 255, 0.4)",children:"Send"})}),v&&a(f,{children:a(ge,{width:"100%",padding:"18px",borderRadius:"100px",backgroundColor:"#F4F4F4",color:"#282828",onClick:h,variant:"tertiary",children:"Close"})})]})]})})]})};var kp=B(H());yr();function c8(){let[{isShown:e}]=th(),o=vp(),t=(0,kp.useRef)(null),r=(0,kp.useRef)(!1);(0,kp.useEffect)(()=>{if(Ge("constructor.onboardingSurveyAfter15MinInEditor"))return t.current=window.setTimeout(()=>{r.current||o("How confident do you feel using Readymag so far?")},15*60*1e3),()=>{t.current&&(clearTimeout(t.current),t.current=null)}},[o]),(0,kp.useEffect)(()=>{e&&(r.current=!0,t.current&&(clearTimeout(t.current),t.current=null))},[e])}k();function d8(){return c8(),w(f,{position:"absolute",bottom:16,left:"50%",transform:"translateX(-50%)",zIndex:3e3,children:[a(n8,{}),a(p8,{})]})}Jt();py();k();function u8(){let{currentPanel:e,isVisible:o}=(0,rh.useContext)(Ct),[t,r]=ay(),i=n=>{n.stopPropagation(),r(!1)};return(0,rh.useEffect)(()=>{let n=["modes","guides","project-settings","help"],s=e!==void 0&&n.includes(e);window.RM.constructorRouter.toggleHideControls(s)},[e]),o?w(q,{children:[a(I5,{}),a(d8,{}),a(i8,{}),t?a(xm,{defaultIsOpen:!0,onClose:i}):null]}):null}sn();var zn=B(H());var Rn=B(H());oe();je();N();fe();pn();$e();Fo();vu();Ve();vt();Jt();Bh();k();var _p=F(ge)`
  display: flex;
  justify-content: center;
  align-items: center;

  width: 244px;
  height: 56px;

  border-radius: 8px;

  color: ${({theme:e})=>e.colors.white};
`,m8=F(ge)`
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  width: 160px;
  border-radius: 16px;
  padding: 16px;
  color: white;
  cursor: pointer;
  &:hover {
    color: white;
  }
  &:hover path {
    fill: white;
  }
  &:disabled {
    opacity: 1;
  }
`,VF=()=>a("svg",{width:"76",height:"76",viewBox:"0 0 76 76",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M33.0394 0.321083C34.6638 0.109189 36.3197 0 38 0C39.6803 0 41.3362 0.109189 42.9606 0.321084C44.0559 0.463955 44.828 1.46768 44.6851 2.56297C44.5423 3.65827 43.5385 4.43035 42.4432 4.28748C40.9899 4.09791 39.5069 4 38 4C36.4931 4 35.0101 4.09791 33.5568 4.28748C32.4615 4.43035 31.4577 3.65826 31.3149 2.56297C31.172 1.46768 31.9441 0.463955 33.0394 0.321083ZM49.9329 3.96559C50.356 2.94527 51.5261 2.46114 52.5465 2.88425C55.6369 4.16578 58.5207 5.84286 61.1349 7.85178C62.0107 8.52483 62.1751 9.78044 61.5021 10.6563C60.829 11.5321 59.5734 11.6965 58.6976 11.0235C56.3573 9.22509 53.7773 7.72493 51.0143 6.57915C49.9939 6.15604 49.5098 4.98591 49.9329 3.96559ZM26.0671 3.96559C26.4902 4.98591 26.0061 6.15604 24.9857 6.57915C22.2227 7.72493 19.6427 9.22509 17.3024 11.0235C16.4266 11.6965 15.171 11.5321 14.4979 10.6563C13.8249 9.78044 13.9893 8.52483 14.8651 7.85178C17.4793 5.84286 20.3631 4.16578 23.4535 2.88425C24.4738 2.46114 25.644 2.94527 26.0671 3.96559ZM10.6563 14.4979C11.5321 15.171 11.6965 16.4266 11.0235 17.3024C9.22509 19.6427 7.72493 22.2227 6.57915 24.9857C6.15604 26.0061 4.98591 26.4902 3.96559 26.0671C2.94527 25.644 2.46114 24.4738 2.88425 23.4535C4.16578 20.3631 5.84286 17.4793 7.85178 14.8651C8.52483 13.9893 9.78044 13.8249 10.6563 14.4979ZM65.3437 14.4979C66.2196 13.8249 67.4752 13.9893 68.1482 14.8651C70.1571 17.4793 71.8342 20.3631 73.1158 23.4535C73.5389 24.4738 73.0547 25.644 72.0344 26.0671C71.0141 26.4902 69.844 26.0061 69.4208 24.9857C68.2751 22.2227 66.7749 19.6427 64.9765 17.3024C64.3035 16.4266 64.4679 15.171 65.3437 14.4979ZM2.56297 31.3149C3.65827 31.4577 4.43035 32.4615 4.28748 33.5568C4.09791 35.0101 4 36.4931 4 38C4 39.5069 4.09791 40.9899 4.28748 42.4432C4.43035 43.5385 3.65826 44.5423 2.56297 44.6851C1.46768 44.828 0.463955 44.0559 0.321083 42.9606C0.109189 41.3362 0 39.6803 0 38C0 36.3197 0.109189 34.6638 0.321084 33.0394C0.463955 31.9441 1.46768 31.172 2.56297 31.3149ZM73.437 31.3149C74.5323 31.172 75.536 31.9441 75.6789 33.0394C75.8908 34.6638 76 36.3197 76 38C76 39.6803 75.8908 41.3362 75.6789 42.9606C75.536 44.0559 74.5323 44.828 73.437 44.6851C72.3417 44.5423 71.5696 43.5385 71.7125 42.4432C71.9021 40.9899 72 39.5069 72 38C72 36.4931 71.9021 35.0101 71.7125 33.5568C71.5696 32.4615 72.3417 31.4577 73.437 31.3149ZM3.96559 49.9329C4.98591 49.5098 6.15604 49.9939 6.57915 51.0143C7.72493 53.7773 9.22509 56.3573 11.0235 58.6976C11.6965 59.5734 11.5321 60.829 10.6563 61.5021C9.78044 62.1751 8.52483 62.0107 7.85178 61.1349C5.84286 58.5207 4.16578 55.6369 2.88425 52.5465C2.46114 51.5262 2.94527 50.356 3.96559 49.9329ZM72.0344 49.9329C73.0547 50.356 73.5389 51.5261 73.1158 52.5465C71.8342 55.6369 70.1571 58.5207 68.1482 61.1349C67.4752 62.0107 66.2196 62.1751 65.3437 61.5021C64.4679 60.829 64.3035 59.5734 64.9765 58.6976C66.7749 56.3573 68.2751 53.7773 69.4208 51.0143C69.844 49.9939 71.0141 49.5098 72.0344 49.9329ZM14.4979 65.3437C15.171 64.4679 16.4266 64.3035 17.3024 64.9765C19.6427 66.7749 22.2227 68.2751 24.9857 69.4208C26.0061 69.844 26.4902 71.0141 26.0671 72.0344C25.644 73.0547 24.4738 73.5389 23.4535 73.1158C20.3631 71.8342 17.4793 70.1571 14.8651 68.1482C13.9893 67.4752 13.8249 66.2196 14.4979 65.3437ZM61.5021 65.3437C62.1751 66.2196 62.0107 67.4752 61.1349 68.1482C58.5207 70.1571 55.6369 71.8342 52.5465 73.1158C51.5262 73.5389 50.356 73.0547 49.9329 72.0344C49.5098 71.0141 49.9939 69.844 51.0143 69.4208C53.7773 68.2751 56.3573 66.7749 58.6976 64.9765C59.5734 64.3035 60.829 64.4679 61.5021 65.3437ZM31.3149 73.437C31.4577 72.3417 32.4615 71.5696 33.5568 71.7125C35.0101 71.9021 36.4931 72 38 72C39.5069 72 40.9899 71.9021 42.4432 71.7125C43.5385 71.5696 44.5423 72.3417 44.6851 73.437C44.828 74.5323 44.0559 75.536 42.9606 75.6789C41.3362 75.8908 39.6803 76 38 76C36.3197 76 34.6638 75.8908 33.0394 75.6789C31.9441 75.536 31.172 74.5323 31.3149 73.437Z",fill:"white"})}),UF=()=>a("svg",{width:"76",height:"76",viewBox:"0 0 72 72",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a("path",{d:"M72 36C72 55.8823 55.8823 72 36 72C16.1177 72 0 55.8823 0 36C0 16.1177 16.1177 0 36 0C55.8823 0 72 16.1177 72 36Z",fill:"white"})}),GF=()=>a("svg",{width:"76",height:"76",viewBox:"0 0 76 76",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M56 4C57.1438 4 58.2574 4.1197 59.3298 4.34656C60.4105 4.57516 61.4718 3.88444 61.7004 2.80378C61.929 1.72313 61.2383 0.661766 60.1577 0.433161C58.8147 0.149073 57.4237 0 56 0C54.5848 0 53.2018 0.14731 51.8662 0.428123C50.7853 0.655401 50.0933 1.71592 50.3205 2.79685C50.5478 3.87778 51.6083 4.56981 52.6893 4.34253C53.7558 4.11828 54.863 4 56 4ZM20 4C21.137 4 22.2442 4.11828 23.3107 4.34253C24.3917 4.56981 25.4522 3.87779 25.6795 2.79685C25.9067 1.71592 25.2147 0.655402 24.1338 0.428123C22.7982 0.14731 21.4152 0 20 0C18.5763 0 17.1853 0.149073 15.8423 0.433161C14.7617 0.661766 14.0709 1.72313 14.2996 2.80378C14.5282 3.88444 15.5895 4.57516 16.6702 4.34656C17.7426 4.1197 18.8562 4 20 4ZM47.9261 3.78403C47.3268 2.8562 46.0887 2.58992 45.1609 3.18926C42.8227 4.69971 40.8203 6.68432 39.2892 9.00773C38.6814 9.93004 38.9364 11.1704 39.8587 11.7782C40.781 12.386 42.0214 12.1311 42.6292 11.2088C43.8552 9.3484 45.4593 7.75851 47.3313 6.54921C48.2592 5.94987 48.5255 4.71185 47.9261 3.78403ZM28.0739 3.78403C27.4745 4.71185 27.7408 5.94987 28.6687 6.54922C30.5407 7.75852 32.1448 9.3484 33.3708 11.2088C33.9786 12.1311 35.219 12.386 36.1413 11.7782C37.0636 11.1704 37.3186 9.93005 36.7108 9.00774C35.1797 6.68433 33.1773 4.69971 30.8391 3.18927C29.9113 2.58992 28.6732 2.8562 28.0739 3.78403ZM64.1282 3.81125C63.5257 4.73706 63.7879 5.97596 64.7137 6.57841C66.5924 7.80094 68.1991 9.4076 69.4216 11.2863C70.024 12.2121 71.2629 12.4743 72.1888 11.8718C73.1146 11.2694 73.3767 10.0305 72.7742 9.10464C71.2473 6.75819 69.2418 4.75265 66.8954 3.22575C65.9695 2.6233 64.7306 2.88544 64.1282 3.81125ZM11.8718 3.81125C11.2694 2.88544 10.0305 2.6233 9.10464 3.22575C6.75819 4.75265 4.75265 6.75819 3.22575 9.10464C2.6233 10.0305 2.88544 11.2694 3.81125 11.8718C4.73706 12.4743 5.97596 12.2121 6.57841 11.2863C7.80094 9.4076 9.4076 7.80094 11.2863 6.57841C12.2121 5.97596 12.4743 4.73706 11.8718 3.81125ZM38.0148 21.8353C36.9112 21.8439 36.0092 20.9569 35.9993 19.8533C35.9892 18.717 35.8608 17.611 35.6267 16.5463C35.3895 15.4675 36.0717 14.4007 37.1505 14.1634C37.4398 14.0998 37.7282 14.1023 38 14.1609C38.2718 14.1023 38.5602 14.0998 38.8495 14.1634C39.9283 14.4006 40.6105 15.4675 40.3733 16.5463C40.1392 17.611 40.0108 18.717 40.0007 19.8533C39.9909 20.9434 39.11 21.8246 38.0204 21.8352M73.1962 14.2996C72.1156 14.5282 71.4248 15.5895 71.6534 16.6702C71.8803 17.7426 72 18.8562 72 20C72 21.137 71.8817 22.2442 71.6575 23.3107C71.4302 24.3917 72.1222 25.4522 73.2031 25.6795C74.2841 25.9067 75.3446 25.2147 75.5719 24.1338C75.8527 22.7982 76 21.4152 76 20C76 18.5763 75.8509 17.1853 75.5668 15.8423C75.3382 14.7617 74.2769 14.0709 73.1962 14.2996ZM2.80379 14.2996C1.72313 14.071 0.661766 14.7617 0.433159 15.8423C0.149071 17.1853 0 18.5763 0 20C0 21.4237 0.149071 22.8147 0.433159 24.1577C0.661766 25.2383 1.72313 25.9291 2.80379 25.7004C3.88444 25.4718 4.57516 24.4105 4.34656 23.3298C4.1197 22.2574 4 21.1438 4 20C4 18.8562 4.1197 17.7426 4.34656 16.6702C4.57516 15.5895 3.88444 14.5282 2.80379 14.2996ZM38.0182 21.8353C38.0182 21.8353 38.0182 21.8353 38.0182 21.8353ZM38.0182 21.8353C38.0177 21.8353 38.0172 21.8353 38.0167 21.8353ZM38.0167 21.8353C38.0166 21.8353 38.0164 21.8353 38.0162 21.8353ZM72.216 28.0739C71.2881 27.4745 70.0501 27.7408 69.4508 28.6687C68.2415 30.5407 66.6516 32.1448 64.7912 33.3708C63.8689 33.9786 63.614 35.219 64.2218 36.1413C64.8296 37.0636 66.07 37.3186 66.9923 36.7108C69.3157 35.1797 71.3003 33.1773 72.8107 30.8391C73.4101 29.9113 73.1438 28.6732 72.216 28.0739ZM3.81125 28.1282C2.88544 28.7306 2.6233 29.9695 3.22575 30.8954C4.75266 33.2418 6.75819 35.2473 9.10464 36.7743C10.0305 37.3767 11.2694 37.1146 11.8718 36.1888C12.4743 35.2629 12.2121 34.024 11.2863 33.4216C9.4076 32.1991 7.80094 30.5924 6.57841 28.7137C5.97596 27.7879 4.73706 27.5257 3.81125 28.1282ZM61.8366 37.1505C61.5994 36.0717 60.5325 35.3895 59.4537 35.6267C58.389 35.8608 57.283 35.9892 56.1467 35.9993C55.0566 36.0091 54.1754 36.89 54.1648 37.9796C54.1647 37.9803 54.1647 37.981 54.1647 37.9818M61.8366 37.1505C61.9002 37.4398 61.8977 37.7282 61.8391 38ZM61.8391 38C61.8977 38.2718 61.9002 38.5602 61.8366 38.8495C61.5993 39.9283 60.5325 40.6105 59.4537 40.3733C58.389 40.1392 57.283 40.0108 56.1467 40.0007C55.0431 39.9908 54.1561 39.0888 54.1647 37.9852M54.1647 37.9838C54.1647 37.9833 54.1647 37.9829 54.1647 37.9824ZM21.9822 38.8386C21.883 39.0537 21.7454 39.2514 21.574 39.4213C21.195 39.7969 20.6816 40.0055 20.1481 40.0007L20.1086 40.0004C20.0971 40.0003 20.0856 40.0001 20.0741 39.9998C20.0626 40 20.051 40.0001 20.0395 40L20 40C18.8562 40 17.7426 40.1197 16.6702 40.3466C15.5895 40.5752 14.5282 39.8844 14.2996 38.8038C14.2417 38.5302 14.2427 38.2579 14.2941 38C14.2427 37.7421 14.2417 37.4698 14.2996 37.1962C14.5282 36.1156 15.5895 35.4248 16.6702 35.6534C17.7426 35.8803 18.8562 36 20 36L20.0395 36C20.051 35.9999 20.0626 36 20.0741 36.0002C20.0856 35.9999 20.0971 35.9997 20.1086 35.9996L20.1481 35.9993C20.6816 35.9945 21.195 36.2031 21.5739 36.5787C21.7373 36.7406 21.8699 36.9278 21.9679 37.1311C22.0674 37.3376 22.1312 37.5609 22.1553 37.7912C22.159 37.8272 22.1618 37.8633 22.1636 37.8995C22.165 37.9268 22.1658 37.9543 22.1661 37.9818M22.1631 38.1116C22.1488 38.3699 22.0855 38.6154 21.9822 38.8386ZM22.1631 38.1116C22.1651 38.0748 22.1661 38.0378 22.1661 38.0008C22.1661 38.0003 22.1661 37.9998 22.1661 37.9993C22.1661 37.9993 22.1661 37.9993 22.1661 37.9992C22.1661 37.9943 22.1661 37.9893 22.1661 37.9843C22.1661 37.9838 22.1661 37.9833 22.1661 37.9828C22.1661 37.9827 22.1661 37.9826 22.1661 37.9825M11.8718 39.8112C11.2694 38.8854 10.0305 38.6233 9.10464 39.2257C6.75819 40.7527 4.75266 42.7582 3.22575 45.1046C2.6233 46.0305 2.88544 47.2694 3.81125 47.8718C4.73706 48.4743 5.97596 48.2121 6.57841 47.2863C7.80094 45.4076 9.4076 43.8009 11.2863 42.5784C12.2121 41.976 12.4743 40.7371 11.8718 39.8112ZM64.2218 39.8587C63.614 40.781 63.8689 42.0214 64.7912 42.6292C66.6516 43.8552 68.2415 45.4593 69.4508 47.3313C70.0501 48.2592 71.2881 48.5254 72.216 47.9261C73.1438 47.3268 73.4101 46.0887 72.8107 45.1609C71.3003 42.8227 69.3157 40.8203 66.9923 39.2892C66.0699 38.6814 64.8296 38.9364 64.2218 39.8587ZM2.80379 50.2996C1.72313 50.0709 0.661766 50.7617 0.433159 51.8423C0.149071 53.1853 0 54.5763 0 56C0 57.4237 0.149071 58.8147 0.433159 60.1577C0.661766 61.2383 1.72313 61.9291 2.80379 61.7004C3.88444 61.4718 4.57516 60.4105 4.34656 59.3298C4.1197 58.2574 4 57.1438 4 56C4 54.8562 4.1197 53.7426 4.34656 52.6702C4.57516 51.5895 3.88444 50.5282 2.80379 50.2996ZM73.2031 50.3205C72.1222 50.5478 71.4302 51.6083 71.6575 52.6893C71.8817 53.7558 72 54.863 72 56C72 57.1438 71.8803 58.2574 71.6534 59.3298C71.4248 60.4105 72.1156 61.4718 73.1962 61.7004C74.2769 61.9291 75.3382 61.2383 75.5668 60.1577C75.8509 58.8147 76 57.4237 76 56C76 54.5848 75.8527 53.2018 75.5719 51.8662C75.3446 50.7853 74.2841 50.0933 73.2031 50.3205ZM36.5787 54.426C36.2031 54.805 35.9945 55.3184 35.9993 55.8519L35.9996 55.8914C35.9997 55.9029 35.9999 55.9144 36.0002 55.9259C36 55.9374 35.9999 55.949 36 55.9605L36 56C36 57.1438 35.8803 58.2574 35.6534 59.3298C35.4248 60.4105 36.1156 61.4718 37.1962 61.7004C37.4698 61.7583 37.7421 61.7573 38 61.7059C38.2579 61.7573 38.5302 61.7583 38.8038 61.7004C39.8844 61.4718 40.5752 60.4105 40.3466 59.3298C40.1197 58.2574 40 57.1438 40 56L40 55.9605C40.0001 55.949 40 55.9374 39.9998 55.9259C40.0001 55.9144 40.0003 55.9029 40.0004 55.8914L40.0007 55.8519C40.0055 55.3184 39.7969 54.805 39.4213 54.4261C39.2594 54.2627 39.0722 54.1301 38.8689 54.0321C38.6596 53.9313 38.4332 53.8671 38.1996 53.8438C38.1395 53.8378 38.079 53.8345 38.0182 53.8339L38.0175 53.8339M36.5787 54.426C36.7486 54.2546 36.9463 54.117 37.1614 54.0178ZM37.1614 54.0178C37.3717 53.9208 37.5986 53.8604 37.8322 53.8408C37.8875 53.8362 37.9433 53.8339 37.9992 53.8339M72.1888 64.1282C71.2629 63.5257 70.024 63.7879 69.4216 64.7137C68.1991 66.5924 66.5924 68.1991 64.7137 69.4216C63.7879 70.024 63.5257 71.2629 64.1282 72.1888C64.7306 73.1146 65.9695 73.3767 66.8954 72.7742C69.2418 71.2473 71.2473 69.2418 72.7743 66.8954C73.3767 65.9695 73.1146 64.7306 72.1888 64.1282ZM39.8112 64.1282C38.8854 64.7306 38.6233 65.9695 39.2257 66.8954C40.7527 69.2418 42.7582 71.2474 45.1046 72.7742C46.0305 73.3767 47.2694 73.1146 47.8718 72.1888C48.4743 71.2629 48.2121 70.024 47.2863 69.4216C45.4076 68.1991 43.8009 66.5924 42.5784 64.7137C41.976 63.7879 40.7371 63.5257 39.8112 64.1282ZM36.1888 64.1282C35.2629 63.5257 34.024 63.7879 33.4216 64.7137C32.1991 66.5924 30.5924 68.1991 28.7137 69.4216C27.7879 70.024 27.5257 71.2629 28.1282 72.1888C28.7306 73.1146 29.9695 73.3767 30.8954 72.7742C33.2418 71.2474 35.2473 69.2418 36.7743 66.8954C37.3767 65.9695 37.1146 64.7306 36.1888 64.1282ZM3.81125 64.1282C2.88544 64.7306 2.6233 65.9695 3.22575 66.8954C4.75265 69.2418 6.75819 71.2473 9.10464 72.7742C10.0305 73.3767 11.2694 73.1146 11.8718 72.1888C12.4743 71.2629 12.2121 70.024 11.2863 69.4216C9.4076 68.1991 7.80094 66.5924 6.57841 64.7137C5.97596 63.7879 4.73706 63.5257 3.81125 64.1282ZM61.7004 73.1962C61.4718 72.1156 60.4105 71.4248 59.3298 71.6534C58.2574 71.8803 57.1438 72 56 72C54.8562 72 53.7426 71.8803 52.6702 71.6534C51.5895 71.4248 50.5282 72.1156 50.2996 73.1962C50.071 74.2769 50.7617 75.3382 51.8423 75.5668C53.1853 75.8509 54.5763 76 56 76C57.4237 76 58.8147 75.8509 60.1577 75.5668C61.2383 75.3382 61.9291 74.2769 61.7004 73.1962ZM25.7004 73.1962C25.4718 72.1156 24.4105 71.4248 23.3298 71.6534C22.2574 71.8803 21.1438 72 20 72C18.8562 72 17.7426 71.8803 16.6702 71.6534C15.5895 71.4248 14.5282 72.1156 14.2996 73.1962C14.0709 74.2769 14.7617 75.3382 15.8423 75.5668C17.1853 75.8509 18.5763 76 20 76C21.4237 76 22.8147 75.8509 24.1577 75.5668C25.2383 75.3382 25.9291 74.2769 25.7004 73.1962Z",fill:"white"})}),jF=()=>a("svg",{width:"76",height:"76",viewBox:"0 0 72 72",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M36.0007 17.8353C36.0891 7.97004 44.1138 0 54 0C63.9411 0 72 8.05887 72 18C72 27.8862 64.03 35.9109 54.1647 35.9993C54.1647 35.9998 54.1646 36.0002 54.1646 36.0007C64.03 36.0891 72 44.1138 72 54C72 63.9411 63.9411 72 54 72C44.0589 72 36 63.9411 36 54C36 63.9411 27.9411 72 18 72C8.05888 72 0 63.9411 0 54C0 44.0589 8.05888 36 18 36C8.05888 36 0 27.9411 0 18C0 8.05887 8.05888 0 18 0C27.8862 0 35.9109 7.97005 35.9993 17.8354C35.9998 17.8354 36.0002 17.8353 36.0007 17.8353ZM18.1661 35.9992C18.1108 35.9997 18.0554 36 18 36C18.0554 36 18.1108 36.0003 18.1661 36.0008C18.1661 36.0003 18.1661 35.9997 18.1661 35.9992ZM35.9992 53.8339C35.9997 53.8892 36 53.9446 36 54C36 53.9446 36.0003 53.8892 36.0008 53.8339C36.0003 53.8339 35.9997 53.8339 35.9992 53.8339Z",fill:"white"})});function g8({modalStatus:e,onClose:o,onStart:t,onEnd:r}){let[i,n]=(0,Rn.useState)(!1),[s,l]=(0,Rn.useState)(e),{togglePanel:c}=(0,Rn.useContext)(Ct),[d,p]=(0,Rn.useState)(!1),[m,u]=(0,Rn.useState)(!1),g=Ht();(0,Rn.useEffect)(()=>{l(e)},[e]);let h=s!=="unshow"&&s!=="unshowWithTooltip";if(!h)return null;let b=async(E,A="tour")=>{try{n(!0),await t(E,A)}finally{n(!1)}},x=()=>{switch(s){case"closing":g.started?gi("unshow"):gi("start");break;case"start":g.step?gi("closing"):r();break;default:r()}},S=()=>{let E=g.tourType==="pro"?"helpTourProLeave":"helpTourLeave";se(E,{step:g.step}),g.started?r():o()},y=()=>{r()},C=()=>{r(!1,!0),b("pro","hidden")},P=()=>{c("help",!1),r(!0)},v=a(f,{display:"flex",alignItems:"center",justifyContent:"center",width:64,height:64,borderRadius:"50%",backgroundColor:V.blue,children:a(Fv,{color:V.white,width:39,height:28})}),T=()=>{switch(s){case"start":return`Get familiar with Readymag's
 toolbox on a step-by-step
 project in 10 minutes`;case"closing":return"Leaving the tour for now?";default:return"Congratulations!"}},R=()=>{switch(s){case"start":return`You\u2019ll go through the main steps
of crafting and publishing a
web page in just 5 minutes.`;case"closing":return`If you ever wish to revisit or need
guidance on specific features, the '?'
panel in project settings is always
there to help`;default:return g.tourType==="default"?`You can finish the basic tour now
or continue grasping more features
in the advanced one`:`Now you know how to set up
a project of your own. If you have any
questions, click on the Help section
for a wide knowledge base`}},I=()=>s==="closing"?a(f,{marginTop:24,display:"flex",flexDirection:"column",children:i?a(mt,{bgColor:"transparent"}):w(q,{children:[a(_p,{disabled:i,variant:"clean",backgroundColor:"#0A85FF",onClick:x,children:"Resume tour"}),a(_p,{disabled:i,variant:"clean",backgroundColor:"rgba(255, 255, 255, 0.1)",onClick:S,marginTop:"4rm",children:"Explore on my own"})]})}):a(f,{marginTop:s==="start"?24:32,display:"flex",flexDirection:"column",children:s==="start"?w(f,{display:"flex",justifyContent:"space-between",width:336,children:[w(m8,{disabled:i,backgroundColor:"#00A882",onClick:()=>{b("default")},onMouseEnter:()=>{p(!0)},onMouseLeave:()=>{p(!1)},children:[a(f,{marginBottom:16,children:d?a(UF,{}):a(VF,{})}),a(ve,{fontSize:16,marginBottom:4,children:"Just basics"}),w(ve,{fontSize:12,textAlign:"center",children:["Learn how to add ",a("br",{})," and tune essential ",a("br",{})," widgets, arrange ",a("br",{})," the layout for desktop ",a("br",{})," ","and mobile"]})]}),w(m8,{disabled:i,backgroundColor:V.blue,onClick:()=>{b("pro")},onMouseEnter:()=>{u(!0)},onMouseLeave:()=>{u(!1)},children:[a(f,{marginBottom:16,children:m?a(jF,{}):a(GF,{})}),a(ve,{fontSize:16,marginBottom:4,children:"A bit more"}),w(ve,{fontSize:12,textAlign:"center",children:["Go deeper into the ",a("br",{})," features: work further ",a("br",{})," with grids, add ",a("br",{})," animations and ",a("br",{})," ","navigation elements"]})]})]}):g.tourType==="pro"?w(q,{children:[a(_p,{disabled:i,variant:"clean",backgroundColor:"#0A85FF",onClick:y,children:"Start own journey"}),a(_p,{marginTop:"4rm",disabled:i,variant:"clean",backgroundColor:"rgba(255, 255, 255, 0.1)",onClick:P,children:"Learn further with us"})]}):w(q,{children:[a(_p,{disabled:i,variant:"clean",backgroundColor:"#0A85FF",onClick:C,children:"Start advanced tour"}),a(_p,{marginTop:"4rm",disabled:i,variant:"clean",backgroundColor:"rgba(255, 255, 255, 0.1)",onClick:y,children:"Set off on my own journey"})]})}),M=!g.started&&s==="closing"?()=>null:x,D=g.started||s!=="closing";return w(qn,{underlayStyles:{backdropFilter:"blur(5px)"},showCloseButton:D,show:h,onExit:M,children:[s==="end"&&v,a(ve,{id:"help-tour-title",display:"flex",alignItems:"center",textAlign:"center",whiteSpace:"pre-wrap",fontSize:24,height:s==="end"?"auto":88,margin:s==="end"?"32px 0 12px":"auto",color:V.white,lineHeight:"6rm",children:T()}),s!=="start"&&a(ve,{id:"help-tour-text",display:"flex",alignItems:"center",textAlign:"center",whiteSpace:"pre-wrap",fontSize:16,height:s==="end"?"auto":62,color:V.gray,children:R()}),I()]})}vt();Bh();var ih=B(H());pr();Be();function h8(e){setTimeout(()=>{window?.RM?.constructorRouter?.trigger("notice:triggerMetrics",e)},700)}function f8(){let{me:{behavior_metrics:e},project:o}=(0,ih.useContext)(ce);return(0,ih.useEffect)(()=>{let t=e?.initial_onboarding_type;t==="blank"&&h8("helpTourSkipped"),t==="templates"&&!o.template_num&&h8("newProjectAfterTemplatesOnboarding")},[]),null}Be();Mh();yr();k();var qF=e=>({template:e.page_id,specialScreenshot:e.thumb}),nh=()=>{let e=(0,zn.useContext)(Ee),o=(0,zn.useContext)(ce),[{modalStatus:t}]=el(),r=vp();f8(),(0,zn.useEffect)(()=>{e.currentOnboardingType==="tour"&&gi("start"),e.currentOnboardingType==="templates"&&Rh("templates",{headlessMode:!0})},[e.currentOnboardingType]);let i=(0,zn.useCallback)((d,p)=>{let{step:m,totalSteps:u,modalStatus:g}=Ht();S0(),d?gi("unshowWithTooltip"):gi("unshow"),e.dispatch({type:"setOnboardingType",onboardingType:"hidden"}),!p&&(g==="closing"&&Ge("constructor.onboardingSurveyProductTourIncomplete")&&m&&m.num>=5&&m.num<u?r("How well did the product tour help you get started?"):g==="end"&&Ge("constructor.onboardingSurveyProductTourComplete")&&r("How well did the product tour help you get started?"))},[e,r]),n=(0,zn.useCallback)(()=>{i()},[i]),s=async d=>{if(d?.templates?.length)for(let p=0;p<d.templates.length;p++){let m=o.pages.length+1;await o.addNewPage(m,qF(d.templates[p]))}},l=async d=>{let p=o.pages.length,m=o.me.plan_limits?.pages_per_mag;if(!m)return;let u=p+d-m;if(u>0){let g=o.pages.slice(-u).map(h=>h._id);for(let h of g)await o.deletePage(h)}},c=(0,zn.useCallback)(async(d,p="tour")=>{try{let m=await g0(d),u=m?.templates?.length||0;await l(u),await s(m),e.dispatch({type:"setOnboardingType",onboardingType:p}),Rh(d)}catch{gi("unshow")}},[s,e]);return a(g8,{modalStatus:t,onClose:n,onStart:c,onEnd:i})};var Bi=B(H());So();N();oe();Jt();jt();k();var YF=F(f,{excludeProps:["isVisible"]})`
  z-index: 3000;
  position: relative;
  transition: opacity 0.3s ease, transform 0.3s ease;
  opacity: ${e=>e.isVisible?1:0};
  transform: translateY(${e=>e.isVisible?"0":"2px"});
`;function XF(e){if(!(e.target instanceof HTMLElement))return!1;let o=e.target;return!!(o.tagName.toLowerCase()==="input"||o.dataset&&o.dataset.text||o.tagName.toLowerCase()==="textarea"&&!o.classList.contains("copyhack")||o.getAttribute("contenteditable"))}var Jw=30;function KF(e,o){return Math.abs(o.x-e.x)>=Jw||Math.abs(o.y-e.y)>=Jw}function b8({children:e,scrollGap:o}){let{viewport:t}=(0,Bi.useContext)(qe),[r,i]=(0,Bi.useState)(!0),[n]=uy(),s=(0,Bi.useRef)(0).current,l=(0,Bi.useRef)(0).current,c=(0,Bi.useRef)({x:0,y:0}).current,d=!!n.name;return t==="phone_portrait"&&(d=!0),(0,Bi.useEffect)(()=>{d&&i(!0);let p=document.getElementById("main"),m=xh(()=>{if(!p)return;let g=p.scrollTop;g>l||(s=g);let b=g-s;Math.abs(g-l)>50&&i(!(b>o)),l=g},200),u=xh(g=>{let h={x:g.clientX,y:g.clientY},b=Math.sqrt(Math.pow(h.x-c.x,2)+Math.pow(h.y-c.y,2));KF(c,h)&&b>=Jw&&i(!0),c=h},100);return d||(p?.addEventListener("scroll",m,!1),document.addEventListener("mousemove",u,!1)),()=>{p?.removeEventListener("scroll",m,!1),document.removeEventListener("mousemove",u,!1)}},[d]),(0,Bi.useEffect)(()=>{function p(u){r||u.key!=="Tab"||XF(u)||(u.preventDefault(),u.stopPropagation(),i(!0))}let m=document.querySelector("body");return d||m.addEventListener("keydown",p),()=>{m.removeEventListener("keydown",p)}},[r,d]),a(YF,{isVisible:r,children:e})}Ir();var $a=B(H());oe();N();fe();$e();Fo();vu();Ve();Be();Ws();var w8=e=>Zt.put(`/api/support/project/${e}/revoke`,{}),x8=e=>Zt.put(`/api/support/project/${e}/accept`,{}),v8=e=>Zt.get(`/api/support/validate?token=${e}`);k();var y8=F(ge)`
  display: flex;
  justify-content: center;
  align-items: center;

  width: 244px;
  height: 56px;

  border-radius: 8px;

  color: ${({theme:e})=>e.colors.white};
`;function k8(e){let[o,t]=(0,$a.useState)(!1),[r,i]=(0,$a.useState)(!1),{project:n}=(0,$a.useContext)(ce);(0,$a.useEffect)(()=>{e.token&&(async()=>(await v8(e.token)).isSupportTokenValid&&t(!0))()},[e.token]);let s=async()=>{try{i(!0),await w8(n.num_id)}finally{i(!1),t(!1)}},l=async()=>{try{i(!0),await x8(n.num_id)}catch(c){console.error("Error allowing support access",c)}finally{i(!1),t(!1)}};return w(qn,{underlayStyles:{backdropFilter:"blur(5px)"},showCloseButton:!0,wrapperProps:{width:"364px"},show:o,onExit:()=>t(!1),children:[a(ve,{id:"request-support-modal-title",display:"flex",alignItems:"center",textAlign:"center",whiteSpace:"pre-wrap",fontSize:24,height:"auto",marginBottom:"3rm",color:V.white,lineHeight:"6rm",children:`Allow Readymag support team access to project ${n.title||"Project"}?`}),a(ve,{id:"request-support-modal-text",display:"flex",alignItems:"center",textAlign:"center",whiteSpace:"pre-wrap",fontSize:16,height:"auto",color:V.gray,marginTop:"8px",children:`This account will retain access for
72 hours only.`}),a(f,{marginTop:"40px",display:"flex",flexDirection:"column",children:r?a(mt,{bgColor:"transparent"}):w(q,{children:[a(y8,{disabled:r,variant:"clean",backgroundColor:"#0A85FF",onClick:l,children:"Allow"}),a(y8,{marginTop:"4rm",disabled:r,variant:"clean",backgroundColor:"rgba(255, 255, 255, 0.1)",onClick:s,children:"Deny"})]})})]})}var ni=B(H());Li();oe();N();fe();Vr();Fo();yI();Wr();var S8=B(H());oe();var sh=B(H()),ZF=e=>{let[o,t]=(0,sh.useState)(!1),r=n=>{n.key===e&&t(!0)},i=n=>{n.key===e&&t(!1)};return(0,sh.useEffect)(()=>(window.addEventListener("keydown",r),window.addEventListener("keyup",i),()=>{window.removeEventListener("keydown",r),window.removeEventListener("keyup",i)}),[]),o},_8=ZF;k();var JF=Dt(F("div")({position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(5px)",zIndex:1e4})),QF=Dt(F("div")({position:"fixed",top:"50%",left:"50%",zIndex:10001}));function C8({onClose:e,isOpen:o,children:t}){let r=_8("Escape");(0,S8.useEffect)(()=>{r&&e?.()},[r]);function i(n){n.stopPropagation(),e?.()}return a(No,{children:o&&w(q,{children:[a(JF,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i}),a(QF,{initial:{opacity:0,y:"-50%",x:"-50%"},animate:{opacity:1,y:"-50%",x:"-50%"},exit:{opacity:0},transition:{type:"spring",duration:.5},children:t})]})})}Be();var P8=B(pt()),T8=B(H());Li();oe();fe();N();$e();k();var eN=F(Ue)`
  user-select: none;

  display: flex;
  align-items: center;

  height: 40px;

  background-color: ${({theme:e,active:o})=>o?Me(e.colors.gray,.16):"transparent"};
  padding: 8px 12px 8px 12px;
  border-radius: 8px;
  text-align: left;

  &:hover > span {
    color: ${({theme:e})=>e.colors.tomato};
  }
`,tN=F(f)`
  user-select: none;
  padding: 8px 12px 8px 12px;
  text-align: left;
`;function I8({versions:e,selectedVersion:o,onVersionClick:t}){let r=(0,T8.useMemo)(()=>P8.default.groupBy(e,({metadata:s})=>s.category),[]),i=Object.keys(r),n=!i.every(s=>s==="older");return a(f,{display:"flex",flexDirection:"column",children:i.map(s=>{let l=r[s];return l?.length?w(f,{children:[n?a(tN,{children:a(ve,{fontSize:"3rm",color:"gray",fontWeight:500,children:j1(s)})}):null,a(f,{display:"flex",flexDirection:"column",children:l.map(c=>a(eN,{active:o._id===c._id,variant:"clean",onClick:()=>t(c._id),children:w(ve,{color:"black",fontSize:"3rm",fontWeight:500,children:[c.metadata.formatedDate," ",c.metadata.titlePostfix?a(ve,{as:"span",fontSize:"3rm",fontWeight:500,color:"gray",children:c.metadata.titlePostfix}):null]})},c._id))})]},s):null})})}var Ha=B(H());Wr();oe();N();N();N();fe();var gd=B(H());oe();oe();N();fe();k();var oN=F("img")`
  border-radius: 8px;
  height: 100%;
  width: 100%;
  object-fit: contain;
`,rN=F(f)`
  display: flex;
  justify-content: center;
  align-items: center;

  overflow: hidden;

  border-radius: 8px;
  height: auto;

  border: 2px solid ${e=>e.borderColor};
`;function M8({page:e,screenshotProps:o}){let[t,r]=(0,gd.useState)(!1),[i,n]=(0,gd.useState)(!0),s=e.screenshots[o.viewport],l=(0,gd.useMemo)(()=>e.enabledViewports?!e.enabledViewports.includes(o.viewport):!1,[o.viewport]),d=l||(!s||t);function p(){r(!0)}function m(){n(!1)}return a(rN,{borderColor:d?Me("gray",.16):"transparent",backgroundColor:i&&!d?Me("gray",.16):"transparent",width:o.width,aspectRatio:o.aspectRatio,children:d?a(ve,{fontSize:"4rm",color:"gray",textAlign:"center",padding:"4rm",children:l?`Page is
not available in
this
version`:`Screenshot is
not available in
this
version`}):a(oN,{src:s,onError:p,onLoad:m,loading:"lazy"})})}k();function iN(e,o){return o?.order?`${o.parent}.${o.order}`:o?.parent||e}function B8({page:e,screenshotProps:o}){let{path:t,num:r}=e;return w(f,{userSelect:"none",pointerEvents:"none",children:[a(M8,{page:e,screenshotProps:o}),a(f,{margin:"1rm",marginLeft:"0.5rm",children:w(ve,{color:"gray",fontSize:"3rm",fontWeight:500,children:["Page ",iN(r,t)]})})]})}k();function hd({version:e,screenshotProps:o}){return a(f,{display:"flex",flexDirection:"column",gap:"2rm",children:e.pages?.map(t=>a(B8,{page:t,screenshotProps:o},`${e._id}-${t.num}`))})}N();k();function Qw({version:e,screenshotProps:o,onClick:t,...r}){return e?a(f,{position:"absolute",opacity:"0.3",cursor:"pointer",onClick:t,...r,children:a(hd,{version:e,screenshotProps:o})}):null}var nN={default:{2:"112rm",1:"72rm",0:"48rm"},phone_portrait:{2:"60rm",1:"40rm",0:"30rm"}},sN={default:"3/2",phone_portrait:"320/568"};function R8({size:e,viewport:o}){return{viewport:o,aspectRatio:sN[o],width:nN[o][e]}}k();var aN=Dt(F("div")({display:"flex",flex:1,flexDirection:"column",alignItems:"center",overflow:"hidden",width:"512px",padding:"64px 0 32px 0"}));function z8({children:e}){return a(No,{children:a(aN,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut",duration:.2},children:e})})}function lN({versions:e,selectedVersion:o,currentViewport:t,currentTileSize:r,onVersionChange:i}){let n=(0,Ha.useCallback)(()=>{i(o-1)},[o]),s=(0,Ha.useCallback)(()=>{i(o+1)},[o]),l=(0,Ha.useMemo)(()=>R8({size:r,viewport:t}),[r,t]);return r===2?a(z8,{children:a(hd,{version:e[o],screenshotProps:l})},`${o}-${t}-${r}`):a(z8,{children:w(f,{display:"flex",gap:"40px",position:"relative",children:[a(Qw,{version:e[o-1],screenshotProps:l,onClick:n,left:"calc(-100% - 40px)"}),a(hd,{version:e[o],screenshotProps:l}),a(Qw,{version:e[o+1],screenshotProps:l,onClick:s,left:"calc(100% + 40px)"})]})},`${o}-${t}-${r}`)}var E8=(0,Ha.memo)(lN);N();oe();k();function A8({children:e}){return a(f,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",width:"16rm",paddingTop:"6rm",paddingBottom:"6rm",border:"1px solid",borderRight:"0px",borderTopLeftRadius:"4rm",borderBottomLeftRadius:"4rm",borderColor:Me("gray",.16),children:e})}function L8({children:e}){return a(f,{width:"72rm",height:"100%",display:"flex",flexDirection:"column",paddingTop:"5rm",paddingBottom:"4rm",backgroundColor:"white",overflow:"hidden",children:e})}Li();N();jh();$e();k();var pN=F(ge)`
  border-radius: 4px;
  height: 48px;
  width: 48px;

  display: flex;
  justify-content: center;
  align-items: center;

  &:hover {
    background-color: #333333;
  }
`,cN=F(f)`
  position: fixed;

  display: flex;
  align-items: center;
  justify-content: space-between;

  background: ${({theme:e})=>`linear-gradient(180deg, ${e.colors.black}, transparent)`};
  backdrop-filter: blur(1px);

  padding: 8px 18px;

  z-index: 1000;
`;function D8({type:e,onClick:o,hidden:t}){return a(pN,{visibility:t?"hidden":"visible",variant:"clean",onClick:o,children:a(Ys,{width:"8rm",height:"6rm",color:"gray",transform:e==="left"?"rotate(0deg)":"rotate(180deg)"})})}function O8({total:e,current:o,onChange:t,children:r}){function i(){t(o-1)}function n(){t(o+1)}return w(cN,{width:"132.5rm",children:[a(D8,{hidden:o===0,type:"left",onClick:i}),r,a(D8,{hidden:o===e,type:"right",onClick:n})]})}var V8=B(H());Li();N();var lh=B(H());je();oe();N();fe();$e();Li();$e();fe();Fo();k();var dN=F(Ue)`
  display: flex;
  align-items: center;
  justify-content: center;

  height: 40px;
  border-radius: 8px;

  user-select: none;

  &:hover,
  &:disabled {
    opacity: 0.8;
  }
`;function ah({status:e,color:o,backgroundColor:t,borderColor:r,onClick:i,children:n,...s}){let[l,c]=[e==="pending",e==="error"];return a(dN,{variant:"unstyled",disabled:l||c,color:o,backgroundColor:t,border:"1px solid",borderColor:r,onClick:i,...s,children:l?a(mt,{color:o,bgColor:"transparent"}):c?a(ve,{fontSize:"3rm",fontWeight:500,children:"Error"}):a(ve,{fontSize:"3rm",fontWeight:500,children:n})})}Ux();k();function uN({version:e,show:o,onConfirm:t,onCancel:r}){return o?a(f,{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:0,left:0,zIndex:1e4,width:"100%",height:"100%",borderRadius:"4rm",backgroundColor:"black",children:w(f,{width:"72rm",display:"flex",gap:"2rm",flexDirection:"column",children:[w(ve,{color:"white",fontSize:"6rm",fontWeight:"500",lineHeight:"24px",children:["Are you sure you want to restore the version from ",U1(e.createdDate),"?"]}),a(ve,{color:"gray",fontSize:"3rm",fontWeight:"500",lineHeight:"16px",children:"The action cannot be undone, but the current state will be saved and you will be able to restore it later. The restoring may take up to 60 sec."}),w(f,{display:"flex",marginTop:"2rm",gap:"4rm",children:[a(Ue,{color:"tomato",fontSize:"6rm",fontWeight:"500",onClick:r,children:"No, go back"}),a(Ue,{color:"white",fontSize:"6rm",fontWeight:"500",onClick:t,children:"Yes"})]})]})}):null}function $8({selectedVersion:e}){let{setStatus:o,status:t}=Id(),[r,i]=(0,lh.useState)(!1);(0,lh.useEffect)(()=>{o("idle")},[e]);async function n(){try{o("pending");let{id:s}=await N1(e.projectNumId,e._id);window.RM.constructorRouter.sockets.startProjectRestore({restoreId:s}),kl({show:!0,jobId:s}),o("success"),se("versionHistory",{action:"restore version",age:Qu(e.createdDate)})}catch{o("error")}}return w(q,{children:[a(uN,{version:e,show:r,onCancel:()=>i(!1),onConfirm:n}),a(ah,{status:t,variant:"secondary",color:"black",backgroundColor:"white",borderColor:Me("gray",.24),onClick:()=>i(!0),children:"Restore this version"})]})}var Cp=B(H());je();Ux();var H8=B(H());Fp();function F8(e,o=[]){let t=(0,H8.useRef)();return Bd((...r)=>(t.current&&!t.current?.signal.aborted&&t.current.abort(),t.current=new AbortController,e(t.current?.signal)(...r)),[o])}Ws();async function N8(e){return await Zt.get(`/api/jobs/${e}/status`)}var mN=["complete","unknown"],Sp=class{constructor({interval:o=2e3}={}){z(this,"intervalId",null);z(this,"interval");this.interval=o}async pollJob(o,t,r){try{let{status:i}=await N8(o);if(mN.includes(i))return t(),!1;if(i==="failed")return r(),!1}catch{return r(),!1}return!0}async start(o){if(!o)throw new Error("Job ID is required");if(this.intervalId)throw new Error("Polling is already in progress");return new Promise((t,r)=>{let i=async()=>{await this.pollJob(o,t,r)||this.stop()};this.intervalId=setInterval(i,this.interval)})}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}isPolling(){return!!this.intervalId}};st();k();function W8({selectedVersion:e}){let{setStatus:o,status:t}=Id(),[r]=(0,Cp.useState)(()=>new Sp),[i,n]=(0,Cp.useState)(null);(0,Cp.useEffect)(()=>{n(null),o("idle"),r.stop()},[e]),(0,Cp.useEffect)(()=>function(){r.stop()},[]);let s=F8(c=>async()=>{try{o("pending");let{id:d}=await W1(e.projectNumId,e._id,{signal:c});await r.start(d);let{projectId:p}=await V1(e.projectNumId,{signal:c});n(p),o("success"),se("versionHistory",{action:"make a copy",age:Qu(e.createdDate)})}catch{o("error")}},[i,e]);function l(){window.open(`${le.readymag_auth_host}/edit/${i}`,"_blank")}return a(ah,{status:t,color:"white",backgroundColor:"tomato",onClick:i?l:s,children:i?"Open a copy":"Make a copy"})}k();var gN=F(f)`
  display: flex;
  flex-direction: column;
  margin: 0 24px;
  gap: 8px;
`,hN=F(f)`
  position: relative;

  ::before {
    content: '';
    position: absolute;
    top: -36px;
    left: 0;
    right: 0;
    height: 36px;
    background: linear-gradient(transparent, #fff);
    pointer-events: none;
  }
`,U8=(0,V8.memo)(({selectedVersion:e})=>w(gN,{children:[a(hN,{}),a(W8,{selectedVersion:e}),a($8,{selectedVersion:e})]}));var G8=B(H());Li();$e();k();var fN=F(ge)`
  color: ${({theme:e})=>e.colors.gray};

  &:hover {
    color: ${({theme:e})=>e.colors.white};
  }
`,j8=(0,G8.memo)(({type:e,onToggle:o})=>{function t(){o(e==="phone_portrait"?"default":"phone_portrait")}return a(fN,{variant:"unstyled",onClick:t,children:a($u,{type:e})})});var Y8=B(H()),X8=B(H());Li();N();$e();k();var bN=F(f)`
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
`,q8=F(Ue)`
  color: ${({theme:e})=>e.colors.darkGray};

  &:hover {
    color: ${({theme:e})=>e.colors.gray};
  }
`;function wN(){return a("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a("g",{children:a("path",{d:"M8 12C8 10.8954 8.89543 10 10 10H22C23.1046 10 24 10.8954 24 12V20C24 21.1046 23.1046 22 22 22H10C8.89543 22 8 21.1046 8 20V12Z",fill:"currentColor"})})})}function xN(){return a("svg",{width:"32",height:"24",viewBox:"0 0 32 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:w("g",{children:[a("rect",{x:"5",y:"8",width:"10",height:"8",rx:"1",fill:"currentColor"}),a("rect",{x:"17",y:"8",width:"10",height:"8",rx:"1",fill:"currentColor"})]})})}var vN=F("input")`
  appearance: none;
  cursor: pointer;
  position: absolute;

  // It's a hack to get native vertical range input, because 'appearance: slider-vertical'
  // don't allow to set custom styles
  transform: rotate(-90deg);
  transform-origin: 50% 50%;

  background: ${({theme:e})=>e.colors.gray};

  // Should be here because 'transform' will override height :(
  width: 100px;
  height: 1px;

  &::-webkit-slider-thumb {
    appearance: none;
    width: 13px;
    height: 13px;
    background: ${({theme:e})=>e.colors.black};
    border-radius: 50%;
    border: 2px solid ${({theme:e})=>e.colors.gray};
    cursor: ns-resize;
    transition: background-color 0.3s ease;
  }

  &::-webkit-slider-thumb:hover {
    background: ${({theme:e})=>e.colors.gray};
  }

  &::-webkit-slider-thumb:active {
    cursor: grabbing;
  }
`,K8=(0,Y8.memo)(({defaultSize:e=2,maxSize:o=2,minSize:t=0,onSizeChange:r})=>{let[i,n]=(0,X8.useState)(e);function s(p){n(parseInt(p.target.value))}function l(){r(i)}function c(){i!==o&&(n(i+1),r(i+1))}function d(){i!==t&&(n(i-1),r(i-1))}return w(f,{display:"flex",flexDirection:"column",gap:"0.5rm",children:[a(q8,{disabled:i===o,variant:"unstyled",onClick:c,"aria-label":"Increase tile size",children:a(wN,{})}),a(bN,{height:"25rm",children:a(vN,{type:"range",value:i,min:t,max:o,step:1,onChange:s,onMouseUp:l})}),a(q8,{disabled:i===t,variant:"unstyled",onClick:d,"aria-label":"Decrease tile size",children:a(xN,{})})]})});k();var yN=F(f)`
  padding: 0 32px;
  position: relative;

  ::after {
    content: '';
    position: absolute;
    bottom: -24px;
    left: 0;
    right: 0;
    height: 24px;
    background: linear-gradient(#fff, transparent);
    pointer-events: none;
    z-index: 10;
  }
`;function kN(){return w(f,{display:"flex",justifyContent:"space-between",userSelect:"none",children:[a(ve,{color:"black",fontWeight:500,fontSize:"6rm",letterSpacing:"-0.16px",children:"Version history"}),a(Ce,{display:"flex",marginRight:"2rm",target:"_blank",href:"https://help.readymag.com/hc/en-us/articles/33666976895643/",children:a(Yv,{color:"gray",width:"2rm"})})]})}function _N({versionsPerProject:e}){return w(f,{flexDirection:"column",marginTop:"2rm",userSelect:"none",children:[w(ve,{color:"black",fontSize:"3rm",lineHeight:"16px",fontWeight:500,children:["Up to ",e," snapshots per project available."]})," ",a(Ce,{href:"/settings#change-plan",target:"_blank",lineHeight:"16px",fontSize:"3rm",color:"tomato",children:"Upgrade for more"})]})}function SN({children:e}){return a(f,{display:"flex",flexDirection:"row",justifyContent:"space-between",overflow:"hidden",height:"144rm",width:"220rm",backgroundColor:"black",borderRadius:"4rm",onClick:o=>o.stopPropagation(),children:e})}function CN({showUpgradeMention:e,versionsPerProject:o}){let[{selectedVersion:t,versions:r,status:i}]=Cf(),n=(0,ni.useContext)(ce),[s,l]=(0,ni.useState)("default"),[c,d]=(0,ni.useState)(1),p=(0,ni.useCallback)(u=>{J1(u)},[]),m=(0,ni.useCallback)(u=>{Q1(u)},[]);return(0,ni.useEffect)(()=>{let u=new AbortController;return X1({projectId:n.project.num_id,signal:u.signal}),function(){u.abort()}},[]),i!=="loaded"?w(f,{display:"flex",flex:1,alignItems:"center",justifyContent:"center",children:[i==="loading"?a(mt,{color:"white",bgColor:"transparent"}):null,i==="error"?a(ve,{color:"gray",children:"Something went wrong"}):null]}):!r.length||!t?a(f,{display:"flex",flex:1,flexDirection:"column",alignItems:"center",justifyContent:"center",children:w(f,{display:"flex",flexDirection:"column",width:"63rm",textAlign:"center",children:[a(ve,{color:"gray",lineHeight:"20px",children:"The first version will appear after 10 minutes of working in the editor."}),a(Ce,{target:"_blank",href:"https://help.readymag.com/hc/en-us/articles/33666976895643/",color:"gray",fontWeight:400,textDecoration:"underline",textUnderlineOffset:"3px",children:"Learn more"})]})}):w(q,{children:[w(A8,{children:[a(j8,{type:s,onToggle:l}),a(K8,{defaultSize:c,onSizeChange:d})]}),a(f,{border:"1px solid",borderRight:"0px",borderColor:Me("gray",.16),children:a(Ft,{children:({ref:u})=>w(f,{ref:u,display:"flex",justifyContent:"center",children:[a(O8,{total:r.length-1,current:t.idx,onChange:p,children:w(ve,{color:"white",fontWeight:400,fontSize:"4rm",lineHeight:"20px",userSelect:"none",children:[t.value.metadata.titlePrefix," ",t.value.metadata.formatedDate,w(ve,{as:"span",color:"gray",children:[" ",t.value.metadata.titlePostfix]})]})}),a(E8,{versions:r,selectedVersion:t.idx,currentViewport:s,currentTileSize:c,onVersionChange:p})]})})}),w(L8,{children:[w(yN,{children:[a(kN,{}),e?a(_N,{versionsPerProject:o}):null]}),a(Ft,{mode:"vertical",children:({ref:u})=>a(f,{ref:u,padding:"16px 24px",children:a(I8,{versions:r,selectedVersion:t.value,onVersionClick:m})})}),a(U8,{selectedVersion:t.value})]})]})}function Z8({user:e,isOwner:o}){let[{show:t}]=Cf(),r=e?.get("permissions"),i=(0,ni.useMemo)(()=>{let n=e?.get("stripe")?.subscription_id,s=r?.can_use_version_history;if(!o||!n||!s)return!1;let[l]=n.split("_");return!["business","extra","professional"].includes(l)},[]);return a(C8,{isOpen:t,onClose:Z1,children:a(SN,{children:a(CN,{showUpgradeMention:i,versionsPerProject:r?.version_history_limit_per_project})})})}k();function PN({router:e,constructorMagModel:o}){let{inPreview:t}=B0(),r=e.workspace?a(af,{router:e,children:a(b8,{scrollGap:210,children:a(u8,{})})}):null,i=e.preview?a(xv,{constructorMagModel:o,router:e.preview,children:a($m,{zIndex:3e3})}):null;return t?i:r}var tx=(e,{router:o,project:t,fromPreview:r,supportAccessToken:i})=>{let n=new Backbone.Model({isVisible:!0});function s(){J8.default.render(a(Fr,{withGlobalStyles:!1,children:a(rl,{router:o,project:t,inPreview:r,children:a(ic,{router:o,widgetbar:n,children:a(Nd,{magModel:t,router:o,children:w(Wd,{userModel:o.me,children:[a(PN,{constructorMagModel:t,router:o}),a(f,{id:"settings-popup-container",position:"absolute",top:"0",left:"0",zIndex:"8000",width:"100%"}),a(nh,{}),a(Z8,{user:o.me,isOwner:o.isOwner}),a(By,{}),i&&a(k8,{token:i})]})})})})}),e)}return s(),{show(){n.set({isVisible:!0})},hide(){n.set({isVisible:!1})},setWorkspace(l){n.set({workspace:l})},isVisible(){return n.get("isVisible")},rerender(){s()}}};LI();lM();pM();yy();AI();var p6=B(jp());N();qa();Be();Jt();Sr();sn();var Jo=B(H());Wr();N();Li();Bo();su();sn();Ai();ec();pI();sI();aI();q6();Qa();var ph=e=>{let o=e.pages.reduce((t,r)=>{let i=r.wids.filter(n=>n.is_global);return t.concat(i)},[]);return{...e,pages:e.pages.map(t=>{let r={...t,widgets:t.wids};return delete r.wids,r}),hasSummary:!0,globalWidgets:o.filter(t=>!t.is_above),aboveAllWidgets:o.filter(t=>t.is_above)}};Uh();var Qi=B(H());ro();sn();Vs();cI();k();var TN=e=>e.globalWidgets.find(o=>o.get("type")==="ecommercecart"),Q8=({constructorProject:e,children:o})=>{let{project:t,setProject:r,page:i,postViewerAction:n}=(0,Qi.useContext)(mr),[s]=(0,Qi.useState)(()=>TN(e)),l=(0,Qi.useCallback)(d=>{if(!t||!s)return;s.save(d),s.hasChanged()&&e.set("changed",!0);let p=t.globalWidgets.map(g=>g.type==="ecommercecart"?{...g,...d}:g);r({...t,globalWidgets:p});let[m,u]=Object.entries(d)[0]||[];m==="bar-auto-open"&&n({type:"changeSetting",key:m,value:u})},[t]),[c]=(0,Qi.useState)(()=>{if(!s)return;let d=new pc({numId:e.attributes.num_id,ecommerceData:e.attributes.ecommerce_data,isPublished:!1,isDownloadedSource:!1}),p=new Backbone.Model({block:{model:s,saveModelChanges:l,saveModelChangesDebounced:_.debounce(l,80),eCommerceManager:d},faded:!1,selected:!1,disabled:!1,visible:!0,select:()=>p.set({selected:!0,faded:!1}),deselect:()=>p.set({selected:!1,faded:!1}),removeFade:()=>p.set({faded:!1}),appearanceAnimation:!1,project:e,user:e.user,injectedRefs:{},workspace:null,controlsManager:null,useSharedState:()=>({}),doesUserHaveAccess:!0,isMixed:()=>!1});return p});return(0,Qi.useMemo)(function(){if(!c)return;let p=c.get("block");p.saveModelChanges=l,p.saveModelChangesDebounced=_.debounce(l,80)},[l]),(0,Qi.useMemo)(function(){if(!c||!i)return;let p=i._id,m=e.pages.find(u=>u.id===p);c.set("page",m)},[i]),c&&s?a(zd,{model:c,context:au,children:o}):o};N();J6();var En=B(H());Li();st();DI();Uh();lI();rI();iI();k();var IN=({autoSize:e,...o})=>{let t=(0,En.useRef)(null),[r]=Cy({ref:t,value:o.value!==void 0?o.value.toString():o.defaultValue?.toString()??"",disabled:!e});return r&&(o.width=r),a(yt,{...o,ref:t})},e6=F(IN)`
  box-sizing: border-box;
  height: 100%;
  max-width: 100%;
  min-width: 100%;
  padding: 1px;
  border: 1px solid rgba(0, 0, 0, 0);
  border-radius: 3px;
  font-size: inherit;
  font-family: inherit;
  color: inherit;
  &:focus {
    border-bottom: 1px solid rgba(0, 0, 0, 0);
    border-color: rgba(255, 255, 255, 0.2);
  }
  &:hover {
    border-color: rgba(255, 255, 255, 0.2);
  }
`,ox=F(yt)`
  box-sizing: border-box;
  height: 100%;
  padding: 1px;
  border: 1px solid rgba(0, 0, 0, 0);
  border-radius: 3px;
  font-size: inherit;
  font-family: inherit;
  color: inherit;
  &:focus {
    border-bottom: 1px solid rgba(0, 0, 0, 0);
    border-color: rgba(255, 255, 255, 0.2);
  }
  &:hover {
    border-color: rgba(255, 255, 255, 0.2);
  }
`,MN=({project:e})=>{let{model:{block:{model:o,saveModelChangesDebounced:t}}}=(0,En.useContext)(au),[r,i]=(0,En.useState)(()=>({"bar-title":o.get("bar-title")??le.defaultSidebarTexts.title,"bar-empty\u0421artTitle":o.get("bar-empty\u0421artTitle")??le.defaultSidebarTexts.empty\u0421artTitle,"bar-checkout":o.get("bar-checkout")??le.defaultSidebarTexts.checkout,"bar-price":o.get("bar-price")??le.defaultSidebarTexts.price,"bar-quantity":o.get("bar-quantity")??le.defaultSidebarTexts.quantity})),n=(0,En.useCallback)(g=>{let h=g.target.name,b=g.target.value;i({...r,[h]:b}),t({...r,[h]:b})},[r,t]),s={translate:"no",autoComplete:"off",autoCorrect:"off",spellCheck:!1},l=w(f,{display:"flex",alignItems:"center",gap:"10px",position:"relative",zIndex:"1",children:[a(ox,{name:"bar-title",value:r["bar-title"],placeholder:le.defaultSidebarTexts.title,maxLength:32,width:"100%",height:"32px",fontSize:"inherit",lineHeight:"inherit",onChange:n,...s}),a(f,{position:"relative",top:"1px",children:a(Dk,{})})]}),c=a(ox,{name:"bar-empty\u0421artTitle",value:r["bar-empty\u0421artTitle"],placeholder:le.defaultSidebarTexts.empty\u0421artTitle,maxLength:32,textAlign:"center",width:"100%",height:"32px",fontSize:"inherit",lineHeight:"inherit",onChange:n,...s}),d=a(ox,{name:"bar-checkout",value:r["bar-checkout"],placeholder:le.defaultSidebarTexts.checkout,maxLength:32,height:"24px",width:"100%",textAlign:"center",onClick:g=>g.stopPropagation(),onChange:n,...s}),p=a(e6,{name:"bar-price",value:r["bar-price"],placeholder:le.defaultSidebarTexts.price,maxLength:32,width:"auto",height:"18px",maxWidth:"120px",minWidth:"20px",fontSize:"0.75em",lineHeight:"inherit",autoSize:!0,onChange:n,...s}),m=a(e6,{name:"bar-quantity",value:r["bar-quantity"],placeholder:le.defaultSidebarTexts.quantity,maxLength:32,width:"auto",height:"18px",maxWidth:"120px",minWidth:"20px",fontSize:"0.75em",autoSize:!0,onChange:n,...s}),[u]=(0,En.useState)(()=>new gv({project:e,publicPath:"",base:""}));return a(hv,{value:u,children:a(av,{value:u.project,children:a(pv,{value:u.router,children:a($k,{project:e,cartTitle:l,emptyText:c,buttonText:d,priceText:p,quantityText:m})})})})},t6=MN;st();nI();k();function o6(e){return`/api/fonts/${e}/css`}function BN(e){return e.map(o=>o.css_url)}function r6({fonts:e}){if(!e?.length)return null;let o=e.filter(n=>n.provider==="custom"),t=e.filter(n=>n.provider==="webtype"),r=e.filter(n=>n.provider==="typetoday"),i=[t.length?o6("webtype"):void 0,r.length?o6("typetoday"):void 0,...o.length?BN(o):[]].filter(Boolean);return i.length?a(q,{children:i.map((n,s)=>a("link",{rel:"stylesheet",type:"text/css",href:n},s))}):null}Fp();function RN({id:e,token:o,fontsMetaData:t}){let r=document.createElement("script");r.src="//use.typekit.net/previewkits/pk-v1.js",r.onload=function(){window.TypekitPreview.setup({auth_id:e,auth_token:o,default_subset:"all"}),window.TypekitPreview.load(t)},window.document.head.appendChild(r)}var i6=RN;k();function zN(e){let o=encodeURIComponent(e.name);if(e.variations.length===1&&e.variations[0]==="n4")return`family=${o}`;let t=[],r=[];for(let n of e.variations.sort((s,l)=>s.localeCompare(l))){let[s,l]=[n.slice(0,1),parseInt(n.slice(1))],c=l*100;s==="n"?t.push(c):s==="i"&&r.push(c)}let i=[...t.map(n=>`0,${n}`),...r.map(n=>`1,${n}`)];return`family=${o}:ital,wght@${i.join(";")}`}function n6({fonts:e}){if(!e?.length)return null;let o=e.filter(n=>n.provider==="google");if(!o.length)return null;let i=`https://fonts.googleapis.com/css2?${o.map(zN).join("&")}`;return w(q,{children:[a("link",{rel:"preconnect",href:"//fonts.googleapis.com"}),a("link",{rel:"preconnect",href:"//fonts.gstatic.com",crossOrigin:"anonymous"}),a("link",{rel:"stylesheet",type:"text/css",href:i})]})}k();function s6({fontsMetaData:e=[],typekitId:o,typekitToken:t}){let r=Hi(()=>e?.filter(i=>i.provider==="typekit").map(i=>({id:i.css_name,variations:i.variations})),[e]);return Hu(()=>{i6({id:o,token:t,fontsMetaData:r})},r.length>0),w(q,{children:[a(n6,{fonts:e}),a(r6,{fonts:e})]})}ro();k();var a6=F(f,{label:"preview-background"})`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: white;
`,EN=Dt(a6),AN=F(f,{label:"device-box"})`
  position: absolute;
  box-sizing: content-box;
  // Device box overflow, auto or hidden, does not matter for most viewports, because its nested iframe occupies 100% of its size.
  // It matters only for tablet viewport, where the iframe is downscaled with transforms.
  // Without overflow hidden, it will have horizontal scroll.
  overflow: hidden;
`,LN=F(f)`
  display: block;
`,DN=(e,o)=>{let t=new URL(`${window.origin}/preview/${e}/${o!=="1"?o+"/":""}`);return t.searchParams.set("external_link_target","parent"),t.toString()},ch=.75;function l6({projectNumId:e,initialPagePath:o}){let t=(0,Jo.useRef)(DN(e,o)).current,{project:r,setProject:i,viewport:n,setIframe:s,constructorProject:l,isViewportEnabled:c,setViewport:d,switchToConstructor:p}=(0,Jo.useContext)(mr),{isRenderedOnClient:m}=Xx(),[u]=iu(),g=Ok(),h=(0,Jo.useRef)(null),[b,x]=(0,Jo.useState)(!1),{deviceBox:S,iframeBox:y,deviceFrame:C,minWidth:P}=(0,Jo.useMemo)(()=>{if(r){let I=Pr.getPageWidth(r,n),{width:M,height:D}=Pr.fitToDevice(n==="tablet_portrait"?I*ch:I,n,u),E={width:M,height:Math.min(D,g.height)};return{deviceBox:n==="default"?{}:ct.center(E,g),iframeBox:n==="tablet_portrait"?{transformOrigin:"left top",scale:ch,width:E.width/ch,height:E.height/ch}:{width:"100%",height:"100%"},deviceFrame:n==="default"?{}:{border:"1px solid #e0e0e0",borderRadius:"4px"},minWidth:Oe.dictionary[n].min_scale_width||Oe.dictionary[n].width}}else return{deviceBox:{},deviceFrame:{},minWidth:Oe.dictionary.default.min_scale_width}},[u,r,n,g]),v=(0,Jo.useMemo)(()=>r?!!r.pages.find(M=>M.widgets?.find(D=>D.type==="ecommercecart")):!1,[r]),T=(0,Jo.useCallback)(I=>{h.current=I,x(!0),s(I)},[]);cv(()=>{vx()}),Hu(function(){r&&(dv(r,{isPublished:!1}),fv(uv(r)),bv(e))},m&&!!r),(0,Jo.useEffect)(()=>{r||l0(e).then(I=>{let M=ph(I);i(M)})},[r]),(0,Jo.useEffect)(function(){if(!b)return;function M(D){if(D.target?.matches?.(window.RM.constructorRouter.workspaceTextInputSelectors))return;let A=c("tablet_portrait"),$=c("phone_portrait"),j=A&&$?{2:"tablet_portrait",3:"phone_portrait"}:A?{2:"tablet_portrait"}:$?{2:"phone_portrait"}:{},pe={1:"default",...j},ee;if(D.key==="p")p();else if(D.key==="d"){let G=Object.values(pe),K=G.indexOf(n);ee=G[K===G.length-1?0:K+1]}else["1","2","3"].includes(D.key)&&(ee=pe[D.key]);ee&&d(ee)}return document.addEventListener("keyup",M),h.current?.contentDocument?.addEventListener("keyup",M),()=>{document.removeEventListener("keyup",M),h.current?.contentDocument?.removeEventListener("keyup",M)}},[c,n,d,p,b]),(0,Jo.useEffect)(function(){if(!b||!h.current)return;function M(){!document.fullscreenElement&&(h.current?.style.setProperty("display","none"),setTimeout(()=>h.current?.style.removeProperty("display")))}return document.addEventListener("fullscreenchange",M),()=>{document.removeEventListener("fullscreenchange",M)}},[b]);let R=r?.edit_params?.fonts??[];return a(q,{children:w(No,{children:["Transition between constructor and preview",a(EN,{minWidth:P,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:a(a6,{children:a(AN,{width:"100%",height:"100%",...C,...S,children:m?w(q,{children:[a(LN,{as:"iframe",src:t,ref:T,...y}),r?w(q,{children:[a($m,{position:"fixed",bottom:16,right:16}),a(vv,{viewport:n})]}):null,r&&(v||mv(r))?w(q,{children:[R.length?a(s6,{fontsMetaData:R,typekitId:le.TYPEKIT_ID,typekitToken:le.TYPEKIT_TOKEN}):void 0,a(Q8,{constructorProject:l,children:a(t6,{project:r})})]}):null]}):null})})})]})})}k();function c6(e,{router:o,initialPageId:t,initialPagePath:r,constructorProject:i,previewProject:n,viewport:s,initialScrollTop:l,projectNumId:c}){let d=(0,p6.createRoot)(e),p=new Backbone.Model({isVisible:!0});return document.body.classList.add(mf),d.render(a(Fr,{withGlobalStyles:!1,children:a(rl,{router:o,project:i,inPreview:!0,children:a(ic,{router:o,widgetbar:p,children:a(Nd,{magModel:i,router:o,children:w(Wd,{userModel:o.me,children:[a(wv,{viewport:s,project:n,constructorProject:i,initialPageId:t,initialScrollTop:l,children:a(l6,{projectNumId:c,initialPagePath:r})}),a(f,{id:"settings-popup-container",position:"absolute",top:"0",left:"0",zIndex:"8000",width:"100%"}),a(nh,{})]})})})})})),()=>{d.unmount(),document.body.classList.remove(mf)}}Fs();H6();Du();pr();So();Qd();lf();var{eventName:d6,hiddenKey:u6}=Hk();function m6(e){return e&&gx(e)&&bx(e?.timeSpent)}function ON({projectId:e,localStorageKey:o}){let t={timeSpent:0};try{let r=localStorage.getItem(o);if(!r)return t;let i=JSON.parse(r);return m6(i[e])&&i[e]||t}catch{return t}}function $N({projectId:e,localStorageKey:o,data:t}){let r={};try{let i=localStorage.getItem(o);if(i){let n=JSON.parse(i);(!n[e]||m6(n[e]))&&(r=n)}}catch{}r[e]=t,localStorage.setItem(o,JSON.stringify(r))}var dh=class{constructor({projectId:o,onThreshold:t,config:r}){z(this,"projectId");z(this,"config");z(this,"onThreshold");z(this,"isInit");z(this,"projectHasChanges");z(this,"timeSpent");z(this,"isTabVisible");z(this,"timerId",null);z(this,"onProjectChanged",()=>{this.projectHasChanges=!0,this.startTracking()});z(this,"onVisibilityChange",()=>{this.isTabVisible=u6 in document&&!document[u6],this.isTabVisible?this.startTracking():this.stopTracking()});z(this,"updateSpentTime",()=>{let{checkEverySeconds:o,thresholdSeconds:t,localStorageKey:r}=this.config;this.timeSpent=this.timeSpent+o,this.timeSpent%t===0&&(this.projectHasChanges=!1,this.onThreshold(),this.stopTracking()),$N({localStorageKey:r,projectId:this.projectId,data:{timeSpent:this.timeSpent}})});let{localStorageKey:i}=r,{timeSpent:n}=ON({projectId:o,localStorageKey:i});this.isInit=!1,this.projectId=o,this.config=r,this.onThreshold=t,this.projectHasChanges=!1,this.isTabVisible=!0,this.timeSpent=this.correctSpentTime(n)}correctSpentTime(o){let{checkEverySeconds:t}=this.config;return o===0||this.timeSpent%t===0?o:Math.floor(o/t)*t}startTracking(){let{checkEverySeconds:o}=this.config,t=o*1e3;this.isInit&&this.isTabVisible&&this.projectHasChanges&&!this.timerId&&(this.timerId=setInterval(this.updateSpentTime,t))}stopTracking(){this.timerId&&(clearInterval(this.timerId),this.timerId=null)}init(){this.isInit||(this.isInit=!0,Ot.on("change",this.onProjectChanged),document.addEventListener(d6,this.onVisibilityChange))}destroy(){this.isInit&&(this.isInit=!1,this.stopTracking(),Ot.off("change",this.onProjectChanged),document.removeEventListener(d6,this.onVisibilityChange))}};var h6=B(jp());qa();var Fa=B(H());N();fe();Fo();st();k();var{versionHistory:{restore:{pollingInterval:HN}}}=le;function FN(){return w(q,{children:["Something went wrong.",a("br",{}),a("br",{}),"Please check your internet connection and reload the page.",a("br",{}),"If the problem persists,"," ",a(Ce,{textDecoration:"underline",color:"gray",href:`mailto:${le.SUPPORT_MAIL}`,children:"contact support"}),"."]})}function NN({isError:e}){return w(f,{position:"absolute",top:0,display:"flex",flexDirection:"column",width:"100vw",height:"100vh",alignItems:"center",justifyContent:"center",backgroundColor:"white",textAlign:"center",zIndex:1e5,children:[e?null:a(mt,{color:"red",bgColor:"transparent"}),a(ve,{fontSize:"4rm",color:"gray",children:e?a(FN,{}):"Restoring backup..."})]})}function g6(){let[{show:e,jobId:o}]=Y1(),[t,r]=(0,Fa.useState)(!1),i=(0,Fa.useRef)(),n=e&&o;return(0,Fa.useEffect)(()=>{n&&(i.current=new Sp({interval:HN}),i.current.start(o).then(()=>window.location.reload()).catch(()=>r(!0)))},[n]),(0,Fa.useEffect)(()=>function(){i.current?.stop(),i.current=null,r(!1)},[]),n?a(NN,{isError:t}):null}k();function f6(e){if(!e)throw new Error("Target element must be provided");(0,h6.createRoot)(e).render(a(Fr,{withGlobalStyles:!1,children:a(g6,{})}))}So();XI();ro();Bo();Za();Us();G6();U6();j6();So();var b6=new Set(["adobe","itc","linotype","bitstream","fontfont","ff","urw++","urw","paratype","pt","t26","ibm"]),w6=new Set(["thin","light","regular","medium","bold","black","heavy","semi","extra","ultra","normal","italic"]),x6=new Set(["pro","next","std","web","classic","one"]),v6=new Set(["condensed","cond","expanded","rounded","round","extended"]),y6=new Set(["serif","slab","sans","script","mono","grotesk","grotesque","gothic","sc"]),k6=new Set(["display","stencil","inline","text"]);function rx(e,o){let t=e.toLowerCase().split(/[^a-z0-9]+/),r=o.toLowerCase().split(/[^a-z0-9]+/),i=t.filter(s=>r.includes(s)),n=Math.max(t.length,r.length);return Math.round(i.length/n*100)}function ix(e,o){let t=e.toLowerCase().split(/[^a-z0-9]+/),r=o.toLowerCase().split(/[^a-z0-9]+/),i=Math.max(t.length,r.length),n=[{key:"allCategories",words:new Set([...b6,...w6,...x6,...v6,...y6,...k6]),weightOrdinaryWords:3},{key:"producers",words:b6,weightNoisyWords:.1},{key:"weights",words:w6,weightNoisyWords:.03},{key:"versions",words:x6,weightNoisyWords:.05},{key:"fontWidths",words:v6,weightNoisyWords:.05},{key:"types",words:y6,weightNoisyWords:.1},{key:"usageOptions",words:k6,weightNoisyWords:.05}],s={},l={},c=(u,g,h)=>{u[g]?u[g].push(h):u[g]=[h]},d=(u,g,h)=>{u[g]?u[g].add(h):u[g]=new Set([h])};for(let u=0;u<i;u++){let g=u<t.length?t[u]:null,h=u<r.length?r[u]:null;for(let b of n)g&&c(s,b.key,g),h&&d(l,b.key,h)}let p=0,m=n.length;for(let u of n){let{key:g,words:h,weightNoisyWords:b=1,weightOrdinaryWords:x=1}=u,S=s[g]||[],y=l[g]||new Set,C=Math.max(S.length,y.size),P=[],v=[];for(let M of S)h.has(M)&&y.has(M)?v.push(M):y.has(M)&&P.push(M);let T=v.length*b/C*100,R=P.length*x/C*100;p+=Math.min(R+T,200)}return xx(p/m,4)}Ai();tf();Xp();Us();var nx="|";function sx(e){let o=e.indexOf(Dd),[t,r]=[e.substring(0,o),e.substring(o+1)];return{key:t,value:r}}function _6(e,o){for(let t in e){let r=e[t];if(r.type!=="LINK")continue;let i=r?.data?.linkStyle,n=o[i];n&&(r.data.linkStyle=n)}}function S6(e={}){let o=[];for(let t in e){let[r,i,n,s,l]=t.split(nx),c={padding:Number(l),size:Number(s),type:i,color:n,textColor:r},d={name:e[t],label:"Link Style from Figma",style:{link:{...c},hover:{...c},current:{...c}}};o.push(d)}return o}function ax(){let e={};for(let o in document.styleSheets){let t=document.styleSheets[o],r=null;try{r=t.rules||t.cssRules}catch{continue}r&&(e={...e,...qp(r)})}return e}Us();Za();async function C6(e){let o={},t=ax(),r={};for(let i in e){let s=e[i].actualFont,{provider:l,cssName:c,variations:d}=s;if(t[c]){r[c]=t[c];continue}o[l]||(o[l]=[]),o[l].push({name:c,variations:d})}for(let i in o){let n=o[i];if(i==="google"){let s=Mt.getGoogleFontUrl(n);if(!s)continue;let l=await Ph(s);r={...r,...qp(l)}}else if(i==="typekit"){let s=[];for(let c of n){let d=c.name,p=c.variations;s.push({id:d,variations:p})}s.length>0&&window.TypekitPreview&&await new Promise(c=>{window.TypekitPreview.load(s,{fontinactive:()=>c(!0),active:()=>c(!0)})});let l=ax();for(let c of n){let d=l[c.name];d&&(r[c.name]=d)}}else if(i==="typetoday"){let s=window.ServerData&&window.ServerData.fonts&&window.ServerData.fonts.typetoday;if(!s)continue;let l=await Ph(s),c=qp(l);for(let d of n){let{name:p}=d;c[p]&&(r[p]=c[p])}}}return r}Fs();async function P6({blocks:e,unprocessedLinkStyles:o,unprocessedFonts:t,linkProjectStyles:r,projectFonts:i,fontShortList:n}){let{linksMap:s,newLinkStyles:l}=WN(o,r),{fontsMap:c,importedFonts:d}=await UN({unprocessedFonts:t,projectFonts:i,fontShortList:n});for(let p of e){if(p.type!=="text")continue;let{blocks:m,blocksMeta:u,styles:g,entityMap:h}=p;_6(h,s),jN({blocks:m,blocksMeta:u,styles:g,entityMap:h},c)}return{newLinkStyles:l,importedFonts:d}}function WN(e,o){let{linksMap:t,unprocessedLinks:r}=VN(e,o),i=S6(r);return{linksMap:t,newLinkStyles:i}}function VN(e={},o=[]){let t=nt(e),r={};for(let i of o){let n=i.name,s=i.style.link;if(!s||!n)continue;let l=[s.textColor,s.type,s.color,s.size,s.padding].join(nx),c=t[l];c&&(r[c]=n,delete t[l])}return{linksMap:r,unprocessedLinks:t}}async function UN({unprocessedFonts:e,projectFonts:o,fontShortList:t}){let r=GN(e,o),i=YN(r.unprocessedFonts,t),n=XN(i.unprocessedFonts),s=await KN({...r.recognizedFonts,...i.recognizedFonts,...n.recognizedFonts});return{importedFonts:i.importedFonts,fontsMap:s}}function GN(e,o){let t=nt(e),r={},i={},n=o.sort(l=>l.provider==="custom"?-1:1),s=(l,c,d)=>{r[l]||(r[l]={...c,similar:[]}),(r[l]?.similar).push(d)};for(let l=0;l<n.length;l++){let c=n[l],d=c.name,p=c.css_name,m=c.provider,u=c.variations,g=c._id;if(!c.hidden){if(t[p]||t[d]){let h=t[p]?p:d,b=t[h],x=fd(b.fontStyles,b.fontWeights),S=Mt.calcBrowserUsedVariation(x,c.variations);i[h]={fontStyles:[...b.fontStyles],fontWeights:[...b.fontWeights],actualFont:{id:g,name:d,cssName:p,provider:m,usedVariations:S,variations:u}},delete t[h]}for(let h in t){let b=t[h],x=rx(h,c.name),S=10,y=55;if(x>S&&(x=ix(h,d)),x<y)continue;let C=fd(b.fontStyles,b.fontWeights),P=Mt.calcBrowserUsedVariation(C,c.variations);s(h,b,{id:g,name:d,cssName:p,provider:m,rate:x,usedVariations:P,variations:u})}}}for(let l in r){let c=r[l],p=c.similar.sort((g,h)=>h.rate-g.rate)[0],m={fontStyles:[...c.fontStyles],fontWeights:[...c.fontWeights]},u={id:p.id,name:p.name,cssName:p.cssName,provider:p.provider,usedVariations:p.usedVariations,variations:p.variations};i[l]={...m,actualFont:u},delete t[l]}return{recognizedFonts:i,unprocessedFonts:t}}function jN(e,o){let t=Jx(e);for(let r of Object.values(e.styles)){let i=r.key,n=t.getBlockForKey(i),s={},l=(d,p)=>{s[d]?s[d].push(p):s[d]=[p]},c=n.getCharacterList().toArray();for(let d=0;d<c.length;d++){let m=c[d]?.getStyle().toArray()||[],u=JN(m),g=u.FONT_FAMILY||null,h=u.FONT_STYLE||null,b=u.FONT_WEIGHT||null,x=g&&o[g]?.actualFont||null,{usedVariation:S,availableVariation:y,variableWght:C}=qN({actualFont:x,fontWeight:b,fontStyle:h});for(let P=0;P<m.length;P++){let v=m[P],{key:T,value:R}=sx(v),I=R;if(T==="FONT_FAMILY"&&x&&(I=x.cssName),S){let{style:M,weight:D}=i0(S);T==="FONT_STYLE"&&(I=M),T==="FONT_WEIGHT"&&(I=String(D))}if(T==="FONT_FEATURE"&&y){let M=R.split(";"),D=x?x[y]?.features||[]:[];I=D?fx(M,D).join(Dd):I}if(I){let M=Ih(T,I);l(T,{offset:d,length:1,style:M})}}C&&l("FONT_VARIABLE",{offset:d,length:1,style:Ih("FONT_VARIABLE",`wght|${C}`)})}r.inlineStyles=n0(s0(s))}}function qN({actualFont:e,fontWeight:o,fontStyle:t}){let r=null,i=null,n=null;if(!e||!o||!t)return{availableVariation:r,usedVariation:i,variableWght:n};let s=Th(o,t),l=Mt.calcBrowserUsedVariation([s],e.usedVariations);r=l.length>0?l[0]:null;let c=r&&e[r]?.variableVariation,d=null;return c&&(n=Math.min(c.max,Math.max(c.min,Number(o))),d=Th(c.defaultValue,t)),i=d||r,{availableVariation:r,usedVariation:i,variableWght:n}}function YN(e={},o={}){let t=["google","typekit","typetoday"],r={},i={},n=nt(e),s=[],l=(c,d,p)=>{i[c]||(i[c]={...d,similar:[]}),(i[c]?.similar).push(p)};for(let c of t){let d=o[c];if(d)for(let p of d){let m=p._id,u=p.variations,g=null,h=null;if(c==="google"?(g="family"in p?p.family:null,h=g):c==="typekit"?(g="name"in p?p.name:null,h="id"in p?p.id:null):c==="typetoday"&&(g="name"in p?p.name:null,h=g),!g||!h)continue;let b=n[g]?g:n[h]?h:null;if(b&&h){let x=n[b],S=fd(x.fontStyles,x.fontWeights),y=Mt.calcBrowserUsedVariation(S,u);r[b]={fontStyles:[...x.fontStyles],fontWeights:[...x.fontWeights],actualFont:{id:m,name:g,cssName:h,provider:c,usedVariations:y,variations:u}},s.push({provider:c,css_name:h,name:g,variations:u,used_variations:y}),l(b,x,{id:m,name:g,cssName:h,rate:100,usedVariations:y,variations:u,provider:c}),delete n[b]}for(let x in n){let S=n[x],y=rx(x,g),C=10,P=65;if(y>C&&(y=ix(x,g)),y<P)continue;let v=fd(S.fontStyles,S.fontWeights),T=Mt.calcBrowserUsedVariation(v,u);l(x,S,{id:m,name:g,cssName:h,rate:y,usedVariations:T,variations:u,provider:c})}}}for(let c in i){let d=i[c];if(r[c])continue;let u=d.similar.sort((b,x)=>x.rate-b.rate)[0],g={fontStyles:[...d.fontStyles],fontWeights:[...d.fontWeights]},h={id:u.id,name:u.name,cssName:u.cssName,provider:u.provider,usedVariations:u.usedVariations,variations:u.variations};r[c]={...g,actualFont:h},s.push({provider:u.provider,css_name:u.cssName,name:u.name,variations:u.variations,used_variations:u.usedVariations}),delete n[c]}return{importedFonts:s,recognizedFonts:r,unprocessedFonts:n}}function XN(e={}){let o={};for(let t in e){let r=e[t],i=fd(r.fontStyles,r.fontWeights),n=Mt.calcBrowserUsedVariation(i,$p.fontWeights);o[t]={fontStyles:[...r.fontStyles],fontWeights:[...r.fontWeights],actualFont:{id:"default",name:$p.fontFamily,provider:"google",cssName:$p.fontFamily,usedVariations:n,variations:$p.fontWeights}}}return{recognizedFonts:o}}async function KN(e){let o=nt(e),t=await ZN(e),r=await Yx(t);for(let i of r.data){let n=o[i.name].actualFont,s=i.variations||[],l=i.features||[],c=i.weight,d=s.find(p=>p.code==="wght");n[c]={features:l},d&&(n[c]={...n[c],variableVariation:{max:d.max,min:d.min,defaultValue:d.defaultValue}})}return o}async function ZN(e){let o=await C6(e),t=[];for(let r in e){let n=e[r].actualFont,s=null,l=null,c=null;if(n.provider==="custom")s=n.id;else{let d=o[n.cssName];d&&(c=d)}n.provider==="system"&&(l=n.name);for(let d of n.usedVariations){let p={name:r,weight:d};s?p.id=s:c&&(p.url=c),l&&(p.systemFontName=l),t.push({...p})}}return t}var fd=(e=[],o=[])=>{let t=e.length,r=[];for(let i=0;i<t;i++){let n=e[i],s=o[i],l=Mt.convertToFVD(n,s);l&&r.push(l)}return r};function JN(e){let o={};for(let t=0;t<e.length;t++){let r=e[t],{key:i,value:n}=sx(r);o[i]=n}return o}function T6(e,o,t){let r=e&&e.width>=0&&e.height>=0,i=Oe.viewports.find(l=>l.name===t),n=r?e.width:o.width,s=r?e.height:o.height;return i?{width:Math.round(Math.min(i.max_width,Math.max(i.width,n))),height:Math.round(Math.min(i.max_height,Math.max(i.min_height,s)))}:{width:n,height:s}}function I6({pageSize:e,originSize:o,rootSize:t,boundingBox:r}){let i=t&&t.width>=0&&t.height>=0,{width:n,height:s}=e,l=(n-o.width)/2,c=i?{width:t.width,height:t.height}:{width:r.w,height:r.h},d={width:n,height:s},p=i?0:r.x,m=i?0:r.y,u=ct.center(d,c),g=u.left+l+p,h=u.top+m;return{left:g,top:h}}function M6({boundingBox:e,originSize:o,zoom:t,pageSize:r,viewportBox:i}){let{width:n}=r,{top:s,left:l,width:c,height:d}=i,p=(n-o.width)/2,m={width:e.w,height:e.h},u={width:c/t,height:d/t},g=l,h=s,b=ct.center(u,m),x=b.left-g+p+e.x,S=b.top-h+e.y;return{left:x,top:S}}function B6(e,o){for(let t of e)t.x=Math.round(t.x-o.left),t.y=Math.round(t.y-o.top)}async function R6(e,o){let t=n=>Object.values(Uy).includes(n),r=0,i=[];for(let n of e){let s=new Promise(l=>{if(!t(n.type))return l(n);try{let c=Gy(n.image,n.type);E0(c.name,c).then(d=>{let p={...n,...d,type:"picture"};delete p.image,r++,o(r),l(p)}).catch(d=>{console.error("Failed to upload image:",d),l(null)})}catch(c){console.error("Failed to process image:",c),l(null)}});i.push(s)}return Promise.all(i).then(n=>n.filter(s=>s!==null)).catch(n=>(console.error("Failed to process blocks:",n),[]))}function z6(e){let o=[];for(let r of e){if(!r)continue;let{x:i,y:n,w:s,h:l,angle:c}=r,d=-(c??0)*Math.PI/180,p=Math.sin(d),m=Math.cos(d),u=dt.calcBoundingBox({width:s,height:l,left:i,top:n,sinAngle:p,cosAngle:m});o.push({left:u.bb_left,top:u.bb_top,right:u.bb_left+u.bb_width,bottom:u.bb_top+u.bb_height})}let t=dt.getBoundingBoxOfBoxes(o);return{x:Math.round(t.left||0),y:Math.round(t.top||0),w:Math.round((t.right||0)-(t.left||0)),h:Math.round((t.bottom||0)-(t.top||0))}}ro();N();pr();fe();k();function uh(){I0()}function lx(e,o,t=0){o==="Default"?Yp(QN(e,t),{variant:"bluePill",placement:"center",withLoader:!0}):o==="Error"&&Yp(e,{variant:"redPill",placement:"center",closeByTimer:!0})}function QN(e,o){return w(f,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[a(L,{color:"white",lineHeight:"20px",fontSize:"16px",fontWeight:"400",children:e}),a(f,{display:"flex",width:"65px",justifyContent:"end",children:w(L,{color:"white",fontSize:"24px",lineHeight:"24px",fontWeight:"500",children:[o,"%"]})})]})}var Na=De.default.memoize(()=>{let e=new URLSearchParams(window.location.search);return e.has("__next")?!0:e.has("__legacy")?!1:Ge("viewer.nextPreview")}),eW=si.default.Router.extend({routes:{"edit/:mag/preview/num/:page/":"goPreviewByPageNum","edit/:mag/preview/template-submission/":"goPreview","edit/:mag/preview/*page/":"goPreview","edit/:mag/preview/":"goPreview","edit/:mag":"start","edit/:mag/":"start","edit/:mag/template-submission/":"start","edit/:mag/:page/":"start","edit/:mag/:page/template-submission/":"start","edit/:mag/:page":"start","edit/:mag/:page/comment/:commentId":"start","edit/:mag/:page/comment/:commentId/":"start"},mag:null,workspaces:{},previewMode:!1,switchingModes:!1,scrollTop:0,keys:{p:80,z:90,g:71,a:65,r:82,l:76,c:67,v:86,f:68,x:88,q:81,b:66,d:68,w:87,m:77,esc:27,"[":219,"]":221,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,0:48},pressedKeySet:new Set,disabledKeysMap:{BaseWidgetCanAdd:[{key:me.default.keycodes.w},{key:me.default.keycodes.t}],BaseWidgetCanLock:[{key:me.default.keycodes.l,optionKeys:Modernizr.mac?["meta","shift"]:["ctrl","shift"]}],BaseWidgetCanHide:[{key:me.default.keycodes.h,optionKeys:Modernizr.mac?["meta","shift"]:["ctrl","shift"]}],BaseWidgetCanRotate:[{key:me.default.keycodes.r}],BaseWidgetCanDelete:[{key:me.default.keycodes.del}],BaseWidgetCanChangeGroup:[{key:me.default.keycodes.g}],BaseWidgetCanChangeCoordinates:[{key:me.default.keycodes.left},{key:me.default.keycodes.right},{key:me.default.keycodes.up},{key:me.default.keycodes.down}],CanUseBlocksMode:[{key:me.default.keycodes.b}],GridsAndGuidesCanUse:[{key:me.default.keycodes.h}]},disabledKeysCommentMode:[{key:me.default.keycodes.w},{key:me.default.keycodes.t},{key:me.default.keycodes.r},{key:me.default.keycodes.del},{key:me.default.keycodes.g},{key:me.default.keycodes.left},{key:me.default.keycodes.right},{key:me.default.keycodes.up},{key:me.default.keycodes.down},{key:me.default.keycodes.l},{key:me.default.keycodes.h}],workspaceTextInputSelectors:'input, textarea:not(.copyhack), [data-text="true"], .rm-code-editor, [contenteditable="true"]',keyHandlers:{},PREVIEW_DELAY:0,PING_INTERVAL:5e3,screenshotDates:[],inactivityTimesMap:{short:60*1e3,long:5*60*1e3},minimalUiClassName:"minimal-constructor-ui",hideControlsClassName:"hide-controls",viewportCounter:1,renewScreenshotsPromise:Promise.resolve(),initialize:function(){De.default.bindAll(this),Wy("constructor"),(0,me.default)(this.onLoadInit);let e=window.ServerData.me;if(this.me=new Kd(e),(l=>{let c=l.get("gacid");if(!c||c&&!c.match(/[0-9]+\.[0-9]+/)){let d=et.getGAcid();d&&l.save({gacid:d},{patch:!0})}})(this.me),zx({apiKey:le.ampId,user:this.me.attributes,config:{autocapture:{pageViews:!1}}}),Rp.init({userId:e&&e._id,GA_ID:le.GA_ID,GA4_ID:le.GA4_ID,GOOGLE_ADS_ID:le.GOOGLE_ADS_ID}),!Va.isDesktop()&&!Va.isTablet()){window.location.href="/"+this.me.get("uri");return}let t=this.me?.get("behavior_metrics");this.helpTourIsFinished=t?.constructor_tour_finished;let r=t?.constructor_tour_shown,i=t?.initial_onboarding_type,n=Lx("_rm_start_with_help_tour");if(!r||n){let l={...t,constructor_tour_shown:!0};this.me.save({behavior_metrics:l},{patch:!0})}if(P0(this),this.currentOnboardingType="hidden",r||(this.currentOnboardingType=i||"tour"),n&&(this.currentOnboardingType="tour",Dx("_rm_start_with_help_tour")),!window.location.href.match(/\/(\d+)\/?/))return this.notFound();RM.common=De.default.extend(RM.common||{},{mode:"constructor"}),this.settingsRendered=!1,this.previewToolbarRendered=!1,document.documentElement.classList.add("enhanced-mobile-frame"),Re.on("change:device",this.onChangeDevice,this),document.documentElement.classList.add("equal-columns"),document.documentElement.classList.add("precise-guides"),Ge("widget.anomalyMonitoring")&&document.addEventListener("click",nc.onClick)},execute(e,o,t){if(Na()&&["goPreview","goPreviewByPageNum"].includes(t)&&this.previewMode)return!1;e&&e.apply(this,o)},onLoadInit:function(){me.default.ajaxSetup({}),(0,me.default)(document).ajaxError(this.onAjaxError),(0,me.default)(document).ajaxSuccess(this.clearConnectionError)},onAjaxError:function(e,o,t){let r=["/api/authservice","/api/proxy","/screenshot","/api/fonts","/api/connect"];switch(o.status){case 403:var i=new RegExp("^\\s*(?:[a-z0-9]+:)?//","i"),n=De.default.any(r,function(s){return new RegExp("^"+s).test(t.url)});n=n||i.test(t.url),n||(Modernizr.sessionstorage&&window.sessionStorage.setItem("rm.loginReturnUrl",window.location.pathname),window.location.href=`/auth/login?redirect=${window.location.pathname}`);return;case 500:console.error(o.responseText);break;case 503:console.error("server error");break}},start:function(e,o,t){let r=si.default.history.getFragment().includes("/comment/"),i=si.default.history.getFragment().includes("?support-token");if(this.suspendCustomCodeWidgetsExecution=new URLSearchParams(window.location.search).has("suspend-custom-code"),this.previewMode&&(this.togglePreview(),this.trigger("previewClose")),this.started){this.showWorkspace(o);return}import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-FK4O2EWF.js").then(({default:c})=>{c("constructor")}),this.started=!0,o=parseInt(o,10),o||(o=1),this.mag=this.mag||new dc({num_id:e}),sc.setContext({sessionId:et.generateUUID(),projectNumId:typeof e=="string"?Number(e):e}),this.syncManager=new Vf(this,this.mag),this.indexController=new cc(this,this.mag),this.mag.has("num_id")&&(this.eCommerceManager=new pc({numId:this.mag.get("num_id")}));let{versionHistory:n}=le,s=this.mag.get("num_id");this.projectVersionObserver=new dh({projectId:s,onThreshold:async()=>{await this.renewScreenshotsPromise,await this.renewScreenshot(),H1(s)},config:n.observer}),Ot.initialize(this.syncManager);let l=this;this.mag.loadFull({success:De.default.bind(function(){ak(this.mag.get("num_id")).then(h=>{lk(h)});let c=this.mag.get("user");this.isOwner=c?.email===this.me.get("email"),Rp.trackDailyVisit({location:"editor",role:Ze.getRoleForAnalytics(this.isOwner)});let d=this.mag.attributes?.lastSnapshotRestore,p=d?.status==="processing";if(f6(document.querySelector("#project-restore-overlay")),p){kl({show:!0,jobId:d.jobId});return}c.permissions.can_use_version_history&&this.projectVersionObserver?.init(),this.whatsNewPopupsRoot=Jf(document.querySelector("#whatsnew-popups"),{lastUserSeen:this.me.get("whatsnew_last_seen"),userRegistrationDate:this.me.get("createDate")}),xy(document.querySelector("#help-tour-notice"),["TextWidgetSelect","TextWidgetDrag","PictureWidgetChoose","PictureWidgetClickOutside","AdjustSizes","PictureWidgetPlace","TurnOffGuides","ButtonWidgetAnchorLinkPosition","ButtonWidgetDrag","DeleteBlocks","EverythingInItsRightPlace","SelectBlocksAndDelete","ArrangeWidgetsInTheGrid","DisableBlocksAndGrid","DeleteNavBar","FixMenuClickOutside","ClickOnBurgerMenuIcon","HoverBetweenBlocks","DeselectAfterSetBlocksDistance"]),vy(document.querySelector("#getting-started-video")),this.renewScreenshots(),Hy({projectId:window.ServerData.projectId,userId:this.mag.get("user")._id}),this.me.mergePermissions(this.mag.user.get("permissions")),Xn.init(this.me.get("permissions")),this.mag.edit_params=new uf(this.mag.get("edit_params"),this.mag),this.mag.unset("edit_params"),this.mag.edit_params.on("sync",function(){this.mag.set("changed",!0)},this),this.mag.edit_params.on("change",function(h,b,x){x&&x.socketUpdate&&this.mag.set("changed",!0)},this),this.zoom=new i1(this,this.mag,(0,me.default)("#zoom")),this.eCommerceManager?this.mag.has("ecommerce_data")&&this.eCommerceManager.updateEcommerceData(this.mag.get("ecommerce_data")):this.eCommerceManager=new pc({numId:this.mag.get("num_id")}),this.eCommerceManager.setCartWidgetExistState(a0(le.environment.constructor,this.mag.globalWidgets)),this.textStyles=new Xk(this.mag.edit_params),this.textStyles.generateCSS("paragraph","constructor",document),this.textStyles.generateCSS("link","constructor",document),this.mag.filterUnusedFonts(),this.validateFonts(this.mag.edit_params),this.fonts=new Kh(this.mag.edit_params),this.fonts.appendFontsCssToDocument({version:"edit"},()=>{window.RM.constructorRouter.trigger("font-added")}),this.arrows=new u1({router:this,mag:this.mag}),this.gg=new c1({router:this,mag:this.mag}),this.mag.on("change:pids",this.checkDeletedPage),this.mag.on("change:title",function(){this.setTitle("Edit")},this),this.mag.on("change:page:screenshot",function(h,b,x){this.trigger("renewScreenshot",h,b,x),h===this.mag.pages.first().id&&this.trigger("updateCover")},this),this.pageOrder=new qk,this.pageOrder.load(this.mag),this.pageOrder.validateAndFixPageOrder(this.mag),this.me.get("_id")&&this.mag.get("user")._id!=this.me.get("_id"),this.setTitle("Edit");let m=i?et.parseUriParameters(t)["support-token"]:void 0;this.workspace&&this.workspace.showUsedViewport();try{this.showWorkspace(o,{isContents:si.default.history.getFragment().indexOf("/contents/")>-1,isTemplateSubmission:si.default.history.getFragment().indexOf("/template-submission/")>-1,supportAccessToken:m})}catch(h){console.error("router show workspace error:",h)}this.mag.get("socket_hash")&&this.workspace&&(this.sockets=new o2(this.mag.get("num_id"),this.mag.get("socket_hash"),this.me,this),this.sockets.initSocket(),this.sockets.on("lockChange",this.onLockMessage,this),this.sockets.on("client-disconnected",this.onClientDisconnected,this),this.sockets.on("takeOver",this.showUnlockPageAlert,this),this.on("redrawPage",this.mag.updateLastChanged,this.mag)),this.gg.create(),this.initScreenshotRenewer(),(0,me.default)(window).on("dragover",function(h){RM.constructorRouter.workspace.trigger("main-dragover",h)}),(0,me.default)(".copyhack").on("keyup",function(){(0,me.default)(this).val("\u200C")});let u=Modernizr.mac?"meta":"ctrl",g=Modernizr.mac?["meta","shift"]:["ctrl","shift"];if(this.bindGlobalKeyPress([{key:"a",handler:this.onSelectAllKey,optionKeys:Modernizr.mac?"meta":"ctrl"},{key:"d",handler:this.onNumericKey.bind(this)},{key:"1",handler:this.onNumericKey.bind(this)},{key:"2",handler:this.onNumericKey.bind(this)},{key:"3",handler:this.onNumericKey.bind(this)},{key:"4",handler:this.onNumericKey.bind(this)},{key:"5",handler:this.onNumericKey.bind(this)},{key:"6",handler:this.onNumericKey.bind(this)},{key:"7",handler:this.onNumericKey.bind(this)},{key:"8",handler:this.onNumericKey.bind(this)},{key:"9",handler:this.onNumericKey.bind(this)},{key:"0",handler:this.onNumericKey.bind(this)},{key:"z",handler:this.undo,optionKeys:u,activeOnInput:!0},{key:"z",handler:this.redo,optionKeys:g,activeOnInput:!0}]),RM.analytics=RM.analytics||new Jd({router:this}),this.analytics=RM.analytics,t&&r){let h=t;hc(!0),Re.once("comments:init",()=>{let b=M1(h);b&&Xu({comment:b,fromList:!0})})}},this),error:function(c){c.status!==403&&l.notFound()}}),(0,me.default)("html").on("keydown",this.onKeyDown),(0,me.default)("html").on("keyup",this.onKeyUp),(0,me.default)(window).on("keyup",this.globalKeyPress),(0,me.default)(window).on("keydown",this.globalKeyPress),(0,me.default)(document).on("cut",this.onCut),(0,me.default)(document).on("copy",this.onCopy),(0,me.default)(document).on("paste",this.onPaste),this.bindGlobalKeyPress([{key:"c",handler:this.onCopyAnimation,optionKeys:Modernizr.mac?["meta","shift"]:["ctrl","shift"]},{key:"c",handler:this.onCopyTextStyles,optionKeys:Modernizr.mac?["meta","alt"]:["ctrl","alt"]},{key:"v",handler:this.onPasteTextStyles,optionKeys:Modernizr.mac?["meta","alt"]:["ctrl","alt"]},{key:"esc",handler:this.onEscapePressed}]),(0,me.default)(window).bind("blur",this.onBrowserTabBlur),(0,me.default)(window).bind("focus",this.onBrowserTabFocus),se(he.OpenProject),Re.on("index:changed",(c,d)=>{d||this.trigger("update_from_server","Order",nt(De.default.pick(c,this.getCurrentPageId())))})},onEscapePressed:function(){let e=this.workspace&&this.workspace.controls.controls.find(o=>o.selected);this.isActiveMinimalUI()?this.toggleMinimalUI():e?e.master.deselect():this.workspace&&this.workspace.getSelectedBlocks().length>0&&Ge("constructor.deselectWidgetOnEsc")&&this.workspace.trigger("deselect")},validateFonts:function(e){if(!e)return;let o=e.get("fonts");o&&o.length&&(o.find(r=>r.css_name==="Inter"&&r.name==="Inter"&&r.provider==="google")||(e.set({fonts:[...o,{provider:"google",css_name:"Inter",name:"Inter",variations:["n1","n2","n3","n4","n5","n6","n7","n8","n9"]}]}),e.save()))},renderPreviewToolbar:function(){this.widgetbar||tx(document.querySelector(".widgetbar"),{router:this,fromPreview:!0,project:this.previewMag})},showWorkspace:function(e,o){if(this.togglePreviewMode(!1),De.default.isObject(e)||(e={num:parseInt(e,10)}),e.num||(e.num=this.mag.getPageNum(e.id)),e.id||(e.id=this.mag.getPageId(e.num)),!e.id&&e.num!==1)return this.showWorkspace(1,o);if(this.workspace&&this.workspace.page.id===e.id){this.workspace.renderMissedWidgets(),this.workspace.onReturnFromPreview();return}this.switchCurrentPage(e.id),this.closeCodeEditor();let t=this.workspace&&this.workspace.viewport||window.sessionStorage.getItem("constructorViewport")||"default";this.workspace&&this.workspace.hide(),this.workspace=this.getWorkspace(e.id,o?.viewportName||t),this.widgetbar=tx(document.querySelector(".widgetbar"),{router:this,project:this.mag,supportAccessToken:o?.supportAccessToken}),this.widgetbar.setWorkspace(this.workspace),this.workspace.page.needUpdate&&!this.showed&&this.mag.pages.fetchFullPage(e.id,{success:De.default.bind(function(){this.showWorkspace(e,o)},this)}),(0,me.default)(".page-content-container").css({top:this.workspace.$el.position().top}),this.workspace.show({...o,switchToViewport:o?.viewportName||t}),(!o||!o.isContents&&!o.isTemplateSubmission)&&this.updateUrl(),this.preloadPages(),this.trigger("pageChange",this.workspace),this.widgetbar.rerender()},getWorkspace:function(e,o="default"){let t=this.workspaces[e];return t||(t=new r_({$container:(0,me.default)("#main"),template:g_["template-constructor-workspace"],page_id:e,mag:this.mag,syncManager:this.syncManager,eCommerceManager:this.eCommerceManager,viewport:o}),this.workspaces[e]=t),t},removeWorkspace:function(e){this.workspaces[e]&&(this.workspaces[e].destroy&&this.workspaces[e].destroy(),delete this.workspaces[e])},triggerPageChange:function(){this.trigger("pageChange",this.workspace)},createTemplateFromCurrentPage:function(e={}){return new Promise((o,t)=>{let r=this.workspace.getTemplateJSON(e);if(!r)return t(new Error("can't create template json for current page"));e.withGlobalWidgets&&r.globalWids&&r.globalWids.length&&(r.wids=r.wids.concat(r.globalWids),delete r.globalWids),new(si.default.Model.extend({url:"/api/template/"}))(r).save({},{success:(n,s)=>{this.mag.addCustomPageTemplate(s),o(s)},error:(n,s)=>{if(n.status===400)try{let l=JSON.parse(n.responseText);if(l&&l.err==="permission_denied")return t(new Error("permission denied"))}catch{return t(new Error(s))}t(new Error(s))}})})},preloadPages:function(){if(!this.workspace)return;let e=1,o=this.workspace.page.get("num");De.default.each(De.default.range(o-e,o+e),function(t){if(t==o)return;let r=this.mag.getPageId(t,{onlyActive:!0});r&&this.getWorkspace(r).preloadBlocks()},this)},hideWorkspaces:function(){this.workspace&&this.workspace.hide(),delete this.workspace,this.trigger("pageChange",null)},updateUrl:function(){if(!this.mag||!this.workspace)return;let e="/edit/"+this.mag.get("num_id")+"/"+this.workspace.page.get("num")+"/",o=si.default.history.getFragment()=="/edit/"+this.mag.get("num_id")+"/"+this.workspace.page.get("num");this.navigate(e,{replace:o})},checkDeletedPage:function(){this.trigger("changePids",this.workspace),this.workspace&&(De.default.include(this.mag.get("pids"),this.workspace.page.id)||this.mag.get("pids")[0]||this.hideWorkspaces())},getCurrentPageNum(){return this.preview?this.preview.mag.currentPage.num:this.workspace?this.workspace.getPageNum():1},getCurrentPageId(){return this.preview?this.preview.mag.currentPage._id:this.workspace?this.workspace.getPageId():void 0},goPreviewByPageNum:function(e,o){this.goPreview(e,o,!0)},async goPreview(e,o,t){if(this.trigger("previewOpen"),this.previewMode&&this.preview)return this.preview.start(e,o);if(Modernizr.msie||Modernizr.msie11){new Op({$parent:(0,me.default)("body > .popups"),router:this,opts:{type:"type-browsers-viewer"}}).render();return}o||(o=1),this.togglePreviewMode(!0);let r=this;if(this.previewMag&&delete this.previewMag,this.previewMag=new dc({num_id:e}),this.mag||(this.mag=new dc({num_id:e})),r.preview&&(r.preview.mag?.off("pageChanged",r.onPreviewPageChanged),r.preview.destroy(),delete r.preview),Na()){let[i,n]=this.mag?.get("_id")?[this.mag,void 0]:await new Promise((p,m)=>{let u=new dc({num_id:e});u.loadFull({success:g=>{u.edit_params=new uf(u.get("edit_params"),u),u.filterUnusedFonts(),p([u,ph(g)])},error:m})}),s=o.toString(),c=i.pages.find(p=>p.get("num").toString()===s||p.get("pagePath")===s)??i.pages.models[0],d=c.get("pagePath")||c.get("num").toString();s!=="1"&&s!==d&&this.navigate(`edit/${e}/preview/${d}/`,{replace:!0}),this.isOwner=this.isOwner??De.default.isEmpty(i.get("shared")),this.fonts=this.fonts??new Kh(i.edit_params),this.me.mergePermissions(i.user.get("permissions")),Xn.init(this.me.get("permissions")),this.unmountPreviewNext=c6(document.querySelector("#mags"),{initialPagePath:d,initialPageId:c.id,initialScrollTop:this.workspace?.getScrollTop(),router:this,constructorProject:i,previewProject:n,viewport:window.sessionStorage.getItem("constructorViewport")||"default",projectNumId:e,projectUri:`/edit/${e}/preview`,featureFlags:window.ServerData.featureFlags,serverSideConfig:window.ServerData.config})}else this.previewMag.loadFull({success:function(i){!r.previewMode||r.preview||Ou(et.usedWidgets(i.pages)).finally(()=>{i.$constructor=(0,me.default)("#constructor"),r.preview=new d_({...i}),r.me.mergePermissions(r.previewMag.user.get("permissions")),Xn.init(r.me.get("permissions")),r.trigger("previewMag:load:success",r.preview),r.preview.setScroll((0,me.default)("#main").scrollTop()),r.preview.go(o,{isPageNum:t,isTemplateSubmission:si.default.history.getFragment().indexOf("/template-submission/")>-1}),r.setTitle("Preview"),r.isOwner=i.user?.email===r.me.get("email"),r.preview.mag.$el.scrollTop(0),r.preview.mag.on("pageChanged",r.onPreviewPageChanged),i&&r.renderPreviewToolbar(i.changed,i.is_published)})},parse:!1});this.renewScreenshot()},onPreviewPageChanged(e,o){this.trigger("previewPageChange",e,o)},setPressedKey(e,o){o?this.pressedKeySet.add(e):this.pressedKeySet.delete(e)},isKeyPressed(e){return this.pressedKeySet.has(e)},async togglePreview({pageNumber:e,scrollTop:o,reload:t}={}){if(this.switchingModes)return;this.switchingModes=!0,tl()||se(he.Preview,{preview:this.previewMode?"Out":"In"}),this.previewMode?this.projectVersionObserver?.startTracking():this.projectVersionObserver?.stopTracking();let r=this.mag.get("num_id");if(Na()){let i=!this.previewMode,n=e||1,s=this.mag.pages.find(c=>c.get("num")===n),l=i?`edit/${r}/preview/${n===1?"":s?(s.get("pagePath")||n)+"/":""}`:`edit/${r}/${n}/`;if(this.scrollTop=o,i&&await new Promise(c=>this.saveActiveBlock(c)),t){let c=new URL(window.location.href);c.pathname=l,window.location.href=c.toString();return}else this.navigate(l,{trigger:!0});(0,me.default)("html").toggleClass("preview-mode",i),setTimeout(()=>this.switchingModes=!1,this.PREVIEW_DELAY),i||await Rp.trackDailyVisit({location:"editor",role:Ze.getRoleForAnalytics(this.isOwner)})}else if(this.previewMode){if(!this.preview){this.animation=!1;return}let i="edit/"+this.mag.get("num_id")+"/"+(this.preview.mag.currentPage?this.preview.mag.currentPage.num:1)+"/";if((this.preview&&this.preview.mag.hasCodeInjection||this.mag.hasCodeInjection||De.default.noop)()){window.location.href="/"+i;return}else this.navigate(i,{trigger:!0});(0,me.default)("html").removeClass("preview-mode"),setTimeout(()=>this.switchingModes=!1,this.PREVIEW_DELAY),Rp.trackDailyVisit({location:"editor",role:Ze.getRoleForAnalytics(this.isOwner)})}else{let i=this.workspace?this.workspace.getPageNum():1;this.saveActiveBlock(()=>{let n="edit/"+this.mag.get("num_id")+"/preview/num/"+i+"/";if(this.mag.hasCodeInjection()){window.location.href="/"+n;return}else this.navigate(n,{trigger:!0});(0,me.default)("html").addClass("preview-mode"),setTimeout(()=>this.switchingModes=!1,this.PREVIEW_DELAY)})}},togglePreviewMode:function(e){let o=!!e;if(o===this.previewMode)return;o&&this.renewScreenshot(),this.previewMode=o;let t=De.default.bind(function(){this.previewAnimating=!1,o?(0,me.default)("#main-background").hide():(this.setTitle("Edit"),Na()?(typeof this.unmountPreviewNext=="function"?this.unmountPreviewNext():console.error("Cannot destroy the preview"),delete this.unmountPreviewNext):(this.preview&&this.preview.mag?.off("pageChanged",this.onPreviewPageChanged),this.preview&&this.preview.destroy(),delete this.preview),this.workspace&&this.workspace.showUsedViewport(),this.workspace&&this.workspace.onResize())},this);if((0,me.default)("body").toggleClass("preview",o),this.previewAnimating=!0,o)(0,me.default)("#constructor").find(".navigation-arrow").fadeOut(this.PREVIEW_DELAY),(0,me.default)("#main, #widgetbar, .controls, #float-panels, .page-size-control").addClass("goout"),Na()?t():(0,me.default)(".mag").fadeIn(this.PREVIEW_DELAY,t),(0,me.default)(".page-content-container").attr("style",""),this.workspace&&this.workspace.onResize();else{let r=Na()?this.scrollTop:this.preview?this.preview.getScroll():0;this.scrollTop=0,this.arrows.onPageChange(this.workspace),(0,me.default)("#main, #widgetbar, .controls, #float-panels, .page-size-control").removeClass("goout"),(0,me.default)("#main-background").show(),this.workspace&&this.workspace.onResize(),Na()?t():(0,me.default)(".mag").fadeOut(this.PREVIEW_DELAY,t),(0,me.default)("#main").scrollTop(r)}this.trigger("togglePreview",o)},saveActiveBlock:function(e=me.default.noop){let o;if(!this.workspace)return e();let t=this.workspace.getSelectedBlocks(),r=t[0];t.length!==1&&(r={model:this.workspace.syncManager.groupSave});let i=n=>{o=setTimeout(()=>{this.stopListening(r.model),e()},n)};i(200),this.listenToOnce(r.model,"request",()=>{i(3e3),this.listenToOnce(r.model,"sync",()=>{clearTimeout(o),e()})}),this.workspace.trigger("deselect")},setTitle:function(e){window.document.title=this.mag?"Readymag \u2022 "+(this.mag.get("title")||"Project")+" \u2022 "+(e||""):"Readymag \u2022 Constructor"},isActiveMinimalUI:function(){return(0,me.default)("html").hasClass(this.minimalUiClassName)},toggleMinimalUI:function(e=!this.isActiveMinimalUI()){(0,me.default)("html").flashClass(`${this.minimalUiClassName}-no-transition`,100),setTimeout(()=>{e?((0,me.default)("html").addClass(this.minimalUiClassName),this.widgetbar?.hide()):((0,me.default)("html").removeClass(this.minimalUiClassName),this.widgetbar?.show())},20)},toggleHideControls:function(e){(0,me.default)("html").toggleClass(this.hideControlsClassName,e)},isDisabledKeysList:function(e,o){let t=e.keyCode,r=o.find(({key:n})=>n===t);if(!r)return!1;let{optionKeys:i}=r;return i?(Array.isArray(i)?i:[i]).some(s=>e[`${s}Key`]):!0},isKeyDisabledByRole:function(e){return Object.entries(this.disabledKeysMap).some(([o,t])=>this.isDisabledKeysList(e,t)&&!Ze.isPermissionAllowed(o))},isDisabledKeysCommentMode:function(e){if(this.workspace?.getCommentModeState?.())return this.isDisabledKeysList(e,this.disabledKeysCommentMode)},onKeyDown:function(e){if(this.isKeyDisabledByRole(e)||this.isDisabledKeysCommentMode(e)||e.target.tagName.toLowerCase()=="input"||e.target.dataset&&e.target.dataset.text||e.target.tagName.toLowerCase()==="textarea"&&!e.target.classList.contains("copyhack")||e.target.getAttribute("contenteditable")||this.previewMode||!De.default.isEmpty(RM.common.disableShortcuts))return;this.altAlonePressed=!1;let o=this.workspace&&this.workspace.getSelectedBlocks().length;e.keyCode===me.default.keycodes.alt&&(this.altAlonePressed=!0);let t=this.workspace&&!this.isCurrentPageLocked(),r;switch(this.setPressedKey(e.keyCode,!0),e.keyCode){case me.default.keycodes.tab:{let i=document.activeElement;if((0,me.default)("#controls-portal").get(0).contains(i))return;this.toggleMinimalUI(),e.preventDefault();break}case me.default.keycodes.esc:break;case me.default.keycodes.left:if(r=t&&this.workspace.moveSelected(e,"left"),!r&&!o||this.isCurrentPageLocked())return this.go("prev"),!1;break;case me.default.keycodes.right:if(r=t&&this.workspace.moveSelected(e,"right"),!r&&!o||this.isCurrentPageLocked())return this.go("next"),!1;break;case me.default.keycodes.up:if(r=t&&this.workspace.moveSelected(e,"up"),!r&&!o||this.isCurrentPageLocked())return this.go("prev"),!1;break;case me.default.keycodes.down:if(r=t&&this.workspace.moveSelected(e,"down"),!r&&!o||this.isCurrentPageLocked())return this.go("next"),!1;break;case me.default.keycodes.backspace:e.preventDefault(),e.stopPropagation();case me.default.keycodes.del:return this.isCurrentPageLocked()?!0:(this.workspace.viewport!=="default"&&RM.constructorRouter.trigger("notice:triggerMetrics","widgetDeletedOnMobile"),this.workspace&&this.workspace.deleteSelectedBlocks(),!1);case me.default.keycodes.w:break;case me.default.keycodes.t:return e.ctrlKey||e.metaKey||this.isCurrentPageLocked()?!0:(this.workspace.addWidget({type:"text",version:3},{useDefaults:!0}),e.preventDefault(),e.stopPropagation(),!1);case me.default.keycodes.g:if(e.ctrlKey||e.metaKey||this.isCurrentPageLocked())return!0;this.mag.edit_params.get("guides")&&this.mag.edit_params.toggle("guides"),RM.constructorRouter.trigger("notice:triggerMetrics","gridsShortcutPressed"),this.mag.edit_params.toggle("grid");break;case me.default.keycodes.h:if((e.ctrlKey||e.metaKey)&&!e.shiftKey||this.isCurrentPageLocked())return!0;if((e.ctrlKey||e.metaKey)&&e.shiftKey)return e.preventDefault(),this.workspace.changeVisibilityForSelectedBlocks(),!0;this.mag.edit_params.get("grid")&&this.mag.edit_params.toggle("grid"),this.mag.edit_params.toggle("guides"),He("TurnOffGuides");break;case me.default.keycodes.l:if(!(e.ctrlKey||e.metaKey)||!e.shiftKey)return!0;e.preventDefault(),this.workspace.changeLockForSelectedBlocks();break;case me.default.keycodes.s:if(this.isCurrentPageLocked())return!0;this.mag.edit_params.toggle("snap");break;case me.default.keycodes.x:if(e.ctrlKey||e.metaKey)return!0;this.mag.edit_params.toggle("sizes");break;case me.default.keycodes.p:break;case me.default.keycodes.v:this.isAnyModeActive()?this.disableCurrentMode():this.workspace&&this.workspace.trigger("specialKeydown",e);break;case me.default.keycodes.alt:case me.default.keycodes.shift:case me.default.keycodes.f:this.workspace&&this.workspace.trigger("specialKeydown",e);break}},navigate:function(e,o){si.default.Router.prototype.navigate.apply(this,arguments),this.afterNavigate(e,o)},afterNavigate:function(){RM.analytics&&RM.analytics.trackPage()},onKeyUp:function(e){if(!(e.target.tagName.toLowerCase()=="input"||e.target.dataset&&e.target.dataset.text||e.target.tagName.toLowerCase()==="textarea"&&!e.target.classList.contains("copyhack")||e.target.getAttribute("contenteditable"))&&!this.previewMode&&De.default.isEmpty(RM.common.disableShortcuts))switch(e.keyCode==me.default.keycodes.alt&&this.altAlonePressed&&e.preventDefault(),this.setPressedKey(e.keyCode,!1),e.keyCode){case me.default.keycodes.alt:case me.default.keycodes.shift:case me.default.keycodes.v:case me.default.keycodes.f:this.workspace&&this.workspace.trigger("specialKeyup",e);break}},onBrowserTabBlur:function(){this.workspace&&this.workspace.trigger("specialKeyup",{type:"keyup",keyCode:me.default.keycodes.alt,altKey:!1}),this.workspace&&this.workspace.trigger("specialKeyup",{type:"keyup",keyCode:me.default.keycodes.v}),this.workspace&&this.workspace.trigger("specialKeyup",{type:"keyup",keyCode:me.default.keycodes.f})},onBrowserTabFocus:function(){this.makeUserActive()},onSelectAllKey:function(){this.workspace&&this.workspace.trigger("selectAll")},onNumericKey:function(e){this.workspace&&this.workspace.getSelectedBlocks().length?this.workspace.changeBlocksOpacity(e.keyCode-48):e.keyCode>=49&&e.keyCode<=51?this.onViewportKey(e.key):e.keyCode===68&&this.onViewportKey(String(this.viewportCounter))},onViewportKey:function(e){if(this.previewMode||!De.default.isEmpty(RM.common.disableShortcuts))return;let o=this.workspace.getViewports().some(n=>n.name==="tablet_portrait"&&n.enabled),t=this.workspace.getViewports().some(n=>n.name==="phone_portrait"&&n.enabled),r=this.workspace.getViewports().filter(n=>n.enabled===!0).length;this.viewportCounter=dt.incrementCircular(this.viewportCounter,r);let i;e==="1"?i="default":e==="2"&&o?i="tablet_portrait":e==="3"&&t||e==="2"&&!o?i="phone_portrait":i=void 0,i&&this.workspace&&this.workspace.trigger("viewportShortcutPressed",i)},onChangeDevice(e){if(!this.workspace)return;let o=this.workspace.viewport,t=Qp[e],r=t!==o,i=(this.workspace.page.get("viewport_"+t)||{}).enabled||t==="default";r&&i?this.workspace.setViewport(t):r?Re.trigger("togglePanel","viewports"):t==="phone_portrait"&&i&&(this.workspace.onResize(),this.workspace.updateWorkspaceViewport())},go:function(e){let o=this.workspace.findPage(e);o&&this.showWorkspace({id:o})},globalKeyPress:function(e){if(this.isKeyDisabledByRole(e)||this.isDisabledKeysCommentMode(e)||!De.default.isEmpty(RM.common.disableShortcuts))return;let o=e.target.tagName.toLowerCase()=="input"||e.target.dataset&&!!e.target.dataset.text||e.target.tagName.toLowerCase()==="textarea"&&!e.target.classList.contains("copyhack")||e.target.getAttribute("contenteditable"),t=this;for(let r in this.keys)this.keys[r]===e.keyCode&&De.default.each(this.keyHandlers[r],function(i){(!o||i.activeOnInput)&&!De.default.any(["ctrl","alt","shift","meta"],function(s){return e[s+"Key"]!=De.default.include(i.optionKeys,s)})&&e.type=="keydown"&&(!t.isCurrentPageLocked()||i.activeOnLock)&&(e.preventDefault(),i(e))})},bindGlobalKeyPress:function(e){let o=De.default.bind(function(t){let r=t.key.toLowerCase();this.keyHandlers[r]=this.keyHandlers[r]||[],De.default.isArray(t.optionKeys)||(t.optionKeys=[t.optionKeys]),t.handler.optionKeys=t.optionKeys,t.handler.activeOnLock=t.activeOnLock,t.handler.activeOnInput=t.activeOnInput,this.keyHandlers[r].push(t.handler)},this);De.default.isArray(e)?De.default.each(e,function(t){o(t)},this):o(e)},unbindGlobalKeyPress:function(e,o){if(!o)delete this.keyHandlers[e];else{let t=[];De.default.find(this.keyHandlers[e],function(r){r!=o&&t.push(r)}),this.keyHandlers[e]=t}},initScreenshotRenewer:function(){this.on("redrawPage",this.onPageRedraw),this.screenshotDates=De.default.range(1,this.mag.pages.length)},onPageRedraw:function(e){this._pageChanged?this._pageChanged!=e&&(this.renewScreenshot(),this._pageChanged=e):this._pageChanged=e},async renewScreenshots(){let e=this.mag.pages.filter(o=>!o.has("screenshot"));if(e?.length)return this.renewScreenshotsPromise=this.renewScreenshotsPromise.then(async()=>{for(let o of e)await o.updateScreenshots(this.mag.get("num_id"))}),this.renewScreenshotsPromise},async renewScreenshot(){if(!this._pageChanged)return;let e=this._pageChanged;this._pageChanged=!1;try{await this.mag.pages.findWhere({_id:e})?.updateScreenshots(this.mag.get("num_id"))}catch{console.error("Screenshoter error")}},notFound:function(){(0,me.default)(function(){(0,me.default)("#constructor").hide(),(0,me.default)("#mags").hide(),De.default.defer(function(){new Lk({type:"404",$container:(0,me.default)("#service-pages")}).render()})})},undo:function(){if(this.previewMode)return;let e=this.workspace&&this.workspace.page;e&&Ot.undo(e.id),Ge("widget.anomalyMonitoring")&&nc.onAction("Undo"),RM.constructorRouter.trigger("notice:triggerMetrics","countActionsCanceled")},redo:function(){if(this.previewMode)return;let e=this.workspace&&this.workspace.page;e&&Ot.redo(e.id),Ge("widget.anomalyMonitoring")&&nc.onAction("Redo")},onCut:function(e){if(this.isCurrentPageLocked()||(0,me.default)(e.target).is(this.workspaceTextInputSelectors))return!0;this.onCopy.apply(this,[...arguments]),this.workspace&&this.workspace.deleteSelectedBlocks()},onCopy:function(e){if(this.previewMode)return;if((0,me.default)(e.target).is(this.workspaceTextInputSelectors))return!0;let o=Sy.convertToClipboard({blocks:this.workspace.getSelectedBlocks(),pageId:this.workspace.page.id,magNumId:this.mag.get("num_id"),indexController:this.indexController,workspace:this.workspace});o&&(e.originalEvent.clipboardData.setData("text/plain",JSON.stringify(o)),e.preventDefault())},onPaste:function(e){let o=this.isKeyPressed(16);if(o&&!De.default.isEmpty(this.animationPasteData))return this.onPasteAnimation(e);if(this.isCurrentPageLocked()||!Ze.isPermissionAllowed("BaseWidgetCanAdd")||this.previewMode)return;if((0,me.default)(e.target).is(this.workspaceTextInputSelectors))return!0;this.workspace&&this.workspace.trigger("specialKeyup",{keyCode:me.default.keycodes.v,type:"keyup"});let t=e.originalEvent.clipboardData;if(t&&t.items&&t.items.length&&/image/i.test(t.items[0].type))return!0;let r=De.default.reduce(t.types,function(i,n){return i+" "+n},"");if(/text/i.test(r)&&!/files/i.test(r)){let i=(e.originalEvent.clipboardData.getData("text/plain")||"").trim(),n;try{let s=JSON.parse(i);for(let l of s.blocks)if(l.code){let c=vd.sanitize(l.code,{FORCE_BODY:!0,ADD_TAGS:["script","style"],ADD_ATTR:["onclick","onload","style"],ALLOWED_URI_REGEXP:/.*/});l.code=c}n=JSON.parse(JSON.stringify(s))}catch{}if(n&&n.object==="rm_figma_pastedata"&&!De.default.isEmpty(n.blocks))return this.pasteDataFromFigma(n,{isPastingAsPage:o}),!1;if(o)return!1;if(n&&n.object=="rm_pastedata"&&!De.default.isEmpty(n.blocks))return this.workspace.pasteBlocks(n),!1;if(i&&i!=="\u200C"){let s=e.originalEvent.clipboardData.getData("text/html"),l=nv({text:i,html:s});return this.workspace.addWidget({type:"text",version:3,...l},{useDefaults:!0}),!1}}return!0},pasteDataFromFigma:async function(e,o={}){let{isPastingAsPage:t}=o,r=t?"Pasting page from Figma":"Pasting elements from Figma",i=()=>lx("Pasting failed. Please try again","Error"),n=A=>lx(r,"Default",A);n(0);let s=null,l=[];for(let A of e.blocks)if(!(!A||!A.type)){if(A.type==="background"){s=A;continue}l.push(A)}let c=e.mag_edit_params?.unprocessedLinkStyles||{},d=e.mag_edit_params?.unprocessedFonts||{},p=this.mag.edit_params.get("fonts"),m=this.mag.getFontsShortList(),u=ja(),g=[],h=[];try{let A=await P6({blocks:l,unprocessedLinkStyles:c,unprocessedFonts:d,linkProjectStyles:u.project,projectFonts:p,fontShortList:m});g=A.newLinkStyles,h=A.importedFonts}catch{i();return}delete e.mag_edit_params?.unprocessedFonts,delete e.mag_edit_params?.unprocessedLinkStyles,e.mag_edit_params.fonts=[...h],e.mag_edit_params.linkStyles=[...g];let b={...e.rootSize},x={...e.rootBoundingBox};delete e?.rootSize,delete e?.rootBoundingBox;let S=this.workspace.viewport,y=z6(l),C=window.RM.constructorRouter.zoom.getZoom(),P=this.workspace.getOriginBox(),v=this.workspace.getViewportPosition(),T={width:P.width,height:P.height},R={left:v.left,top:v.top,width:v.viewportWidth,height:v.height},I=t?T6({width:x.width,height:x.height},{width:y.w,height:y.h},S):{width:v.width,height:v.pageHeight},M=t?I6({boundingBox:y,originSize:T,pageSize:I,rootSize:b}):M6({boundingBox:y,originSize:T,zoom:C,pageSize:I,viewportBox:R});B6(l,M);let D=async A=>{let $=0,pe=await R6(A,K=>{$=K/A.length*100,n(Math.round($))}),ee=100-$,G=1/l.length*ee;this.workspace.pasteBlocks({...e,blocks:pe},{invisible:!0,onComplete:()=>{setTimeout(uh,300),se(he.EditorActions,{action:"import from figma",figmaImportMethod:t?"page":"elements"})},onError:()=>i(),onBlockAdded:()=>{$+=G,n(Math.round($))}})};if(!t){if(l.length>0)try{await D(l)}catch{i();return}else setTimeout(uh,300);return}let E={default:"desktopWidth",phone_portrait:"phoneWidth",tablet_portrait:"tabletWidth"}[S];try{s&&this.workspace.getBackground().model.save({color:s.color}),this.workspace.page.setViewportParam(S,"height",I.height),this.workspace.page.saveHeight(),await this.mag.save({[E]:I.width},{patch:!0}),l.length>0?await D(l):uh()}catch{i();return}},onCopyTextStyles:function(e){let o=this.workspace.getSelectedBlocks();o.length===1&&o[0].model.get("type")==="text"&&(e.preventDefault(),o[0].storeCopiedStyles())},onPasteTextStyles:function(e){e.preventDefault();let o=this.workspace.getSelectedBlocks();o.length===1&&o[0].model.get("type")==="text"&&o[0].applyCopiedStyles()},onCopyAnimation:function(e){if(e.preventDefault(),delete this.animationPasteData,this.previewMode)return;if((0,me.default)(e.target).is(this.workspaceTextInputSelectors))return!0;let o=this.workspace.getSelectedBlocks(),t=o.reduce((i,n)=>{let s=ll.getUuidHash(n.model.getAnimations())||"none";return{...i,[s]:!0}},{}),r=De.default.keys(t);!r.length||r.length>1||r[0]==="none"||o.length&&(this.animationPasteData=nt(o[0].model.getAnimations()))},onPasteAnimation:function(e){if(e.preventDefault(),De.default.isEmpty(this.animationPasteData)||this.previewMode)return;if((0,me.default)(e.target).is(this.workspaceTextInputSelectors))return!0;let o=De.default.map(this.workspace.getSelectedBlocks(),De.default.bind(function(t){let r=this.animationPasteData.find(s=>s.type==="click"),i=this.workspace.viewport!=="default",n=nt(this.animationPasteData).map(s=>({...s,type:i&&s.type==="hover"?r?"none":"click":s.type,UUID:et.generateUUID()}));return{_id:t.model.get("_id"),animation:n}},this));De.default.isEmpty(o)||(this.workspace.save_group(o),this.workspace.trigger("paste-animation"))},forbidAccess:function(){window.location.href="/"},raiseConnectionError:function(){let e=this;this.connectionError||this.socketConnectionError||(this.connectionError=!0,this.trigger("showConnectionAlert"),clearInterval(this.pingTimer),this.pingTimer=setInterval(function(){e.pingXHR&&e.pingXHR.abort(),e.pingXHR=me.default.get("/api/ping",function(){clearInterval(e.pingTimer),e.clearConnectionError()})},this.PING_INTERVAL))},clearConnectionError:function(){let e=[],o=0;this.connectionError&&(this.connectionError=!1,De.default.each(this.workspaces,function(t){De.default.each(t.blocks,function(r){r.model.wasNotSaved&&e.push(r.model)})}),this.syncManager?.groupSave?.wasNotSaved&&e.push(this.syncManager.groupSave),e.length===0&&this.trigger("hideConnectionAlert"),De.default.each(e,t=>{t.once("re-saved",()=>{o++,o===e.length&&this.trigger("hideConnectionAlert")}),t.save()}))},raiseSocketConnectionError:function(){RM.DEBUG&&console.log("Socket connection error raised"),!this.socketConnectionError&&(this.connectionError&&(clearInterval(this.pingTimer),this.connectionError=!1,this.trigger("hideConnectionAlert")),this.socketConnectionError=!0,this.trigger("showSocketConnectionAlert"))},clearSocketConnectionError:function(){RM.DEBUG&&console.log("Socket connection error cleared"),!(this.sockets.errorRaisedAt-Date.now()>60*1e3)&&this.mag.fetchLastChanged(De.default.bind(function(e){e.wasChanged||(this.trigger("hideSocketConnectionAlert"),delete this.sockets.errorRaisedAt,delete this.socketConnectionError)},this))},showBlockLayer:function(e,o){let t=(0,me.default)("<div>").insertAfter("#constructor").addClass("rm-block-layer");return typeof e=="function"&&t.on("click",e),o&&(o.darker?t.addClass("darker"):o.transparent&&t.addClass("transparent")),De.default.delay(function(){t.addClass("fade-in")},20),t},hideBlockLayer:function(e){e&&(e.removeClass("fade-in"),De.default.delay(function(){e.remove()},220))},exportMagAsTemplateset:function({dontRenewScreenshots:e,isSharedAsTemplate:o,templateSettings:t}){let r=new(si.default.Model.extend({url:"/api/templateset/"})),i=[],n=[],s=this.mag.hasGlobalWidgets()?{withGlobalWidgets:!0}:{};De.default.each(this.mag.pages.models,function(l){let c=this.getWorkspace(l.get("_id"));if(!c)return;let d=c.getTemplateJSON(s);d&&(n=De.default.uniq(n.concat(d.globalWids),"_id"),delete d.globalWids,i.push(d))},this),n.length&&i.forEach(l=>{l.wids=l.wids.concat(n)}),i.length&&r.save({templates:i,mag_num_id:this.mag.get("num_id"),mag_title:this.mag.get("title")||"Project "+this.mag.get("num_id"),dontRenewScreenshots:e,isSharedAsTemplate:o,templateSettings:t})},switchCurrentPage:function(e){this.inactiveUser&&this.makeUserActive(e),this.inactivityTimer&&this.startInactivityTimer(),this.sockets&&this.sockets.users_list&&this.sockets.users_list.size()>1&&this.renewScreenshot(),this.sockets&&this.sockets.lockPage(e)},onLockMessage:function(e){e.length||(e=[e]);let o=this.workspace.locked;this.lockCache=this.lockCache||{},De.default.each(e,De.default.bind(function(t){let r=t.userId,i=t.pageId;t.tp==="lock"&&(this.lockCache[i]=r,Re.trigger("page:locked",i,r)),t.tp==="unlock"&&(delete this.lockCache[i],Re.trigger("page:unlocked",i))},this)),this.workspace&&this.workspace.updateLockState(),o&&!this.workspace.locked&&this.lockCache[this.workspace.page.id]==this.me.id&&this.workspace.page.needUpdate&&this.mag.pages.fetchFullPage(this.workspace.page.id)},onClientDisconnected:function(e){this.lockCache=this.lockCache||{};for(let o in this.lockCache)this.lockCache[o]===e&&delete this.lockCache[o]},syncLockedPages:function(){this.workspace&&this.workspace.updateLockState()},isPageLocked:function(e){return this.lockCache&&this.lockCache[e]&&this.lockCache[e]!=this.me.id},isPageLockedByMe:function(e){return this.lockCache&&this.lockCache[e]&&this.lockCache[e]==this.me.id},isCurrentPageLocked:function(){return this.workspace&&this.isPageLocked(this.workspace.page.get("_id"))},getLockUserInfoByPage:function(e){let o=this.lockCache&&this.lockCache[e];return this.sockets&&this.sockets.users_list&&this.sockets.users_list.get(o)},unlockPage:function(e){this.sockets&&this.sockets.takeOver(e.get("_id")),this.closeCodeEditor()},showUnlockPageAlert:function(e){let o=e.get("name"),r=(i=>{if(!i)return"";let[n,s]=i.split(" ");return s?n[0]+s[0]:n[0]})(o);this.workspace&&this.workspace.setViewport("default"),this.workspace&&this.workspace.trigger("deselect"),this.alertSharedUnlockPage&&this.alertSharedUnlockPage.hide(),this.alertSharedUnlockPage=this.alertSharedUnlockPage||new Op({$parent:(0,me.default)("body > .popups"),router:this.router,opts:{type:"type-shared-unlock-page",text:`
            <div class="avatar">${r}</div>
            <div>${o} is editing the project now </div>
            <span class="text-secondary">
              Multiple users cannot edit the <br/> project simultaneously.
              Please <br/> conact ${o} to regain access
            </span>
          `,close_button:!0},alert_source:"shared unlock page"}),this.alertSharedUnlockPage.render(),this.alertSharedUnlockPage.once("hide",function(){delete this.alertSharedUnlockPage},this)},updateFromSocket:function(e){let o=De.default.bind(function(h){let b=this.mag.pages.get(h);b&&(RM.DEBUG&&console.log(b,"needUpdate"),b.needUpdate=!0)},this),t=(h,b)=>{if(!b)return;let x=this.mag.getWidgetById(h);if(x)x.parse(De.default.omit(b,["_id","is_global","is_above"]),{parse:!0,socketUpdate:!0});else{let S=this.mag.getPage(b.pid);S&&(x=S.addWidget(b,{socketUpdate:!0,nosave:!0}))}x&&this.syncManager&&(this.syncManager.historyModelsList[h]={model:x,attrs:x.cloneJSON()})};RM.DEBUG&&console.log("receive socket update",e.modelName,e.data);let r=(h,b,x)=>h!==this.workspace.viewport?De.default.omit(x,["wids",...Oe.widgetViewportFields(b)]):De.default.omit(x,["wids"]);switch(this.mag.updateLastChanged(),e.modelName){case"Widget":var g=e.data.pid;o(g);var i=this.mag.pages.get(g);if(i===this.workspace.page||e.data.is_global){let h=i.widgets.get(e.data._id);if(!h)return;if(h.set(r(e.viewport,h.get("type"),e.data),{parse:!0,first:!0,socketUpdate:!0}),h.get("is_global")&&e.viewport!==this.workspace.viewport){let b=De.default.pick(e.data,[...Oe.widgetViewportFields(h.get("type"))]);De.default.isEmpty(b)||(h[`viewport_${e.viewport}`]={...h[`viewport_${e.viewport}`]||{},...b})}}else if(i&&i!==this.workspace.page){if(i.widgets.get(e.data._id))return;let b=new Lu(e.data);i.addWidget(b,{socketUpdate:!0,silent:!0,nosave:!0,updateIndex:!1})}break;case"Page":var g=e.data._id;o(g);var i=this.mag.pages.get(g);if(!i)return;if(i==this.workspace.page&&!De.default.isEqual(i.get("wids"),e.data.wids)){this.mag.pages.fetchFullPage(i.id);break}i.set(e.data,{parse:!0,socketUpdate:!0});break;case"Mag":if(e.data.pids){let h=De.default.difference(e.data.pids,this.mag.get("pids"));this.mag.set({pids:De.default.difference(e.data.pids,h)},{socketUpdate:!0}),De.default.each(h,function(b){this.mag.pages.fetchFullPage(b,{socketUpdate:!0,success:De.default.bind(function(){this.syncLockedPages()},this)})},this)}this.mag.set(De.default.omit(e.data,"pids"),{parse:!0,socketUpdate:!0});break;case"PageOrder":var n=RM.constructorRouter.mag.getPageUri(RM.constructorRouter.workspace.page.id)+"/",s=si.default.history.getFragment().split("?")[0],l=s.indexOf(n)==s.length-n.length;this.pageOrder.set(e.data,{parse:!0,socketUpdate:!0}),this.pageOrder.orderPages(e.data.order,{socketUpdate:!0}),l&&(this.updateUrl(),this.workspace&&this.trigger("pageChange",this.workspace)),this.syncLockedPages();break;case"MagEditParams":{let h=nt(this.mag.edit_params.toJSON());this.mag.edit_params.set(e.data,{parse:!0,socketUpdate:!0}),this.mag.triggerEditParamsRewrite(h,e.data);break}case"TextStyles":Np({...Wp(),...e.data});break;case"LinkStyles":Vp({...ja(),...e.data});break;case"ListStyles":Up({...Gp(),...e.data});break;case"Swatches":Oy({...$y(),...e.data});break;case"Guides":if(Ge("constructor.guidesPerUser"))break;var c=e.data._id,d=this.gg.guides&&this.gg.guides.models;if(!d||!d.get)return;var p=d.get(c);p&&p.set(e.data,{parse:!0,socketUpdate:!0});break;case"GroupSave":var m={parse:!0,first:!0,socketUpdate:!0},u=this.workspace?.viewport;if(u&&Array.isArray(e.data.changes)){let h=[];e.data.changes.forEach(b=>{if(b.modelType!=="widget"){h.push(b);return}let x=b;b.is_global&&e.data.widgetsAttrs&&e.data.widgetsAttrs[b._id]&&t(b._id,e.data.widgetsAttrs[b._id]),e.viewport===u?u!=="default"&&(x={...De.default.omit(b,`viewport_${e.viewport}`),...b[`viewport_${e.viewport}`]}):e.viewport==="default"&&typeof b.is_global>"u"&&typeof b.is_above>"u"&&typeof b.is_locked>"u"&&(x={...De.default.pick(b,["_id","modelType"]),viewport_default:De.default.omit(b,["_id","modelType"])}),h.push(x)}),h.length&&(e.data.changes=h)}this.workspace.set_group(e.data.changes,m),De.default.each(e.data.pids,function(h){o(h)});break;case"TrashPages":{let h=e.data,b=x=>this.mag.pages.get(x)||this.mag.trashPages.get(x)||this.workspace.syncManager.historyModelsList[x]?.model;if(h.added){let x=b(h.added);x&&this.mag.trashPages.add(x,{socketUpdate:!0})}else if(h.removed){let x=b(h.removed);x&&this.mag.trashPages.remove(x,{socketUpdate:!0})}else h.emptyTrash&&this.mag.trashPages.reset();this.mag.set("has_deleted_pages",this.mag.trashPages.length>0,{socketUpdate:!0});break}case"UpdateInMobileViewport":var g=e.data;g&&o(g);break;case"Order":this.indexController.updateFromSocket(e.data);break}},startInactivityTimer:function(o){var o=o||{time:"short"};this.inactiveUser||!this.sockets||(this.stopInactivityTimer(),this.inactivityTimer=setTimeout(De.default.bind(function(){this.sockets.leavePage(this.workspace.page.id),this.navigate("edit/"+this.mag.get("num_id")+"/contents/",{replace:!0}),this.inactiveUser=!0},this),this.inactivityTimesMap[o.time]))},stopInactivityTimer:function(){this.sockets&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null)},makeUserActive:function(e){this.sockets&&(this.stopInactivityTimer(),this.inactiveUser&&(delete this.inactiveUser,this.mag.fetchLastChanged(De.default.bind(function(o){o.wasChanged&&(this.workspace&&this.workspace.trigger("deselect"),De.default.defer(function(){window.location.reload()}))},this)),this.switchCurrentPage(e||this.workspace.page.id)))},openCodeEditor:function(e){window.RM.common.disableShortcuts["code-editor"]=!0,this.workspaceCodeEditor=new p_({router:this,mag:this.mag,model:e&&e.model}),this.workspaceCodeEditor.show(),this.widgetbar&&this.widgetbar.hide(),this.workspace&&this.listenTo(this.workspace,"panelShowed",this.closeCodeEditor),this.workspace&&this.listenTo(this.workspace,"select",this.closeCodeEditor),this.isCodeEditorVisible=!0},closeCodeEditor:function(e){!this.workspaceCodeEditor||!this.isCodeEditorVisible||(this.isCodeEditorVisible=!1,e||this.workspaceCodeEditor.saveCodes(),this.workspaceCodeEditor.hide(),this.widgetbar&&this.widgetbar.show(),this.workspace&&this.stopListening(this.workspace,"panelShowed",this.closeCodeEditor),this.workspace&&this.stopListening(this.workspace,"select",this.closeCodeEditor),delete window.RM.common.disableShortcuts["code-editor"])},reloadWorkspaces:function(){this.mag.loadFull({success:()=>{this.syncManager=new Vf(this,this.mag),Ot.initialize(this.syncManager),this.workspace&&this.workspace.trigger("deselect"),this.widgetbar&&this.widgetbar.rerender(),Re.trigger("closeSettings");for(let o in this.workspaces)this.removeWorkspace(o);let e=this.workspace.page.id;delete this.workspace,this.showWorkspace({id:e})},error:e=>{e.status!==403&&this.notFound()}})},isAnyModeActive:function(){let e=this.workspace?.getCommentModeState?.(),o=this.mag.edit_params.get("blocks"),t=Ze.getCurrentProjectRole(this.mag.get("num_id"))==="editor";return e||o||t},disableCurrentMode:function(){this.workspace?.getCommentModeState?.()&&hc(!1),this.mag.edit_params.get("blocks")&&this.changeBlocksMode(!1,!1),this.changeEditorMode("member")},changeBlocksMode:async function(e,o=!1){this.mag.edit_params.save("blocks",e),o&&(await this.changeEditorMode("member"),hc(!1))},toggleBlocksMode:async function(){let e=this.mag.edit_params.get("blocks");this.changeBlocksMode(!e,!0)},canChangeLockedLayoutMode:function(){return this.isOwner||this.mag.teamRole==="member"},changeEditorMode:async function(e,o=!1){if(o&&(this.mag.edit_params.save("blocks",!1),hc(!1)),!!this.canChangeLockedLayoutMode())try{let t=this.mag.get("num_id"),r=Ze.getCurrentProjectRole(t);if(e===r)return;this.mag.roleName=e,Ze.saveProjectRole(t,e),this.reloadWorkspaces(),Re.trigger("refreshTeamworkData"),e==="editor"&&se(he.ContentEditMode,{eventLabel:"on"})}catch{window.RM.constructorRouter.trigger("notice:show","Oops",{canBeClosed:!0})}},toggleSelfEditorMode:async function(){let e=this.mag.get("num_id"),t=Ze.getCurrentProjectRole(e)==="member"?"editor":"member";await this.changeEditorMode(t,!0)},destroy(){Re.off("change:device",this.onChangeDevice,this),Ge("widget.anomalyMonitoring")&&document.removeEventListener("click",nc.onClick)}}),E6=eW;var O6=B(Wb());KI();Za();st();var Ut=B($t()),An=B(pt());var Es=B($t()),L6=B(Mo()),As=B(pt());ui();tn();var A6={"template-constructor-search-panel":Lt`
	<div class="search-panel">
		<div class="search-panel-wrapper">

			<div class="search">
				<div class="search-wrapper">
					<input class="search-input"  spellcheck="false" maxlength="100" type="text" value="" data-testid="image-search-input"/>
					<div class="search-icon"></div>
					<div class="search-clear"></div>
				</div>
			</div>

			<div class="panel-title invisible"></div>
			<div class="back-button invisible"></div>

			<div class="scroll-wrapper">
				<div class="results-wrapper">
					<div class="results" data-testid="image-search-results">

						<div class="preloader-wrapper">
							<div class="rmpreloader">
								<div class="shadow"></div>
								<div class="arc"></div>
							</div>
						</div>

						<div class="message">
							<div class="top-text"></div>
							<div class="bottom-text"></div>
						</div>

					</div>
				</div>
				<div class="scroll"></div>
			</div>


			<a class="logo" href="" target="_blank"></a>


			<div class="logged-user">
				<a class="userpic" target="_blank"></a>
				<div class="logout">Logout</div>
			</div>

		</div>
	</div>
`};bh();var tW=L6.default.View.extend({initialize:function(e){this.initPanel(e)},initPanel:function(){As.default.bindAll(this)},render:function(){this.template=A6["template-constructor-search-panel"],this.setElement((0,Es.default)(this.template({})).insertAfter("#constructor")),this.$el.on("click",function(e){e.stopPropagation()}),this.$el.on("click",".search-icon",this.onSearchIconClick),this.$el.on("click",".search-clear",this.onSearchClearClick),this.$el.on("click",".back-button",this.onBackButtonClick),this.$el.find(".search-input").on("input propertychange",this.onInputChanged).on("keypress keyup keydown",this.onInputKey),this.scroll=(0,Es.default)(this.$(".scroll-wrapper")).RMScroll({$container:this.$(".scroll-wrapper .results-wrapper"),$content:this.$(".scroll-wrapper .results-wrapper .results"),$handle:this.$(".scroll-wrapper .scroll"),onScroll:this.onScroll}).data("scroll"),this.rendered=!0},onScroll:function(){},showPreloader:function(e){this.$(".results .preloader-wrapper").toggleClass("fill-content",e),this.$(".results .preloader-wrapper").removeClass("invisible"),this.$(".results .rmpreloader").css("display","block")},hidePreloader:function(e){this.$(".results .preloader-wrapper").toggleClass("invisible",e),this.$(".results .preloader-wrapper").removeClass("fill-content"),this.$(".results .rmpreloader").css("display","none")},showMessage:function(e,o){this.$(".results .message .top-text").text(e),this.$(".results .message .bottom-text").text(o),this.$(".results .message").css("display","block")},hideMessage:function(){this.$(".results .message").css("display","none")},showPanelTitle:function(e){let o=(0,Es.default)('<span class="space">'+(e||"").split("ct").join('c</span><span class="space">t')+"</span>");this.$(".panel-title").empty().append(o),this.$(".panel-title").toggleClass("invisible",!1)},hidePanelTitle:function(){this.$(".panel-title").toggleClass("invisible",!0)},showSearch:function(){this.$(".search").toggleClass("invisible",!1)},hideSearch:function(){this.$(".search").toggleClass("invisible",!0)},showBackButton:function(){this.$(".back-button").toggleClass("invisible",!1)},hideBackButton:function(){this.$(".back-button").toggleClass("invisible",!0)},onBackButtonClick:function(){},onInputChanged:function(){et.setInputSize(this.$(".search-input"),550),this.$(".search-clear").toggle(this.$(".search-input").val()!=="")},onSearchClearClick:function(){this.$(".search-input").blur(),this.emptySearchInput(),this.$(".search-input").focus()},onInputKey:function(e){if(e.stopPropagation(),e.keyCode===27&&e.preventDefault(),e.type==="keyup"){if(e.keyCode===27){this.$(".search-input").val()!==""?(this.$(".search-input").blur(),this.emptySearchInput(),this.$(".search-input").focus()):this.hide();return}e.keyCode===13&&(e.preventDefault(),this.newSearch())}},newSearch:function(){this.$el.hasClass("search-on-center")&&this.$(".search-input").val()&&(this.$el.removeClass("search-on-center"),this.onInputChanged())},onBodyKey:function(e){this.$(".search-input").is(":focus")||(e.keyCode===27&&(e.preventDefault(),e.stopPropagation()),e.type==="keyup"&&e.keyCode===27&&this.bodyEscKey())},bodyEscKey:function(){this.hide()},emptySearchInput:function(){this.$(".search-input").val("").width("3px"),this.$(".search-clear").hide()},onSearchIconClick:function(e){e.stopPropagation(),this.$(".search-input").focus(),this.newSearch()},onMouseWheel:function(e){e&&e.stopPropagation(),e&&e.preventDefault()},disableMouseWheel:function(){(0,Es.default)(document).bind("mousewheel",this.onMouseWheel)},enableMouseWheel:function(){(0,Es.default)(document).unbind("mousewheel",this.onMouseWheel)},show:function(e,o){if(import("https://st-p.rmcdn1.net/1ce0501a/dist/c/c-FK4O2EWF.js").then(({default:t})=>{t("searchpanel")}),this.$el.hasClass("search-on-center")&&e&&this.$el.removeClass("search-on-center"),this.settings=o,!this.rendered){this.render(),setTimeout(As.default.bind(function(){this.show(e,o)},this),0);return}this.disableMouseWheel(),this.$block_layer=RM.constructorRouter.showBlockLayer(this.hide),this.$el.removeClass("show-out").addClass("show-in").css("display","block"),setTimeout(As.default.bind(function(){this.$el.removeClass("show-in")},this),20),setTimeout(As.default.bind(function(){this.$el.css("width","+=1")},this),300),setTimeout(As.default.bind(function(){this.$el.css("width","-=1"),this.setFocusOnShow(),e&&this.newSearch()},this),300),e&&(this.emptySearchInput(),this.$(".search-input").val(e)),this.onInputChanged(),(0,Es.default)("body").on("keypress keyup keydown",this.onBodyKey)},setFocusOnShow:function(){this.$(".search-input").focus()},hide:function(e){e&&e.stopPropagation(),this.enableMouseWheel(),RM.constructorRouter.hideBlockLayer(this.$block_layer),(0,Es.default)("body").off("keypress keyup keydown",this.onBodyKey),this.$el.addClass("show-out"),setTimeout(As.default.bind(function(){this.$el.css("display","none")},this),200),setTimeout(As.default.bind(function(){Ls()},this),200)}}),Wa=tW;st();tn();var mh={"template-constructor-search-panel-unsplash":Lt`

    <div class="bottom-menu">
        <ul>
            <li data-item="search" class="searching active">Search</li>
            <li data-item="my-photos" class="my-photos">My&thinsp;&thinsp;Photos</li>
            <li data-item="my-collections" class="my-collections">My&thinsp;&thinsp;Collections</li>
        </ul>
        <span></span>
    </div>


    <div class="popup-image">
        <div class="image"></div>
        <div class="source-wrapper">
            <span class="copyright"> </span>
            <a class="source" target="_blank" href="">source</a>
        </div>
    </div>

`,"template-constructor-search-panel-unsplash-connect":Lt`
    <div class="connect-wrapper">
        <div class="connect-logo"></div>
        <div class="connect-button">Connect</div>
    </div>
`,"template-constructor-search-panel-unsplash-collection":Lt`
    <div class="collection" style="background-image: url('<%=collection.cover_photo.urls.thumb%>')" data-collection="<%=collection.id%>">
        <div class="greybg"></div>
        <div class="overlay">
            <div class="title"><%-collection.title%></div>
            <div class="count"><%-collection.total_photos%>&thinsp;&thinsp;photo<%-(collection.total_photos==1) ? '': 's'%></div>
        </div>
    </div>
`};var oW=Wa.extend({name:"searchUnsplash",params:{serviceUrl:"https://unsplash.com/",apiCredit:"?utm_source=readymag&utm_medium=referral&utm_campaign=api-credit",panelClass:"search-unsplash",PreloadDesignImagesType:"searchpanel-unsplash",per_page:30,imageHeight:98,imagePadding:7,imageMaxWidth:2,imageMinWidth:.5,maxImageSize:2880},noResultsText:{search:["Sorry, no photos found.","Try different keywords."],"my-photos":["You haven't uploaded any photos yet.",""],"my-collections":["You haven't created any collections yet.",""]},requestInAction:!1,searchParams:{query:""},curMenuItem:"search",initialize:function(e){this.initPanel(e)},render:function(){Wa.prototype.render.apply(this,arguments);let e=mh["template-constructor-search-panel-unsplash"];this.connect_template=mh["template-constructor-search-panel-unsplash-connect"];let o=e({});(0,Ut.default)(o).appendTo(this.$el.find(".search-panel-wrapper")),this.$("a.logo").attr("href",this.params.serviceUrl+this.params.apiCredit),this.$el.addClass(this.params.panelClass).addClass("search-on-center"),this.$imagePopup=this.$(".popup-image"),this.$imagePopup.on("mouseleave",this.hideImagePopup),this.$imagePopup.bind("mousewheel",this.onImagePopupScroll),this.$imagePopup.find(".image").on("mouseup",this.imagePopupClick),this.$(".bottom-menu li").on("click",this.onMenuItemClick),setTimeout(An.default.bind(function(){this.checkAuth(!0)},this),1),this.$(".logged-user .logout").on("click",this.logout),this.$el.on("mouseup",".results",this.onResultsClick)},newSearch:function(e){Wa.prototype.newSearch.apply(this,arguments),this.showSearch(),this.hidePanelTitle(),this.hideBackButton();let o=this.$(".search .search-input").val().trim();this.searchParams.query===o&&!e||this.doSearch(o)},doSearch:function(e){this.searchParams={query:e,page:1},this.clearResults(),this.makeSearchRequest()},recalcImagesSizes:function(e){let o=[],t=-this.params.imagePadding,r=this.$(".results").width(),i=this,n=!0;this.$(".results .image").each(An.default.bind(function(l,c){let d=(0,Ut.default)(c).data("width"),p=(0,Ut.default)(c).data("height"),m=this.params.imageHeight/p,u=Math.ceil(d*m);u<this.params.imageHeight*this.params.imageMinWidth&&(u=Math.floor(this.params.imageHeight*this.params.imageMinWidth)),u>this.params.imageHeight*this.params.imageMaxWidth&&(u=Math.floor(this.params.imageHeight*this.params.imageMaxWidth)),t+u+this.params.imagePadding>r&&(n=!1,s(o,t,!1),t=-this.params.imagePadding,o=[]),o.push({img:(0,Ut.default)(c),new_w:u}),t+=u+this.params.imagePadding},this)),s(o,t,!0,e);function s(l,c,d,p){if(l.length==0)return;let m=Math.floor((r-c)/l.length),u=(r-c)%l.length,g=0;d&&(m=0,u=0),An.default.each(l,function(h){g++,h.new_w+=m,g<=u&&(h.new_w+=1),h.img.css({height:i.params.imageHeight,width:h.new_w,"margin-bottom":d?0:i.params.imagePadding,"margin-right":g==l.length?0:i.params.imagePadding,display:d&&!n&&!p?"none":"block"})})}},clearResults:function(){this.$(".results .connect-wrapper").remove(),this.$(".results .image").remove(),this.$(".results .collection").remove(),this.hidePreloader(),this.hideMessage(),this.scroll&&this.scroll.recalc()},renderImage:function(e){let o=e.urls.raw+"?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&h=200&fit=max&s=1897f83cf25fe8a8fd14ea067685731b",t=e.urls.raw;Math.max(e.width,e.height)>this.params.maxImageSize&&(e.width>e.height?t+="?ixlib=rb-0.3.5&q=90&fm=jpg&crop=entropy&cs=tinysrgb&w="+this.params.maxImageSize+"&fit=max&s=1897f83cf25fe8a8fd14ea067685731b":t+="?ixlib=rb-0.3.5&q=90&fm=jpg&crop=entropy&cs=tinysrgb&h="+this.params.maxImageSize+"&fit=max&s=1897f83cf25fe8a8fd14ea067685731b"),(0,Ut.default)("<div></div>").addClass("image").data("width",e.width).data("height",e.height).data("id",e.id).data("ownername",e.user.name).data("src",t).data("download-url",e.links.download_location).data("src-thumb",o).css({"background-image":'url("'+o+'")'}).on("mouseenter",this.onImageMouseEnter).on("mouseleave",this.onImageMouseLeave).insertBefore(this.$(".results .preloader-wrapper"))},renderCollection:function(e){let o=mh["template-constructor-search-panel-unsplash-collection"];(0,Ut.default)(o({collection:e})).on("click",this.onCollectionClick).data("collection-name",e.title).insertBefore(this.$(".results .preloader-wrapper"))},makeSearchRequest:function(){this.showPreloader(),this.requestInAction=!0;let e=this.searchParams.type||"search",o={page:this.searchParams.page||1,per_page:this.params.per_page},t={params:o,method:e};e==="search"&&(o.query=this.searchParams.query),e==="my-collection-photos"&&(t.collectionId=this.searchParams.collectionId),Ut.default.ajax({method:"POST",url:"/api/authservice/unsplash/call",context:this,data:t,success:function(r){let i=r.results||r;if(e=="my-collections"&&this.searchParams.type=="my-collections"&&(i=i.filter(function(s){return!!s.total_photos}),this.showPanelTitle(i.length+" Collection"+(i.length!==1?"s":""))),!i||!i.length&&this.searchParams.page==1){this.clearResults(),this.showMessage.apply(this,this.noResultsText[e]),this.searchParams.text="",this.requestInAction=!1;return}this.requestInAction=!1,r.total_pages?this.searchParams.allPages=r.total_pages<=this.searchParams.page:this.searchParams.allPages=i.length<this.params.per_page,this.searchParams.page++;let n=this.searchParams.type!=="my-collections"?this.renderImage:this.renderCollection;An.default.each(i,n.bind(this)),this.recalcImagesSizes(this.searchParams.allPages),this.hidePreloader(),this.scroll&&this.scroll.recalc()},error:function(){this.clearResults(),this.showMessage("Oops, an error occured.","Please, try again."),this.searchParams.text="",this.requestInAction=!1}})},setFocusOnShow:function(){this.curMenuItem==="search"&&Wa.prototype.setFocusOnShow.apply(this,arguments)},showUserImages:function(e){if(this.clearResults(),e!=="search"?this.hideSearch():this.showSearch(),e==="my-photos"?this.showPanelTitle("My Photos"):e!=="my-collection-photos"&&this.hidePanelTitle(),e!=="my-collection-photos"?this.hideBackButton():(this.$(".my-collections").addClass("my-collections-inside"),this.showBackButton()),this.authorized)this.searchParams.type=e,this.searchParams.page=1,this.makeSearchRequest();else{let o=this.connect_template({});(0,Ut.default)(o).appendTo(this.$(".results")),this.$(".connect-button").on("click",An.default.bind(function(){this.checkAuth(!1)},this))}},onCollectionClick:function(e){let o=(0,Ut.default)(e.currentTarget);this.searchParams.collectionId=o.data("collection"),this.showPanelTitle(o.data("collection-name")),this.showUserImages("my-collection-photos")},onMenuItemClick:function(e){let o=(0,Ut.default)(e.currentTarget),t=o.data("item");if(!(o.hasClass("active")&&(t!=="my-collections"||this.searchParams.type!="my-collection-photos"))){if(this.curMenuItem=t,this.$(".bottom-menu li").removeClass("active"),this.$(".my-collections").removeClass("my-collections-inside"),o.addClass("active"),this.$(".search").toggleClass("inactive",this.curMenuItem==="my-photos"||this.curMenuItem==="my-collections"),this.clearResults(),this.curMenuItem==="search"){this.newSearch(!0),setTimeout(this.setFocusOnShow.bind(this),0);return}this.$el.hasClass("search-on-center")&&(this.$el.removeClass("search-on-center"),this.onInputChanged()),this.showUserImages(this.curMenuItem)}},onBackButtonClick:function(){this.showUserImages("my-collections")},onImageMouseEnter:function(e){clearTimeout(this.imagePopupTimeout),clearTimeout(this.imagePreviewTimeout),this.imagePopupTimeout=setTimeout(An.default.bind(function(){this.showImagePopup(e)},this),500),this.settings.preview&&(this.imagePreviewTimeout=setTimeout(An.default.bind(function(){this.settings.preview((0,Ut.default)(e.currentTarget).data("src-thumb"),{success:function(){this.settings.preview((0,Ut.default)(e.currentTarget).data("src"))}.bind(this)})},this),200))},onImageMouseLeave:function(){clearTimeout(this.imagePopupTimeout),clearTimeout(this.imagePreviewTimeout)},hideImagePopup:function(){this.$curImagePopup=null,this.$imagePopup.fadeOut(100)},onImagePopupScroll:function(e,o,t,r){this.$(".scroll-wrapper .results-wrapper").trigger(e,o,t,r),this.hideImagePopup()},showImagePopup:function(e){let o=(0,Ut.default)((0,Ut.default)(e.target).closest(".image")),t=parseInt(o.width(),10);this.$curImagePopup=o,this.$imagePopup.find(".image *").remove(),o.find(".rmpreloader").clone().appendTo(this.$imagePopup.find(".image")),o.find(".error").clone().appendTo(this.$imagePopup.find(".image")),this.$imagePopup.find(".image").css({width:t,"margin-left":0,height:o.css("height"),"background-image":o.css("background-image")});let r="https://unsplash.com/photos/"+o.data("id")+this.params.apiCredit;this.$imagePopup.find(".source").attr("href",r).text(o.data("ownername")),this.$imagePopup.fadeIn(100);let i=parseInt(this.$imagePopup.width(),10),n=Math.floor(i-t)/2,s=o.offset().left-this.$el.offset().left-n-8,l=o.offset().top-this.$el.offset().top-8;this.$imagePopup.css({left:s,top:l}),this.$imagePopup.find(".image").css({"margin-left":n})},onScroll:function(e){Wa.prototype.onScroll.apply(this,arguments),this.$(".results .image").length&&(e.scroll_event&&this.hideImagePopup(),e.content_size-e.container_size-e.scroll_pos<32&&(this.requestInAction||this.searchParams.allPages||this.makeSearchRequest()))},checkAuth:function(e){if(e)Ut.default.ajax({url:"/api/authservice/unsplash/check",method:"GET",success:this.showSearchTools,context:this,global:!1});else if(!this.authorized){this.unsplashAuthWindow&&this.unsplashAuthWindow.close(),(0,Ut.default)(window).on("message",this.processWindowMessage);let o=screen.width,t=screen.height,r=Math.min(1e3,o),i=Math.min(700,t-40),n=Math.ceil((o-r)/2),s=Math.ceil((t-i)/2);this.unsplashAuthWindow=window.open("/api/authservice/unsplash/authorize","_blank",["toolbar=no","location="+(window.opera?"no":"yes"),"directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no","width="+r,"height="+i,"top="+s,"left="+n].join())}},logout:function(){this.logoutInProgress||(this.logoutInProgress=!0,Ut.default.get("/api/authservice/unsplash/logout",An.default.bind(function(){this.$(".logged-user").css("display","none"),this.authorized=!1,(this.curMenuItem=="my-photos"||this.curMenuItem=="my-collections")&&this.showUserImages(this.curMenuItem),this.logoutInProgress=!1},this)))},handleAuthResult:function(e){e&&!e.error&&e.profile&&this.showSearchTools()},showSearchTools:function(){this.authorized=!0,Ut.default.ajax({url:"/api/authservice/unsplash/call",method:"POST",data:{method:"my"},context:this,global:!1,success:function(e){if(!e)return;this.$(".logged-user").css("display","block"),this.$(".logged-user .userpic").css("background-image",'url("'+e.profile_image.small+'")');let o=e.name&&(e.name.first_name||""+e.name.last_name)||""||e.username;o&&this.$(".logged-user .userpic").attr("title",o).attr("href","https://unsplash.com/@"+e.username+"/likes"),this.authorized=!0,(this.curMenuItem=="my-photos"||this.curMenuItem=="my-collections")&&this.showUserImages(this.curMenuItem)}})},processWindowMessage:function(e){let o;if(e=e.originalEvent||{},e.origin==le.readymag_auth_host){try{o=JSON.parse(decodeURIComponent(e.data))}catch{}o&&o.event=="social-auth"&&((0,Ut.default)(window).off("message",this.processWindowMessage),this.unsplashAuthWindow&&this.unsplashAuthWindow.close(),this.unsplashAuthWindow=null,this.handleAuthResult(o.message))}},imagePopupClick:function(){this.selectImage(this.$curImagePopup)},selectImage:function(e){e&&(this.selectedImage=e.data("src"),this.selectedImageDownloadUrl=e.data("download-url"),this.$lastSelectedImage=e,this.hide())},onResultsClick:function(e){let o=(0,Ut.default)(e.target);o.hasClass("image")&&this.selectImage(o)},requestUnsplashDownloadUrl:function(){Ut.default.ajax({url:"/api/authservice/unsplash/call",method:"POST",data:{method:"download",url:this.selectedImageDownloadUrl}})},hide:function(){let e=function(){Wa.prototype.hide.apply(this,arguments),clearTimeout(this.imagePopupTimeout),clearTimeout(this.imagePreviewTimeout),this.hideImagePopup(),typeof this.settings.upload=="function"&&this.selectedImage&&(this.requestUnsplashDownloadUrl(),this.settings.upload(this.selectedImage)),(0,Ut.default)(window).off("message",this.processWindowMessage)}.bind(this);this.settings.preview&&!this.$lastSelectedImage?this.settings.preview("",{success:e,error:e}):e()}});(0,Ut.default)(function(){RM.views.searchUnsplash=new oW});Modernizr.webkit||Modernizr.firefox||(window.location.href="/sorry");jy.setSupportedFormats();co.directive("sortable",{inserted:function(e,o){e._sortable=new O6.default(e,o.value||{})},componentUpdated:function(e,o){}});(0,px.default)(function(){Nk(),window.Backbone=Fk(D6.default),Mt.preloadShortList(),Mt.generateCSS("paragraph","constructor",document,window.ServerData.editParams.paragraph_styles),Mt.generateCSS("link","constructor",document,window.ServerData.editParams.link_styles),window.RM.constructorRouter=new E6,window.Backbone.history.universalStart({pushState:!0}),px.default.ajaxPrefilter(e=>{e.url?.startsWith("/api")&&(e.headers={...e.headers,[le.RMVersionHeader]:le.RELEASE})})});
